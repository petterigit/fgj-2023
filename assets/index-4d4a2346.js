var Ia=Object.defineProperty;var Ra=(p,y,f)=>y in p?Ia(p,y,{enumerable:!0,configurable:!0,writable:!0,value:f}):p[y]=f;var jt=(p,y,f)=>(Ra(p,typeof y!="symbol"?y+"":y,f),f);(function(){const y=document.createElement("link").relList;if(y&&y.supports&&y.supports("modulepreload"))return;for(const m of document.querySelectorAll('link[rel="modulepreload"]'))w(m);new MutationObserver(m=>{for(const b of m)if(b.type==="childList")for(const T of b.addedNodes)T.tagName==="LINK"&&T.rel==="modulepreload"&&w(T)}).observe(document,{childList:!0,subtree:!0});function f(m){const b={};return m.integrity&&(b.integrity=m.integrity),m.referrerpolicy&&(b.referrerPolicy=m.referrerpolicy),m.crossorigin==="use-credentials"?b.credentials="include":m.crossorigin==="anonymous"?b.credentials="omit":b.credentials="same-origin",b}function w(m){if(m.ep)return;m.ep=!0;const b=f(m);fetch(m.href,b)}})();/*!
 * excalibur - 0.28.0-alpha.627+4b1f36b - 2023-2-2
 * https://github.com/excaliburjs/Excalibur
 * Copyright (c) 2023 Excalibur.js <https://github.com/excaliburjs/Excalibur/graphs/contributors>
 * Licensed BSD-2-Clause
 * @preserve
 */var Ba={4662:(p,y,f)=>{f(3430);var w=f(8791);p.exports=w("Array","sort")},8343:(p,y,f)=>{f(4769);var w=f(9276);p.exports=w.Object.keys},7111:(p,y,f)=>{var w=f(6733),m=f(9821),b=TypeError;p.exports=function(T){if(w(T))return T;throw b(m(T)+" is not a function")}},1176:(p,y,f)=>{var w=f(5052),m=String,b=TypeError;p.exports=function(T){if(w(T))return T;throw b(m(T)+" is not an object")}},9540:(p,y,f)=>{var w=f(905),m=f(3231),b=f(9646),T=function(P){return function(M,R,F){var X=w(M),E=b(X),A=m(F,E),L;if(P&&R!=R){for(;E>A;)if(L=X[A++],L!=L)return!0}else for(;E>A;A++)if((P||A in X)&&X[A]===R)return P||A||0;return!P&&-1}};p.exports={includes:T(!0),indexOf:T(!1)}},6038:(p,y,f)=>{var w=f(4229);p.exports=function(m,b){var T=[][m];return!!T&&w(function(){T.call(null,b||function(){return 1},1)})}},9794:(p,y,f)=>{var w=f(3231),m=f(9646),b=f(2324),T=Array,P=Math.max;p.exports=function(M,R,F){for(var X=m(M),E=w(R,X),A=w(F===void 0?X:F,X),L=T(P(A-E,0)),V=0;E<A;E++,V++)b(L,V,M[E]);return L.length=V,L}},3867:(p,y,f)=>{var w=f(9794),m=Math.floor,b=function(M,R){var F=M.length,X=m(F/2);return F<8?T(M,R):P(M,b(w(M,0,X),R),b(w(M,X),R),R)},T=function(M,R){for(var F=M.length,X=1,E,A;X<F;){for(A=X,E=M[X];A&&R(M[A-1],E)>0;)M[A]=M[--A];A!==X++&&(M[A]=E)}return M},P=function(M,R,F,X){for(var E=R.length,A=F.length,L=0,V=0;L<E||V<A;)M[L+V]=L<E&&V<A?X(R[L],F[V])<=0?R[L++]:F[V++]:L<E?R[L++]:F[V++];return M};p.exports=b},7079:(p,y,f)=>{var w=f(5968),m=w({}.toString),b=w("".slice);p.exports=function(T){return b(m(T),8,-1)}},1589:(p,y,f)=>{var w=f(1601),m=f(6733),b=f(7079),T=f(95),P=T("toStringTag"),M=Object,R=b(function(){return arguments}())=="Arguments",F=function(X,E){try{return X[E]}catch{}};p.exports=w?b:function(X){var E,A,L;return X===void 0?"Undefined":X===null?"Null":typeof(A=F(E=M(X),P))=="string"?A:R?b(E):(L=b(E))=="Object"&&m(E.callee)?"Arguments":L}},7081:(p,y,f)=>{var w=f(8270),m=f(4826),b=f(7933),T=f(1787);p.exports=function(P,M,R){for(var F=m(M),X=T.f,E=b.f,A=0;A<F.length;A++){var L=F[A];!w(P,L)&&!(R&&w(R,L))&&X(P,L,E(M,L))}}},5762:(p,y,f)=>{var w=f(7400),m=f(1787),b=f(5358);p.exports=w?function(T,P,M){return m.f(T,P,b(1,M))}:function(T,P,M){return T[P]=M,T}},5358:p=>{p.exports=function(y,f){return{enumerable:!(y&1),configurable:!(y&2),writable:!(y&4),value:f}}},2324:(p,y,f)=>{var w=f(9310),m=f(1787),b=f(5358);p.exports=function(T,P,M){var R=w(P);R in T?m.f(T,R,b(0,M)):T[R]=M}},4768:(p,y,f)=>{var w=f(6733),m=f(1787),b=f(6039),T=f(8400);p.exports=function(P,M,R,F){F||(F={});var X=F.enumerable,E=F.name!==void 0?F.name:M;if(w(R)&&b(R,E,F),F.global)X?P[M]=R:T(M,R);else{try{F.unsafe?P[M]&&(X=!0):delete P[M]}catch{}X?P[M]=R:m.f(P,M,{value:R,enumerable:!1,configurable:!F.nonConfigurable,writable:!F.nonWritable})}return P}},8400:(p,y,f)=>{var w=f(9859),m=Object.defineProperty;p.exports=function(b,T){try{m(w,b,{value:T,configurable:!0,writable:!0})}catch{w[b]=T}return T}},9563:(p,y,f)=>{var w=f(9821),m=TypeError;p.exports=function(b,T){if(!delete b[T])throw m("Cannot delete property "+w(T)+" of "+w(b))}},7400:(p,y,f)=>{var w=f(4229);p.exports=!w(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!=7})},3777:p=>{var y=typeof document=="object"&&document.all,f=typeof y>"u"&&y!==void 0;p.exports={all:y,IS_HTMLDDA:f}},2635:(p,y,f)=>{var w=f(9859),m=f(5052),b=w.document,T=m(b)&&m(b.createElement);p.exports=function(P){return T?b.createElement(P):{}}},2671:(p,y,f)=>{var w=f(598),m=w.match(/firefox\/(\d+)/i);p.exports=!!m&&+m[1]},8506:(p,y,f)=>{var w=f(598);p.exports=/MSIE|Trident/.test(w)},598:p=>{p.exports=typeof navigator<"u"&&String(navigator.userAgent)||""},6358:(p,y,f)=>{var w=f(9859),m=f(598),b=w.process,T=w.Deno,P=b&&b.versions||T&&T.version,M=P&&P.v8,R,F;M&&(R=M.split("."),F=R[0]>0&&R[0]<4?1:+(R[0]+R[1])),!F&&m&&(R=m.match(/Edge\/(\d+)/),(!R||R[1]>=74)&&(R=m.match(/Chrome\/(\d+)/),R&&(F=+R[1]))),p.exports=F},9811:(p,y,f)=>{var w=f(598),m=w.match(/AppleWebKit\/(\d+)\./);p.exports=!!m&&+m[1]},8791:(p,y,f)=>{var w=f(9859),m=f(5968);p.exports=function(b,T){return m(w[b].prototype[T])}},3837:p=>{p.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},3103:(p,y,f)=>{var w=f(9859),m=f(7933).f,b=f(5762),T=f(4768),P=f(8400),M=f(7081),R=f(6541);p.exports=function(F,X){var E=F.target,A=F.global,L=F.stat,V,W,Q,rt,J,k;if(A?W=w:L?W=w[E]||P(E,{}):W=(w[E]||{}).prototype,W)for(Q in X){if(J=X[Q],F.dontCallGetSet?(k=m(W,Q),rt=k&&k.value):rt=W[Q],V=R(A?Q:E+(L?".":"#")+Q,F.forced),!V&&rt!==void 0){if(typeof J==typeof rt)continue;M(J,rt)}(F.sham||rt&&rt.sham)&&b(J,"sham",!0),T(W,Q,J,F)}}},4229:p=>{p.exports=function(y){try{return!!y()}catch{return!0}}},7188:(p,y,f)=>{var w=f(4229);p.exports=!w(function(){var m=function(){}.bind();return typeof m!="function"||m.hasOwnProperty("prototype")})},266:(p,y,f)=>{var w=f(7188),m=Function.prototype.call;p.exports=w?m.bind(m):function(){return m.apply(m,arguments)}},1805:(p,y,f)=>{var w=f(7400),m=f(8270),b=Function.prototype,T=w&&Object.getOwnPropertyDescriptor,P=m(b,"name"),M=P&&function(){}.name==="something",R=P&&(!w||w&&T(b,"name").configurable);p.exports={EXISTS:P,PROPER:M,CONFIGURABLE:R}},5968:(p,y,f)=>{var w=f(7188),m=Function.prototype,b=m.call,T=w&&m.bind.bind(b,b);p.exports=w?T:function(P){return function(){return b.apply(P,arguments)}}},1333:(p,y,f)=>{var w=f(9859),m=f(6733),b=function(T){return m(T)?T:void 0};p.exports=function(T,P){return arguments.length<2?b(w[T]):w[T]&&w[T][P]}},5300:(p,y,f)=>{var w=f(7111),m=f(9650);p.exports=function(b,T){var P=b[T];return m(P)?void 0:w(P)}},9859:(p,y,f)=>{var w=function(m){return m&&m.Math==Math&&m};p.exports=w(typeof globalThis=="object"&&globalThis)||w(typeof window=="object"&&window)||w(typeof self=="object"&&self)||w(typeof f.g=="object"&&f.g)||function(){return this}()||Function("return this")()},8270:(p,y,f)=>{var w=f(5968),m=f(2991),b=w({}.hasOwnProperty);p.exports=Object.hasOwn||function(P,M){return b(m(P),M)}},5977:p=>{p.exports={}},4394:(p,y,f)=>{var w=f(7400),m=f(4229),b=f(2635);p.exports=!w&&!m(function(){return Object.defineProperty(b("div"),"a",{get:function(){return 7}}).a!=7})},9337:(p,y,f)=>{var w=f(5968),m=f(4229),b=f(7079),T=Object,P=w("".split);p.exports=m(function(){return!T("z").propertyIsEnumerable(0)})?function(M){return b(M)=="String"?P(M,""):T(M)}:T},8511:(p,y,f)=>{var w=f(5968),m=f(6733),b=f(5353),T=w(Function.toString);m(b.inspectSource)||(b.inspectSource=function(P){return T(P)}),p.exports=b.inspectSource},6407:(p,y,f)=>{var w=f(1180),m=f(9859),b=f(5052),T=f(5762),P=f(8270),M=f(5353),R=f(4399),F=f(5977),X="Object already initialized",E=m.TypeError,A=m.WeakMap,L,V,W,Q=function(B){return W(B)?V(B):L(B,{})},rt=function(B){return function(tt){var Y;if(!b(tt)||(Y=V(tt)).type!==B)throw E("Incompatible receiver, "+B+" required");return Y}};if(w||M.state){var J=M.state||(M.state=new A);J.get=J.get,J.has=J.has,J.set=J.set,L=function(B,tt){if(J.has(B))throw E(X);return tt.facade=B,J.set(B,tt),tt},V=function(B){return J.get(B)||{}},W=function(B){return J.has(B)}}else{var k=R("state");F[k]=!0,L=function(B,tt){if(P(B,k))throw E(X);return tt.facade=B,T(B,k,tt),tt},V=function(B){return P(B,k)?B[k]:{}},W=function(B){return P(B,k)}}p.exports={set:L,get:V,has:W,enforce:Q,getterFor:rt}},6733:(p,y,f)=>{var w=f(3777),m=w.all;p.exports=w.IS_HTMLDDA?function(b){return typeof b=="function"||b===m}:function(b){return typeof b=="function"}},6541:(p,y,f)=>{var w=f(4229),m=f(6733),b=/#|\.prototype\./,T=function(X,E){var A=M[P(X)];return A==F?!0:A==R?!1:m(E)?w(E):!!E},P=T.normalize=function(X){return String(X).replace(b,".").toLowerCase()},M=T.data={},R=T.NATIVE="N",F=T.POLYFILL="P";p.exports=T},9650:p=>{p.exports=function(y){return y==null}},5052:(p,y,f)=>{var w=f(6733),m=f(3777),b=m.all;p.exports=m.IS_HTMLDDA?function(T){return typeof T=="object"?T!==null:w(T)||T===b}:function(T){return typeof T=="object"?T!==null:w(T)}},4231:p=>{p.exports=!1},9395:(p,y,f)=>{var w=f(1333),m=f(6733),b=f(1321),T=f(6969),P=Object;p.exports=T?function(M){return typeof M=="symbol"}:function(M){var R=w("Symbol");return m(R)&&b(R.prototype,P(M))}},9646:(p,y,f)=>{var w=f(4237);p.exports=function(m){return w(m.length)}},6039:(p,y,f)=>{var w=f(5968),m=f(4229),b=f(6733),T=f(8270),P=f(7400),M=f(1805).CONFIGURABLE,R=f(8511),F=f(6407),X=F.enforce,E=F.get,A=String,L=Object.defineProperty,V=w("".slice),W=w("".replace),Q=w([].join),rt=P&&!m(function(){return L(function(){},"length",{value:8}).length!==8}),J=String(String).split("String"),k=p.exports=function(B,tt,Y){V(A(tt),0,7)==="Symbol("&&(tt="["+W(A(tt),/^Symbol\(([^)]*)\)/,"$1")+"]"),Y&&Y.getter&&(tt="get "+tt),Y&&Y.setter&&(tt="set "+tt),(!T(B,"name")||M&&B.name!==tt)&&(P?L(B,"name",{value:tt,configurable:!0}):B.name=tt),rt&&Y&&T(Y,"arity")&&B.length!==Y.arity&&L(B,"length",{value:Y.arity});try{Y&&T(Y,"constructor")&&Y.constructor?P&&L(B,"prototype",{writable:!1}):B.prototype&&(B.prototype=void 0)}catch{}var ut=X(B);return T(ut,"source")||(ut.source=Q(J,typeof tt=="string"?tt:"")),B};Function.prototype.toString=k(function(){return b(this)&&E(this).source||R(this)},"toString")},917:p=>{var y=Math.ceil,f=Math.floor;p.exports=Math.trunc||function(m){var b=+m;return(b>0?f:y)(b)}},1787:(p,y,f)=>{var w=f(7400),m=f(4394),b=f(7137),T=f(1176),P=f(9310),M=TypeError,R=Object.defineProperty,F=Object.getOwnPropertyDescriptor,X="enumerable",E="configurable",A="writable";y.f=w?b?function(V,W,Q){if(T(V),W=P(W),T(Q),typeof V=="function"&&W==="prototype"&&"value"in Q&&A in Q&&!Q[A]){var rt=F(V,W);rt&&rt[A]&&(V[W]=Q.value,Q={configurable:E in Q?Q[E]:rt[E],enumerable:X in Q?Q[X]:rt[X],writable:!1})}return R(V,W,Q)}:R:function(V,W,Q){if(T(V),W=P(W),T(Q),m)try{return R(V,W,Q)}catch{}if("get"in Q||"set"in Q)throw M("Accessors not supported");return"value"in Q&&(V[W]=Q.value),V}},7933:(p,y,f)=>{var w=f(7400),m=f(266),b=f(9195),T=f(5358),P=f(905),M=f(9310),R=f(8270),F=f(4394),X=Object.getOwnPropertyDescriptor;y.f=w?X:function(A,L){if(A=P(A),L=M(L),F)try{return X(A,L)}catch{}if(R(A,L))return T(!m(b.f,A,L),A[L])}},8151:(p,y,f)=>{var w=f(140),m=f(3837),b=m.concat("length","prototype");y.f=Object.getOwnPropertyNames||function(P){return w(P,b)}},894:(p,y)=>{y.f=Object.getOwnPropertySymbols},1321:(p,y,f)=>{var w=f(5968);p.exports=w({}.isPrototypeOf)},140:(p,y,f)=>{var w=f(5968),m=f(8270),b=f(905),T=f(9540).indexOf,P=f(5977),M=w([].push);p.exports=function(R,F){var X=b(R),E=0,A=[],L;for(L in X)!m(P,L)&&m(X,L)&&M(A,L);for(;F.length>E;)m(X,L=F[E++])&&(~T(A,L)||M(A,L));return A}},5632:(p,y,f)=>{var w=f(140),m=f(3837);p.exports=Object.keys||function(T){return w(T,m)}},9195:(p,y)=>{var f={}.propertyIsEnumerable,w=Object.getOwnPropertyDescriptor,m=w&&!f.call({1:2},1);y.f=m?function(T){var P=w(this,T);return!!P&&P.enumerable}:f},2914:(p,y,f)=>{var w=f(266),m=f(6733),b=f(5052),T=TypeError;p.exports=function(P,M){var R,F;if(M==="string"&&m(R=P.toString)&&!b(F=w(R,P))||m(R=P.valueOf)&&!b(F=w(R,P))||M!=="string"&&m(R=P.toString)&&!b(F=w(R,P)))return F;throw T("Can't convert object to primitive value")}},4826:(p,y,f)=>{var w=f(1333),m=f(5968),b=f(8151),T=f(894),P=f(1176),M=m([].concat);p.exports=w("Reflect","ownKeys")||function(F){var X=b.f(P(F)),E=T.f;return E?M(X,E(F)):X}},9276:(p,y,f)=>{var w=f(9859);p.exports=w},8885:(p,y,f)=>{var w=f(9650),m=TypeError;p.exports=function(b){if(w(b))throw m("Can't call method on "+b);return b}},4399:(p,y,f)=>{var w=f(3036),m=f(1441),b=w("keys");p.exports=function(T){return b[T]||(b[T]=m(T))}},5353:(p,y,f)=>{var w=f(9859),m=f(8400),b="__core-js_shared__",T=w[b]||m(b,{});p.exports=T},3036:(p,y,f)=>{var w=f(4231),m=f(5353);(p.exports=function(b,T){return m[b]||(m[b]=T!==void 0?T:{})})("versions",[]).push({version:"3.27.2",mode:w?"pure":"global",copyright:"© 2014-2023 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.27.2/LICENSE",source:"https://github.com/zloirock/core-js"})},4860:(p,y,f)=>{var w=f(6358),m=f(4229);p.exports=!!Object.getOwnPropertySymbols&&!m(function(){var b=Symbol();return!String(b)||!(Object(b)instanceof Symbol)||!Symbol.sham&&w&&w<41})},3231:(p,y,f)=>{var w=f(3329),m=Math.max,b=Math.min;p.exports=function(T,P){var M=w(T);return M<0?m(M+P,0):b(M,P)}},905:(p,y,f)=>{var w=f(9337),m=f(8885);p.exports=function(b){return w(m(b))}},3329:(p,y,f)=>{var w=f(917);p.exports=function(m){var b=+m;return b!==b||b===0?0:w(b)}},4237:(p,y,f)=>{var w=f(3329),m=Math.min;p.exports=function(b){return b>0?m(w(b),9007199254740991):0}},2991:(p,y,f)=>{var w=f(8885),m=Object;p.exports=function(b){return m(w(b))}},2066:(p,y,f)=>{var w=f(266),m=f(5052),b=f(9395),T=f(5300),P=f(2914),M=f(95),R=TypeError,F=M("toPrimitive");p.exports=function(X,E){if(!m(X)||b(X))return X;var A=T(X,F),L;if(A){if(E===void 0&&(E="default"),L=w(A,X,E),!m(L)||b(L))return L;throw R("Can't convert object to primitive value")}return E===void 0&&(E="number"),P(X,E)}},9310:(p,y,f)=>{var w=f(2066),m=f(9395);p.exports=function(b){var T=w(b,"string");return m(T)?T:T+""}},1601:(p,y,f)=>{var w=f(95),m=w("toStringTag"),b={};b[m]="z",p.exports=String(b)==="[object z]"},3326:(p,y,f)=>{var w=f(1589),m=String;p.exports=function(b){if(w(b)==="Symbol")throw TypeError("Cannot convert a Symbol value to a string");return m(b)}},9821:p=>{var y=String;p.exports=function(f){try{return y(f)}catch{return"Object"}}},1441:(p,y,f)=>{var w=f(5968),m=0,b=Math.random(),T=w(1 .toString);p.exports=function(P){return"Symbol("+(P===void 0?"":P)+")_"+T(++m+b,36)}},6969:(p,y,f)=>{var w=f(4860);p.exports=w&&!Symbol.sham&&typeof Symbol.iterator=="symbol"},7137:(p,y,f)=>{var w=f(7400),m=f(4229);p.exports=w&&m(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!=42})},1180:(p,y,f)=>{var w=f(9859),m=f(6733),b=w.WeakMap;p.exports=m(b)&&/native code/.test(String(b))},95:(p,y,f)=>{var w=f(9859),m=f(3036),b=f(8270),T=f(1441),P=f(4860),M=f(6969),R=w.Symbol,F=m("wks"),X=M?R.for||R:R&&R.withoutSetter||T;p.exports=function(E){return b(F,E)||(F[E]=P&&b(R,E)?R[E]:X("Symbol."+E)),F[E]}},3430:(p,y,f)=>{var w=f(3103),m=f(5968),b=f(7111),T=f(2991),P=f(9646),M=f(9563),R=f(3326),F=f(4229),X=f(3867),E=f(6038),A=f(2671),L=f(8506),V=f(6358),W=f(9811),Q=[],rt=m(Q.sort),J=m(Q.push),k=F(function(){Q.sort(void 0)}),B=F(function(){Q.sort(null)}),tt=E("sort"),Y=!F(function(){if(V)return V<70;if(!(A&&A>3)){if(L)return!0;if(W)return W<603;var j="",mt,ht,nt,Ft;for(mt=65;mt<76;mt++){switch(ht=String.fromCharCode(mt),mt){case 66:case 69:case 70:case 72:nt=3;break;case 68:case 71:nt=4;break;default:nt=2}for(Ft=0;Ft<47;Ft++)Q.push({k:ht+Ft,v:nt})}for(Q.sort(function(ce,qt){return qt.v-ce.v}),Ft=0;Ft<Q.length;Ft++)ht=Q[Ft].k.charAt(0),j.charAt(j.length-1)!==ht&&(j+=ht);return j!=="DGBEFHACIJK"}}),ut=k||!B||!tt||!Y,oi=function(j){return function(mt,ht){return ht===void 0?-1:mt===void 0?1:j!==void 0?+j(mt,ht)||0:R(mt)>R(ht)?1:-1}};w({target:"Array",proto:!0,forced:ut},{sort:function(mt){mt!==void 0&&b(mt);var ht=T(this);if(Y)return mt===void 0?rt(ht):rt(ht,mt);var nt=[],Ft=P(ht),ce,qt;for(qt=0;qt<Ft;qt++)qt in ht&&J(nt,ht[qt]);for(X(nt,oi(mt)),ce=P(nt),qt=0;qt<ce;)ht[qt]=nt[qt++];for(;qt<Ft;)M(ht,qt++);return ht}})},4769:(p,y,f)=>{var w=f(3103),m=f(2991),b=f(5632),T=f(4229),P=T(function(){b(1)});w({target:"Object",stat:!0,forced:P},{keys:function(R){return b(m(R))}})},1388:(p,y,f)=>{f.d(y,{Z:()=>M});var w=f(272),m=f.n(w),b=f(2609),T=f.n(b),P=T()(m());P.push([p.id,`/* Buttons styles start */

button#excalibur-play {
  display: inline-block;
  position: relative;
  z-index: 999;
  border-radius: 6px;
  border: none;
  /*border: 3px solid;
    border-color: white;
    box-shadow: 0 0 10px #ccc;*/
  padding: 1rem 1.5rem 1rem 4rem;
  margin: 0;
  text-decoration: none;
  background: #00b233;
  color: #ffffff;
  font-family: sans-serif;
  font-size: 2rem;
  white-space: nowrap;
  line-height: 1;
  cursor: pointer;
  text-align: center;
  transition: background 250ms ease-in-out, transform 150ms ease;
  -webkit-appearance: none;
  -moz-appearance: none;

  -webkit-animation: excalibur-button-fadein 200ms; /* Safari, Chrome and Opera > 12.1 */
  -moz-animation: excalibur-button-fadein 200ms; /* Firefox < 16 */
  -ms-animation: excalibur-button-fadein 200ms; /* Internet Explorer */
  -o-animation: excalibur-button-fadein 200ms; /* Opera < 12.1 */
  animation: excalibur-button-fadein 200ms;
}

/*
button#excalibur-play {
  display: none;
}*/

button#excalibur-play:after {
  position: absolute;
  content: '';
  border: 8px solid;
  border-color: transparent transparent transparent white;
  left: 35px;
  top: 24px;
  width: 0;
  height: 0;
}

button#excalibur-play:before {
  position: absolute;
  content: '';
  border: 3px solid;
  left: 19px;
  top: 14px;
  border-radius: 20px;
  width: 30px;
  height: 30px;
}

button#excalibur-play:hover,
button#excalibur-play:focus {
  background: #00982c;
}

button#excalibur-play:focus {
  outline: 1px solid #fff;
  outline-offset: -4px;
}

button#excalibur-play:active {
  transform: scale(0.99);
}

@keyframes excalibur-button-fadein {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}

/* Firefox < 16 */
@-moz-keyframes excalibur-button-fadein {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}

/* Safari, Chrome and Opera > 12.1 */
@-webkit-keyframes excalibur-button-fadein {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}

/* Internet Explorer */
@-ms-keyframes excalibur-button-fadein {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}

/* Opera < 12.1 */
@-o-keyframes excalibur-button-fadein {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}
`,"",{version:3,sources:["webpack://./Loader.css"],names:[],mappings:"AAAA,yBAAyB;;AAEzB;EACE,qBAAqB;EACrB,kBAAkB;EAClB,YAAY;EACZ,kBAAkB;EAClB,YAAY;EACZ;;+BAE6B;EAC7B,8BAA8B;EAC9B,SAAS;EACT,qBAAqB;EACrB,mBAAmB;EACnB,cAAc;EACd,uBAAuB;EACvB,eAAe;EACf,mBAAmB;EACnB,cAAc;EACd,eAAe;EACf,kBAAkB;EAClB,8DAA8D;EAC9D,wBAAwB;EACxB,qBAAqB;;EAErB,gDAAgD,EAAE,oCAAoC;EACtF,6CAA6C,EAAE,iBAAiB;EAChE,4CAA4C,EAAE,sBAAsB;EACpE,2CAA2C,EAAE,iBAAiB;EAC9D,wCAAwC;AAC1C;;AAEA;;;EAGE;;AAEF;EACE,kBAAkB;EAClB,WAAW;EACX,iBAAiB;EACjB,uDAAuD;EACvD,UAAU;EACV,SAAS;EACT,QAAQ;EACR,SAAS;AACX;;AAEA;EACE,kBAAkB;EAClB,WAAW;EACX,iBAAiB;EACjB,UAAU;EACV,SAAS;EACT,mBAAmB;EACnB,WAAW;EACX,YAAY;AACd;;AAEA;;EAEE,mBAAmB;AACrB;;AAEA;EACE,uBAAuB;EACvB,oBAAoB;AACtB;;AAEA;EACE,sBAAsB;AACxB;;AAEA;EACE;IACE,UAAU;EACZ;EACA;IACE,UAAU;EACZ;AACF;;AAEA,iBAAiB;AACjB;EACE;IACE,UAAU;EACZ;EACA;IACE,UAAU;EACZ;AACF;;AAEA,oCAAoC;AACpC;EACE;IACE,UAAU;EACZ;EACA;IACE,UAAU;EACZ;AACF;;AAEA,sBAAsB;AACtB;EACE;IACE,UAAU;EACZ;EACA;IACE,UAAU;EACZ;AACF;;AAEA,iBAAiB;AACjB;EACE;IACE,UAAU;EACZ;EACA;IACE,UAAU;EACZ;AACF",sourcesContent:[`/* Buttons styles start */

button#excalibur-play {
  display: inline-block;
  position: relative;
  z-index: 999;
  border-radius: 6px;
  border: none;
  /*border: 3px solid;
    border-color: white;
    box-shadow: 0 0 10px #ccc;*/
  padding: 1rem 1.5rem 1rem 4rem;
  margin: 0;
  text-decoration: none;
  background: #00b233;
  color: #ffffff;
  font-family: sans-serif;
  font-size: 2rem;
  white-space: nowrap;
  line-height: 1;
  cursor: pointer;
  text-align: center;
  transition: background 250ms ease-in-out, transform 150ms ease;
  -webkit-appearance: none;
  -moz-appearance: none;

  -webkit-animation: excalibur-button-fadein 200ms; /* Safari, Chrome and Opera > 12.1 */
  -moz-animation: excalibur-button-fadein 200ms; /* Firefox < 16 */
  -ms-animation: excalibur-button-fadein 200ms; /* Internet Explorer */
  -o-animation: excalibur-button-fadein 200ms; /* Opera < 12.1 */
  animation: excalibur-button-fadein 200ms;
}

/*
button#excalibur-play {
  display: none;
}*/

button#excalibur-play:after {
  position: absolute;
  content: '';
  border: 8px solid;
  border-color: transparent transparent transparent white;
  left: 35px;
  top: 24px;
  width: 0;
  height: 0;
}

button#excalibur-play:before {
  position: absolute;
  content: '';
  border: 3px solid;
  left: 19px;
  top: 14px;
  border-radius: 20px;
  width: 30px;
  height: 30px;
}

button#excalibur-play:hover,
button#excalibur-play:focus {
  background: #00982c;
}

button#excalibur-play:focus {
  outline: 1px solid #fff;
  outline-offset: -4px;
}

button#excalibur-play:active {
  transform: scale(0.99);
}

@keyframes excalibur-button-fadein {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}

/* Firefox < 16 */
@-moz-keyframes excalibur-button-fadein {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}

/* Safari, Chrome and Opera > 12.1 */
@-webkit-keyframes excalibur-button-fadein {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}

/* Internet Explorer */
@-ms-keyframes excalibur-button-fadein {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}

/* Opera < 12.1 */
@-o-keyframes excalibur-button-fadein {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}
`],sourceRoot:""}]);const M=P},7379:(p,y,f)=>{f.d(y,{Z:()=>M});var w=f(272),m=f.n(w),b=f(2609),T=f.n(b),P=T()(m());P.push([p.id,`
#ex-toast-container {
  position: absolute;
  height: 0;
  min-width: 50%;
  left: 50%;
  top: 0;
}

.ex-toast-message {
  left: -50%;
  position: relative;
  display: flex;
  justify-content: space-between;


  padding: 10px;
  margin-top: 5px;
  font-size: 18px;
  font-family: sans-serif;
  border-radius: 6px;
  border: 3px solid #b7b779;
  background-color: rgb(253, 253, 192);
}


.ex-toast-message button {
  align-self: flex-start;
}`,"",{version:3,sources:["webpack://./Util/Toaster.css"],names:[],mappings:";AACA;EACE,kBAAkB;EAClB,SAAS;EACT,cAAc;EACd,SAAS;EACT,MAAM;AACR;;AAEA;EACE,UAAU;EACV,kBAAkB;EAClB,aAAa;EACb,8BAA8B;;;EAG9B,aAAa;EACb,eAAe;EACf,eAAe;EACf,uBAAuB;EACvB,kBAAkB;EAClB,yBAAyB;EACzB,oCAAoC;AACtC;;;AAGA;EACE,sBAAsB;AACxB",sourcesContent:[`
#ex-toast-container {
  position: absolute;
  height: 0;
  min-width: 50%;
  left: 50%;
  top: 0;
}

.ex-toast-message {
  left: -50%;
  position: relative;
  display: flex;
  justify-content: space-between;


  padding: 10px;
  margin-top: 5px;
  font-size: 18px;
  font-family: sans-serif;
  border-radius: 6px;
  border: 3px solid #b7b779;
  background-color: rgb(253, 253, 192);
}


.ex-toast-message button {
  align-self: flex-start;
}`],sourceRoot:""}]);const M=P},2609:p=>{p.exports=function(y){var f=[];return f.toString=function(){return this.map(function(m){var b="",T=typeof m[5]<"u";return m[4]&&(b+="@supports (".concat(m[4],") {")),m[2]&&(b+="@media ".concat(m[2]," {")),T&&(b+="@layer".concat(m[5].length>0?" ".concat(m[5]):""," {")),b+=y(m),T&&(b+="}"),m[2]&&(b+="}"),m[4]&&(b+="}"),b}).join("")},f.i=function(m,b,T,P,M){typeof m=="string"&&(m=[[null,m,void 0]]);var R={};if(T)for(var F=0;F<this.length;F++){var X=this[F][0];X!=null&&(R[X]=!0)}for(var E=0;E<m.length;E++){var A=[].concat(m[E]);T&&R[A[0]]||(typeof M<"u"&&(typeof A[5]>"u"||(A[1]="@layer".concat(A[5].length>0?" ".concat(A[5]):""," {").concat(A[1],"}")),A[5]=M),b&&(A[2]&&(A[1]="@media ".concat(A[2]," {").concat(A[1],"}")),A[2]=b),P&&(A[4]?(A[1]="@supports (".concat(A[4],") {").concat(A[1],"}"),A[4]=P):A[4]="".concat(P)),f.push(A))}},f}},272:p=>{p.exports=function(y){var f=y[1],w=y[3];if(!w)return f;if(typeof btoa=="function"){var m=btoa(unescape(encodeURIComponent(JSON.stringify(w)))),b="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(m),T="/*# ".concat(b," */");return[f].concat([T]).join(`
`)}return[f].join(`
`)}}},ca={};function Gt(p){var y=ca[p];if(y!==void 0)return y.exports;var f=ca[p]={id:p,exports:{}};return Ba[p](f,f.exports,Gt),f.exports}Gt.n=p=>{var y=p&&p.__esModule?()=>p.default:()=>p;return Gt.d(y,{a:y}),y};Gt.d=(p,y)=>{for(var f in y)Gt.o(y,f)&&!Gt.o(p,f)&&Object.defineProperty(p,f,{enumerable:!0,get:y[f]})};Gt.g=function(){if(typeof globalThis=="object")return globalThis;try{return this||new Function("return this")()}catch{if(typeof window=="object")return window}}();Gt.o=(p,y)=>Object.prototype.hasOwnProperty.call(p,y);Gt.r=p=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(p,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(p,"__esModule",{value:!0})};var C={};(()=>{Gt.d(C,{fWn:()=>Ps,Ia8:()=>_r,rqv:()=>S,hLI:()=>Ts,yyv:()=>Br,tX5:()=>ws,vtX:()=>gi,r7K:()=>Ui,lCh:()=>uo,cE4:()=>ct,fwF:()=>zi,sce:()=>an,_c7:()=>Me,KUs:()=>Ir,Ajp:()=>is,RDh:()=>Vn,_H9:()=>Vi,mxs:()=>Ar,OmD:()=>vt,kBf:()=>nt,C4F:()=>Di,NQt:()=>un,JjN:()=>Dr,V1s:()=>ho,Xz7:()=>yn,Cdc:()=>nn,FKn:()=>Yt,wTW:()=>Re,SUY:()=>Mr,ab2:()=>en,GfZ:()=>ae,YMS:()=>Fi,oyv:()=>Kt,aUb:()=>os,SdD:()=>pi,JUv:()=>Pe,jEj:()=>G,TFq:()=>De,HDU:()=>Ne,R_y:()=>vs,ydN:()=>ns,t50:()=>Ns,s$$:()=>ti,v2G:()=>dt,Ilk:()=>j,s9i:()=>Ao,dxL:()=>Ni,LLX:()=>yo,wA2:()=>re,R_p:()=>Wt,IQ$:()=>go,I5F:()=>ut,X8$:()=>hs,FR6:()=>Se,U8o:()=>ms,kbG:()=>xe,iS_:()=>Hs,cGG:()=>Fs,RPN:()=>Un,skb:()=>vo,SLU:()=>rr,RdJ:()=>_e,cNu:()=>rn,gU7:()=>dr,LSk:()=>io,Nmp:()=>Mn,d1Y:()=>Ut,xrL:()=>Es,sRW:()=>pr,cmV:()=>la,qWz:()=>In,N0Q:()=>yr,q8b:()=>Mt,ynB:()=>ie,jT9:()=>oo,wAz:()=>Ds,D4V:()=>r,N6H:()=>Ws,W1A:()=>sr,JHW:()=>$t,v2K:()=>Pr,pBf:()=>Pi,GMl:()=>ai,zW2:()=>p,B0K:()=>ys,Nv7:()=>xs,C_p:()=>Ks,iqw:()=>ue,MUA:()=>nr,xqU:()=>Xs,pTp:()=>eo,vUK:()=>T,j9l:()=>Rn,Zxw:()=>Is,v51:()=>Pt,Hdx:()=>Dn,Z$d:()=>Bn,iqV:()=>Po,o$7:()=>Us,olM:()=>Ft,Zm$:()=>pt,$QH:()=>Qi,i78:()=>Ki,h6u:()=>Ke,hts:()=>di,j88:()=>zs,VME:()=>Oe,nt:()=>Vr,Ukr:()=>pn,zsu:()=>ne,oA6:()=>le,TVh:()=>ln,TwZ:()=>Pn,GTT:()=>fr,xxj:()=>mo,XdK:()=>Si,Jmb:()=>te,cXo:()=>vn,Dm5:()=>Ji,IIB:()=>w,zI0:()=>Cs,LYD:()=>Hn,cEG:()=>wo,SEl:()=>x,t9V:()=>_,SKZ:()=>se,__J:()=>c,RI$:()=>lo,x12:()=>$o,ccz:()=>fe,aNw:()=>As,xwn:()=>On,dNK:()=>ro,ini:()=>tt,YdH:()=>Y,y3G:()=>Jt,l57:()=>be,xn0:()=>Cn,t2V:()=>Cr,uxB:()=>Bt,cpd:()=>mi,fiy:()=>vr,$XZ:()=>wr,uqK:()=>Ri,STE:()=>Zr,y$z:()=>ee,mAD:()=>Xn,sOq:()=>oe,hUw:()=>Bs,_0G:()=>O,Sqs:()=>ko,hpZ:()=>hn,Vol:()=>Rr,vYX:()=>Ms,wIZ:()=>ot,cBi:()=>Wn,c30:()=>bo,RFv:()=>as,kfC:()=>wi,mgq:()=>ta,YVA:()=>lt,Kgp:()=>hr,HH$:()=>ui,M_d:()=>Zi,rgh:()=>hi,Ra6:()=>ci,KhR:()=>li,BS5:()=>de,xhz:()=>ze,xOq:()=>fs,a9j:()=>ke,bHk:()=>_s,CgK:()=>Qe,cuY:()=>Ve,kvE:()=>$e,SBu:()=>ts,AE_:()=>Nn,ctO:()=>Tr,OLH:()=>ao,kky:()=>R,nSF:()=>Ht,zHn:()=>_i,zwx:()=>_o,AeJ:()=>sn,hLz:()=>Te,D9g:()=>po,wA:()=>gr,jhr:()=>mr,GVs:()=>es,_zO:()=>Ti,w6$:()=>Tn,mhV:()=>to,MOD:()=>ye,kwd:()=>kn,Lmr:()=>br,xsS:()=>ei,lLr:()=>Zs,Z$r:()=>oi,IXb:()=>Er,SGH:()=>xo,SMj:()=>s,L34:()=>ka,exe:()=>Ie,bnF:()=>Dt,MFA:()=>ht,$uU:()=>pe,jyi:()=>Yi,E03:()=>Gs,V6q:()=>$i,rg2:()=>Fr,DVW:()=>Js,nVo:()=>Ln,F6N:()=>To,xP7:()=>We,Odq:()=>kr,Zif:()=>Ae,ZGJ:()=>En,MJk:()=>Ur,xvT:()=>ls,PHM:()=>ks,dpR:()=>At,n9L:()=>no,KwO:()=>so,B7y:()=>Rs,x7r:()=>l,wx7:()=>rs,Uvn:()=>$,OFT:()=>Mi,xzN:()=>co,M5Z:()=>F,ZrN:()=>m,OWs:()=>k,dF9:()=>$s,oZy:()=>He,rD2:()=>Ii,VHo:()=>gs,ohE:()=>ss,R$E:()=>An,q3I:()=>fo,Pab:()=>L,uZ5:()=>A,McK:()=>P,F9c:()=>X,k0b:()=>Sn,hnT:()=>xt,RSJ:()=>Wi,Mku:()=>Fe,h90:()=>Lr,rms:()=>Zn,ErP:()=>it,aVg:()=>Ce,lPc:()=>Zt,Z8E:()=>Li,_N2:()=>on,yFn:()=>Oi,lNv:()=>$r,cu9:()=>Fn,MZQ:()=>Bi,FUM:()=>ur,BxR:()=>wt,vdf:()=>rt,iaL:()=>J,w6H:()=>Q,Q4c:()=>Jr,Xxe:()=>E,Uxb:()=>V,Yr5:()=>W,Bhw:()=>B,yOA:()=>y});var p={};Gt.r(p),Gt.d(p,{ActivateEvent:()=>ws,CollisionEndEvent:()=>pi,CollisionPostSolveEvent:()=>Ne,CollisionPreSolveEvent:()=>vs,CollisionStartEvent:()=>Ns,ContactEndEvent:()=>Se,ContactStartEvent:()=>ms,DeactivateEvent:()=>Hs,EnterTriggerEvent:()=>Ws,EnterViewPortEvent:()=>sr,EventTypes:()=>ai,ExitTriggerEvent:()=>nr,ExitViewPortEvent:()=>Xs,GameEvent:()=>pt,GameStartEvent:()=>Qi,GameStopEvent:()=>Ki,GamepadAxisEvent:()=>Ke,GamepadButtonEvent:()=>di,GamepadConnectEvent:()=>zs,GamepadDisconnectEvent:()=>Oe,HiddenEvent:()=>Si,InitializeEvent:()=>Ji,KillEvent:()=>se,PostCollisionEvent:()=>ui,PostDebugDrawEvent:()=>Zi,PostDrawEvent:()=>hi,PostFrameEvent:()=>ci,PostKillEvent:()=>li,PostUpdateEvent:()=>de,PreCollisionEvent:()=>ze,PreDebugDrawEvent:()=>fs,PreDrawEvent:()=>ke,PreFrameEvent:()=>_s,PreKillEvent:()=>Qe,PreUpdateEvent:()=>Ve,VisibleEvent:()=>gs});var y={};Gt.r(y),Gt.d(y,{getAttributeComponentSize:()=>or,getAttributePointerType:()=>ar,getGlTypeSizeBytes:()=>wn});var f={};Gt.r(f),Gt.d(f,{circle:()=>fi,line:()=>cr,point:()=>qo,roundRect:()=>xn,vector:()=>jo});var w={};Gt.r(w),Gt.d(w,{Axes:()=>dn,Buttons:()=>cn,Gamepad:()=>Ge,Gamepads:()=>Qn,KeyEvent:()=>qn,Keyboard:()=>jn,Keys:()=>Gn,NativePointerButton:()=>Xi,PointerButton:()=>ii,PointerComponent:()=>as,PointerEvent:()=>fn,PointerEventReceiver:()=>Kn,PointerScope:()=>Hi,PointerSystem:()=>wi,PointerType:()=>si,WheelDeltaMode:()=>Ls,WheelEvent:()=>Co});var m={};Gt.r(m),Gt.d(m,{ConsoleAppender:()=>ut,DrawUtil:()=>f,EasingFunctions:()=>Mt,LogLevel:()=>tt,Logger:()=>Y,Observable:()=>ee,ScreenAppender:()=>oi,addItemToArray:()=>qt,contains:()=>us,delay:()=>_t,fail:()=>Ot,getPosition:()=>ce,removeItemFromArray:()=>Le}),Gt(4662),Gt(8343);function b(){if(typeof window>"u"&&(window={audioContext:function(){}}),typeof window<"u"&&!window.requestAnimationFrame&&(window.requestAnimationFrame=window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(a){window.setInterval(a,1e3/60)}),typeof window<"u"&&!window.cancelAnimationFrame&&(window.cancelAnimationFrame=window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||function(){}),typeof window<"u"&&!window.AudioContext){if(window.webkitAudioContext){const t=window.webkitAudioContext.prototype.decodeAudioData;window.webkitAudioContext.prototype.decodeAudioData=function(e){return new Promise((i,n)=>{t.call(this,e,i,n)})}}window.AudioContext=window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.msAudioContext||window.oAudioContext}typeof window<"u"&&!window.devicePixelRatio&&(window.devicePixelRatio=window.devicePixelRatio||1)}class T{static useCanvasGraphicsContext(){T.enable("use-canvas-context")}static freeze(){T._FROZEN=!0}static _reset(){T._FROZEN=!1,T._FLAGS={}}static enable(t){if(this._FROZEN)throw Error("Feature flags can only be enabled before Engine constructor time");T._FLAGS[t]=!0}static disable(t){if(this._FROZEN)throw Error("Feature flags can only be disabled before Engine constructor time");T._FLAGS[t]=!1}static isEnabled(t){return!!T._FLAGS[t]}static show(){return Object.keys(T._FLAGS)}}T._FROZEN=!1,T._FLAGS={};function P(a,t){return{type:a,value:t}}const M=4294967295;class R{constructor(t){this.seed=t,this._lowerMask=2147483647,this._upperMask=2147483648,this._w=32,this._n=624,this._m=397,this._a=2567483615,this._u=11,this._s=7,this._b=2636928640,this._t=15,this._c=4022730752,this._l=18,this._f=1812433253,this._mt=new Array(this._n),this._mt[0]=(t||Date.now())>>>0;for(let e=1;e<this._n;e++){const i=this._mt[e-1]^this._mt[e-1]>>>this._w-2;this._mt[e]=(this._f*((i&4294901760)>>>16)<<16)+this._f*(i&65535)+e>>>0}this._index=this._n}_twist(){const t=[0,this._a];let e=0,i=0;for(;i<this._n-this._m;i++)e=this._mt[i]&this._upperMask|this._mt[i+1]&this._lowerMask,this._mt[i]=this._mt[i+this._m]^e>>>1^t[e&1]&M;for(;i<this._n-1;i++)e=this._mt[i]&this._upperMask|this._mt[i+1]&this._lowerMask,this._mt[i]=this._mt[i+(this._m-this._n)]^e>>>1^t[e&1]&M;e=this._mt[this._n-1]&this._upperMask|this._mt[0]&this._lowerMask,this._mt[this._n-1]=this._mt[this._m-1]^e>>>1^t[e&1]&M,this._index=0}nextInt(){this._index>=this._n&&this._twist();let t=this._mt[this._index++];return t^=t>>>this._u,t^=t<<this._s&this._b,t^=t<<this._t&this._c,t^=t>>>this._l,t>>>0}next(){return this.nextInt()*(1/4294967296)}floating(t,e){return(e-t)*this.next()+t}integer(t,e){return Math.floor((e-t+1)*this.next()+t)}bool(t=.5){return this.next()<=t}pickOne(t){return t[this.integer(0,t.length-1)]}pickSet(t,e,i=!1){return i?this._pickSetWithDuplicates(t,e):this._pickSetWithoutDuplicates(t,e)}_pickSetWithoutDuplicates(t,e){if(e>t.length||e<0)throw new Error("Invalid number of elements to pick, must pick a value 0 < n <= length");if(e===t.length)return t;const i=new Array(e);let n=0;const o=t.slice(0);for(;n<e;){const h=this.integer(0,o.length-1);i[n++]=o[h],o.splice(h,1)}return i}_pickSetWithDuplicates(t,e){if(e<0)throw new Error("Invalid number of elements to pick, must pick a value 0 <= n < MAX_INT");const i=new Array(e);for(let n=0;n<e;n++)i[n]=this.pickOne(t);return i}shuffle(t){const e=t.slice(0);let i=null;for(let n=0;n<e.length-2;n++){const o=this.integer(n,e.length-1);i=e[n],e[n]=e[o],e[o]=i}return e}range(t,e,i){const n=new Array(t);for(let o=0;o<t;o++)n[o]=this.integer(e,i);return n}d4(){return this.integer(1,4)}d6(){return this.integer(1,6)}d8(){return this.integer(1,8)}d10(){return this.integer(1,10)}d12(){return this.integer(1,12)}d20(){return this.integer(1,20)}}const F=Math.PI*2;function X(a){return a>=0?a-Math.floor(a):a-Math.ceil(a)}function E(a){return a===0?0:a<0?-1:1}function A(a,t,e){return Math.min(Math.max(t,a),e)}function L(a){let t=a;if(a>F)for(;t>F;)t-=F;if(a<0)for(;t<0;)t+=F;return t}function V(a){return 180/Math.PI*a}function W(a){return a/180*Math.PI}const Q=(a,t)=>Array.from(new Array(t-a+1),(e,i)=>i+a);function rt(a,t,e=new R){return e?e.floating(a,t):a+Math.random()*(t-a)}function J(a,t,e=new R){return e?e.integer(a,t):Math.round(rt(a,t))}class k{static get Zero(){return new k(0,0)}static get One(){return new k(1,1)}static get Half(){return new k(.5,.5)}static get Up(){return new k(0,-1)}static get Down(){return new k(0,1)}static get Left(){return new k(-1,0)}static get Right(){return new k(1,0)}static fromAngle(t){return new k(Math.cos(t),Math.sin(t))}static isValid(t){return!(t==null||isNaN(t.x)||isNaN(t.y)||t.x===1/0||t.y===1/0||t.x===-1/0||t.y===-1/0)}static distance(t,e){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}static min(t,e){return new k(Math.min(t.x,e.x),Math.min(t.y,e.y))}static max(t,e){return new k(Math.max(t.x,e.x),Math.max(t.y,e.y))}constructor(t,e){this._x=0,this._y=0,this._x=t,this._y=e}get x(){return this._x}set x(t){this._x=t}get y(){return this._y}set y(t){this._y=t}setTo(t,e){this.x=t,this.y=e}equals(t,e=.001){return Math.abs(this.x-t.x)<=e&&Math.abs(this.y-t.y)<=e}distance(t){if(!t)return Math.sqrt(this.x*this.x+this.y*this.y);const e=this.x-t.x,i=this.y-t.y;return Math.sqrt(e*e+i*i)}squareDistance(t){t||(t=k.Zero);const e=this.x-t.x,i=this.y-t.y;return e*e+i*i}clampMagnitude(t){const e=this.size,i=A(e,0,t);return this.size=i,this}get size(){return this.distance()}set size(t){const e=this.normalize().scale(t);this.setTo(e.x,e.y)}normalize(){const t=this.distance();return t>0?new k(this.x/t,this.y/t):new k(0,1)}average(t){return this.add(t).scale(.5)}scale(t,e){const i=e||new k(0,0);return t instanceof k?(i.x=this.x*t.x,i.y=this.y*t.y):(i.x=this.x*t,i.y=this.y*t),i}add(t,e){return e?(e.x=this.x+t.x,e.y=this.y+t.y,e):new k(this.x+t.x,this.y+t.y)}sub(t){return new k(this.x-t.x,this.y-t.y)}addEqual(t){return this.setTo(this.x+t.x,this.y+t.y),this}subEqual(t){return this.setTo(this.x-t.x,this.y-t.y),this}scaleEqual(t){return this.setTo(this.x*t,this.y*t),this}dot(t){return this.x*t.x+this.y*t.y}cross(t){if(t instanceof k)return this.x*t.y-this.y*t.x;if(typeof t=="number")return new k(t*this.y,-t*this.x)}static cross(t,e){return new k(-t*e.y,t*e.x)}perpendicular(){return new k(this.y,-this.x)}normal(){return this.perpendicular().normalize()}negate(){return this.scale(-1)}toAngle(){return Math.atan2(this.y,this.x)}rotate(t,e){e||(e=new k(0,0));const i=Math.sin(t),n=Math.cos(t),o=n*(this.x-e.x)-i*(this.y-e.y)+e.x,h=i*(this.x-e.x)+n*(this.y-e.y)+e.y;return new k(o,h)}clone(t){const e=t??new k(0,0);return e.x=this.x,e.y=this.y,e}toString(t){return t?`(${this.x.toFixed(t)}, ${this.y.toFixed(t)})`:`(${this.x}, ${this.y})`}}function B(a,t){return new k(a,t)}var tt;(function(a){a[a.Debug=0]="Debug",a[a.Info=1]="Info",a[a.Warn=2]="Warn",a[a.Error=3]="Error",a[a.Fatal=4]="Fatal"})(tt||(tt={}));class Y{constructor(){if(this._appenders=[],this.defaultLevel=tt.Info,Y._INSTANCE)throw new Error("Logger is a singleton");return Y._INSTANCE=this,Y._INSTANCE.addAppender(new ut),Y._INSTANCE}static getInstance(){return Y._INSTANCE==null&&(Y._INSTANCE=new Y),Y._INSTANCE}addAppender(t){this._appenders.push(t)}clearAppenders(){this._appenders.length=0}_log(t,e){t==null&&(t=this.defaultLevel);const i=this._appenders.length;for(let n=0;n<i;n++)t>=this.defaultLevel&&this._appenders[n].log(t,e)}debug(...t){this._log(tt.Debug,t)}info(...t){this._log(tt.Info,t)}warn(...t){this._log(tt.Warn,t)}error(...t){this._log(tt.Error,t)}fatal(...t){this._log(tt.Fatal,t)}}Y._INSTANCE=null;class ut{log(t,e){if(!console&&!console.log&&console.warn&&console.error)return;const i=[];i.unshift.apply(i,e),i.unshift("["+tt[t]+"] : "),t<tt.Warn?console.log.apply?console.log.apply(console,i):console.log(i.join(" ")):t<tt.Error?console.warn.apply?console.warn.apply(console,i):console.warn(i.join(" ")):console.error.apply?console.error.apply(console,i):console.error(i.join(" "))}}class oi{constructor(t,e){this._messages=[],this._canvas=document.createElement("canvas"),this._canvas.width=t||window.innerWidth,this._canvas.height=e||window.innerHeight,this._canvas.style.position="absolute",this._ctx=this._canvas.getContext("2d"),document.body.appendChild(this._canvas)}log(t,e){const i=e.join(",");this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height),this._messages.unshift("["+tt[t]+"] : "+i);let n=10,o=1;for(let h=0;h<this._messages.length;h++)this._ctx.fillStyle="rgba(255,255,255,"+o.toFixed(2)+")",this._ctx.fillText(this._messages[h],200,n),n+=10,o=o>0?o-.05:0}}class j{constructor(t,e,i,n){this.r=t,this.g=e,this.b=i,this.a=n??1}static fromRGB(t,e,i,n){return new j(t,e,i,n)}static fromRGBString(t){const e=/^rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d+(?:\.\d+)?))?\)/i;let i=null;if(i=t.match(e)){const n=parseInt(i[1],10),o=parseInt(i[2],10),h=parseInt(i[3],10);let d=1;return i[4]&&(d=parseFloat(i[4])),new j(n,o,h,d)}else throw new Error("Invalid rgb/a string: "+t)}static fromHex(t){const e=/^#?([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})?$/i;let i=null;if(i=t.match(e)){const n=parseInt(i[1],16),o=parseInt(i[2],16),h=parseInt(i[3],16);let d=1;return i[4]&&(d=parseInt(i[4],16)/255),new j(n,o,h,d)}else throw new Error("Invalid hex string: "+t)}static fromHSL(t,e,i,n=1){return new mt(t,e,i,n).toRGBA()}lighten(t=.1){const e=mt.fromRGBA(this.r,this.g,this.b,this.a);return e.l+=(1-e.l)*t,e.toRGBA()}darken(t=.1){const e=mt.fromRGBA(this.r,this.g,this.b,this.a);return e.l-=e.l*t,e.toRGBA()}saturate(t=.1){const e=mt.fromRGBA(this.r,this.g,this.b,this.a);return e.s+=e.s*t,e.toRGBA()}desaturate(t=.1){const e=mt.fromRGBA(this.r,this.g,this.b,this.a);return e.s-=e.s*t,e.toRGBA()}multiply(t){const e=t.r/255*this.r/255*255,i=t.g/255*this.g/255*255,n=t.b/255*this.b/255*255,o=t.a*this.a;return new j(e,i,n,o)}screen(t){const e=t.invert(),i=t.invert();return e.multiply(i).invert()}invert(){return new j(255-this.r,255-this.g,255-this.b,1-this.a)}average(t){const e=(t.r+this.r)/2,i=(t.g+this.g)/2,n=(t.b+this.b)/2,o=(t.a+this.a)/2;return new j(e,i,n,o)}equal(t){return this.toString()===t.toString()}toString(t="rgb"){switch(t){case"rgb":return this.toRGBA();case"hsl":return this.toHSLA();case"hex":return this.toHex();default:throw new Error("Invalid Color format")}}_componentToHex(t){const e=t.toString(16);return e.length===1?"0"+e:e}toHex(){return"#"+this._componentToHex(this.r)+this._componentToHex(this.g)+this._componentToHex(this.b)}toRGBA(){const t=String(this.r.toFixed(0))+", "+String(this.g.toFixed(0))+", "+String(this.b.toFixed(0));return this.a!==void 0||this.a!==null?"rgba("+t+", "+String(this.a)+")":"rgb("+t+")"}toHSLA(){return mt.fromRGBA(this.r,this.g,this.b,this.a).toString()}fillStyle(){return this.toString()}clone(){return new j(this.r,this.g,this.b,this.a)}static get Black(){return j.fromHex("#000000")}static get White(){return j.fromHex("#FFFFFF")}static get Gray(){return j.fromHex("#808080")}static get LightGray(){return j.fromHex("#D3D3D3")}static get DarkGray(){return j.fromHex("#A9A9A9")}static get Yellow(){return j.fromHex("#FFFF00")}static get Orange(){return j.fromHex("#FFA500")}static get Red(){return j.fromHex("#FF0000")}static get Vermilion(){return j.fromHex("#FF5B31")}static get Rose(){return j.fromHex("#FF007F")}static get Magenta(){return j.fromHex("#FF00FF")}static get Violet(){return j.fromHex("#7F00FF")}static get Blue(){return j.fromHex("#0000FF")}static get Azure(){return j.fromHex("#007FFF")}static get Cyan(){return j.fromHex("#00FFFF")}static get Viridian(){return j.fromHex("#59978F")}static get Green(){return j.fromHex("#00FF00")}static get Chartreuse(){return j.fromHex("#7FFF00")}static get Transparent(){return j.fromHex("#FFFFFF00")}static get ExcaliburBlue(){return j.fromHex("#176BAA")}}class mt{constructor(t,e,i,n){this.h=t,this.s=e,this.l=i,this.a=n}static hue2rgb(t,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?t+(e-t)*6*i:i<1/2?e:i<2/3?t+(e-t)*(2/3-i)*6:t}static fromRGBA(t,e,i,n){t/=255,e/=255,i/=255;const o=Math.max(t,e,i),h=Math.min(t,e,i);let d,u;const g=(o+h)/2;if(o===h)d=u=0;else{const v=o-h;switch(u=g>.5?v/(2-o-h):v/(o+h),o){case t:d=(e-i)/v+(e<i?6:0);break;case e:d=(i-t)/v+2;break;case i:d=(t-e)/v+4;break}d/=6}return new mt(d,u,g,n)}toRGBA(){let t,e,i;if(this.s===0)t=e=i=this.l;else{const n=this.l<.5?this.l*(1+this.s):this.l+this.s-this.l*this.s,o=2*this.l-n;t=mt.hue2rgb(o,n,this.h+1/3),e=mt.hue2rgb(o,n,this.h),i=mt.hue2rgb(o,n,this.h-1/3)}return new j(t*255,e*255,i*255,this.a)}toString(){const t=this.h.toFixed(0),e=this.s.toFixed(0),i=this.l.toFixed(0),n=this.a.toFixed(0);return`hsla(${t}, ${e}, ${i}, ${n})`}}var ht;(function(a){a.None="None",a.Top="Top",a.Bottom="Bottom",a.Left="Left",a.Right="Right"})(ht||(ht={})),function(a){function t(i){return i===a.Top?a.Bottom:i===a.Bottom?a.Top:i===a.Left?a.Right:i===a.Right?a.Left:a.None}a.getOpposite=t;function e(i){const n=[k.Left,k.Right,k.Up,k.Down],o=[a.Left,a.Right,a.Top,a.Bottom];let h=-Number.MAX_VALUE,d=-1;for(let u=0;u<n.length;u++)n[u].dot(i)>h&&(h=n[u].dot(i),d=u);return o[d]}a.fromDirection=e}(ht||(ht={}));class nt{constructor(t=0,e=0,i=0,n=0){typeof t=="object"?(this.left=t.left,this.top=t.top,this.right=t.right,this.bottom=t.bottom):typeof t=="number"&&(this.left=t,this.top=e,this.right=i,this.bottom=n)}clone(){return new nt(this.left,this.top,this.right,this.bottom)}static getSideFromIntersection(t){return t&&t?Math.abs(t.x)>Math.abs(t.y)?t.x<0?ht.Right:ht.Left:t.y<0?ht.Bottom:ht.Top:ht.None}static fromPoints(t){let e=1/0,i=1/0,n=-1/0,o=-1/0;for(let h=0;h<t.length;h++)t[h].x<e&&(e=t[h].x),t[h].x>n&&(n=t[h].x),t[h].y<i&&(i=t[h].y),t[h].y>o&&(o=t[h].y);return new nt(e,i,n,o)}static fromDimension(t,e,i=k.Half,n=k.Zero){return new nt(-t*i.x+n.x,-e*i.y+n.y,t-t*i.x+n.x,e-e*i.y+n.y)}get width(){return this.right-this.left}get height(){return this.bottom-this.top}hasZeroDimensions(){return this.width===0||this.height===0}get center(){return new k((this.left+this.right)/2,(this.top+this.bottom)/2)}translate(t){return new nt(this.left+t.x,this.top+t.y,this.right+t.x,this.bottom+t.y)}rotate(t,e=k.Zero){const i=this.getPoints().map(n=>n.rotate(t,e));return nt.fromPoints(i)}scale(t,e=k.Zero){const i=this.translate(e);return new nt(i.left*t.x,i.top*t.y,i.right*t.x,i.bottom*t.y)}transform(t){const e=t.data[0]*this.left,i=t.data[1]*this.left,n=t.data[0]*this.right,o=t.data[1]*this.right,h=t.data[2]*this.top,d=t.data[3]*this.top,u=t.data[2]*this.bottom,g=t.data[3]*this.bottom,v=t.getPosition(),I=Math.min(e,n)+Math.min(h,u)+v.x,D=Math.min(i,o)+Math.min(d,g)+v.y,U=Math.max(e,n)+Math.max(h,u)+v.x,H=Math.max(i,o)+Math.max(d,g)+v.y;return new nt({left:I,top:D,right:U,bottom:H})}getPerimeter(){const t=this.width,e=this.height;return 2*(t+e)}getPoints(){const t=[];return t.push(new k(this.left,this.top)),t.push(new k(this.right,this.top)),t.push(new k(this.right,this.bottom)),t.push(new k(this.left,this.bottom)),t}rayCast(t,e=1/0){let i=-1/0,n=1/0;const o=t.dir.x===0?Number.MAX_VALUE:1/t.dir.x,h=t.dir.y===0?Number.MAX_VALUE:1/t.dir.y,d=(this.left-t.pos.x)*o,u=(this.right-t.pos.x)*o;i=Math.min(d,u),n=Math.max(d,u);const g=(this.top-t.pos.y)*h,v=(this.bottom-t.pos.y)*h;return i=Math.max(i,Math.min(g,v)),n=Math.min(n,Math.max(g,v)),n>=Math.max(0,i)&&i<e}rayCastTime(t,e=1/0){let i=-1/0,n=1/0;const o=t.dir.x===0?Number.MAX_VALUE:1/t.dir.x,h=t.dir.y===0?Number.MAX_VALUE:1/t.dir.y,d=(this.left-t.pos.x)*o,u=(this.right-t.pos.x)*o;i=Math.min(d,u),n=Math.max(d,u);const g=(this.top-t.pos.y)*h,v=(this.bottom-t.pos.y)*h;return i=Math.max(i,Math.min(g,v)),n=Math.min(n,Math.max(g,v)),n>=Math.max(0,i)&&i<e?i:-1}contains(t){return t instanceof k?this.left<=t.x&&this.top<=t.y&&this.bottom>=t.y&&this.right>=t.x:t instanceof nt?this.left<=t.left&&this.top<=t.top&&t.bottom<=this.bottom&&t.right<=this.right:!1}combine(t){return new nt(Math.min(this.left,t.left),Math.min(this.top,t.top),Math.max(this.right,t.right),Math.max(this.bottom,t.bottom))}get dimensions(){return new k(this.width,this.height)}overlaps(t,e){const i=e||0;if(t.hasZeroDimensions())return this.contains(t);if(this.hasZeroDimensions())return t.contains(this);const n=this.combine(t);return n.width+i<t.width+this.width&&n.height+i<t.height+this.height}intersect(t){const e=this.combine(t);if(e.width<t.width+this.width&&e.height<t.height+this.height&&!e.dimensions.equals(t.dimensions)&&!e.dimensions.equals(this.dimensions)){let i=0;this.right>=t.left&&this.right<=t.right?i=t.left-this.right:i=t.right-this.left;let n=0;return this.top<=t.bottom&&this.top>=t.top?n=t.bottom-this.top:n=t.top-this.bottom,Math.abs(i)<Math.abs(n)?new k(i,0):new k(0,n)}else if(e.dimensions.equals(t.dimensions)||e.dimensions.equals(this.dimensions)){let i=0;this.width-t.width>=0?this.right-t.right<=t.left-this.left?i=t.left-this.right:i=t.right-this.left:t.right-this.right<=this.left-t.left?i=this.left-t.right:i=this.right-t.left;let n=0;return this.height-t.height>=0?this.bottom-t.bottom<=t.top-this.top?n=t.top-this.bottom:n=t.bottom-this.top:t.bottom-this.bottom<=this.top-t.top?n=this.top-t.bottom:n=this.bottom-t.top,Math.abs(i)<Math.abs(n)?new k(i,0):new k(0,n)}else return null}intersectWithSide(t){const e=this.intersect(t);return nt.getSideFromIntersection(e)}draw(t,e=j.Yellow){t.debug.drawRect(this.left,this.top,this.width,this.height,{color:e})}}class Ft{constructor(){this._isCompleted=!1,this.promise=new Promise((t,e)=>{this._resolver=t,this._rejecter=e})}get isCompleted(){return this._isCompleted}resolve(t){this._isCompleted||(this._isCompleted=!0,this._resolver(t))}reject(t){this._isCompleted||(this._isCompleted=!0,this._rejecter(t))}}function ce(a){let t=0,e=0;const i=o=>{t+=o.offsetLeft,o.offsetParent&&i(o.offsetParent)},n=o=>{e+=o.offsetTop,o.offsetParent&&n(o.offsetParent)};return i(a),n(a),new k(t,e)}function qt(a,t){return t.indexOf(a)===-1?(t.push(a),!0):!1}function Le(a,t){let e=-1;return(e=t.indexOf(a))>-1?(t.splice(e,1),!0):!1}function us(a,t){for(let e=0;e<a.length;e++)if(a[e]===t)return!0;return!1}function Ot(a){throw new Error(a)}function _t(a,t){var e;const i=new Ft;return((e=t==null?void 0:t.schedule.bind(t))!==null&&e!==void 0?e:setTimeout)(()=>{i.resolve()},a),i.promise}var be;(function(a){a[a.X=12]="X",a[a.Y=13]="Y"})(be||(be={}));class Jt{constructor(){this.data=new Float32Array(16),this._scaleX=1,this._scaleSignX=1,this._scaleY=1,this._scaleSignY=1}static ortho(t,e,i,n,o,h){const d=new Jt;return d.data[0]=2/(e-t),d.data[1]=0,d.data[2]=0,d.data[3]=0,d.data[4]=0,d.data[5]=2/(n-i),d.data[6]=0,d.data[7]=0,d.data[8]=0,d.data[9]=0,d.data[10]=-2/(h-o),d.data[11]=0,d.data[12]=-(e+t)/(e-t),d.data[13]=-(n+i)/(n-i),d.data[14]=-(h+o)/(h-o),d.data[15]=1,d}clone(t){const e=t||new Jt;return e.data[0]=this.data[0],e.data[1]=this.data[1],e.data[2]=this.data[2],e.data[3]=this.data[3],e.data[4]=this.data[4],e.data[5]=this.data[5],e.data[6]=this.data[6],e.data[7]=this.data[7],e.data[8]=this.data[8],e.data[9]=this.data[9],e.data[10]=this.data[10],e.data[11]=this.data[11],e.data[12]=this.data[12],e.data[13]=this.data[13],e.data[14]=this.data[14],e.data[15]=this.data[15],e}toDOMMatrix(){return new DOMMatrix([...this.data])}static fromFloat32Array(t){const e=new Jt;return e.data=t,e}static identity(){const t=new Jt;return t.data[0]=1,t.data[1]=0,t.data[2]=0,t.data[3]=0,t.data[4]=0,t.data[5]=1,t.data[6]=0,t.data[7]=0,t.data[8]=0,t.data[9]=0,t.data[10]=1,t.data[11]=0,t.data[12]=0,t.data[13]=0,t.data[14]=0,t.data[15]=1,t}reset(){const t=this;return t.data[0]=1,t.data[1]=0,t.data[2]=0,t.data[3]=0,t.data[4]=0,t.data[5]=1,t.data[6]=0,t.data[7]=0,t.data[8]=0,t.data[9]=0,t.data[10]=1,t.data[11]=0,t.data[12]=0,t.data[13]=0,t.data[14]=0,t.data[15]=1,t}static translation(t,e){const i=Jt.identity();return i.data[12]=t,i.data[13]=e,i}static scale(t,e){const i=Jt.identity();return i.data[0]=t,i.data[5]=e,i.data[10]=1,i.data[15]=1,i}static rotation(t){const e=Jt.identity();return e.data[0]=Math.cos(t),e.data[4]=-Math.sin(t),e.data[1]=Math.sin(t),e.data[5]=Math.cos(t),e}multiply(t,e){if(t instanceof k){const i=e||new k(0,0),n=t,o=n.x*this.data[0]+n.y*this.data[4]+this.data[12],h=n.x*this.data[1]+n.y*this.data[5]+this.data[13];return i.x=o,i.y=h,i}else{const i=e||new Jt,n=t,o=this.data[0],h=this.data[1],d=this.data[2],u=this.data[3],g=this.data[4],v=this.data[5],I=this.data[6],D=this.data[7],U=this.data[8],H=this.data[9],Z=this.data[10],K=this.data[11],z=this.data[12],N=this.data[13],et=this.data[14],st=this.data[15],ft=n.data[0],at=n.data[1],q=n.data[2],It=n.data[3],Tt=n.data[4],Lt=n.data[5],Et=n.data[6],me=n.data[7],bi=n.data[8],xi=n.data[9],yi=n.data[10],_n=n.data[11],gn=n.data[12],mn=n.data[13],gt=n.data[14],Io=n.data[15];i.data[0]=o*ft+g*at+U*q+z*It,i.data[1]=h*ft+v*at+H*q+N*It,i.data[2]=d*ft+I*at+Z*q+et*It,i.data[3]=u*ft+D*at+K*q+st*It,i.data[4]=o*Tt+g*Lt+U*Et+z*me,i.data[5]=h*Tt+v*Lt+H*Et+N*me,i.data[6]=d*Tt+I*Lt+Z*Et+et*me,i.data[7]=u*Tt+D*Lt+K*Et+st*me,i.data[8]=o*bi+g*xi+U*yi+z*_n,i.data[9]=h*bi+v*xi+H*yi+N*_n,i.data[10]=d*bi+I*xi+Z*yi+et*_n,i.data[11]=u*bi+D*xi+K*yi+st*_n,i.data[12]=o*gn+g*mn+U*gt+z*Io,i.data[13]=h*gn+v*mn+H*gt+N*Io,i.data[14]=d*gn+I*mn+Z*gt+et*Io,i.data[15]=u*gn+D*mn+K*gt+st*Io;const ha=this.getScale();return i._scaleSignX=E(ha.x)*E(i._scaleSignX),i._scaleSignY=E(ha.y)*E(i._scaleSignY),i}}translate(t,e){const i=this.data[0],n=this.data[1],o=this.data[2],h=this.data[3],d=this.data[4],u=this.data[5],g=this.data[6],v=this.data[7],I=this.data[8],D=this.data[9],U=this.data[10],H=this.data[11],Z=this.data[12],K=this.data[13],z=this.data[14],N=this.data[15],et=0,st=1;return this.data[12]=i*t+d*e+I*et+Z*st,this.data[13]=n*t+u*e+D*et+K*st,this.data[14]=o*t+g*e+U*et+z*st,this.data[15]=h*t+v*e+H*et+N*st,this}setPosition(t,e){this.data[12]=t,this.data[13]=e}getPosition(){return B(this.data[12],this.data[13])}rotate(t){const e=this.data[0],i=this.data[1],n=this.data[2],o=this.data[3],h=this.data[4],d=this.data[5],u=this.data[6],g=this.data[7],v=Math.sin(t),I=Math.cos(t);return this.data[0]=I*e+v*h,this.data[1]=I*i+v*d,this.data[2]=I*n+v*u,this.data[3]=I*o+v*g,this.data[4]=I*h-v*e,this.data[5]=I*d-v*i,this.data[6]=I*u-v*n,this.data[7]=I*g-v*o,this}scale(t,e){const i=this.data[0],n=this.data[1],o=this.data[2],h=this.data[3],d=this.data[4],u=this.data[5],g=this.data[6],v=this.data[7];return this.data[0]=i*t,this.data[1]=n*t,this.data[2]=o*t,this.data[3]=h*t,this.data[4]=d*e,this.data[5]=u*e,this.data[6]=g*e,this.data[7]=v*e,this}setRotation(t){const e=this.getScale(),i=Math.sin(t),n=Math.cos(t);this.data[0]=n*e.x,this.data[1]=i*e.y,this.data[4]=-i*e.x,this.data[5]=n*e.y}getRotation(){const t=Math.atan2(this.data[1]/this.getScaleY(),this.data[0]/this.getScaleX());return L(t)}getScaleX(){const t=B(this.data[0],this.data[4]).size;return this._scaleSignX*t}getScaleY(){const t=B(this.data[1],this.data[5]).size;return this._scaleSignY*t}getScale(){return B(this.getScaleX(),this.getScaleY())}setScaleX(t){if(this._scaleX===t)return;this._scaleSignX=E(t);const e=B(this.data[0]*this._scaleSignX,this.data[4]*this._scaleSignX).normalize();this.data[0]=e.x*t,this.data[4]=e.y*t,this._scaleX=t}setScaleY(t){if(this._scaleY===t)return;this._scaleSignY=E(t);const e=B(this.data[1]*this._scaleSignY,this.data[5]*this._scaleSignY).normalize();this.data[1]=e.x*t,this.data[5]=e.y*t,this._scaleY=t}setScale(t){this.setScaleX(t.x),this.setScaleY(t.y)}getBasisDeterminant(){return this.data[0]*this.data[5]-this.data[1]*this.data[4]}getAffineInverse(t){const i=1/this.getBasisDeterminant(),n=this.data[0],o=this.data[4],h=this.data[1],d=this.data[5],u=t||Jt.identity();u.data[0]=d*i,u.data[1]=-h*i,u.data[4]=-o*i,u.data[5]=n*i;const g=this.data[12],v=this.data[13];return u.data[12]=-(g*u.data[0]+v*u.data[4]),u.data[13]=-(g*u.data[1]+v*u.data[5]),u}isIdentity(){return this.data[0]===1&&this.data[1]===0&&this.data[2]===0&&this.data[3]===0&&this.data[4]===0&&this.data[5]===1&&this.data[6]===0&&this.data[7]===0&&this.data[8]===0&&this.data[9]===0&&this.data[10]===1&&this.data[11]===0&&this.data[12]===0&&this.data[13]===0&&this.data[14]===0&&this.data[15]===1}toString(){return`
[${this.data[0]} ${this.data[4]} ${this.data[8]} ${this.data[12]}]
[${this.data[1]} ${this.data[5]} ${this.data[9]} ${this.data[13]}]
[${this.data[2]} ${this.data[6]} ${this.data[10]} ${this.data[14]}]
[${this.data[3]} ${this.data[7]} ${this.data[11]} ${this.data[15]}]
`}}class ct{constructor(){this.data=new Float64Array(6),this._scale=new Float64Array([1,1]),this._scaleSignX=1,this._scaleSignY=1}toDOMMatrix(){return new DOMMatrix([...this.data])}static identity(){const t=new ct;return t.data[0]=1,t.data[1]=0,t.data[2]=0,t.data[3]=1,t.data[4]=0,t.data[5]=0,t}static translation(t,e){const i=ct.identity();return i.data[4]=t,i.data[5]=e,i}static scale(t,e){const i=ct.identity();return i.data[0]=t,i.data[3]=e,i._scale[0]=t,i._scale[1]=e,i}static rotation(t){const e=ct.identity();return e.data[0]=Math.cos(t),e.data[1]=Math.sin(t),e.data[2]=-Math.sin(t),e.data[3]=Math.cos(t),e}setPosition(t,e){this.data[4]=t,this.data[5]=e}getPosition(){return B(this.data[4],this.data[5])}rotate(t){const e=this.data[0],i=this.data[1],n=this.data[2],o=this.data[3],h=Math.sin(t),d=Math.cos(t);return this.data[0]=d*e+h*n,this.data[1]=d*i+h*o,this.data[2]=d*n-h*e,this.data[3]=d*o-h*i,this}translate(t,e){const i=this.data[0],n=this.data[1],o=this.data[2],h=this.data[3],d=this.data[4],u=this.data[5];return this.data[4]=i*t+o*e+d,this.data[5]=n*t+h*e+u,this}scale(t,e){const i=this.data[0],n=this.data[1],o=this.data[2],h=this.data[3];return this.data[0]=i*t,this.data[1]=n*t,this.data[2]=o*e,this.data[3]=h*e,this._scale[0]=t,this._scale[1]=e,this}determinant(){return this.data[0]*this.data[3]-this.data[1]*this.data[2]}inverse(t){const i=1/this.determinant(),n=this.data[0],o=this.data[2],h=this.data[1],d=this.data[3],u=t||ct.identity();u.data[0]=d*i,u.data[1]=-h*i,u.data[2]=-o*i,u.data[3]=n*i;const g=this.data[4],v=this.data[5];return u.data[4]=-(g*u.data[0]+v*u.data[2]),u.data[5]=-(g*u.data[1]+v*u.data[3]),u}multiply(t,e){if(t instanceof k){const i=e||new k(0,0),n=t,o=n.x*this.data[0]+n.y*this.data[2]+this.data[4],h=n.x*this.data[1]+n.y*this.data[3]+this.data[5];return i.x=o,i.y=h,i}else{const i=e||new ct,n=t,o=this.data[0],h=this.data[1],d=this.data[2],u=this.data[3],g=this.data[4],v=this.data[5],I=n.data[0],D=n.data[1],U=n.data[2],H=n.data[3],Z=n.data[4],K=n.data[5];i.data[0]=o*I+d*D,i.data[1]=h*I+u*D,i.data[2]=o*U+d*H,i.data[3]=h*U+u*H,i.data[4]=o*Z+d*K+g,i.data[5]=h*Z+u*K+v;const z=this.getScale();return i._scaleSignX=E(z.x)*E(i._scaleSignX),i._scaleSignY=E(z.y)*E(i._scaleSignY),i}}to4x4(){const t=new Jt;return t.data[0]=this.data[0],t.data[1]=this.data[1],t.data[2]=0,t.data[3]=0,t.data[4]=this.data[2],t.data[5]=this.data[3],t.data[6]=0,t.data[7]=0,t.data[8]=0,t.data[9]=0,t.data[10]=1,t.data[11]=0,t.data[12]=this.data[4],t.data[13]=this.data[5],t.data[14]=0,t.data[15]=1,t}setRotation(t){const e=this.getScale(),i=Math.sin(t),n=Math.cos(t);this.data[0]=n*e.x,this.data[1]=i*e.y,this.data[2]=-i*e.x,this.data[3]=n*e.y}getRotation(){const t=Math.atan2(this.data[1]/this.getScaleY(),this.data[0]/this.getScaleX());return L(t)}getScaleX(){const t=B(this.data[0],this.data[2]).distance();return this._scaleSignX*t}getScaleY(){const t=B(this.data[1],this.data[3]).distance();return this._scaleSignY*t}getScale(){return B(this.getScaleX(),this.getScaleY())}setScaleX(t){if(t===this._scale[0])return;this._scaleSignX=E(t);const e=B(this.data[0]*this._scaleSignX,this.data[2]*this._scaleSignX).normalize();this.data[0]=e.x*t,this.data[2]=e.y*t,this._scale[0]=t}setScaleY(t){if(t===this._scale[1])return;this._scaleSignY=E(t);const e=B(this.data[1]*this._scaleSignY,this.data[3]*this._scaleSignY).normalize();this.data[1]=e.x*t,this.data[3]=e.y*t,this._scale[1]=t}setScale(t){this.setScaleX(t.x),this.setScaleY(t.y)}isIdentity(){return this.data[0]===1&&this.data[1]===0&&this.data[2]===0&&this.data[3]===1&&this.data[4]===0&&this.data[5]===0}reset(){const t=this;return t.data[0]=1,t.data[1]=0,t.data[2]=0,t.data[3]=1,t.data[4]=0,t.data[5]=0,t}clone(t){const e=t||new ct;return e.data[0]=this.data[0],e.data[1]=this.data[1],e.data[2]=this.data[2],e.data[3]=this.data[3],e.data[4]=this.data[4],e.data[5]=this.data[5],e}toString(){return`
[${this.data[0]} ${this.data[2]} ${this.data[4]}]
[${this.data[1]} ${this.data[3]} ${this.data[5]}]
[0 0 1]
`}}class Qt{constructor(){this._transforms=[],this._currentTransform=ct.identity()}save(){this._transforms.push(this._currentTransform),this._currentTransform=this._currentTransform.clone()}restore(){this._currentTransform=this._transforms.pop()}translate(t,e){return this._currentTransform.translate(t,e)}rotate(t){return this._currentTransform.rotate(t)}scale(t,e){return this._currentTransform.scale(t,e)}set current(t){this._currentTransform=t}get current(){return this._currentTransform}}class ps{constructor(){this._states=[],this._currentState=this._getDefaultState()}_getDefaultState(){return{opacity:1,z:0,tint:j.White}}_cloneState(){return{opacity:this._currentState.opacity,z:this._currentState.z,tint:this._currentState.tint.clone()}}save(){this._states.push(this._currentState),this._currentState=this._cloneState()}restore(){this._currentState=this._states.pop()}get current(){return this._currentState}set current(t){this._currentState=t}}var ai;(function(a){a.Kill="kill",a.PreKill="prekill",a.PostKill="postkill",a.PreDraw="predraw",a.PostDraw="postdraw",a.PreDebugDraw="predebugdraw",a.PostDebugDraw="postdebugdraw",a.PreUpdate="preupdate",a.PostUpdate="postupdate",a.PreFrame="preframe",a.PostFrame="postframe",a.PreCollision="precollision",a.CollisionStart="collisionstart",a.CollisionEnd="collisionend",a.PostCollision="postcollision",a.Initialize="initialize",a.Activate="activate",a.Deactivate="deactivate",a.ExitViewport="exitviewport",a.EnterViewport="enterviewport",a.ExitTrigger="exit",a.EnterTrigger="enter",a.Connect="connect",a.Disconnect="disconnect",a.Button="button",a.Axis="axis",a.Visible="visible",a.Hidden="hidden",a.Start="start",a.Stop="stop",a.PointerUp="pointerup",a.PointerDown="pointerdown",a.PointerMove="pointermove",a.PointerEnter="pointerenter",a.PointerLeave="pointerleave",a.PointerCancel="pointercancel",a.PointerWheel="pointerwheel",a.Up="up",a.Down="down",a.Move="move",a.Enter="enter",a.Leave="leave",a.Cancel="cancel",a.Wheel="wheel",a.Press="press",a.Release="release",a.Hold="hold",a.PointerDragStart="pointerdragstart",a.PointerDragEnd="pointerdragend",a.PointerDragEnter="pointerdragenter",a.PointerDragLeave="pointerdragleave",a.PointerDragMove="pointerdragmove"})(ai||(ai={}));class pt{constructor(){this._bubbles=!0}get bubbles(){return this._bubbles}set bubbles(t){this._bubbles=t}stopPropagation(){this.bubbles=!1}}class se extends pt{constructor(t){super(),this.target=t}}class Qe extends pt{constructor(t){super(),this.target=t}}class li extends pt{constructor(t){super(),this.target=t}}class Qi extends pt{constructor(t){super(),this.target=t}}class Ki extends pt{constructor(t){super(),this.target=t}}class ke extends pt{constructor(t,e,i){super(),this.ctx=t,this.delta=e,this.target=i}}class hi extends pt{constructor(t,e,i){super(),this.ctx=t,this.delta=e,this.target=i}}class fs extends pt{constructor(t,e){super(),this.ctx=t,this.target=e}}class Zi extends pt{constructor(t,e){super(),this.ctx=t,this.target=e}}class Ve extends pt{constructor(t,e,i){super(),this.engine=t,this.delta=e,this.target=i}}class de extends pt{constructor(t,e,i){super(),this.engine=t,this.delta=e,this.target=i}}class _s extends pt{constructor(t,e){super(),this.engine=t,this.prevStats=e,this.target=t}}class ci extends pt{constructor(t,e){super(),this.engine=t,this.stats=e,this.target=t}}class zs extends pt{constructor(t,e){super(),this.index=t,this.gamepad=e,this.target=e}}class Oe extends pt{constructor(t,e){super(),this.index=t,this.gamepad=e,this.target=e}}class di extends pt{constructor(t,e,i){super(),this.button=t,this.value=e,this.target=i}}class Ke extends pt{constructor(t,e,i){super(),this.axis=t,this.value=e,this.target=i}}class gs extends pt{constructor(t){super(),this.target=t}}class Si extends pt{constructor(t){super(),this.target=t}}class ze extends pt{constructor(t,e,i,n){super(),this.other=e,this.side=i,this.intersection=n,this.target=t}}class ui extends pt{constructor(t,e,i,n){super(),this.other=e,this.side=i,this.intersection=n,this.target=t}get actor(){return this.target}set actor(t){this.target=t}}class ms{constructor(t,e,i){this.target=t,this.other=e,this.contact=i}}class Se{constructor(t,e){this.target=t,this.other=e}}class vs{constructor(t,e,i,n,o){this.target=t,this.other=e,this.side=i,this.intersection=n,this.contact=o}}class Ne{constructor(t,e,i,n,o){this.target=t,this.other=e,this.side=i,this.intersection=n,this.contact=o}}class Ns extends pt{constructor(t,e,i){super(),this.other=e,this.contact=i,this.target=t}get actor(){return this.target}set actor(t){this.target=t}}class pi extends pt{constructor(t,e){super(),this.other=e,this.target=t}get actor(){return this.target}set actor(t){this.target=t}}class Ji extends pt{constructor(t,e){super(),this.engine=t,this.target=e}}class ws extends pt{constructor(t,e){super(),this.context=t,this.target=e}}class Hs extends pt{constructor(t,e){super(),this.context=t,this.target=e}}class Xs extends pt{constructor(t){super(),this.target=t}}class sr extends pt{constructor(t){super(),this.target=t}}class Ws extends pt{constructor(t,e){super(),this.target=t,this.actor=e}}class nr extends pt{constructor(t,e){super(),this.target=t,this.actor=e}}class Pi{constructor(){this._handlers={},this._wiredEventDispatchers=[],this._deferedHandlerRemovals=[]}clear(){this._handlers={},this._wiredEventDispatchers=[]}_processDeferredHandlerRemovals(){for(const t of this._deferedHandlerRemovals)this._removeHandler(t.name,t.handler);this._deferedHandlerRemovals.length=0}emit(t,e){if(this._processDeferredHandlerRemovals(),!t)return;t=t.toLowerCase(),(typeof e>"u"||e===null)&&(e=new pt);let i,n;if(this._handlers[t])for(i=0,n=this._handlers[t].length,i;i<n;i++)this._handlers[t][i](e);for(i=0,n=this._wiredEventDispatchers.length,i;i<n;i++)this._wiredEventDispatchers[i].emit(t,e)}on(t,e){this._processDeferredHandlerRemovals(),t=t.toLowerCase(),this._handlers[t]||(this._handlers[t]=[]),this._handlers[t].push(e)}off(t,e){this._deferedHandlerRemovals.push({name:t,handler:e})}_removeHandler(t,e){t=t.toLowerCase();const i=this._handlers[t];if(i)if(!e)this._handlers[t].length=0;else{const n=i.indexOf(e);n>-1&&this._handlers[t].splice(n,1)}}once(t,e){this._processDeferredHandlerRemovals();const i=n=>{const o=n||new pt;this.off(t,i),e(o)};this.on(t,i)}wire(t){t._wiredEventDispatchers.push(this)}unwire(t){const e=t._wiredEventDispatchers.indexOf(this);e>-1&&t._wiredEventDispatchers.splice(e,1)}}class Ti{constructor(t,e,i=!0){this.path=t,this.responseType=e,this.bustCache=i,this.data=null,this.logger=Y.getInstance(),this.events=new Pi}isLoaded(){return this.data!==null}_cacheBust(t){return/\?\w*=\w*/.test(t)?t+="&__="+Date.now():t+="?__="+Date.now(),t}load(){return new Promise((t,e)=>{if(this.data!==null){this.logger.debug("Already have data for resource",this.path),this.events.emit("complete",this.data),t(this.data);return}const i=new XMLHttpRequest;i.open("GET",this.bustCache?this._cacheBust(this.path):this.path,!0),i.responseType=this.responseType,i.addEventListener("loadstart",n=>this.events.emit("loadstart",n)),i.addEventListener("progress",n=>this.events.emit("progress",n)),i.addEventListener("error",n=>this.events.emit("error",n)),i.addEventListener("load",n=>this.events.emit("load",n)),i.addEventListener("load",()=>{if(i.status!==0&&i.status!==200){this.logger.error("Failed to load resource ",this.path," server responded with error code",i.status),this.events.emit("error",i.response),e(new Error(i.statusText));return}this.data=i.response,this.events.emit("complete",this.data),this.logger.debug("Completed loading resource",this.path),t(this.data)}),i.send()})}}function ki(a,t){return a&&(a.__isProxy===void 0?new Proxy(a,{set:(e,i,n)=>(e[i]!==n&&(e[i]=n,typeof i=="string"&&i[0]!=="_"&&t(e)),!0),get:(e,i)=>i!=="__isProxy"?e[i]:!0}):a)}function Hr(a,t){return a&&(a.__isProxy===void 0?new Proxy(a,{set:(e,i,n)=>(e[i]=n,typeof i=="string"&&i[0]!=="_"&&t(e),!0),get:(e,i)=>i!=="__isProxy"?e[i]:!0}):a)}class ne{isStale(){return this._transformStale}get flipHorizontal(){return this._flipHorizontal}set flipHorizontal(t){this._flipHorizontal=t,this._transformStale=!0}get flipVertical(){return this._flipVertical}set flipVertical(t){this._flipVertical=t,this._transformStale=!0}get rotation(){return this._rotation}set rotation(t){this._rotation=t,this._transformStale=!0}get scale(){return this._scale}set scale(t){this._scale=ki(t,()=>{this._transformStale=!0}),this._transformStale=!0}get origin(){return this._origin}set origin(t){this._origin=ki(t,()=>{this._transformStale=!0}),this._transformStale=!0}constructor(t){var e,i,n,o,h,d;this.id=ne._ID++,this.transform=ct.identity(),this.tint=null,this._transformStale=!0,this.showDebug=!1,this._flipHorizontal=!1,this._flipVertical=!1,this._rotation=0,this.opacity=1,this._scale=k.One,this._origin=null,this._width=0,this._height=0,t&&(this.origin=(e=t.origin)!==null&&e!==void 0?e:this.origin,this.flipHorizontal=(i=t.flipHorizontal)!==null&&i!==void 0?i:this.flipHorizontal,this.flipVertical=(n=t.flipVertical)!==null&&n!==void 0?n:this.flipVertical,this.rotation=(o=t.rotation)!==null&&o!==void 0?o:this.rotation,this.opacity=(h=t.opacity)!==null&&h!==void 0?h:this.opacity,this.scale=(d=t.scale)!==null&&d!==void 0?d:this.scale)}cloneGraphicOptions(){return{origin:this.origin?this.origin.clone():null,flipHorizontal:this.flipHorizontal,flipVertical:this.flipVertical,rotation:this.rotation,opacity:this.opacity,scale:this.scale?this.scale.clone():null}}get width(){return Math.abs(this._width*this.scale.x)}get height(){return Math.abs(this._height*this.scale.y)}set width(t){this._width=t,this._transformStale=!0}set height(t){this._height=t,this._transformStale=!0}get localBounds(){return nt.fromDimension(this.width,this.height,k.Zero)}draw(t,e,i){this._preDraw(t,e,i),this._drawImage(t,0,0),this._postDraw(t)}_preDraw(t,e,i){t.save(),t.translate(e,i),this._transformStale&&(this.transform.reset(),this.transform.scale(Math.abs(this.scale.x),Math.abs(this.scale.y)),this._rotate(this.transform),this._flip(this.transform),this._transformStale=!1),t.multiply(this.transform),t.opacity=t.opacity*this.opacity,this.tint&&(t.tint=this.tint)}_rotate(t){var e;const i=this.scale.x>0?1:-1,n=this.scale.y>0?1:-1,o=(e=this.origin)!==null&&e!==void 0?e:B(this.width/2,this.height/2);t.translate(o.x,o.y),t.rotate(this.rotation),t.scale(i,n),t.translate(-o.x,-o.y)}_flip(t){this.flipHorizontal&&(t.translate(this.width/this.scale.x,0),t.scale(-1,1)),this.flipVertical&&(t.translate(0,this.height/this.scale.y),t.scale(1,-1))}_postDraw(t){this.showDebug&&t.debug.drawRect(0,0,this.width,this.height),t.restore()}}ne._ID=0;class Yi extends ne{static from(t){return new Yi({image:t})}constructor(t){var e,i;super(t),this._logger=Y.getInstance(),this._dirty=!0,this._logNotLoadedWarning=!1,this.image=t.image;const{width:n,height:o}=t;this.sourceView=(e=t.sourceView)!==null&&e!==void 0?e:{x:0,y:0,width:n??0,height:o??0},this.destSize=(i=t.destSize)!==null&&i!==void 0?i:{width:n??0,height:o??0},this._updateSpriteDimensions(),this.image.ready.then(()=>{this._updateSpriteDimensions()})}get width(){return Math.abs(this.destSize.width*this.scale.x)}get height(){return Math.abs(this.destSize.height*this.scale.y)}set width(t){t/=Math.abs(this.scale.x),this.destSize.width=t,super.width=Math.ceil(this.destSize.width)}set height(t){t/=Math.abs(this.scale.y),this.destSize.height=t,super.height=Math.ceil(this.destSize.height)}_updateSpriteDimensions(){var t,e,i,n,o,h;const{width:d,height:u}=this.image;this.sourceView.width=((t=this.sourceView)===null||t===void 0?void 0:t.width)||d,this.sourceView.height=((e=this.sourceView)===null||e===void 0?void 0:e.height)||u,this.destSize.width=((i=this.destSize)===null||i===void 0?void 0:i.width)||((n=this.sourceView)===null||n===void 0?void 0:n.width)||d,this.destSize.height=((o=this.destSize)===null||o===void 0?void 0:o.height)||((h=this.sourceView)===null||h===void 0?void 0:h.height)||u,this.width=Math.ceil(this.destSize.width)*this.scale.x,this.height=Math.ceil(this.destSize.height)*this.scale.y}_preDraw(t,e,i){this.image.isLoaded()&&this._dirty&&(this._dirty=!1,this._updateSpriteDimensions()),super._preDraw(t,e,i)}_drawImage(t,e,i){this.image.isLoaded()?t.drawImage(this.image.image,this.sourceView.x,this.sourceView.y,this.sourceView.width,this.sourceView.height,e,i,this.destSize.width,this.destSize.height):(this._logNotLoadedWarning||this._logger.warn(`ImageSource ${this.image.path} is not yet loaded and won't be drawn. Please call .load() or include in a Loader.

Read https://excaliburjs.com/docs/imagesource for more information.`),this._logNotLoadedWarning=!0)}clone(){return new Yi({image:this.image,sourceView:{...this.sourceView},destSize:{...this.destSize},...this.cloneGraphicOptions()})}}var te;(function(a){a.Pixel="Pixel",a.Blended="Blended"})(te||(te={}));class At{static register(t){At._GL=t,At._MAX_TEXTURE_SIZE=t.getParameter(t.MAX_TEXTURE_SIZE)}static get(t){return At._TEXTURE_MAP.get(t)}static has(t){return At._TEXTURE_MAP.has(t)}static load(t,e,i=!1){const n=At._GL;if(!n)return null;let o=null;if(At.has(t)&&(o=At.get(t)),o)return i&&(n.bindTexture(n.TEXTURE_2D,o),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,t)),o;o=n.createTexture(),At.checkImageSizeSupportedAndLog(t),n.bindTexture(n.TEXTURE_2D,o),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE);const h=e??At.filtering;return n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,h===te.Pixel?n.NEAREST:n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,h===te.Pixel?n.NEAREST:n.LINEAR),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,t),At._TEXTURE_MAP.set(t,o),o}static delete(t){const e=At._GL;if(!e)return null;let i=null;At.has(t)&&(i=At.get(t),e.deleteTexture(i))}static checkImageSizeSupportedAndLog(t){var e;const i=(e=t.dataset.originalSrc)!==null&&e!==void 0?e:"internal canvas bitmap";return t.width>At._MAX_TEXTURE_SIZE||t.height>At._MAX_TEXTURE_SIZE?(At._LOGGER.error(`The image [${i}] provided to Excalibur is too large for the device's maximum texture size of (${At._MAX_TEXTURE_SIZE}x${At._MAX_TEXTURE_SIZE}) please resize to an image for excalibur to render properly.

Images will likely render as black rectangles.

Read more here: https://developer.mozilla.org/en-US/docs/Web/API/WebGL_API/WebGL_best_practices#understand_system_limits`),!1):((t.width>4096||t.height>4096)&&At._LOGGER.warn(`The image [${i}] provided to excalibur is too large may not work on all mobile devices, it is recommended you resize images to a maximum (4096x4096).

Images will likely render as black rectangles on some mobile platforms.

Read more here: https://developer.mozilla.org/en-US/docs/Web/API/WebGL_API/WebGL_best_practices#understand_system_limits`),!0)}}At._LOGGER=Y.getInstance(),At.filtering=te.Blended,At._TEXTURE_MAP=new Map,At._MAX_TEXTURE_SIZE=0;class vn{get width(){return this.image.naturalWidth}get height(){return this.image.naturalHeight}isLoaded(){return this._src||(this._src=this.data.src),!!this._src}get image(){return this.data}constructor(t,e=!1,i){this.path=t,this._logger=Y.getInstance(),this.data=new Image,this._readyFuture=new Ft,this.ready=this._readyFuture.promise,this._resource=new Ti(t,"blob",e),this._filtering=i,(t.endsWith(".svg")||t.endsWith(".gif"))&&this._logger.warn(`Image type is not fully supported, you may have mixed results ${t}. Fully supported: jpg, bmp, and png`)}async load(){if(this.isLoaded())return this.data;try{let t;if(this.path.includes("data:image/"))t=this.path;else{const n=await this._resource.load();t=URL.createObjectURL(n)}const e=new Image,i=new Ft;e.onload=()=>i.resolve(),e.src=t,e.setAttribute("data-original-src",this.path),await i.promise,this.data=e}catch(t){throw`Error loading ImageSource from path '${this.path}' with error [${t.message}]`}return At.load(this.data,this._filtering),this._readyFuture.resolve(this.data),this.data}toSprite(){return Yi.from(this)}unload(){this.data=new Image}}class $i{constructor(t){this._logger=Y.getInstance(),this.sprites=[];const{sprites:e,rows:i,columns:n}=t;this.sprites=e,this.rows=i??1,this.columns=n??this.sprites.length}getSprite(t,e){if(t>=this.columns||t<0)return this._logger.warn(`No sprite exists in the SpriteSheet at (${t}, ${e}), x: ${t} should be between 0 and ${this.columns-1}`),null;if(e>=this.rows||e<0)return this._logger.warn(`No sprite exists in the SpriteSheet at (${t}, ${e}), y: ${e} should be between 0 and ${this.rows-1}`),null;const i=t+e*this.columns;return this.sprites[i]}static fromImageSourceWithSourceViews(t){const e=t.sourceViews.map(i=>new Yi({image:t.image,sourceView:i}));return new $i({sprites:e})}static fromImageSource(t){var e;const i=[];t.spacing=(e=t.spacing)!==null&&e!==void 0?e:{};const{image:n,grid:{rows:o,columns:h,spriteWidth:d,spriteHeight:u},spacing:{originOffset:g,margin:v}}=t,I={x:0,y:0,...g},D={x:0,y:0,...v};for(let U=0;U<h;U++)for(let H=0;H<o;H++)i[U+H*h]=new Yi({image:n,sourceView:{x:U*d+D.x*U+I.x,y:H*u+D.y*H+I.y,width:d,height:u},destSize:{height:u,width:d}});return new $i({sprites:i,rows:o,columns:h})}clone(){return new $i({sprites:this.sprites.map(t=>t.clone()),rows:this.rows,columns:this.columns})}}class Gs extends ne{constructor(t){super(t),this._text="",this.alphabet="",this.shadow=null,this.caseInsensitive=!1,this.spacing=0,this._logger=Y.getInstance(),this._alreadyWarnedAlphabet=!1,this._alreadyWarnedSpriteSheet=!1;const{alphabet:e,spriteSheet:i,caseInsensitive:n,spacing:o,shadow:h}=t;this.alphabet=e,this.spriteSheet=i,this.caseInsensitive=n??this.caseInsensitive,this.spacing=o??this.spacing,this.shadow=h??this.shadow}_getCharacterSprites(t){const e=[],i=this.caseInsensitive?t.toLocaleLowerCase():t,n=this.caseInsensitive?this.alphabet.toLocaleLowerCase():this.alphabet;for(let o=0;o<i.length;o++){const h=i[o];let d=n.indexOf(h);d===-1&&(d=0,this._alreadyWarnedAlphabet||(this._logger.warn(`SpriteFont - Cannot find letter '${h}' in configured alphabet '${n}'.`),this._logger.warn("There maybe be more issues in the SpriteFont configuration. No additional warnings will be logged."),this._alreadyWarnedAlphabet=!0));const u=this.spriteSheet.sprites[d];u?e.push(u):this._alreadyWarnedSpriteSheet||(this._logger.warn(`SpriteFont - Cannot find sprite for '${h}' at index '${d}' in configured SpriteSheet`),this._logger.warn("There maybe be more issues in the SpriteFont configuration. No additional warnings will be logged."),this._alreadyWarnedSpriteSheet=!0)}return e}measureText(t,e){const i=this._getLinesFromText(t,e),n=i.reduce((u,g)=>u.length>g.length?u:g),o=this._getCharacterSprites(n);let h=0,d=0;for(const u of o)h+=u.width+this.spacing,d=Math.max(d,u.height);return nt.fromDimension(h,d*i.length,k.Zero)}_drawImage(t,e,i,n){let o=0,h=0,d=0;const u=this._getLinesFromText(this._text,n);for(const g of u){for(const v of this._getCharacterSprites(g))v.draw(t,e+o,i+h),o+=v.width+this.spacing,d=Math.max(d,v.height);o=0,h+=d}}render(t,e,i,n,o,h){this._text=e;const d=this.measureText(e,h);this.width=d.width,this.height=d.height,this.shadow&&(t.save(),t.translate(this.shadow.offset.x,this.shadow.offset.y),this._preDraw(t,n,o),this._drawImage(t,0,0,h),this._postDraw(t),t.restore()),this._preDraw(t,n,o),this._drawImage(t,0,0,h),this._postDraw(t)}clone(){return new Gs({alphabet:this.alphabet,spriteSheet:this.spriteSheet,spacing:this.spacing})}_getLinesFromText(t,e){if(Y.getInstance().info(this.spacing),this._cachedText===t&&this._cachedRenderWidth===e)return this._cachedLines;const i=t.split(`
`);if(e==null)return i;for(let n=0;n<i.length;n++){let o=i[n],h="";if(this.measureText(o).width>e){for(;this.measureText(o).width>e;)h=o[o.length-1]+h,o=o.slice(0,-1);i[n]=o,i[n+1]=h}}return this._cachedText=t,this._cachedLines=i,this._cachedRenderWidth=e,i}}const Fo="data:image/png;base64,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";class rr{constructor(){this.fontSheet=Fo,this.size=16,this.load()}load(){return this._imageSource=new vn(this.fontSheet),this._imageSource.load().then(()=>{this._spriteSheet=$i.fromImageSource({image:this._imageSource,grid:{rows:3,columns:16,spriteWidth:16,spriteHeight:16}}),this._spriteFont=new Gs({alphabet:`0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ,!'&."?-()+ `,caseInsensitive:!0,spriteSheet:this._spriteSheet,spacing:-6})})}write(t,e,i){this._imageSource.isLoaded()&&this._spriteFont.render(t,e,null,i.x,i.y)}}class Xr{constructor(t,e){this._gl=t,this._texture=e}use(){const t=this._gl;t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,this._texture)}disable(){const t=this._gl;t.bindTexture(t.TEXTURE_2D,null)}}class Ze{constructor(t){this.width=t.width,this.height=t.height,this._gl=t.gl,this._setupFramebuffer()}setResolution(t,e){const i=this._gl;this.width=t,this.height=e,i.bindTexture(i.TEXTURE_2D,this._frameTexture),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,this.width,this.height,0,i.RGBA,i.UNSIGNED_BYTE,null)}get frameBuffer(){return this._frameBuffer}get frameTexture(){return this._frameTexture}_setupFramebuffer(){const t=this._gl;this._frameTexture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this._frameTexture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,this.width,this.height,0,t.RGBA,t.UNSIGNED_BYTE,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE);const e=t.COLOR_ATTACHMENT0;this._frameBuffer=t.createFramebuffer(),t.bindFramebuffer(t.FRAMEBUFFER,this._frameBuffer),t.framebufferTexture2D(t.FRAMEBUFFER,e,t.TEXTURE_2D,this._frameTexture,0),this.disable()}toRenderSource(){return new Xr(this._gl,this._frameTexture)}use(){const t=this._gl;t.bindFramebuffer(t.FRAMEBUFFER,this._frameBuffer),t.viewport(0,0,this.width,this.height)}disable(){const t=this._gl;t.bindFramebuffer(t.FRAMEBUFFER,null),t.bindTexture(t.TEXTURE_2D,null)}}class ue{static clear(){ue._GL=null}static register(t){ue._GL=t}static get gl(){if(!ue._GL)throw Error("Attempted gl access before init");return ue._GL}}const Uo=`#version 300 es
in vec2 a_position;
in vec4 a_color;

out lowp vec4 v_color;

uniform mat4 u_matrix;

void main() {
   // Set the vertex position using the ortho transform matrix
   gl_Position = u_matrix * vec4(a_position, 0.0, 1.0);

   // Passthrough the color
   v_color = a_color;
}`,Lo=`#version 300 es
precision mediump float;

// Color
in lowp vec4 v_color;

out vec4 fragColor;

void main() {
  fragColor = v_color;
}`;function wn(a,t){switch(t){case a.FLOAT:return 4;case a.SHORT:return 2;case a.UNSIGNED_SHORT:return 2;case a.BYTE:return 1;case a.UNSIGNED_BYTE:return 1;default:return 1}}function or(a,t){switch(t){case a.LOW_FLOAT:case a.HIGH_FLOAT:case a.FLOAT:return 1;case a.FLOAT_VEC2:return 2;case a.FLOAT_VEC3:return 3;case a.FLOAT_VEC4:return 4;case a.BYTE:return 1;case a.UNSIGNED_BYTE:return 1;case a.UNSIGNED_SHORT:case a.SHORT:return 1;default:return 1}}function ar(a,t){switch(t){case a.LOW_FLOAT:case a.HIGH_FLOAT:case a.FLOAT:case a.FLOAT_VEC2:case a.FLOAT_VEC3:case a.FLOAT_VEC4:return a.FLOAT;case a.BYTE:return a.BYTE;case a.UNSIGNED_BYTE:return a.UNSIGNED_BYTE;case a.SHORT:return a.SHORT;case a.UNSIGNED_SHORT:return a.UNSIGNED_SHORT;default:return a.FLOAT}}class Ie{get compiled(){return this._compiled}constructor(t){this._gl=ue.gl,this.uniforms={},this.attributes={},this._compiled=!1;const{vertexSource:e,fragmentSource:i}=t;this.vertexSource=e,this.fragmentSource=i}use(){this._gl.useProgram(this.program),Ie._ACTIVE_SHADER_INSTANCE=this}isCurrentlyBound(){return Ie._ACTIVE_SHADER_INSTANCE===this}compile(){const t=this._gl,e=this._compileShader(t,this.vertexSource,t.VERTEX_SHADER),i=this._compileShader(t,this.fragmentSource,t.FRAGMENT_SHADER);this.program=this._createProgram(t,e,i);const n=this.getAttributes();for(const h of n)this.attributes[h.name]=h;const o=this.getUniforms();for(const h of o)this.uniforms[h.name]=h;return this._compiled=!0,this.program}getUniforms(){const t=this._gl,e=t.getProgramParameter(this.program,t.ACTIVE_UNIFORMS),i=[];for(let n=0;n<e;n++){const o=t.getActiveUniform(this.program,n),h=t.getUniformLocation(this.program,o.name);i.push({name:o.name,glType:o.type,location:h})}return i}getAttributes(){const t=this._gl,e=t.getProgramParameter(this.program,t.ACTIVE_ATTRIBUTES),i=[];for(let n=0;n<e;n++){const o=t.getActiveAttrib(this.program,n),h=t.getAttribLocation(this.program,o.name);i.push({name:o.name,glType:ar(t,o.type),size:or(t,o.type),location:h,normalized:!1})}return i}setTexture(t,e){const i=this._gl;i.activeTexture(i.TEXTURE0+t),i.bindTexture(i.TEXTURE_2D,e)}setUniformInt(t,e){this.setUniform("uniform1i",t,~~e)}setUniformIntArray(t,e){this.setUniform("uniform1iv",t,e)}setUniformBoolean(t,e){this.setUniform("uniform1i",t,e?1:0)}setUniformFloat(t,e){this.setUniform("uniform1f",t,e)}setUniformFloatArray(t,e){this.setUniform("uniform1fv",t,e)}setUniformFloatVector(t,e){this.setUniform("uniform2f",t,e.x,e.y)}setUniformMatrix(t,e){this.setUniform("uniformMatrix4fv",t,!1,e.data)}setUniform(t,e,...i){if(!this._compiled)throw Error(`Must compile shader before setting a uniform ${t}:${e}`);if(!this.isCurrentlyBound())throw Error("Currently accessed shader instance is not the current active shader in WebGL, must call `shader.use()` before setting uniforms");const o=this._gl.getUniformLocation(this.program,e);if(o){const h=[o,...i];this._gl[t].apply(this._gl,h)}else throw Error(`Uniform ${t}:${e} doesn't exist or is not used in the shader source code, unused uniforms are optimized away by most browsers`)}_createProgram(t,e,i){const n=t.createProgram();if(n===null)throw Error("Could not create graphics shader program");if(t.attachShader(n,e),t.attachShader(n,i),t.linkProgram(n),!t.getProgramParameter(n,t.LINK_STATUS))throw Error(`Could not link the program: [${t.getProgramInfoLog(n)}]`);return n}_compileShader(t,e,i){const n=t.VERTEX_SHADER===i?"vertex":"fragment",o=t.createShader(i);if(o===null)throw Error(`Could not build shader: [${e}]`);if(t.shaderSource(o,e),t.compileShader(o),!t.getShaderParameter(o,t.COMPILE_STATUS)){const d=t.getShaderInfoLog(o);throw Error(`Could not compile ${n} shader:

${d}${this._processSourceForError(e,d)}`)}return o}_processSourceForError(t,e){const i=t.split(`
`),n=e.search(/\d:\d/),o=e.indexOf(" ",n),[h,d]=e.slice(n,o).split(":").map(u=>Number(u));for(let u=0;u<i.length;u++)i[u]=`${u+1}: ${i[u]}${d===u+1?" <----- ERROR!":""}`;return`

Source:
`+i.join(`
`)}}Ie._ACTIVE_SHADER_INSTANCE=null;class He{constructor(t){this._gl=ue.gl,this.type="dynamic";const{size:e,type:i,data:n}=t;if(this.buffer=this._gl.createBuffer(),!n&&!e)throw Error("Must either provide data or a size to the VertexBuffer");n?this.bufferData=n:this.bufferData=new Float32Array(e),this.type=i??this.type;const o=this._gl;o.bindBuffer(o.ARRAY_BUFFER,this.buffer),o.bufferData(o.ARRAY_BUFFER,this.bufferData,this.type==="static"?o.STATIC_DRAW:o.DYNAMIC_DRAW)}bind(){const t=this._gl;t.bindBuffer(t.ARRAY_BUFFER,this.buffer)}upload(t){const e=this._gl;e.bindBuffer(e.ARRAY_BUFFER,this.buffer),t?e.bufferSubData(e.ARRAY_BUFFER,0,this.bufferData,0,t):e.bufferData(e.ARRAY_BUFFER,this.bufferData,this.type==="static"?e.STATIC_DRAW:e.DYNAMIC_DRAW)}}class Ii{get vertexBuffer(){return this._vertexBuffer}get attributes(){return this._attributes}constructor(t){this._gl=ue.gl,this._logger=Y.getInstance(),this._layout=[],this._attributes=[],this._vertexTotalSizeBytes=0;const{shader:e,vertexBuffer:i,attributes:n}=t;this._vertexBuffer=i,this._attributes=n,this._shader=e,this.initialize()}get totalVertexSizeBytes(){return this._vertexTotalSizeBytes}initialize(){if(!this._shader.compiled)throw Error("Shader not compiled, shader must be compiled before defining a vertex layout");this._layout.length=0;const t=this._shader.attributes;for(const i of this._attributes){const n=t[i[0]];if(!n)throw Error(`The attribute named: ${i[0]} size ${i[1]} not found in the shader source code:
 ${this._shader.vertexSource}`);if(n.size!==i[1])throw Error(`VertexLayout size definition for attribute: [${i[0]}, ${i[1]}], doesnt match shader source size ${n.size}:
 ${this._shader.vertexSource}`);this._layout.push(n)}let e=0;for(const i of this._layout){const n=wn(this._gl,i.glType);this._vertexTotalSizeBytes+=n*i.size,e+=i.size}this._vertexBuffer.bufferData.length%e!==0&&this._logger.warn(`The vertex component size (${e})  does divide evenly into the specified vertex buffer (${this._vertexBuffer.bufferData.length})`)}use(t=!1,e){const i=this._gl;if(!this._shader.isCurrentlyBound())throw Error("Shader associated with this vertex layout is not active! Call shader.use() before layout.use()");this._vertexBuffer.bind(),t&&this._vertexBuffer.upload(e);let n=0;for(const o of this._layout)i.vertexAttribPointer(o.location,o.size,o.glType,o.normalized,this.totalVertexSizeBytes,n),i.enableVertexAttribArray(o.location),n+=wn(i,o.glType)*o.size}}class zt{static clear(){zt.DrawCallCount=0,zt.DrawnImagesCount=0}}zt.DrawCallCount=0,zt.DrawnImagesCount=0;class Wr{constructor(){this.type="ex.line",this.priority=0,this._maxLines=10922,this._vertexIndex=0,this._lineCount=0}initialize(t,e){this._gl=t,this._context=e,this._shader=new Ie({vertexSource:Uo,fragmentSource:Lo}),this._shader.compile(),this._shader.use(),this._shader.setUniformMatrix("u_matrix",this._context.ortho),this._vertexBuffer=new He({size:6*2*this._maxLines,type:"dynamic"}),this._layout=new Ii({vertexBuffer:this._vertexBuffer,shader:this._shader,attributes:[["a_position",2],["a_color",4]]})}draw(t,e,i){this._isFull()&&this.flush(),this._lineCount++;const n=this._context.getTransform(),o=n.multiply(t),h=n.multiply(e),d=this._vertexBuffer.bufferData;d[this._vertexIndex++]=o.x,d[this._vertexIndex++]=o.y,d[this._vertexIndex++]=i.r/255,d[this._vertexIndex++]=i.g/255,d[this._vertexIndex++]=i.b/255,d[this._vertexIndex++]=i.a,d[this._vertexIndex++]=h.x,d[this._vertexIndex++]=h.y,d[this._vertexIndex++]=i.r/255,d[this._vertexIndex++]=i.g/255,d[this._vertexIndex++]=i.b/255,d[this._vertexIndex++]=i.a}_isFull(){return this._lineCount>=this._maxLines}hasPendingDraws(){return this._lineCount!==0}flush(){if(this._lineCount===0)return;const t=this._gl;this._shader.use(),this._layout.use(!0),this._shader.setUniformMatrix("u_matrix",this._context.ortho),t.drawArrays(t.LINES,0,this._lineCount*2),zt.DrawnImagesCount+=this._lineCount,zt.DrawCallCount++,this._vertexIndex=0,this._lineCount=0}}const Vo=`#version 300 es
in vec2 a_position;
in vec4 a_color;
in float a_size;
out lowp vec4 v_color;
uniform mat4 u_matrix;

void main() {
  gl_Position = u_matrix * vec4(a_position, 0.0, 1.0);
  gl_PointSize = a_size * 2.0;
  v_color = a_color;
}`,Oo=`#version 300 es

precision mediump float;
in lowp vec4 v_color;

out vec4 fragColor;

void main() {
  float r = 0.0, delta = 0.0, alpha = 1.0;
  vec2 cxy = 2.0 * gl_PointCoord - 1.0;
  r = dot(cxy, cxy);

  delta = fwidth(r);
  alpha = 1.0 - smoothstep(1.0 - delta, 1.0 + delta, r);
  // "premultiply" the color by alpha
  vec4 color = v_color;
  color.a = color.a * alpha;
  color.rgb = color.rgb * color.a;
  fragColor = color;
}`;class qs{constructor(){this.type="ex.point",this.priority=0,this._maxPoints=10922,this._pointCount=0,this._vertexIndex=0}initialize(t,e){this._gl=t,this._context=e,this._shader=new Ie({vertexSource:Vo,fragmentSource:Oo}),this._shader.compile(),this._shader.use(),this._shader.setUniformMatrix("u_matrix",this._context.ortho),this._buffer=new He({size:7*this._maxPoints,type:"dynamic"}),this._layout=new Ii({shader:this._shader,vertexBuffer:this._buffer,attributes:[["a_position",2],["a_color",4],["a_size",1]]})}draw(t,e,i){this._isFull()&&this.flush(),this._pointCount++;const n=this._context.getTransform(),o=this._context.opacity,h=this._context.snapToPixel,d=n.multiply(t);h&&(d.x=~~(d.x+wt),d.y=~~(d.y+wt));const u=this._buffer.bufferData;u[this._vertexIndex++]=d.x,u[this._vertexIndex++]=d.y,u[this._vertexIndex++]=e.r/255,u[this._vertexIndex++]=e.g/255,u[this._vertexIndex++]=e.b/255,u[this._vertexIndex++]=e.a*o,u[this._vertexIndex++]=i*Math.max(n.getScaleX(),n.getScaleY())}_isFull(){return this._pointCount>=this._maxPoints}hasPendingDraws(){return this._pointCount!==0}flush(){if(this._pointCount===0)return;const t=this._gl;this._shader.use(),this._layout.use(!0),this._shader.setUniformMatrix("u_matrix",this._context.ortho),t.drawArrays(t.POINTS,0,this._pointCount),zt.DrawnImagesCount+=this._pointCount,zt.DrawCallCount++,this._pointCount=0,this._vertexIndex=0}}const Je=`#version 300 es
in vec2 a_position;

in vec2 a_texcoord;
out vec2 v_texcoord;

void main() {
  gl_Position = vec4(a_position, 0.0, 1.0);

  // Pass the texcoord to the fragment shader.
  v_texcoord = a_texcoord;
}`,js=`#version 300 es
precision mediump float;

// Passed in from the vertex shader.
in vec2 v_texcoord;

// The texture.
uniform sampler2D u_texture;

out vec4 fragColor;

void main() {
   fragColor = texture(u_texture, v_texcoord);
}`;class bs{constructor(t){this._gl=t,this._shader=new Ie({vertexSource:Je,fragmentSource:js}),this._shader.compile(),this._buffer=new He({type:"static",data:new Float32Array([-1,-1,0,0,-1,1,0,1,1,-1,1,0,1,-1,1,0,-1,1,0,1,1,1,1,1])}),this._layout=new Ii({shader:this._shader,vertexBuffer:this._buffer,attributes:[["a_position",2],["a_texcoord",2]]}),this._buffer.upload()}renderWithPostProcessor(t){const e=this._gl;t.getShader().use(),t.getLayout().use(),e.drawArrays(e.TRIANGLES,0,6)}renderToScreen(){const t=this._gl;this._shader.use(),this._layout.use(),t.drawArrays(t.TRIANGLES,0,6)}}class ts{constructor(t,e){this._gl=ue.gl,this._logger=Y.getInstance();const i=this._gl;this.buffer=i.createBuffer(),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,this.buffer);const n=t*6;if(!e)this.bufferData=new Uint32Array(n);else{const d=Math.floor(16383.5);this.bufferGlType=i.UNSIGNED_SHORT,this.bufferData=new Uint16Array(n),t>d&&this._logger.warn(`Total quads exceeds hardware index buffer limit (uint16), max(${d}) requested quads(${t})`)}let o=0;for(let h=0;h<n;h+=6)this.bufferData[h+0]=o+0,this.bufferData[h+1]=o+1,this.bufferData[h+2]=o+2,this.bufferData[h+3]=o+2,this.bufferData[h+4]=o+1,this.bufferData[h+5]=o+3,o+=4;i.bufferData(i.ELEMENT_ARRAY_BUFFER,this.bufferData,i.STATIC_DRAW)}get size(){return this.bufferData.length}upload(){const t=this._gl;t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.buffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.bufferData,t.STATIC_DRAW)}bind(){const t=this._gl;t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.buffer)}}const lr=`#version 300 es
precision mediump float;

// UV coord
in vec2 v_texcoord;

// Texture index
in lowp float v_textureIndex;

// Textures in the current draw
uniform sampler2D u_textures[%%count%%];

// Opacity
in float v_opacity;

in vec4 v_tint;

out vec4 fragColor;

void main() {
   // In order to support the most efficient sprite batching, we have multiple
   // textures loaded into the gpu (usually 8) this picker logic skips over textures
   // that do not apply to a particular sprite.

   vec4 color = vec4(1.0, 0, 0, 1.0);

   // GLSL is templated out to pick the right texture and set the vec4 color
   %%texture_picker%%

   color.rgb = color.rgb * v_opacity;
   color.a = color.a * v_opacity;
   fragColor = color * v_tint;
}`,zo=`#version 300 es
in vec2 a_position;

// Opacity 
in float a_opacity;
out float v_opacity;

// UV coordinate
in vec2 a_texcoord;
out vec2 v_texcoord;

// Texture number
in lowp float a_textureIndex;
out lowp float v_textureIndex;

in vec4 a_tint;
out vec4 v_tint;

uniform mat4 u_matrix;

void main() {
   // Set the vertex position using the ortho transform matrix
   gl_Position = u_matrix * vec4(a_position, 0.0, 1.0);

   // Pass through the Opacity to the fragment shader
   v_opacity = a_opacity;
   // Pass through the UV coord to the fragment shader
   v_texcoord = a_texcoord;
   // Pass through the texture number to the fragment shader
   v_textureIndex = a_textureIndex;
   // Pass through the tint
   v_tint = a_tint;
}`;class Qs{constructor(){this.type="ex.image",this.priority=0,this._maxImages=10922,this._maxTextures=0,this._imageCount=0,this._textures=[],this._vertexIndex=0}initialize(t,e){this._gl=t,this._context=e,this._maxTextures=Math.min(t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),125);const i=this._transformFragmentSource(lr,this._maxTextures);this._shader=new Ie({fragmentSource:i,vertexSource:zo}),this._shader.compile(),this._shader.use(),this._shader.setUniformMatrix("u_matrix",e.ortho),this._shader.setUniformIntArray("u_textures",[...Array(this._maxTextures)].map((n,o)=>o)),this._buffer=new He({size:10*4*this._maxImages,type:"dynamic"}),this._layout=new Ii({shader:this._shader,vertexBuffer:this._buffer,attributes:[["a_position",2],["a_opacity",1],["a_texcoord",2],["a_textureIndex",1],["a_tint",4]]}),this._quads=new ts(this._maxImages,!0)}_transformFragmentSource(t,e){let i=t.replace("%%count%%",e.toString()),n="";for(let o=0;o<e;o++)o===0?n+=`if (v_textureIndex <= ${o}.5) {
`:n+=`   else if (v_textureIndex <= ${o}.5) {
`,n+=`      color = texture(u_textures[${o}], v_texcoord);
`,n+=`   }
`;return i=i.replace("%%texture_picker%%",n),i}_addImageAsTexture(t){const e=At.load(t);this._textures.indexOf(e)===-1&&this._textures.push(e)}_bindTextures(t){for(let e=0;e<this._maxTextures;e++)t.activeTexture(t.TEXTURE0+e),t.bindTexture(t.TEXTURE_2D,this._textures[e]||this._textures[0])}_getTextureIdForImage(t){return t?this._textures.indexOf(At.get(t)):-1}_isFull(){return this._imageCount>=this._maxImages||this._textures.length>=this._maxTextures}draw(t,e,i,n,o,h,d,u,g){var v,I,D,U;this._isFull()&&this.flush(),this._imageCount++,this._addImageAsTexture(t);let H=(t==null?void 0:t.width)||n||0,Z=(t==null?void 0:t.height)||o||0,K=[0,0,(v=n??(t==null?void 0:t.width))!==null&&v!==void 0?v:0,(I=o??(t==null?void 0:t.height))!==null&&I!==void 0?I:0],z=[e??1,i??1];h!==void 0&&d!==void 0&&u!==void 0&&g!==void 0&&(K=[e??1,i??1,(D=n??(t==null?void 0:t.width))!==null&&D!==void 0?D:0,(U=o??(t==null?void 0:t.height))!==null&&U!==void 0?U:0],z=[h,d],H=u,Z=g),e=K[0],i=K[1];const N=K[2],et=K[3],st=this._context.getTransform(),ft=this._context.opacity,at=this._context.snapToPixel;let q=B(z[0],z[1]),It=B(z[0]+H,z[1]),Tt=B(z[0],z[1]+Z),Lt=B(z[0]+H,z[1]+Z);q=st.multiply(q),It=st.multiply(It),Tt=st.multiply(Tt),Lt=st.multiply(Lt),at&&(q.x=~~(q.x+wt),q.y=~~(q.y+wt),It.x=~~(It.x+wt),It.y=~~(It.y+wt),Tt.x=~~(Tt.x+wt),Tt.y=~~(Tt.y+wt),Lt.x=~~(Lt.x+wt),Lt.y=~~(Lt.y+wt));const Et=this._context.tint,me=this._getTextureIdForImage(t),bi=t.width||H,xi=t.height||Z,yi=e/bi,_n=i/xi,gn=(e+N-.01)/bi,mn=(i+et-.01)/xi,gt=this._layout.vertexBuffer.bufferData;gt[this._vertexIndex++]=q.x,gt[this._vertexIndex++]=q.y,gt[this._vertexIndex++]=ft,gt[this._vertexIndex++]=yi,gt[this._vertexIndex++]=_n,gt[this._vertexIndex++]=me,gt[this._vertexIndex++]=Et.r/255,gt[this._vertexIndex++]=Et.g/255,gt[this._vertexIndex++]=Et.b/255,gt[this._vertexIndex++]=Et.a,gt[this._vertexIndex++]=Tt.x,gt[this._vertexIndex++]=Tt.y,gt[this._vertexIndex++]=ft,gt[this._vertexIndex++]=yi,gt[this._vertexIndex++]=mn,gt[this._vertexIndex++]=me,gt[this._vertexIndex++]=Et.r/255,gt[this._vertexIndex++]=Et.g/255,gt[this._vertexIndex++]=Et.b/255,gt[this._vertexIndex++]=Et.a,gt[this._vertexIndex++]=It.x,gt[this._vertexIndex++]=It.y,gt[this._vertexIndex++]=ft,gt[this._vertexIndex++]=gn,gt[this._vertexIndex++]=_n,gt[this._vertexIndex++]=me,gt[this._vertexIndex++]=Et.r/255,gt[this._vertexIndex++]=Et.g/255,gt[this._vertexIndex++]=Et.b/255,gt[this._vertexIndex++]=Et.a,gt[this._vertexIndex++]=Lt.x,gt[this._vertexIndex++]=Lt.y,gt[this._vertexIndex++]=ft,gt[this._vertexIndex++]=gn,gt[this._vertexIndex++]=mn,gt[this._vertexIndex++]=me,gt[this._vertexIndex++]=Et.r/255,gt[this._vertexIndex++]=Et.g/255,gt[this._vertexIndex++]=Et.b/255,gt[this._vertexIndex++]=Et.a}hasPendingDraws(){return this._imageCount!==0}flush(){if(this._imageCount===0)return;const t=this._gl;this._shader.use(),this._layout.use(!0,4*10*this._imageCount),this._shader.setUniformMatrix("u_matrix",this._context.ortho),this._bindTextures(t),this._quads.bind(),t.drawElements(t.TRIANGLES,this._imageCount*6,this._quads.bufferGlType,0),zt.DrawnImagesCount+=this._imageCount,zt.DrawCallCount++,this._imageCount=0,this._vertexIndex=0,this._textures.length=0}}const Gr=`#version 300 es

precision mediump float;

// UV coord
in vec2 v_uv;

in vec2 v_size; // in pixels

// Color coord to blend with image
in lowp vec4 v_color;

// Stroke color if used
in lowp vec4 v_strokeColor;

// Stroke thickness if used
in lowp float v_strokeThickness; // in pixels

// Opacity
in float v_opacity;

out vec4 fragColor;

void main() {
    // modified from https://stackoverflow.com/questions/59197671/glsl-rounded-rectangle-with-variable-border
    vec2 uv = v_uv;
    vec2 fragCoord = uv * v_size;
    float maxX = v_size.x - v_strokeThickness;
    float minX = v_strokeThickness;
    float maxY = v_size.y - v_strokeThickness;
    float minY = v_strokeThickness;

    if (fragCoord.x < maxX && fragCoord.x > minX &&
        fragCoord.y < maxY && fragCoord.y > minY) {
      fragColor = v_color;
    } else {
      fragColor = v_strokeColor;
    }
    fragColor.a *= v_opacity;
    fragColor.rgb *= fragColor.a;

    // vec2 v2CenteredPos     = abs(fragCoord - v_size.xy / 2.0);
    // vec2 v2HalfShapeSizePx = v_size.xy/2.0 - v_strokeThickness/2.0;

    // float fHalfBorderDist      = 0.0;
    // float fHalfBorderThickness = 0.0;

    // if (fragCoord.x > max(v_radius, v_strokeThickness) && 
    //     fragCoord.x < v_size.x - max(v_radius, v_strokeThickness))
    // {
    //     fHalfBorderDist      = v2CenteredPos.y - v2HalfShapeSizePx.y;
    //     fHalfBorderThickness = v_strokeThickness / 2.0;
    // }
    // else if (fragCoord.y > max(v_radius, v_strokeThickness) && 
    //          fragCoord.y < v_size.y - max(v_radius, v_strokeThickness))
    // {
    //     fHalfBorderDist      = v2CenteredPos.x - v2HalfShapeSizePx.x;
    //     fHalfBorderThickness = v_strokeThickness / 2.0;
    // }
    // else
    // {
    //     vec2 edgeVec = max(vec2(0.0), v_radius - vec2(
    //         uv.x > 0.5 ? v_size.x - fragCoord.x : fragCoord.x,
    //         uv.y > 0.5 ? v_size.y - fragCoord.y : fragCoord.y));
        
    //     float ellipse_ab    = v_radius-v_strokeThickness;
    //     vec2 ellipse_isect = (v_strokeThickness > v_radius || v_strokeThickness > v_radius) ? vec2(0.0) :
    //                             edgeVec.xy * ellipse_ab*ellipse_ab / length(ellipse_ab*edgeVec.yx); 
            
    //     fHalfBorderThickness = (v_radius - length(ellipse_isect)) / 2.0;
    //     fHalfBorderDist      = length(edgeVec) - (v_radius - fHalfBorderThickness);
    // }

    // vec4 v4FromColor = v_strokeColor;
    // v4FromColor.rgb *= v4FromColor.a;
    // vec4 v4ToColor   = vec4(0.0); // background color is transparent
    // if (fHalfBorderDist < 0.0) {
    //     v4ToColor = v_color;
    //     v4ToColor.rgb *= v4ToColor.a;
    // }

    // float mixPct = abs(fHalfBorderDist) - fHalfBorderThickness;

    // vec4 finalColor = mix(v4FromColor, v4ToColor, mixPct);
    // gl_FragColor = finalColor;
}`,No=`#version 300 es
in vec2 a_position;

// UV coordinate
in vec2 a_uv;
out vec2 v_uv;

in vec2 a_size;
out vec2 v_size;

// Opacity 
in float a_opacity;
out float v_opacity;

in vec4 a_color;
out vec4 v_color;

in vec4 a_strokeColor;
out vec4 v_strokeColor;

in float a_strokeThickness;
out float v_strokeThickness;

uniform mat4 u_matrix;


void main() {
   // Set the vertex position using the ortho transform matrix
   gl_Position = u_matrix * vec4(a_position, 0.0, 1.0);

   // Pass through UV coords
   v_uv = a_uv;
   // Pass through size
   v_size = a_size;
   // Pass through the Opacity to the fragment shader
   v_opacity = a_opacity;
   // Pass through the color to the fragment shader
   v_color = a_color;
   // Pass through the stroke color to the fragment shader
   v_strokeColor = a_strokeColor;
   // Pass through the stroke thickenss to the fragment shader
   v_strokeThickness = a_strokeThickness;
}`;class qr{constructor(){this.type="ex.rectangle",this.priority=0,this._maxRectangles=10922,this._rectangleCount=0,this._vertexIndex=0}initialize(t,e){this._gl=t,this._context=e,this._shader=new Ie({fragmentSource:Gr,vertexSource:No}),this._shader.compile(),this._shader.use(),this._shader.setUniformMatrix("u_matrix",e.ortho),this._buffer=new He({size:16*4*this._maxRectangles,type:"dynamic"}),this._layout=new Ii({shader:this._shader,vertexBuffer:this._buffer,attributes:[["a_position",2],["a_uv",2],["a_size",2],["a_opacity",1],["a_color",4],["a_strokeColor",4],["a_strokeThickness",1]]}),this._quads=new ts(this._maxRectangles,!0)}_isFull(){return this._rectangleCount>=this._maxRectangles}draw(...t){t[0]instanceof k&&t[1]instanceof k?this.drawLine.apply(this,t):this.drawRectangle.apply(this,t)}drawLine(t,e,i,n=1){this._isFull()&&this.flush(),this._rectangleCount++;const o=this._context.getTransform(),h=this._context.opacity,d=this._context.snapToPixel,u=e.sub(t),g=u.size,v=u.normalize().perpendicular(),I=n/2,D=o.multiply(v.scale(I).add(t)),U=o.multiply(v.scale(-I).add(t)),H=o.multiply(v.scale(I).add(e)),Z=o.multiply(v.scale(-I).add(e));d&&(D.x=~~(D.x+wt),D.y=~~(D.y+wt),H.x=~~(H.x+wt),H.y=~~(H.y+wt),U.x=~~(U.x+wt),U.y=~~(U.y+wt),Z.x=~~(Z.x+wt),Z.y=~~(Z.y+wt));const K=0,z=0,N=1,et=1,st=j.Transparent,ft=0,at=1,q=this._layout.vertexBuffer.bufferData;q[this._vertexIndex++]=D.x,q[this._vertexIndex++]=D.y,q[this._vertexIndex++]=K,q[this._vertexIndex++]=z,q[this._vertexIndex++]=g,q[this._vertexIndex++]=n,q[this._vertexIndex++]=h,q[this._vertexIndex++]=i.r/255,q[this._vertexIndex++]=i.g/255,q[this._vertexIndex++]=i.b/255,q[this._vertexIndex++]=i.a,q[this._vertexIndex++]=st.r/255,q[this._vertexIndex++]=st.g/255,q[this._vertexIndex++]=st.b/255,q[this._vertexIndex++]=st.a,q[this._vertexIndex++]=ft/at,q[this._vertexIndex++]=U.x,q[this._vertexIndex++]=U.y,q[this._vertexIndex++]=K,q[this._vertexIndex++]=et,q[this._vertexIndex++]=g,q[this._vertexIndex++]=n,q[this._vertexIndex++]=h,q[this._vertexIndex++]=i.r/255,q[this._vertexIndex++]=i.g/255,q[this._vertexIndex++]=i.b/255,q[this._vertexIndex++]=i.a,q[this._vertexIndex++]=st.r/255,q[this._vertexIndex++]=st.g/255,q[this._vertexIndex++]=st.b/255,q[this._vertexIndex++]=st.a,q[this._vertexIndex++]=ft/at,q[this._vertexIndex++]=H.x,q[this._vertexIndex++]=H.y,q[this._vertexIndex++]=N,q[this._vertexIndex++]=z,q[this._vertexIndex++]=g,q[this._vertexIndex++]=n,q[this._vertexIndex++]=h,q[this._vertexIndex++]=i.r/255,q[this._vertexIndex++]=i.g/255,q[this._vertexIndex++]=i.b/255,q[this._vertexIndex++]=i.a,q[this._vertexIndex++]=st.r/255,q[this._vertexIndex++]=st.g/255,q[this._vertexIndex++]=st.b/255,q[this._vertexIndex++]=st.a,q[this._vertexIndex++]=ft/at,q[this._vertexIndex++]=Z.x,q[this._vertexIndex++]=Z.y,q[this._vertexIndex++]=N,q[this._vertexIndex++]=et,q[this._vertexIndex++]=g,q[this._vertexIndex++]=n,q[this._vertexIndex++]=h,q[this._vertexIndex++]=i.r/255,q[this._vertexIndex++]=i.g/255,q[this._vertexIndex++]=i.b/255,q[this._vertexIndex++]=i.a,q[this._vertexIndex++]=st.r/255,q[this._vertexIndex++]=st.g/255,q[this._vertexIndex++]=st.b/255,q[this._vertexIndex++]=st.a,q[this._vertexIndex++]=ft/at}drawRectangle(t,e,i,n,o=j.Transparent,h=0){this._isFull()&&this.flush(),this._rectangleCount++;const d=this._context.getTransform(),u=this._context.opacity,g=this._context.snapToPixel,v=d.multiply(t.add(B(0,0))),I=d.multiply(t.add(B(e,0))),D=d.multiply(t.add(B(e,i))),U=d.multiply(t.add(B(0,i)));g&&(v.x=~~(v.x+wt),v.y=~~(v.y+wt),I.x=~~(I.x+wt),I.y=~~(I.y+wt),U.x=~~(U.x+wt),U.y=~~(U.y+wt),D.x=~~(D.x+wt),D.y=~~(D.y+wt));const H=0,Z=0,K=1,z=1,N=this._layout.vertexBuffer.bufferData;N[this._vertexIndex++]=v.x,N[this._vertexIndex++]=v.y,N[this._vertexIndex++]=H,N[this._vertexIndex++]=Z,N[this._vertexIndex++]=e,N[this._vertexIndex++]=i,N[this._vertexIndex++]=u,N[this._vertexIndex++]=n.r/255,N[this._vertexIndex++]=n.g/255,N[this._vertexIndex++]=n.b/255,N[this._vertexIndex++]=n.a,N[this._vertexIndex++]=o.r/255,N[this._vertexIndex++]=o.g/255,N[this._vertexIndex++]=o.b/255,N[this._vertexIndex++]=o.a,N[this._vertexIndex++]=h,N[this._vertexIndex++]=U.x,N[this._vertexIndex++]=U.y,N[this._vertexIndex++]=H,N[this._vertexIndex++]=z,N[this._vertexIndex++]=e,N[this._vertexIndex++]=i,N[this._vertexIndex++]=u,N[this._vertexIndex++]=n.r/255,N[this._vertexIndex++]=n.g/255,N[this._vertexIndex++]=n.b/255,N[this._vertexIndex++]=n.a,N[this._vertexIndex++]=o.r/255,N[this._vertexIndex++]=o.g/255,N[this._vertexIndex++]=o.b/255,N[this._vertexIndex++]=o.a,N[this._vertexIndex++]=h,N[this._vertexIndex++]=I.x,N[this._vertexIndex++]=I.y,N[this._vertexIndex++]=K,N[this._vertexIndex++]=Z,N[this._vertexIndex++]=e,N[this._vertexIndex++]=i,N[this._vertexIndex++]=u,N[this._vertexIndex++]=n.r/255,N[this._vertexIndex++]=n.g/255,N[this._vertexIndex++]=n.b/255,N[this._vertexIndex++]=n.a,N[this._vertexIndex++]=o.r/255,N[this._vertexIndex++]=o.g/255,N[this._vertexIndex++]=o.b/255,N[this._vertexIndex++]=o.a,N[this._vertexIndex++]=h,N[this._vertexIndex++]=D.x,N[this._vertexIndex++]=D.y,N[this._vertexIndex++]=K,N[this._vertexIndex++]=z,N[this._vertexIndex++]=e,N[this._vertexIndex++]=i,N[this._vertexIndex++]=u,N[this._vertexIndex++]=n.r/255,N[this._vertexIndex++]=n.g/255,N[this._vertexIndex++]=n.b/255,N[this._vertexIndex++]=n.a,N[this._vertexIndex++]=o.r/255,N[this._vertexIndex++]=o.g/255,N[this._vertexIndex++]=o.b/255,N[this._vertexIndex++]=o.a,N[this._vertexIndex++]=h}hasPendingDraws(){return this._rectangleCount!==0}flush(){if(this._rectangleCount===0)return;const t=this._gl;this._shader.use(),this._layout.use(!0),this._shader.setUniformMatrix("u_matrix",this._context.ortho),this._quads.bind(),t.drawElements(t.TRIANGLES,this._rectangleCount*6,this._quads.bufferGlType,0),zt.DrawnImagesCount+=this._rectangleCount,zt.DrawCallCount++,this._rectangleCount=0,this._vertexIndex=0}}const jr=`#version 300 es
precision highp float;

// UV coord
in vec2 v_uv;

// Color coord to blend with image
in lowp vec4 v_color;

// Stroke color if used
in lowp vec4 v_strokeColor;

// Stroke thickness if used
in lowp float v_strokeThickness;

// Opacity
in float v_opacity;

out vec4 fragColor;

void main() {
  // make (0, 0) the center the uv 
  vec2 uv = v_uv * 2.0 - 1.0;

  vec4 color = v_color;
  vec4 strokeColor = v_strokeColor;

  // circle border is at radius 1.0 
  // dist is > 0 when inside the circle 
  float d = length(uv);
  float dist = 1.0 - length(uv);

  // Fade based on fwidth
  float fade = fwidth(dot(uv, uv));

  // if dist is greater than 0 step to 1;
  // when we cross this 0 threshold add a smooth fade
  float fill = smoothstep(-fade/2.0, fade/2.0, dist);

  // if dist is greater than the stroke thickness step to 1
  float stroke = 1.0 - smoothstep(v_strokeThickness, v_strokeThickness + fade, dist);

  strokeColor.a *= fill * stroke;
  strokeColor.rgb *= strokeColor.a;

  color.a *= fill * (1.0 - stroke);
  color.rgb *= color.a;

  vec4 finalColor = mix(vec4(0.0), (color + strokeColor), fill);
  finalColor.rgb = finalColor.rgb * v_opacity;
  finalColor.a = finalColor.a * v_opacity;
  fragColor = finalColor;
}`,Ho=`#version 300 es
in vec2 a_position;

// UV coordinate
in vec2 a_uv;
out vec2 v_uv;

// Opacity 
in float a_opacity;
out float v_opacity;

in vec4 a_color;
out vec4 v_color;

in vec4 a_strokeColor;
out vec4 v_strokeColor;

in float a_strokeThickness;
out float v_strokeThickness;

uniform mat4 u_matrix;


void main() {
   // Set the vertex position using the ortho transform matrix
   gl_Position = u_matrix * vec4(a_position, 0.0, 1.0);

   // Pass through UV coords
   v_uv = a_uv;
   // Pass through the Opacity to the fragment shader
   v_opacity = a_opacity;
   // Pass through the color to the fragment shader
   v_color = a_color;
   // Pass through the stroke color to the fragment shader
   v_strokeColor = a_strokeColor;
   // Pass through the stroke thickenss to the fragment shader
   v_strokeThickness = a_strokeThickness;
}`;class bn{constructor(){this.type="ex.circle",this.priority=0,this._maxCircles=10922,this._circleCount=0,this._vertexIndex=0}initialize(t,e){this._gl=t,this._context=e,this._shader=new Ie({fragmentSource:jr,vertexSource:Ho}),this._shader.compile(),this._shader.use(),this._shader.setUniformMatrix("u_matrix",e.ortho),this._buffer=new He({size:14*4*this._maxCircles,type:"dynamic"}),this._layout=new Ii({shader:this._shader,vertexBuffer:this._buffer,attributes:[["a_position",2],["a_uv",2],["a_opacity",1],["a_color",4],["a_strokeColor",4],["a_strokeThickness",1]]}),this._quads=new ts(this._maxCircles,!0)}_isFull(){return this._circleCount>=this._maxCircles}draw(t,e,i,n=j.Transparent,o=0){this._isFull()&&this.flush(),this._circleCount++;const h=this._context.getTransform(),d=this._context.opacity,u=this._context.snapToPixel,g=h.multiply(t.add(B(-e,-e))),v=h.multiply(t.add(B(e,-e))),I=h.multiply(t.add(B(e,e))),D=h.multiply(t.add(B(-e,e)));u&&(g.x=~~(g.x+wt),g.y=~~(g.y+wt),v.x=~~(v.x+wt),v.y=~~(v.y+wt),D.x=~~(D.x+wt),D.y=~~(D.y+wt),I.x=~~(I.x+wt),I.y=~~(I.y+wt));const U=0,H=0,Z=1,K=1,z=this._layout.vertexBuffer.bufferData;z[this._vertexIndex++]=g.x,z[this._vertexIndex++]=g.y,z[this._vertexIndex++]=U,z[this._vertexIndex++]=H,z[this._vertexIndex++]=d,z[this._vertexIndex++]=i.r/255,z[this._vertexIndex++]=i.g/255,z[this._vertexIndex++]=i.b/255,z[this._vertexIndex++]=i.a,z[this._vertexIndex++]=n.r/255,z[this._vertexIndex++]=n.g/255,z[this._vertexIndex++]=n.b/255,z[this._vertexIndex++]=n.a,z[this._vertexIndex++]=o/e,z[this._vertexIndex++]=D.x,z[this._vertexIndex++]=D.y,z[this._vertexIndex++]=U,z[this._vertexIndex++]=K,z[this._vertexIndex++]=d,z[this._vertexIndex++]=i.r/255,z[this._vertexIndex++]=i.g/255,z[this._vertexIndex++]=i.b/255,z[this._vertexIndex++]=i.a,z[this._vertexIndex++]=n.r/255,z[this._vertexIndex++]=n.g/255,z[this._vertexIndex++]=n.b/255,z[this._vertexIndex++]=n.a,z[this._vertexIndex++]=o/e,z[this._vertexIndex++]=v.x,z[this._vertexIndex++]=v.y,z[this._vertexIndex++]=Z,z[this._vertexIndex++]=H,z[this._vertexIndex++]=d,z[this._vertexIndex++]=i.r/255,z[this._vertexIndex++]=i.g/255,z[this._vertexIndex++]=i.b/255,z[this._vertexIndex++]=i.a,z[this._vertexIndex++]=n.r/255,z[this._vertexIndex++]=n.g/255,z[this._vertexIndex++]=n.b/255,z[this._vertexIndex++]=n.a,z[this._vertexIndex++]=o/e,z[this._vertexIndex++]=I.x,z[this._vertexIndex++]=I.y,z[this._vertexIndex++]=Z,z[this._vertexIndex++]=K,z[this._vertexIndex++]=d,z[this._vertexIndex++]=i.r/255,z[this._vertexIndex++]=i.g/255,z[this._vertexIndex++]=i.b/255,z[this._vertexIndex++]=i.a,z[this._vertexIndex++]=n.r/255,z[this._vertexIndex++]=n.g/255,z[this._vertexIndex++]=n.b/255,z[this._vertexIndex++]=n.a,z[this._vertexIndex++]=o/e}hasPendingDraws(){return this._circleCount!==0}flush(){if(this._circleCount===0)return;const t=this._gl;this._shader.use(),this._layout.use(!0),this._shader.setUniformMatrix("u_matrix",this._context.ortho),this._quads.bind(),t.drawElements(t.TRIANGLES,this._circleCount*6,this._quads.bufferGlType,0),zt.DrawnImagesCount+=this._circleCount,zt.DrawCallCount++,this._circleCount=0,this._vertexIndex=0}}class hr{constructor(t,e,i=100){this.builder=t,this.recycler=e,this.maxObjects=i,this.totalAllocations=0,this.index=0,this.objects=[],this.disableWarnings=!1,this._logger=Y.getInstance()}preallocate(){for(let t=0;t<this.maxObjects;t++)this.objects[t]=this.builder()}using(t){const e=t(this);return e?this.done(...e):this.done()}borrow(t){const e=this.get();t(e),this.index--}get(...t){return this.index===this.maxObjects&&(this.disableWarnings||this._logger.warn("Max pooled objects reached, possible memory leak? Doubling"),this.maxObjects=this.maxObjects*2),this.objects[this.index]?this.recycler(this.objects[this.index++],...t):(this.totalAllocations++,this.objects[this.index++]=this.builder(...t))}done(...t){this.index=0;for(const e of t){const i=this.objects.indexOf(e);this.objects[i]=this.builder(),this.totalAllocations++}return t}}class Qr{constructor(){this.z=0,this.priority=0,this.transform=ct.identity(),this.state={z:0,opacity:1,tint:j.White}}}const wt=1e-4;class Xo{constructor(t){this._webglCtx=t,this._debugText=new rr}drawRect(t,e,i,n,o={color:j.Black}){this.drawLine(B(t,e),B(t+i,e),{...o}),this.drawLine(B(t+i,e),B(t+i,e+n),{...o}),this.drawLine(B(t+i,e+n),B(t,e+n),{...o}),this.drawLine(B(t,e+n),B(t,e),{...o})}drawLine(t,e,i={color:j.Black}){this._webglCtx.draw("ex.line",t,e,i.color)}drawPoint(t,e={color:j.Black,size:5}){this._webglCtx.draw("ex.point",t,e.color,e.size)}drawText(t,e){this._debugText.write(this._webglCtx,t,e)}}class Ks{get z(){return this._state.current.z}set z(t){this._state.current.z=t}get opacity(){return this._state.current.opacity}set opacity(t){this._state.current.opacity=t}get tint(){return this._state.current.tint}set tint(t){this._state.current.tint=t}get width(){return this.__gl.canvas.width}get height(){return this.__gl.canvas.height}get ortho(){return this._ortho}checkIfResolutionSupported(t){let e=!0;return(t.width>4096||t.height>4096)&&(e=!1),e}constructor(t){this._logger=Y.getInstance(),this._renderers=new Map,this._isDrawLifecycle=!1,this.useDrawSorting=!0,this._drawCallPool=new hr(()=>new Qr,u=>(u.priority=0,u.z=0,u.renderer=void 0,u.args=void 0,u),4e3),this._drawCalls=[],this._postProcessTargets=[],this._postprocessors=[],this._transform=new Qt,this._state=new ps,this.snapToPixel=!1,this.smoothing=!1,this.backgroundColor=j.ExcaliburBlue,this._alreadyWarnedDrawLifecycle=!1,this.debug=new Xo(this);const{canvasElement:e,enableTransparency:i,smoothing:n,snapToPixel:o,backgroundColor:h,useDrawSorting:d}=t;if(this.__gl=e.getContext("webgl2",{antialias:n??this.smoothing,premultipliedAlpha:!1,alpha:i??!0,depth:!0,powerPreference:"high-performance"}),!this.__gl)throw Error("Failed to retrieve webgl context from browser");ue.register(this.__gl),At.register(this.__gl),this.snapToPixel=o??this.snapToPixel,this.smoothing=n??this.smoothing,this.backgroundColor=h??this.backgroundColor,this.useDrawSorting=d??this.useDrawSorting,this._drawCallPool.disableWarnings=!0,this._drawCallPool.preallocate(),this._init()}_init(){const t=this.__gl;this._ortho=Jt.ortho(0,t.canvas.width,t.canvas.height,0,400,-400),t.viewport(0,0,t.canvas.width,t.canvas.height),t.clearColor(this.backgroundColor.r/255,this.backgroundColor.g/255,this.backgroundColor.b/255,this.backgroundColor.a),t.clear(t.COLOR_BUFFER_BIT),t.enable(t.BLEND),t.blendEquation(t.FUNC_ADD),t.blendFunc(t.ONE,t.ONE_MINUS_SRC_ALPHA),t.blendEquationSeparate(t.FUNC_ADD,t.FUNC_ADD),t.blendFuncSeparate(t.ONE,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA),this.register(new Qs),this.register(new qr),this.register(new bn),this.register(new qs),this.register(new Wr),this._screenRenderer=new bs(t),this._renderTarget=new Ze({gl:t,width:t.canvas.width,height:t.canvas.height}),this._postProcessTargets=[new Ze({gl:t,width:t.canvas.width,height:t.canvas.height}),new Ze({gl:t,width:t.canvas.width,height:t.canvas.height})]}register(t){this._renderers.set(t.type,t),t.initialize(this.__gl,this)}get(t){return this._renderers.get(t)}_isCurrentRenderer(t){return!this._currentRenderer||this._currentRenderer===t}beginDrawLifecycle(){this._isDrawLifecycle=!0}endDrawLifecycle(){this._isDrawLifecycle=!1}draw(t,...e){!this._isDrawLifecycle&&!this._alreadyWarnedDrawLifecycle&&(this._logger.warn(`Attempting to draw outside the the drawing lifecycle (preDraw/postDraw) is not supported and is a source of bugs/errors.
If you want to do custom drawing, use Actor.graphics, or any onPreDraw or onPostDraw handler.`),this._alreadyWarnedDrawLifecycle=!0);const i=this._renderers.get(t);if(i)if(this.useDrawSorting){const n=this._drawCallPool.get();n.z=this._state.current.z,n.priority=i.priority,n.renderer=t,this.getTransform().clone(n.transform),n.state.z=this._state.current.z,n.state.opacity=this._state.current.opacity,n.state.tint=this._state.current.tint,n.args=e,this._drawCalls.push(n)}else this._currentRenderer||(this._currentRenderer=i),this._isCurrentRenderer(i)||this._currentRenderer.flush(),i.draw(...e),this._currentRenderer=i;else throw Error(`No renderer with name ${t} has been registered`)}resetTransform(){this._transform.current=ct.identity()}updateViewport(t){const e=this.__gl;this._ortho=this._ortho=Jt.ortho(0,t.width,t.height,0,400,-400),this._renderTarget.setResolution(e.canvas.width,e.canvas.height),this._postProcessTargets[0].setResolution(e.canvas.width,e.canvas.height),this._postProcessTargets[1].setResolution(e.canvas.width,e.canvas.height)}drawImage(t,e,i,n,o,h,d,u,g){if(!(n===0||o===0)){{if(u===0||g===0)return;if(t.width===0||t.height===0)return}if(!t){Y.getInstance().warn("Cannot draw a null or undefined image"),console.trace&&console.trace();return}this.draw("ex.image",t,e,i,n,o,h,d,u,g)}}drawLine(t,e,i,n=1){this.draw("ex.rectangle",t,e,i,n)}drawRectangle(t,e,i,n,o,h){this.draw("ex.rectangle",t,e,i,n,o,h)}drawCircle(t,e,i,n,o){this.draw("ex.circle",t,e,i,n,o)}save(){this._transform.save(),this._state.save()}restore(){this._transform.restore(),this._state.restore()}translate(t,e){this._transform.translate(this.snapToPixel?~~(t+wt):t,this.snapToPixel?~~(e+wt):e)}rotate(t){this._transform.rotate(t)}scale(t,e){this._transform.scale(t,e)}transform(t){this._transform.current=t}getTransform(){return this._transform.current}multiply(t){this._transform.current.multiply(t,this._transform.current)}addPostProcessor(t){this._postprocessors.push(t),t.initialize(this.__gl)}removePostProcessor(t){const e=this._postprocessors.indexOf(t);e!==-1&&this._postprocessors.splice(e,1)}clearPostProcessors(){this._postprocessors.length=0}clear(){const t=this.__gl;this._renderTarget.use(),t.clearColor(this.backgroundColor.r/255,this.backgroundColor.g/255,this.backgroundColor.b/255,this.backgroundColor.a),t.clear(t.COLOR_BUFFER_BIT)}flush(){const t=this.__gl;if(this._renderTarget.use(),this.useDrawSorting){const i=new Map;for(const[h]of this._renderers){const d=this._drawCalls.findIndex(u=>u.renderer===h);i.set(h,d)}this._drawCalls.sort((h,d)=>{const u=h.z-d.z,g=i.get(h.renderer)-i.get(d.renderer),v=h.priority-d.priority;return u===0?v===0?g:v:u});const n=this._transform.current,o=this._state.current;if(this._drawCalls.length){let h=this._drawCalls[0].renderer,d=this._renderers.get(h);for(let u=0;u<this._drawCalls.length;u++)this._transform.current=this._drawCalls[u].transform,this._state.current=this._drawCalls[u].state,this._drawCalls[u].renderer!==h&&(d.flush(),h=this._drawCalls[u].renderer,d=this._renderers.get(h)),d.draw(...this._drawCalls[u].args);d.hasPendingDraws()&&d.flush()}this._transform.current=n,this._state.current=o,this._drawCallPool.done(),this._drawCalls.length=0}else for(const i of this._renderers.values())i.hasPendingDraws()&&i.flush();this._renderTarget.disable(),this._renderTarget.toRenderSource().use();for(let i=0;i<this._postprocessors.length;i++)this._postProcessTargets[i%2].use(),this._screenRenderer.renderWithPostProcessor(this._postprocessors[i]),this._postProcessTargets[i%2].toRenderSource().use();t.bindFramebuffer(t.FRAMEBUFFER,null),this._screenRenderer.renderToScreen()}}const Nt=1e-4;class Wo{constructor(t){this._ex=t,this._debugText=new rr}drawRect(t,e,i,n){this._ex.__ctx.save(),this._ex.__ctx.strokeStyle="red",this._ex.__ctx.strokeRect(this._ex.snapToPixel?~~(t+Nt):t,this._ex.snapToPixel?~~(e+Nt):e,this._ex.snapToPixel?~~(i+Nt):i,this._ex.snapToPixel?~~(n+Nt):n),this._ex.__ctx.restore()}drawLine(t,e,i={color:j.Black}){this._ex.__ctx.save(),this._ex.__ctx.beginPath(),this._ex.__ctx.strokeStyle=i.color.toString(),this._ex.__ctx.moveTo(this._ex.snapToPixel?~~(t.x+Nt):t.x,this._ex.snapToPixel?~~(t.y+Nt):t.y),this._ex.__ctx.lineTo(this._ex.snapToPixel?~~(e.x+Nt):e.x,this._ex.snapToPixel?~~(e.y+Nt):e.y),this._ex.__ctx.lineWidth=2,this._ex.__ctx.stroke(),this._ex.__ctx.closePath(),this._ex.__ctx.restore()}drawPoint(t,e={color:j.Black,size:5}){this._ex.__ctx.save(),this._ex.__ctx.beginPath(),this._ex.__ctx.fillStyle=e.color.toString(),this._ex.__ctx.arc(this._ex.snapToPixel?~~(t.x+Nt):t.x,this._ex.snapToPixel?~~(t.y+Nt):t.y,e.size,0,Math.PI*2),this._ex.__ctx.fill(),this._ex.__ctx.closePath(),this._ex.__ctx.restore()}drawText(t,e){this._debugText.write(this._ex,t,e)}}class xs{get width(){return this.__ctx.canvas.width}get height(){return this.__ctx.canvas.height}get opacity(){return this._state.current.opacity}set opacity(t){this._state.current.opacity=t}get tint(){return this._state.current.tint}set tint(t){this._state.current.tint=t}get smoothing(){return this.__ctx.imageSmoothingEnabled}set smoothing(t){this.__ctx.imageSmoothingEnabled=t}constructor(t){this.useDrawSorting=!1,this.z=0,this.backgroundColor=j.ExcaliburBlue,this._state=new ps,this.snapToPixel=!1,this.debug=new Wo(this);const{canvasElement:e,enableTransparency:i,snapToPixel:n,smoothing:o,backgroundColor:h}=t;this.__ctx=e.getContext("2d",{alpha:i??!0}),this.backgroundColor=h??this.backgroundColor,this.snapToPixel=n??this.snapToPixel,this.smoothing=o??this.smoothing}resetTransform(){this.__ctx.resetTransform()}updateViewport(t){}drawImage(t,e,i,n,o,h,d,u,g){if(n===0||o===0)return;if(u===0||g===0)return;if(t.width===0||t.height===0)return;this.__ctx.globalAlpha=this.opacity;const v=[t,e,i,n,o,h,d,u,g].filter(I=>I!==void 0).map(I=>typeof I=="number"&&this.snapToPixel?~~I:I);this.__ctx.drawImage.apply(this.__ctx,v),zt.DrawCallCount++,zt.DrawnImagesCount=1}drawLine(t,e,i,n=1){this.__ctx.save(),this.__ctx.beginPath(),this.__ctx.strokeStyle=i.toString(),this.__ctx.moveTo(this.snapToPixel?~~(t.x+Nt):t.x,this.snapToPixel?~~(t.y+Nt):t.y),this.__ctx.lineTo(this.snapToPixel?~~(e.x+Nt):e.x,this.snapToPixel?~~(e.y+Nt):e.y),this.__ctx.lineWidth=n,this.__ctx.stroke(),this.__ctx.closePath(),this.__ctx.restore()}drawRectangle(t,e,i,n){this.__ctx.save(),this.__ctx.fillStyle=n.toString(),this.__ctx.fillRect(this.snapToPixel?~~(t.x+Nt):t.x,this.snapToPixel?~~(t.y+Nt):t.y,this.snapToPixel?~~(e+Nt):e,this.snapToPixel?~~(i+Nt):i),this.__ctx.restore()}drawCircle(t,e,i,n,o){this.__ctx.save(),this.__ctx.beginPath(),n&&(this.__ctx.strokeStyle=n.toString()),o&&(this.__ctx.lineWidth=o),this.__ctx.fillStyle=i.toString(),this.__ctx.arc(this.snapToPixel?~~(t.x+Nt):t.x,this.snapToPixel?~~(t.y+Nt):t.y,e,0,Math.PI*2),this.__ctx.fill(),n&&this.__ctx.stroke(),this.__ctx.closePath(),this.__ctx.restore()}save(){this.__ctx.save()}restore(){this.__ctx.restore()}translate(t,e){this.__ctx.translate(this.snapToPixel?~~(t+Nt):t,this.snapToPixel?~~(e+Nt):e)}rotate(t){this.__ctx.rotate(t)}scale(t,e){this.__ctx.scale(t,e)}getTransform(){throw new Error("Not implemented")}multiply(t){this.__ctx.setTransform(this.__ctx.getTransform().multiply(t.toDOMMatrix()))}addPostProcessor(t){}removePostProcessor(t){}clearPostProcessors(){}beginDrawLifecycle(){}endDrawLifecycle(){}clear(){this.__ctx.clearRect(0,0,this.width,this.height),this.__ctx.fillStyle=this.backgroundColor.toString(),this.__ctx.fillRect(0,0,this.width,this.height),zt.clear()}flush(){}}var Ut;(function(a){a.Fixed="Fixed",a.FitContainerAndFill="FitContainerAndFill",a.FitScreenAndFill="FitScreenAndFill",a.FitContainerAndZoom="FitContainerAndZoom",a.FitScreenAndZoom="FitScreenAndZoom",a.FitScreen="FitScreen",a.FillScreen="FillScreen",a.FitContainer="FitContainer",a.FillContainer="FillContainer"})(Ut||(Ut={}));class es{static get SVGA(){return{width:800,height:600}}static get Standard(){return{width:1920,height:1080}}static get Atari2600(){return{width:160,height:192}}static get GameBoy(){return{width:160,height:144}}static get GameBoyAdvance(){return{width:240,height:160}}static get NintendoDS(){return{width:256,height:192}}static get NES(){return{width:256,height:224}}static get SNES(){return{width:256,height:244}}}class Zs{constructor(t){var e,i,n;this._antialiasing=!0,this._resolutionStack=[],this._viewportStack=[],this._pixelRatioOverride=null,this._isFullScreen=!1,this._isDisposed=!1,this._logger=Y.getInstance(),this._fullscreenChangeHandler=()=>{this._isFullScreen=!this._isFullScreen,this._logger.debug("Fullscreen Change",this._isFullScreen)},this._pixelRatioChangeHandler=()=>{this._logger.debug("Pixel Ratio Change",window.devicePixelRatio),this._listenForPixelRatio(),this._devicePixelRatio=this._calculateDevicePixelRatio(),this.applyResolutionAndViewport()},this._resizeHandler=()=>{const o=this.parent;this._logger.debug("View port resized"),this._setResolutionAndViewportByDisplayMode(o),this.applyResolutionAndViewport()},this._devicePixelRatio=this._calculateDevicePixelRatio(),this._alreadyWarned=!1,this._contentArea=new nt,this.viewport=t.viewport,this.resolution=(e=t.resolution)!==null&&e!==void 0?e:{...this.viewport},this._contentResolution=this.resolution,this._displayMode=(i=t.displayMode)!==null&&i!==void 0?i:Ut.Fixed,this._canvas=t.canvas,this.graphicsContext=t.context,this._antialiasing=(n=t.antialiasing)!==null&&n!==void 0?n:this._antialiasing,this._browser=t.browser,this._pixelRatioOverride=t.pixelRatio,this._applyDisplayMode(),this._listenForPixelRatio(),this._canvas.addEventListener("fullscreenchange",this._fullscreenChangeHandler),this.applyResolutionAndViewport()}_listenForPixelRatio(){this._mediaQueryList&&!this._mediaQueryList.addEventListener&&this._mediaQueryList.removeListener(this._pixelRatioChangeHandler),this._mediaQueryList=this._browser.window.nativeComponent.matchMedia(`(resolution: ${window.devicePixelRatio}dppx)`),this._mediaQueryList.addEventListener?this._mediaQueryList.addEventListener("change",this._pixelRatioChangeHandler,{once:!0}):this._mediaQueryList.addListener(this._pixelRatioChangeHandler)}dispose(){this._isDisposed||(this._isDisposed=!0,this._browser.window.off("resize",this._resizeHandler),this._resizeObserver&&this._resizeObserver.disconnect(),this.parent.removeEventListener("resize",this._resizeHandler),this._mediaQueryList.removeEventListener?this._mediaQueryList.removeEventListener("change",this._pixelRatioChangeHandler):this._mediaQueryList.removeListener(this._pixelRatioChangeHandler),this._canvas.removeEventListener("fullscreenchange",this._fullscreenChangeHandler))}_calculateDevicePixelRatio(){return window.devicePixelRatio<1?1:window.devicePixelRatio||1}get pixelRatio(){return this._pixelRatioOverride?this._pixelRatioOverride:this._devicePixelRatio}get isHiDpi(){return this.pixelRatio!==1}get displayMode(){return this._displayMode}get canvas(){return this._canvas}get parent(){switch(this.displayMode){case Ut.FillContainer:case Ut.FitContainer:case Ut.FitContainerAndFill:case Ut.FitContainerAndZoom:return this.canvas.parentElement||document.body;default:return window}}get resolution(){return this._resolution}set resolution(t){this._resolution=t}get viewport(){return this._viewport?this._viewport:this._resolution}set viewport(t){this._viewport=t}get aspectRatio(){return this._resolution.width/this._resolution.height}get scaledWidth(){return this._resolution.width*this.pixelRatio}get scaledHeight(){return this._resolution.height*this.pixelRatio}setCurrentCamera(t){this._camera=t}pushResolutionAndViewport(){this._resolutionStack.push(this.resolution),this._viewportStack.push(this.viewport),this.resolution={...this.resolution},this.viewport={...this.viewport}}peekViewport(){return this._viewportStack[this._viewportStack.length-1]}peekResolution(){return this._resolutionStack[this._resolutionStack.length-1]}popResolutionAndViewport(){this.resolution=this._resolutionStack.pop(),this.viewport=this._viewportStack.pop()}applyResolutionAndViewport(){this._canvas.width=this.scaledWidth,this._canvas.height=this.scaledHeight,this.graphicsContext instanceof Ks&&!this.graphicsContext.checkIfResolutionSupported({width:this.scaledWidth,height:this.scaledHeight})&&!this._alreadyWarned&&(this._alreadyWarned=!0,this._logger.warn(`The currently configured resolution (${this.resolution.width}x${this.resolution.height}) and pixel ratio (${this.pixelRatio}) are too large for the platform WebGL implementation, this may work but cause WebGL rendering to behave oddly. Try reducing the resolution or disabling Hi DPI scaling to avoid this (read more here https://excaliburjs.com/docs/screens#understanding-viewport--resolution).`)),this._antialiasing?this._canvas.style.imageRendering="auto":(this._canvas.style.imageRendering="pixelated",this._canvas.style.imageRendering===""&&(this._canvas.style.imageRendering="crisp-edges")),this._canvas.style.width=this.viewport.width+"px",this._canvas.style.height=this.viewport.height+"px",this.graphicsContext.updateViewport(this.resolution),this.graphicsContext.resetTransform(),this.graphicsContext.smoothing=this._antialiasing,this.graphicsContext instanceof xs&&this.graphicsContext.scale(this.pixelRatio,this.pixelRatio)}get antialiasing(){return this._antialiasing}set antialiasing(t){this._antialiasing=t,this.graphicsContext.smoothing=this._antialiasing}get isFullScreen(){return this._isFullScreen}goFullScreen(t){if(t){const e=document.getElementById(t);if(e)return e.requestFullscreen()}return this._canvas.requestFullscreen()}exitFullScreen(){return document.exitFullscreen()}pageToScreenCoordinates(t){let e=t.x,i=t.y;if(this._isFullScreen||(e-=ce(this._canvas).x,i-=ce(this._canvas).y),this._isFullScreen)if(window.innerWidth/this.aspectRatio<window.innerHeight){const n=window.innerWidth/this.aspectRatio,o=(window.innerHeight-n)/2;i=(i-o)/n*this.viewport.height,e=e/window.innerWidth*this.viewport.width}else{const n=window.innerHeight*this.aspectRatio,o=(window.innerWidth-n)/2;e=(e-o)/n*this.viewport.width,i=i/window.innerHeight*this.viewport.height}return e=e/this.viewport.width*this.resolution.width,i=i/this.viewport.height*this.resolution.height,new k(e,i)}screenToPageCoordinates(t){let e=t.x,i=t.y;if(e=e/this.resolution.width*this.viewport.width,i=i/this.resolution.height*this.viewport.height,this._isFullScreen)if(window.innerWidth/this.aspectRatio<window.innerHeight){const n=window.innerWidth/this.aspectRatio,o=(window.innerHeight-n)/2;i=i/this.viewport.height*n+o,e=e/this.viewport.width*window.innerWidth}else{const n=window.innerHeight*this.aspectRatio,o=(window.innerWidth-n)/2;e=e/this.viewport.width*n+o,i=i/this.viewport.height*window.innerHeight}return this._isFullScreen||(e+=ce(this._canvas).x,i+=ce(this._canvas).y),new k(e,i)}screenToWorldCoordinates(t){return this._camera?this._camera.inverse.multiply(t):t.sub(B(this.resolution.width/2,this.resolution.height/2))}worldToScreenCoordinates(t){return this._camera?this._camera.transform.multiply(t):t.add(B(this.resolution.width/2,this.resolution.height/2))}pageToWorldCoordinates(t){const e=this.pageToScreenCoordinates(t);return this.screenToWorldCoordinates(e)}worldToPageCoordinates(t){const e=this.worldToScreenCoordinates(t);return this.screenToPageCoordinates(e)}getWorldBounds(){const t=this.screenToWorldCoordinates(k.Zero),e=t.x+this.drawWidth,i=t.y+this.drawHeight;return new nt(t.x,t.y,e,i)}get canvasWidth(){return this.canvas.width}get halfCanvasWidth(){return this.canvas.width/2}get canvasHeight(){return this.canvas.height}get halfCanvasHeight(){return this.canvas.height/2}get drawWidth(){return this._camera?this.resolution.width/this._camera.zoom:this.resolution.width}get halfDrawWidth(){return this.drawWidth/2}get drawHeight(){return this._camera?this.resolution.height/this._camera.zoom:this.resolution.height}get halfDrawHeight(){return this.drawHeight/2}get center(){return B(this.halfDrawWidth,this.halfDrawHeight)}get contentArea(){return this._contentArea}_computeFit(){document.body.style.margin="0px",document.body.style.overflow="hidden";const t=this.aspectRatio;let e=0,i=0;window.innerWidth/t<window.innerHeight?(e=window.innerWidth,i=window.innerWidth/t):(e=window.innerHeight*t,i=window.innerHeight),this.viewport={width:e,height:i},this._contentArea=nt.fromDimension(this.resolution.width,this.resolution.height,k.Zero)}_computeFitScreenAndFill(){document.body.style.margin="0px",document.body.style.overflow="hidden";const t=window.innerWidth,e=window.innerHeight;this._computeFitAndFill(t,e)}_computeFitContainerAndFill(){document.body.style.margin="0px",document.body.style.overflow="hidden";const t=this.canvas.parentElement,e=t.clientWidth,i=t.clientHeight;this._computeFitAndFill(e,i)}_computeFitAndFill(t,e){if(this.viewport={width:t,height:e},t/e<=this._contentResolution.width/this._contentResolution.height){this.resolution={width:t*this._contentResolution.width/t,height:t*this._contentResolution.width/t*e/t};const i=(this.resolution.height-this._contentResolution.height)/2;this._contentArea=new nt({top:i,left:0,right:this._contentResolution.width,bottom:this.resolution.height-i})}else{this.resolution={width:e*this._contentResolution.height/e*t/e,height:e*this._contentResolution.height/e};const i=(this.resolution.width-this._contentResolution.width)/2;this._contentArea=new nt({top:0,left:i,right:this.resolution.width-i,bottom:this._contentResolution.height})}}_computeFitScreenAndZoom(){document.body.style.margin="0px",document.body.style.overflow="hidden",this.canvas.style.position="absolute";const t=window.innerWidth,e=window.innerHeight;this._computeFitAndZoom(t,e)}_computeFitContainerAndZoom(){document.body.style.margin="0px",document.body.style.overflow="hidden",this.canvas.style.position="absolute";const t=this.canvas.parentElement;t.style.position="relative",t.style.overflow="hidden";const e=t.clientWidth,i=t.clientHeight;this._computeFitAndZoom(e,i)}_computeFitAndZoom(t,e){const i=this.aspectRatio;let n=0,o=0;t/i<e?(n=t,o=t/i):(n=e*i,o=e);const h=t/n,d=e/o,u=Math.max(h,d),g=n*u,v=o*u;g>t?this.canvas.style.left=-(g-t)/2+"px":this.canvas.style.left="",v>e?this.canvas.style.top=-(v-e)/2+"px":this.canvas.style.top="",this.viewport={width:g,height:v};const I=nt.fromDimension(this.viewport.width,this.viewport.height,k.Zero);if(this.viewport.width>t){const D=(this.viewport.width-t)/this.viewport.width*this.resolution.width;I.top=0,I.left=D/2,I.right=this.resolution.width-D/2,I.bottom=this.resolution.height}if(this.viewport.height>e){const D=(this.viewport.height-e)/this.viewport.height*this.resolution.height;I.top=D/2,I.left=0,I.bottom=this.resolution.height-D/2,I.right=this.resolution.width}this._contentArea=I}_computeFitContainer(){const t=this.aspectRatio;let e=0,i=0;const n=this.canvas.parentElement;n.clientWidth/t<n.clientHeight?(e=n.clientWidth,i=n.clientWidth/t):(e=n.clientHeight*t,i=n.clientHeight),this.viewport={width:e,height:i},this._contentArea=nt.fromDimension(this.resolution.width,this.resolution.height,k.Zero)}_applyDisplayMode(){this._setResolutionAndViewportByDisplayMode(this.parent),this.parent instanceof Window?this._browser.window.on("resize",this._resizeHandler):(this._resizeObserver=new ResizeObserver(()=>{this._resizeHandler()}),this._resizeObserver.observe(this.parent)),this.parent.addEventListener("resize",this._resizeHandler)}_setResolutionAndViewportByDisplayMode(t){this.displayMode===Ut.FillContainer&&(this.resolution={width:t.clientWidth,height:t.clientHeight},this.viewport=this.resolution),this.displayMode===Ut.FillScreen&&(document.body.style.margin="0px",document.body.style.overflow="hidden",this.resolution={width:t.innerWidth,height:t.innerHeight},this.viewport=this.resolution),this._contentArea=nt.fromDimension(this.resolution.width,this.resolution.height,k.Zero),this.displayMode===Ut.FitScreen&&this._computeFit(),this.displayMode===Ut.FitContainer&&this._computeFitContainer(),this.displayMode===Ut.FitScreenAndFill&&this._computeFitScreenAndFill(),this.displayMode===Ut.FitContainerAndFill&&this._computeFitContainerAndFill(),this.displayMode===Ut.FitScreenAndZoom&&this._computeFitScreenAndZoom(),this.displayMode===Ut.FitContainerAndZoom&&this._computeFitContainerAndZoom()}}class is{static create(){return this._INSTANCE||(window.AudioContext||window.webkitAudioContext)&&(this._INSTANCE=new AudioContext),this._INSTANCE}}is._INSTANCE=null;function Go(a){return!!a.playbackState}class ss{static unlock(){return new Promise((e,i)=>{if(ss._UNLOCKED||!is.create())return e(!0);const n=setTimeout(()=>{Y.getInstance().warn("Excalibur was unable to unlock the audio context, audio probably will not play in this browser."),e(!1)},200),o=is.create();o.resume().then(()=>{const h=o.createBuffer(1,1,22050),d=o.createBufferSource();let u=!1;d.buffer=h,d.connect(o.destination),d.onended=()=>u=!0,d.start(0),setTimeout(()=>{Go(d)?(d.playbackState===d.PLAYING_STATE||d.playbackState===d.FINISHED_STATE)&&(ss._UNLOCKED=!0):(o.currentTime>0||u)&&(ss._UNLOCKED=!0)},0),clearTimeout(n),e(!0)},()=>{i()})})}static isUnlocked(){return this._UNLOCKED}}ss._UNLOCKED=!1;class Re{constructor(){this.eventDispatcher=new Pi}on(t,e){this.eventDispatcher.on(t,e)}off(t,e){this.eventDispatcher.off(t,e)}emit(t,e){this.eventDispatcher.emit(t,e)}once(t,e){this.eventDispatcher.once(t,e)}}function cr(a,t=j.Red,e,i,n,o,h=1,d="butt"){a.save(),a.beginPath(),a.lineWidth=h,a.lineCap=d,a.strokeStyle=t.toString(),a.moveTo(e,i),a.lineTo(n,o),a.closePath(),a.stroke(),a.restore()}function qo(a,t=j.Red,e){a.beginPath(),a.strokeStyle=t.toString(),a.arc(e.x,e.y,5,0,Math.PI*2),a.closePath(),a.stroke()}function jo(a,t,e,i,n=1){const o=t?t.toString():"blue",h=i.scale(n);a.beginPath(),a.strokeStyle=o,a.moveTo(e.x,e.y),a.lineTo(e.x+h.x,e.y+h.y),a.closePath(),a.stroke()}function xn(a,t,e,i,n,o=5,h=j.White,d=null){let u;if(typeof o=="number")u={tl:o,tr:o,br:o,bl:o};else{const g={tl:0,tr:0,br:0,bl:0};for(const v in g)if(g.hasOwnProperty(v)){const I=v;u[I]=o[I]||g[I]}}a.beginPath(),a.moveTo(t+u.tl,e),a.lineTo(t+i-u.tr,e),a.quadraticCurveTo(t+i,e,t+i,e+u.tr),a.lineTo(t+i,e+n-u.br),a.quadraticCurveTo(t+i,e+n,t+i-u.br,e+n),a.lineTo(t+u.bl,e+n),a.quadraticCurveTo(t,e+n,t,e+n-u.bl),a.lineTo(t,e+u.tl),a.quadraticCurveTo(t,e,t+u.tl,e),a.closePath(),d&&(a.fillStyle=d.toString(),a.fill()),h&&(a.strokeStyle=h.toString(),a.stroke())}function fi(a,t,e,i,n=j.White,o=null){a.beginPath(),a.arc(t,e,i,0,Math.PI*2),a.closePath(),o&&(a.fillStyle=o.toString(),a.fill()),n&&(a.strokeStyle=n.toString(),a.stroke())}const Kr="data:image/png;base64,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";var Qo=Gt(1388);class Ht extends ne{constructor(t){var e,i,n,o,h,d,u,g,v,I;super(t),this.filtering=null,this.lineCap="butt",this.quality=1,this._dirty=!0,this._smoothing=!1,this._color=ki(j.Black,()=>this.flagDirty()),this._lineWidth=1,this._lineDash=[],this._padding=0,t&&(this.quality=(e=t.quality)!==null&&e!==void 0?e:this.quality,this.color=(i=t.color)!==null&&i!==void 0?i:j.Black,this.strokeColor=t==null?void 0:t.strokeColor,this.smoothing=(n=t.smoothing)!==null&&n!==void 0?n:this.smoothing,this.lineWidth=(o=t.lineWidth)!==null&&o!==void 0?o:this.lineWidth,this.lineDash=(h=t.lineDash)!==null&&h!==void 0?h:this.lineDash,this.lineCap=(d=t.lineCap)!==null&&d!==void 0?d:this.lineCap,this.padding=(u=t.padding)!==null&&u!==void 0?u:this.padding,this.filtering=(g=t.filtering)!==null&&g!==void 0?g:this.filtering),this._bitmap=document.createElement("canvas");const D=(v=t==null?void 0:t.width)!==null&&v!==void 0?v:this._bitmap.width,U=(I=t==null?void 0:t.height)!==null&&I!==void 0?I:this._bitmap.height;this.width=D,this.height=U;const H=this._bitmap.getContext("2d");if(H)this._ctx=H;else throw new Error("Browser does not support 2d canvas drawing, cannot create Raster graphic")}cloneRasterOptions(){return{color:this.color?this.color.clone():null,strokeColor:this.strokeColor?this.strokeColor.clone():null,smoothing:this.smoothing,lineWidth:this.lineWidth,lineDash:this.lineDash,lineCap:this.lineCap,quality:this.quality,padding:this.padding}}get dirty(){return this._dirty}flagDirty(){this._dirty=!0}get width(){return Math.abs(this._getTotalWidth()*this.scale.x)}set width(t){t/=Math.abs(this.scale.x),this._bitmap.width=t,this._originalWidth=t,this.flagDirty()}get height(){return Math.abs(this._getTotalHeight()*this.scale.y)}set height(t){t/=Math.abs(this.scale.y),this._bitmap.height=t,this._originalHeight=t,this.flagDirty()}_getTotalWidth(){var t;return(((t=this._originalWidth)!==null&&t!==void 0?t:this._bitmap.width)+this.padding*2)*1}_getTotalHeight(){var t;return(((t=this._originalHeight)!==null&&t!==void 0?t:this._bitmap.height)+this.padding*2)*1}get localBounds(){return nt.fromDimension(this._getTotalWidth()*this.scale.x,this._getTotalHeight()*this.scale.y,k.Zero)}get smoothing(){return this._smoothing}set smoothing(t){this._smoothing=t,this.flagDirty()}get color(){return this._color}set color(t){this.flagDirty(),this._color=ki(t,()=>this.flagDirty())}get strokeColor(){return this._strokeColor}set strokeColor(t){this.flagDirty(),this._strokeColor=ki(t,()=>this.flagDirty())}get lineWidth(){return this._lineWidth}set lineWidth(t){this._lineWidth=t,this.flagDirty()}get lineDash(){return this._lineDash}set lineDash(t){this._lineDash=t,this.flagDirty()}get padding(){return this._padding}set padding(t){this._padding=t,this.flagDirty()}rasterize(){this._dirty=!1,this._ctx.clearRect(0,0,this._getTotalWidth(),this._getTotalHeight()),this._ctx.save(),this._applyRasterProperties(this._ctx),this.execute(this._ctx),this._ctx.restore(),At.load(this._bitmap,this.filtering,!0)}_applyRasterProperties(t){var e,i,n;this._bitmap.width=this._getTotalWidth()*this.quality,this._bitmap.height=this._getTotalHeight()*this.quality,t.scale(this.quality,this.quality),t.translate(this.padding,this.padding),t.imageSmoothingEnabled=this.smoothing,t.lineWidth=this.lineWidth,t.setLineDash((e=this.lineDash)!==null&&e!==void 0?e:t.getLineDash()),t.lineCap=this.lineCap,t.strokeStyle=(i=this.strokeColor)===null||i===void 0?void 0:i.toString(),t.fillStyle=(n=this.color)===null||n===void 0?void 0:n.toString()}_drawImage(t,e,i){this._dirty&&this.rasterize(),t.scale(1/this.quality,1/this.quality),t.drawImage(this._bitmap,e,i)}}class yn extends Ht{get ctx(){return this._ctx}constructor(t){super(t),this._options=t}clone(){return new yn({...this._options,...this.cloneGraphicOptions(),...this.cloneRasterOptions()})}execute(t){var e,i;!((e=this._options)===null||e===void 0)&&e.draw&&((i=this._options)===null||i===void 0||i.draw(t)),this._options.cache||this.flagDirty()}}class ys{}ys.type={any:"",blob:"blob",json:"json",text:"text",document:"document",arraybuffer:"arraybuffer"};class Js{constructor(){this.states=new Map}get currentState(){return this._currentState}set currentState(t){this._currentState=t}static create(t,e){const i=new Js;i.data=e;for(const n in t.states)i.states.set(n,{name:n,...t.states[n]});for(const n of i.states.values())for(const o of n.transitions)if(o!=="*"&&!i.states.has(o))throw Error(`Invalid state machine, state [${n.name}] has a transition to another state that doesn't exist [${o}]`);return i.currentState=i.startState=i.states.get(t.start),i}in(t){return this.currentState.name===t}go(t,e){var i,n;if(this.currentState.transitions.includes(t)||this.currentState.transitions.includes("*")){const o=this.states.get(t);return this.currentState.onExit&&((i=this.currentState)===null||i===void 0?void 0:i.onExit({to:o.name,data:this.data}))===!1||o!=null&&o.onEnter&&(o==null?void 0:o.onEnter({from:this.currentState.name,eventData:e,data:this.data}))===!1?!1:(this.currentState=o,!((n=this.currentState)===null||n===void 0)&&n.onState&&this.currentState.onState(),!0)}return!1}update(t){this.currentState.onUpdate&&this.currentState.onUpdate(this.data,t)}save(t){localStorage.setItem(t,JSON.stringify({currentState:this.currentState.name,data:this.data}))}restore(t){const e=JSON.parse(localStorage.getItem(t));this.currentState=this.states.get(e.currentState),this.data=e.data}}class An{_createNewBufferSource(){this._instance=this._audioContext.createBufferSource(),this._instance.buffer=this._src,this._instance.loop=this.loop,this._instance.playbackRate.value=this._playbackRate,this._instance.connect(this._volumeNode),this._volumeNode.connect(this._audioContext.destination)}_handleEnd(){this.loop||(this._instance.onended=()=>{this._playingResolve(!0)})}set loop(t){this._loop=t,this._instance&&(this._instance.loop=t,this.loop||(this._instance.onended=()=>{this._playingResolve(!0)}))}get loop(){return this._loop}set volume(t){t=A(t,0,1),this._volume=t,this._stateMachine.in("PLAYING")&&this._volumeNode.gain.setTargetAtTime?this._volumeNode.gain.setTargetAtTime(t,this._audioContext.currentTime,.1):this._volumeNode.gain.value=t}get volume(){return this._volume}get duration(){var t;return(t=this._duration)!==null&&t!==void 0?t:this.getTotalPlaybackDuration()}set duration(t){this._duration=t}constructor(t){this._src=t,this._audioContext=is.create(),this._volumeNode=this._audioContext.createGain(),this._playingPromise=new Promise(e=>{this._playingResolve=e}),this._stateMachine=Js.create({start:"STOPPED",states:{PLAYING:{onEnter:({data:e})=>{this._createNewBufferSource(),this._handleEnd(),this.loop?this._instance.start(0,e.pausedAt*this._playbackRate):this._instance.start(0,e.pausedAt*this._playbackRate,this.duration),e.startedAt=this._audioContext.currentTime-e.pausedAt,e.pausedAt=0},onState:()=>this._playStarted(),onExit:({to:e})=>{e==="STOPPED"&&this._playingResolve(!0),this._instance.onended=null,this._instance.disconnect(),this._instance.stop(0),this._instance=null},transitions:["STOPPED","PAUSED","SEEK"]},SEEK:{onEnter:({eventData:e,data:i})=>{i.pausedAt=(e??0)/this._playbackRate,i.startedAt=0},transitions:["*"]},STOPPED:{onEnter:({data:e})=>{e.pausedAt=0,e.startedAt=0,this._playingResolve(!0)},transitions:["PLAYING","PAUSED","SEEK"]},PAUSED:{onEnter:({data:e})=>{e.pausedAt=this._audioContext.currentTime-e.startedAt},transitions:["PLAYING","STOPPED","SEEK"]}}},{startedAt:0,pausedAt:0}),this._volume=1,this._loop=!1,this._playStarted=()=>{},this._playbackRate=1,this._createNewBufferSource()}isPlaying(){return this._stateMachine.in("PLAYING")}isPaused(){return this._stateMachine.in("PAUSED")||this._stateMachine.in("SEEK")}play(t=()=>{}){return this._playStarted=t,this._stateMachine.go("PLAYING"),this._playingPromise}pause(){this._stateMachine.go("PAUSED")}stop(){this._stateMachine.go("STOPPED")}seek(t){this._stateMachine.go("PAUSED"),this._stateMachine.go("SEEK",t)}getTotalPlaybackDuration(){return this._src.duration}getPlaybackPosition(){const{pausedAt:t,startedAt:e}=this._stateMachine.data;return t?t*this._playbackRate:e?(this._audioContext.currentTime-e)*this._playbackRate:0}set playbackRate(t){this._instance.playbackRate.value=this._playbackRate=t}get playbackRate(){return this._instance.playbackRate.value}}class Cn extends pt{set bubbles(t){}get bubbles(){return!1}get _path(){return null}set _path(t){}constructor(t,e="MediaEvent"){super(),this.target=t,this._name=e}stopPropagation(){}action(){}propagate(){}layPath(t){}}class Ri extends Cn{constructor(t,e){super(t,"NativeSoundEvent"),this.track=e}}class Zr extends Cn{constructor(t,e){super(t,"NativeSoundProcessedEvent"),this._processedData=e,this.data=this._processedData}}function Ys(a){try{const t=new Audio,e=/.*\.([A-Za-z0-9]+)$/,i=a.match(e)[1];return!!t.canPlayType("audio/"+i)}catch(t){return Y.getInstance().warn("Cannot determine audio support, assuming no support for the Audio Tag",t),!1}}class pe extends Re{set loop(t){this._loop=t;for(const e of this._tracks)e.loop=this._loop;this.logger.debug("Set loop for all instances of sound",this.path,"to",this._loop)}get loop(){return this._loop}set volume(t){this._volume=t;for(const e of this._tracks)e.volume=this._volume;this.emit("volumechange",new Ri(this)),this.logger.debug("Set loop for all instances of sound",this.path,"to",this._volume)}get volume(){return this._volume}get duration(){return this._duration}set duration(t){this._duration=t}get instances(){return this._tracks}get path(){return this._resource.path}set path(t){this._resource.path=t}constructor(...t){super(),this.logger=Y.getInstance(),this._loop=!1,this._volume=1,this._isStopped=!1,this._tracks=[],this._wasPlayingOnHidden=!1,this._playbackRate=1,this._audioContext=is.create(),this._resource=new Ti("",ys.type.arraybuffer);for(const e of t)if(Ys(e)){this.path=e;break}this.path||(this.logger.warn("This browser does not support any of the audio files specified:",t.join(", ")),this.logger.warn("Attempting to use",t[0]),this.path=t[0])}isLoaded(){return!!this.data}async load(){var t,e;if(this.data)return this.data;const i=await this._resource.load(),n=await this.decodeAudio(i.slice(0));return this._duration=(e=(t=this._duration)!==null&&t!==void 0?t:n==null?void 0:n.duration)!==null&&e!==void 0?e:void 0,this.emit("processed",new Zr(this,n)),this.data=n}async decodeAudio(t){try{return await this._audioContext.decodeAudioData(t.slice(0))}catch{return this.logger.error("Unable to decode  this browser may not fully support this format, or the file may be corrupt, if this is an mp3 try removing id3 tags and album art from the file."),await Promise.reject()}}wireEngine(t){t&&(this._engine=t,this._engine.on("hidden",()=>{t.pauseAudioWhenHidden&&this.isPlaying()&&(this._wasPlayingOnHidden=!0,this.pause())}),this._engine.on("visible",()=>{t.pauseAudioWhenHidden&&this._wasPlayingOnHidden&&(this.play(),this._wasPlayingOnHidden=!1)}),this._engine.on("start",()=>{this._isStopped=!1}),this._engine.on("stop",()=>{this.stop(),this._isStopped=!0}))}instanceCount(){return this._tracks.length}isPlaying(){return this._tracks.some(t=>t.isPlaying())}isPaused(){return this._tracks.some(t=>t.isPaused())}play(t){return this.isLoaded()?this._isStopped?(this.logger.warn("Cannot start playing. Engine is in a stopped state."),Promise.resolve(!1)):(this.volume=t||this.volume,this.isPaused()?this._resumePlayback():this._startPlayback()):(this.logger.warn("Cannot start playing. Resource",this.path,"is not loaded yet"),Promise.resolve(!0))}pause(){if(this.isPlaying()){for(const t of this._tracks)t.pause();this.emit("pause",new Ri(this)),this.logger.debug("Paused all instances of sound",this.path)}}stop(){for(const t of this._tracks)t.stop();this.emit("stop",new Ri(this)),this._tracks.length=0,this.logger.debug("Stopped all instances of sound",this.path)}get playbackRate(){return this._playbackRate}set playbackRate(t){this._playbackRate=t,this._tracks.forEach(e=>{e.playbackRate=this._playbackRate})}seek(t,e=0){this._tracks.length===0&&this._getTrackInstance(this.data),this._tracks[e].seek(t)}getTotalPlaybackDuration(){return this.data.duration}getPlaybackPosition(t=0){return this._tracks.length?this._tracks[t].getPlaybackPosition():0}getTrackId(t){return this._tracks.indexOf(t)}async _resumePlayback(){if(this.isPaused){const t=[];for(const e of this._tracks)t.push(e.play().then(()=>(this.emit("playbackend",new Ri(this,e)),this._tracks.splice(this.getTrackId(e),1),!0)));this.emit("resume",new Ri(this)),this.logger.debug("Resuming paused instances for sound",this.path,this._tracks),await Promise.all(t)}return!0}async _startPlayback(){const t=await this._getTrackInstance(this.data),e=await t.play(()=>{this.emit("playbackstart",new Ri(this,t)),this.logger.debug("Playing new instance for sound",this.path)});return this.emit("playbackend",new Ri(this,t)),this._tracks.splice(this.getTrackId(t),1),e}_getTrackInstance(t){const e=new An(t);return e.loop=this.loop,e.volume=this.volume,e.duration=this.duration,e.playbackRate=this._playbackRate,this._tracks.push(e),e}}class As extends Re{get _image(){return this._imageElement||(this._imageElement=new Image,this._imageElement.src=this.logo),this._imageElement}get playButtonRootElement(){return this._playButtonRootElement}get playButtonElement(){return this._playButtonElement}get _playButton(){const t=document.getElementById("excalibur-play-root");return t&&(this._playButtonRootElement=t),this._playButtonRootElement||(this._playButtonRootElement=document.createElement("div"),this._playButtonRootElement.id="excalibur-play-root",this._playButtonRootElement.style.position="absolute",document.body.appendChild(this._playButtonRootElement)),this._styleBlock||(this._styleBlock=document.createElement("style"),this._styleBlock.textContent=this._playButtonStyles,document.head.appendChild(this._styleBlock)),this._playButtonElement||(this._playButtonElement=this.startButtonFactory(),this._playButtonRootElement.appendChild(this._playButtonElement)),this._playButtonElement}constructor(t){super(),this.canvas=new yn({filtering:te.Blended,smoothing:!0,cache:!0,draw:this.draw.bind(this)}),this._resourceList=[],this._index=0,this._playButtonShown=!1,this._resourceCount=0,this._numLoaded=0,this._progressCounts={},this._totalCounts={},this.logo=Kr,this.logoWidth=468,this.logoHeight=118,this.loadingBarColor=j.White,this.backgroundColor="#176BAA",this.suppressPlayButton=!1,this._playButtonStyles=Qo.Z.toString(),this.playButtonText="Play game",this.startButtonFactory=()=>{let e=document.getElementById("excalibur-play");return e||(e=document.createElement("button")),e.id="excalibur-play",e.textContent=this.playButtonText,e.style.display="none",e},this._loadingFuture=new Ft,t&&this.addResources(t)}wireEngine(t){this._engine=t,this.canvas.width=this._engine.canvas.width,this.canvas.height=this._engine.canvas.height}addResource(t){const e=this._index++;this._resourceList.push(t),this._progressCounts[e]=0,this._totalCounts[e]=1,this._resourceCount++}addResources(t){let e=0;const i=t.length;for(e;e<i;e++)this.addResource(t[e])}isLoaded(){return this._numLoaded===this._resourceCount}async showPlayButton(){var t,e;if(this.suppressPlayButton)this.hidePlayButton(),await _t(500,(t=this._engine)===null||t===void 0?void 0:t.clock);else{const i=()=>{this._positionPlayButton()};return!((e=this._engine)===null||e===void 0)&&e.browser&&this._engine.browser.window.on("resize",i),this._playButtonShown=!0,this._playButton.style.display="block",document.body.addEventListener("keyup",o=>{o.key==="Enter"&&this._playButton.click()}),this._positionPlayButton(),await new Promise(o=>{const h=d=>{var u;d.stopPropagation(),this.hidePlayButton(),!((u=this._engine)===null||u===void 0)&&u.browser&&this._engine.browser.window.off("resize",i),o()};this._playButton.addEventListener("click",h),this._playButton.addEventListener("touchend",h),this._playButton.addEventListener("pointerup",h)})}}hidePlayButton(){this._playButtonShown=!1,this._playButton.style.display="none"}dispose(){this._playButtonRootElement.parentElement&&(this._playButtonRootElement.removeChild(this._playButtonElement),document.body.removeChild(this._playButtonRootElement),document.head.removeChild(this._styleBlock),this._playButtonRootElement=null,this._playButtonElement=null,this._styleBlock=null)}update(t,e){}areResourcesLoaded(){return this._loadingFuture.promise}async load(){var t,e;await((t=this._image)===null||t===void 0?void 0:t.decode()),this.canvas.flagDirty(),await Promise.all(this._resourceList.map(async i=>{await i.load().finally(()=>{this._numLoaded++,this.canvas.flagDirty()})}));for(const i of this._resourceList)i instanceof pe&&i.wireEngine(this._engine);return this._loadingFuture.resolve(),await _t(200,(e=this._engine)===null||e===void 0?void 0:e.clock),this.canvas.flagDirty(),await this.showPlayButton(),await ss.unlock(),this.data=this._resourceList}markResourceComplete(){this._numLoaded++}get progress(){return this._resourceCount>0?A(this._numLoaded,0,this._resourceCount)/this._resourceCount:1}_positionPlayButton(){if(this._engine){const t=this._engine.screen.viewport.height,e=this._engine.screen.viewport.width;if(this._playButtonRootElement){const i=this._engine.canvas.offsetLeft,n=this._engine.canvas.offsetTop,o=this._playButton.clientWidth,h=this._playButton.clientHeight;this.playButtonPosition?(this._playButtonRootElement.style.left=`${this.playButtonPosition.x}px`,this._playButtonRootElement.style.top=`${this.playButtonPosition.y}px`):(this._playButtonRootElement.style.left=`${i+e/2-o/2}px`,this._playButtonRootElement.style.top=`${n+t/2-h/2+100}px`)}}}draw(t){const e=this._engine.canvasHeight/this._engine.pixelRatio,i=this._engine.canvasWidth/this._engine.pixelRatio;this._positionPlayButton(),t.fillStyle=this.backgroundColor,t.fillRect(0,0,i,e);let n=e/2;const o=Math.min(this.logoWidth,i*.75);let h=i/2-o/2;this.logoPosition&&(h=this.logoPosition.x,n=this.logoPosition.y);const d=Math.floor(o*(this.logoHeight/this.logoWidth)),u=this._engine.getAntialiasing();if(this._engine.setAntialiasing(!0),this.logoPosition?t.drawImage(this._image,0,0,this.logoWidth,this.logoHeight,h,n,o,d):t.drawImage(this._image,0,0,this.logoWidth,this.logoHeight,h,n-d-20,o,d),!this.suppressPlayButton&&this._playButtonShown){this._engine.setAntialiasing(u);return}let g=h,v=n;this.loadingBarPosition&&(g=this.loadingBarPosition.x,v=this.loadingBarPosition.y),t.lineWidth=2,xn(t,g,v,o,20,10,this.loadingBarColor);const I=o*this.progress,D=5,U=I-D*2,H=20-D*2;xn(t,g+D,v+D,U>10?U:10,H,5,null,this.loadingBarColor),this._engine.setAntialiasing(u)}}const Ye={webgl:"WebGL",webaudio:"WebAudio",gamepadapi:"Gamepad API"};class dr{constructor(){this._features=null,this.failedTests=[],this._criticalTests={canvasSupport:function(){const t=document.createElement("canvas");return!!(t.getContext&&t.getContext("2d"))},arrayBufferSupport:function(){const t=new XMLHttpRequest;t.open("GET","/");try{t.responseType="arraybuffer"}catch{return!1}return t.responseType==="arraybuffer"},dataUrlSupport:function(){return document.createElement("canvas").toDataURL("image/png").indexOf("data:image/png")===0},objectUrlSupport:function(){return"URL"in window&&"revokeObjectURL"in URL&&"createObjectURL"in URL},rgbaSupport:function(){const t=document.createElement("a").style;return t.cssText="background-color:rgba(150,255,150,.5)",(""+t.backgroundColor).indexOf("rgba")>-1}},this._warningTest={webAudioSupport:function(){return!!(window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.msAudioContext||window.oAudioContext)},webglSupport:function(){const t=document.createElement("canvas");return!!(t.getContext&&t.getContext("webgl"))}},this._features=this._loadBrowserFeatures()}getBrowserFeatures(){return this._features===null&&(this._features=this._loadBrowserFeatures()),this._features}logBrowserFeatures(){let t=`%cSUPPORTED BROWSER FEATURES
==========================%c
`;const e=["font-weight: bold; color: navy","font-weight: normal; color: inherit"],i=this.getBrowserFeatures();for(const n of Object.keys(Ye))i[n]?(t+="(%c✓%c)",e.push("font-weight: bold; color: green"),e.push("font-weight: normal; color: inherit")):(t+="(%c✗%c)",e.push("font-weight: bold; color: red"),e.push("font-weight: normal; color: inherit")),t+=" "+Ye[n]+`
`;e.unshift(t),console.log.apply(console,e)}_loadBrowserFeatures(){return{canvas:(()=>this._criticalTests.canvasSupport())(),arraybuffer:(()=>this._criticalTests.arrayBufferSupport())(),dataurl:(()=>this._criticalTests.dataUrlSupport())(),objecturl:(()=>this._criticalTests.objectUrlSupport())(),rgba:(()=>this._criticalTests.rgbaSupport())(),webaudio:(()=>this._warningTest.webAudioSupport())(),webgl:(()=>this._warningTest.webglSupport())(),gamepadapi:(()=>!!navigator.getGamepads)()}}test(){let t=!1;for(const e in this._criticalTests)this._criticalTests[e].call(this)||(this.failedTests.push(e),Y.getInstance().error("Critical browser feature missing, Excalibur requires:",e),t=!0);if(t)return!1;for(const e in this._warningTest)this._warningTest[e]()||Y.getInstance().warn("Warning browser feature missing, Excalibur will have reduced performance:",e);return!0}}var dt;(function(a){a.PreventCollision="PreventCollision",a.Passive="Passive",a.Active="Active",a.Fixed="Fixed"})(dt||(dt={}));const Bi=5,Ct={},Jr=()=>{for(const a in Ct)Ct[a]=0},Xt=(a,t)=>{const e=T.isEnabled("suppress-obsolete-message");Ct[a]<Bi&&!e&&(Y.getInstance().warn(a),console.trace&&t.showStackTrace&&console.trace()),Ct[a]++};function ur(a){return a={message:"This feature will be removed in future versions of Excalibur.",alternateMethod:null,showStackTrace:!1,...a},function(t,e,i){if(i&&!(typeof i.value=="function"||typeof i.get=="function"||typeof i.set=="function"))throw new SyntaxError("Only classes/functions/getters/setters can be marked as obsolete");const o=`${`${t.name||""}${t.name&&e?".":""}${e||""}`} is marked obsolete: ${a.message}`+(a.alternateMethod?` Use ${a.alternateMethod} instead`:"");Ct[o]||(Ct[o]=0);const h=i?{...i}:t;if(!i){class d extends h{constructor(...g){Xt(o,a),super(...g)}}return d}return i&&i.value?(h.value=function(){return Xt(o,a),i.value.apply(this,arguments)},h):(i&&i.get&&(h.get=function(){return Xt(o,a),i.get.apply(this,arguments)}),i&&i.set&&(h.set=function(){return Xt(o,a),i.set.apply(this,arguments)}),h)}}var Be=function(a,t,e,i){var n=arguments.length,o=n<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(a,t,e,i);else for(var d=a.length-1;d>=0;d--)(h=a[d])&&(o=(n<3?h(o):n>3?h(t,e,o):h(t,e))||o);return n>3&&o&&Object.defineProperty(t,e,o),o},ns;(function(a){a.Arcade="arcade",a.Realistic="realistic"})(ns||(ns={}));var Di;(function(a){a[a.DynamicAABBTree=0]="DynamicAABBTree"})(Di||(Di={}));var Cs;(function(a){a[a.Euler=0]="Euler"})(Cs||(Cs={}));class ot{static get gravity(){return ot.acc}static set gravity(t){ot.acc=t}static useArcadePhysics(){ot.collisionResolutionStrategy=ns.Arcade}static useRealisticPhysics(){ot.collisionResolutionStrategy=ns.Realistic}static get dynamicTreeVelocityMultiplyer(){return ot.dynamicTreeVelocityMultiplier}static set dynamicTreeVelocityMultiplyer(t){ot.dynamicTreeVelocityMultiplier=t}}ot.acc=new k(0,0),ot.enabled=!0,ot.broadphaseStrategy=Di.DynamicAABBTree,ot.collisionResolutionStrategy=ns.Arcade,ot.defaultMass=10,ot.integrator=Cs.Euler,ot.dynamicTreeVelocityMultiplier=2,ot.boundsPadding=5,ot.positionIterations=3,ot.velocityIterations=8,ot.slop=1,ot.steeringFactor=.2,ot.warmStart=!0,ot.bodiesCanSleepByDefault=!1,ot.surfaceEpsilon=.1,ot.sleepEpsilon=.07,ot.wakeThreshold=ot.sleepEpsilon*3,ot.sleepBias=.9,ot.checkForFastBodies=!0,ot.disableMinimumSpeedForFastBody=!1,Be([ur({message:"Alias for incorrect spelling used in older versions, will be removed in v0.25.0",alternateMethod:"dynamicTreeVelocityMultiplier"})],ot,"dynamicTreeVelocityMultiplyer",null);var xe;(function(a){a.World="world",a.Screen="screen"})(xe||(xe={}));class $s extends k{constructor(t){super(0,0),this._getX=t.getX,this._getY=t.getY,this._setX=t.setX,this._setY=t.setY}get x(){return this._x=this._getX()}set x(t){this._setX(t),this._x=t}get y(){return this._y=this._getY()}set y(t){this._setY(t),this._y=t}}class Yr extends k{constructor(t,e){super(t.x,t.y),this.original=t,this.change=e}get x(){return this._x=this.original.x}set x(t){this.change(t,this._y),this._x=this.original.x=t}get y(){return this._y=this.original.y}set y(t){this.change(this._x,t),this._y=this.original.y=t}}class rs{constructor(){this._parent=null,this._children=[],this._pos=B(0,0),this._rotation=0,this._scale=B(1,1),this._isDirty=!1,this._isInverseDirty=!1,this._matrix=ct.identity(),this._inverse=ct.identity()}get parent(){return this._parent}set parent(t){if(this._parent){const e=this._parent._children.indexOf(this);e>-1&&this._parent._children.splice(e,1)}this._parent=t,this._parent&&this._parent._children.push(this),this.flagDirty()}get children(){return this._children}set pos(t){t.equals(this._pos)||(this._pos.x=t.x,this._pos.y=t.y,this.flagDirty())}get pos(){return new Yr(this._pos,(t,e)=>{(t!==this._pos.x||e!==this._pos.y)&&this.flagDirty()})}set globalPos(t){let e=t.clone();this.parent&&(e=this.parent.inverse.multiply(t)),e.equals(this._pos)||(this._pos=e,this.flagDirty())}get globalPos(){return new $s({getX:()=>this.matrix.data[4],getY:()=>this.matrix.data[5],setX:t=>{if(this.parent){const{x:e}=this.parent.inverse.multiply(B(t,this.pos.y));this.pos.x=e}else this.pos.x=t;t!==this.matrix.data[4]&&this.flagDirty()},setY:t=>{if(this.parent){const{y:e}=this.parent.inverse.multiply(B(this.pos.x,t));this.pos.y=e}else this.pos.y=t;t!==this.matrix.data[5]&&this.flagDirty()}})}set rotation(t){const e=L(t);e!==this._rotation&&this.flagDirty(),this._rotation=e}get rotation(){return this._rotation}set globalRotation(t){let e=0;this.parent&&(e=this.parent.globalRotation);const i=L(t+e);i!==this._rotation&&this.flagDirty(),this._rotation=i}get globalRotation(){return this.parent?this.matrix.getRotation():this.rotation}set scale(t){t.equals(this._scale)||(this._scale.x=t.x,this._scale.y=t.y,this.flagDirty())}get scale(){return new Yr(this._scale,(t,e)=>{(t!==this._scale.x||e!==this._scale.y)&&this.flagDirty()})}set globalScale(t){let e=B(1,1);this.parent&&(e=this.parent.globalScale),this.scale=t.scale(B(1/e.x,1/e.y))}get globalScale(){return new $s({getX:()=>this.parent?this.matrix.getScaleX():this.scale.x,getY:()=>this.parent?this.matrix.getScaleY():this.scale.y,setX:t=>{if(this.parent){const e=this.parent.globalScale.x;this.scale.x=t/e}else this.scale.x=t},setY:t=>{if(this.parent){const e=this.parent.globalScale.y;this.scale.y=t/e}else this.scale.y=t}})}get matrix(){return this._isDirty&&(this.parent===null?this._matrix=this._calculateMatrix():this._matrix=this.parent.matrix.multiply(this._calculateMatrix()),this._isDirty=!1),this._matrix}get inverse(){return this._isInverseDirty&&(this._inverse=this.matrix.inverse(),this._isInverseDirty=!1),this._inverse}_calculateMatrix(){return ct.identity().translate(this.pos.x,this.pos.y).rotate(this.rotation).scale(this.scale.x,this.scale.y)}flagDirty(){this._isDirty=!0,this._isInverseDirty=!0;for(let t=0;t<this._children.length;t++)this._children[t].flagDirty()}apply(t){return this.matrix.multiply(t)}applyInverse(t){return this.inverse.multiply(t)}setTransform(t,e,i){this._pos.x=t.x,this._pos.y=t.y,this._rotation=L(e),this._scale.x=i.x,this._scale.y=i.y,this.flagDirty()}clone(t){const e=t??new rs;this._pos.clone(e._pos),e._rotation=this._rotation,this._scale.clone(e._scale),e.flagDirty()}}function tn(a){return!!(a!=null&&a.clone)}class re{constructor(){this.owner=null}clone(){const t=new this.constructor;for(const e in this)if(this.hasOwnProperty(e)){const i=this[e];tn(i)&&e!=="owner"&&e!=="clone"?t[e]=i.clone():t[e]=i}return t}}class En extends re{constructor(t,e){super(),this.type=t,this.value=e}}class ee{constructor(){this.observers=[],this.subscriptions=[]}register(t){this.observers.push(t)}subscribe(t){this.subscriptions.push(t)}unregister(t){const e=this.observers.indexOf(t);e!==-1&&this.observers.splice(e,1)}unsubscribe(t){const e=this.subscriptions.indexOf(t);e!==-1&&this.subscriptions.splice(e,1)}notifyAll(t){const e=this.observers.length;for(let n=0;n<e;n++)this.observers[n].notify(t);const i=this.subscriptions.length;for(let n=0;n<i;n++)this.subscriptions[n](t)}clear(){this.observers.length=0,this.subscriptions.length=0}}class $ extends re{constructor(){super(...arguments),this.type="ex.transform",this._transform=new rs,this._addChildTransform=t=>{const e=t.get($);e&&(e._transform.parent=this._transform)},this.zIndexChanged$=new ee,this._z=0,this.coordPlane=xe.World}get(){return this._transform}onAdd(t){for(const e of t.children)this._addChildTransform(e);t.childrenAdded$.subscribe(e=>this._addChildTransform(e)),t.childrenRemoved$.subscribe(e=>{const i=e.get($);i&&(i._transform.parent=null)})}onRemove(t){this._transform.parent=null}get z(){return this._z}set z(t){const e=this._z;this._z=t,e!==t&&this.zIndexChanged$.notifyAll(t)}get pos(){return this._transform.pos}set pos(t){this._transform.pos=t}get globalPos(){return this._transform.globalPos}set globalPos(t){this._transform.globalPos=t}get rotation(){return this._transform.rotation}set rotation(t){this._transform.rotation=t}get globalRotation(){return this._transform.globalRotation}set globalRotation(t){this._transform.globalRotation=t}get scale(){return this._transform.scale}set scale(t){this._transform.scale=t}get globalScale(){return this._transform.globalScale}set globalScale(t){this._transform.globalScale=t}applyInverse(t){return this._transform.applyInverse(t)}apply(t){return this._transform.apply(t)}}class Bt extends re{constructor(){super(...arguments),this.type="ex.motion",this.vel=k.Zero,this.acc=k.Zero,this.scaleFactor=k.Zero,this.angularVelocity=0,this.torque=0,this.inertia=1}}class Pe{constructor(t,e,i){this._name=t,this._category=e,this._mask=i}get name(){return this._name}get category(){return this._category}get mask(){return this._mask}canCollide(t){return(this.category&t.mask)!==0&&(t.category&this.mask)!==0}invert(){return new Pe("~("+this.name+")",~this.category,~this.mask)}static combine(t){const e=t.map(o=>o.name).join("+"),i=t.reduce((o,h)=>h.category|o,0),n=~i;return new Pe(e,i,n)}static collidesWith(t){return Pe.combine(t).invert()}}Pe.All=new Pe("Collide with all groups",-1,-1);class oe{constructor(t,e){this.colliderA=t,this.colliderB=e,this.id=null,this.id=oe.calculatePairHash(t.id,e.id)}static canCollide(t,e){var i,n;const o=(i=t==null?void 0:t.owner)===null||i===void 0?void 0:i.get(vt),h=(n=e==null?void 0:e.owner)===null||n===void 0?void 0:n.get(vt);return!(t.id===e.id||t.owner&&e.owner&&t.owner.id===e.owner.id||t.localBounds.hasZeroDimensions()||e.localBounds.hasZeroDimensions()||!o||!h||!o.group.canCollide(h.group)||o.collisionType===dt.Fixed&&h.collisionType===dt.Fixed||h.collisionType===dt.PreventCollision||o.collisionType===dt.PreventCollision||!o.active||!h.active)}get canCollide(){const t=this.colliderA,e=this.colliderB;return oe.canCollide(t,e)}collide(){return this.colliderA.collide(this.colliderB)}hasCollider(t){return t===this.colliderA||t===this.colliderB}static calculatePairHash(t,e){return t.value<e.value?`#${t.value}+${e.value}`:`#${e.value}+${t.value}`}}class $e{constructor(t,e){this.min=t,this.max=e}overlaps(t){return this.max>t.min&&t.max>this.min}getOverlap(t){return this.overlaps(t)?this.max>t.max?t.max-this.min:this.max-t.min:0}}class Mi{constructor(t){this.parent=t,this.parent=t||null,this.data=null,this.bounds=new nt,this.left=null,this.right=null,this.height=0}isLeaf(){return!this.left&&!this.right}}class Es{constructor(t=new nt(-Number.MAX_VALUE,-Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)){this.worldBounds=t,this.root=null,this.nodes={}}_insert(t){if(this.root===null){this.root=t,this.root.parent=null;return}const e=t.bounds;let i=this.root;for(;!i.isLeaf();){const d=i.left,u=i.right,g=i.bounds.getPerimeter(),I=i.bounds.combine(e).getPerimeter(),D=2*I,U=2*(I-g);let H=0;const Z=e.combine(d.bounds);let K,z;d.isLeaf()?H=Z.getPerimeter()+U:(z=d.bounds.getPerimeter(),K=Z.getPerimeter(),H=K-z+U);let N=0;const et=e.combine(u.bounds);if(u.isLeaf()?N=et.getPerimeter()+U:(z=u.bounds.getPerimeter(),K=et.getPerimeter(),N=K-z+U),D<H&&D<N)break;H<N?i=d:i=u}const n=i.parent,o=new Mi(n);o.bounds=e.combine(i.bounds),o.height=i.height+1,n!==null?(n.left===i?n.left=o:n.right=o,o.left=i,o.right=t,i.parent=o,t.parent=o):(o.left=i,o.right=t,i.parent=o,t.parent=o,this.root=o);let h=t.parent;for(;h;){if(h=this._balance(h),!h.left)throw new Error("Parent of current leaf cannot have a null left child"+h);if(!h.right)throw new Error("Parent of current leaf cannot have a null right child"+h);h.height=1+Math.max(h.left.height,h.right.height),h.bounds=h.left.bounds.combine(h.right.bounds),h=h.parent}}_remove(t){if(t===this.root){this.root=null;return}const e=t.parent,i=e.parent;let n;if(e.left===t?n=e.right:n=e.left,i){i.left===e?i.left=n:i.right=n,n.parent=i;let o=i;for(;o;)o=this._balance(o),o.bounds=o.left.bounds.combine(o.right.bounds),o.height=1+Math.max(o.left.height,o.right.height),o=o.parent}else this.root=n,n.parent=null}trackCollider(t){const e=new Mi;e.data=t,e.bounds=t.bounds,e.bounds.left-=2,e.bounds.top-=2,e.bounds.right+=2,e.bounds.bottom+=2,this.nodes[t.id.value]=e,this._insert(e)}updateCollider(t){var e;const i=this.nodes[t.id.value];if(!i)return!1;const n=t.bounds;if(!this.worldBounds.contains(n))return Y.getInstance().warn("Collider with id "+t.id.value+" is outside the world bounds and will no longer be tracked for physics"),this.untrackCollider(t),!1;if(i.bounds.contains(n))return!1;if(this._remove(i),n.left-=ot.boundsPadding,n.top-=ot.boundsPadding,n.right+=ot.boundsPadding,n.bottom+=ot.boundsPadding,t.owner){const o=(e=t.owner)===null||e===void 0?void 0:e.get(vt);if(o){const h=o.vel.x*32/1e3*ot.dynamicTreeVelocityMultiplier,d=o.vel.y*32/1e3*ot.dynamicTreeVelocityMultiplier;h<0?n.left+=h:n.right+=h,d<0?n.top+=d:n.bottom+=d}}return i.bounds=n,this._insert(i),!0}untrackCollider(t){const e=this.nodes[t.id.value];e&&(this._remove(e),this.nodes[t.id.value]=null,delete this.nodes[t.id.value])}_balance(t){if(t===null)throw new Error("Cannot balance at null node");if(t.isLeaf()||t.height<2)return t;const e=t.left,i=t.right,n=t,o=e,h=i,d=e.left,u=e.right,g=i.left,v=i.right,I=h.height-o.height;if(I>1)return h.left=n,h.parent=n.parent,n.parent=h,h.parent?h.parent.left===n?h.parent.left=h:h.parent.right=h:this.root=h,g.height>v.height?(h.right=g,n.right=v,v.parent=n,n.bounds=o.bounds.combine(v.bounds),h.bounds=n.bounds.combine(g.bounds),n.height=1+Math.max(o.height,v.height),h.height=1+Math.max(n.height,g.height)):(h.right=v,n.right=g,g.parent=n,n.bounds=o.bounds.combine(g.bounds),h.bounds=n.bounds.combine(v.bounds),n.height=1+Math.max(o.height,g.height),h.height=1+Math.max(n.height,v.height)),h;if(I<-1){if(o.left=n,o.parent=n.parent,n.parent=o,o.parent)if(o.parent.left===n)o.parent.left=o;else{if(o.parent.right!==n)throw"Error rotating Dynamic Tree";o.parent.right=o}else this.root=o;return d.height>u.height?(o.right=d,n.left=u,u.parent=n,n.bounds=h.bounds.combine(u.bounds),o.bounds=n.bounds.combine(d.bounds),n.height=1+Math.max(h.height,u.height),o.height=1+Math.max(n.height,d.height)):(o.right=u,n.left=d,d.parent=n,n.bounds=h.bounds.combine(d.bounds),o.bounds=n.bounds.combine(u.bounds),n.height=1+Math.max(h.height,d.height),o.height=1+Math.max(n.height,u.height)),o}return t}getHeight(){return this.root===null?0:this.root.height}query(t,e){const i=t.bounds,n=o=>{if(o&&o.bounds.overlaps(i))if(o.isLeaf()&&o.data!==t){if(e.call(t,o.data))return!0}else return n(o.left)||n(o.right);return!1};n(this.root)}rayCastQuery(t,e=1/0,i){const n=o=>{if(o&&o.bounds.rayCast(t,e))if(o.isLeaf()){if(i.call(t,o.data))return!0}else return n(o.left)||n(o.right);return!1};n(this.root)}getNodes(){const t=e=>e?[e].concat(t(e.left),t(e.right)):[];return t(this.root)}debug(t){const e=i=>{i&&(i.isLeaf()?i.bounds.draw(t,j.Green):i.bounds.draw(t,j.White),i.left&&e(i.left),i.right&&e(i.right))};e(this.root)}}class _i{constructor(t,e){this.pos=t,this.dir=e.normalize()}intersect(t){const e=t.begin.sub(this.pos);if(this.dir.cross(t.getSlope())===0&&e.cross(this.dir)!==0)return-1;const i=this.dir.cross(t.getSlope());if(i===0)return-1;const n=e.cross(t.getSlope())/i;if(n>=0){const o=e.cross(this.dir)/i/t.getLength();if(o>=0&&o<=1)return n}return-1}intersectPoint(t){const e=this.intersect(t);return e<0?null:this.getPoint(e)}getPoint(t){return this.pos.add(this.dir.scale(t))}}class pr{constructor(){this._dynamicCollisionTree=new Es,this._pairs=new Set,this._collisionPairCache=[],this._colliders=[]}getColliders(){return this._colliders}rayCast(t,e){var i,n,o;const h=[],d=(i=e==null?void 0:e.maxDistance)!==null&&i!==void 0?i:1/0,u=(n=e==null?void 0:e.collisionGroup)!==null&&n!==void 0?n:Pe.All,g=(o=e==null?void 0:e.searchAllColliders)!==null&&o!==void 0?o:!1;return this._dynamicCollisionTree.rayCastQuery(t,d,v=>{var I;const U=v.owner.get(vt);if(u.mask!==Pe.All.mask&&((I=U==null?void 0:U.group)===null||I===void 0?void 0:I.mask)!==u.mask)return!1;const H=v.rayCast(t,d);return!!(H&&(h.push({distance:H.sub(t.pos).distance(),point:H,collider:v,body:U}),!g))}),h}track(t){if(!t){Y.getInstance().warn("Cannot track null collider");return}if(t instanceof Wt){const e=t.getColliders();for(const i of e)i.owner=t.owner,this._colliders.push(i),this._dynamicCollisionTree.trackCollider(i)}else this._colliders.push(t),this._dynamicCollisionTree.trackCollider(t)}untrack(t){if(!t){Y.getInstance().warn("Cannot untrack a null collider");return}if(t instanceof Wt){const e=t.getColliders();for(const i of e){const n=this._colliders.indexOf(i);n!==-1&&this._colliders.splice(n,1),this._dynamicCollisionTree.untrackCollider(i)}}else{const e=this._colliders.indexOf(t);e!==-1&&this._colliders.splice(e,1),this._dynamicCollisionTree.untrackCollider(t)}}_pairExists(t,e){const i=oe.calculatePairHash(t.id,e.id);return this._pairs.has(i)}broadphase(t,e,i){const n=e/1e3,o=t.filter(d=>{var u,g;const v=(u=d.owner)===null||u===void 0?void 0:u.get(vt);return((g=d.owner)===null||g===void 0?void 0:g.active)&&v.collisionType!==dt.PreventCollision});this._collisionPairCache=[],this._pairs.clear();let h;for(let d=0,u=o.length;d<u;d++)h=o[d],this._dynamicCollisionTree.query(h,g=>{if(!this._pairExists(h,g)&&oe.canCollide(h,g)){const v=new oe(h,g);this._pairs.add(v.id),this._collisionPairCache.push(v)}return!1});if(i&&(i.physics.pairs=this._collisionPairCache.length),ot.checkForFastBodies)for(const d of o){const u=d.owner.get(vt);if(u.collisionType!==dt.Active)continue;const g=u.vel.size*n+u.acc.size*.5*n*n,v=Math.min(d.bounds.height,d.bounds.width);if(ot.disableMinimumSpeedForFastBody||g>v/2){i&&i.physics.fastBodies++;const I=u.globalPos.sub(u.oldPos),D=d.center,U=d.getFurthestPoint(u.vel),H=U.sub(I),Z=new _i(H,u.vel);Z.pos=Z.pos.add(Z.dir.scale(-2*ot.surfaceEpsilon));let K,z=new k(1/0,1/0);if(this._dynamicCollisionTree.rayCastQuery(Z,g+ot.surfaceEpsilon*2,N=>{if(!this._pairExists(d,N)&&oe.canCollide(d,N)){const et=N.rayCast(Z,g+ot.surfaceEpsilon*10);if(et){const st=et.sub(H);st.size<z.size&&(z=st,K=N)}}return!1}),K&&k.isValid(z)){const N=new oe(d,K);this._pairs.has(N.id)||(this._pairs.add(N.id),this._collisionPairCache.push(N));const et=D.sub(U);u.globalPos=H.add(et).add(z).add(Z.dir.scale(10*ot.surfaceEpsilon)),d.update(u.transform.get()),i&&i.physics.fastBodyCollisions++}}}return this._collisionPairCache}narrowphase(t,e){let i=[];for(let n=0;n<t.length;n++){const o=t[n].collide();if(i=i.concat(o),e&&o.length>0)for(const h of o)e.physics.contacts.set(h.id,h)}return e&&(e.physics.collisions+=i.length),i}update(t){let e=0;const i=t.length;for(let n=0;n<i;n++)this._dynamicCollisionTree.updateCollider(t[n])&&e++;return e}debug(t){this._dynamicCollisionTree.debug(t)}}class Fi{constructor(){this.id=P("collider",Fi._ID++),this.__compositeColliderId=null,this.events=new Pi}touching(t){return!!this.collide(t)}}Fi._ID=0;class Wt extends Fi{constructor(t){super(),this._collisionProcessor=new pr,this._dynamicAABBTree=new Es,this._colliders=[];for(const e of t)this.addCollider(e)}clearColliders(){this._colliders=[]}addCollider(t){this.events.wire(t.events),t.__compositeColliderId=this.id,this._colliders.push(t),this._collisionProcessor.track(t),this._dynamicAABBTree.trackCollider(t)}removeCollider(t){this.events.unwire(t.events),t.__compositeColliderId=null,Le(t,this._colliders),this._collisionProcessor.untrack(t),this._dynamicAABBTree.untrackCollider(t)}getColliders(){return this._colliders}get worldPos(){var t,e;return(e=(t=this._transform)===null||t===void 0?void 0:t.pos)!==null&&e!==void 0?e:k.Zero}get center(){var t,e;return(e=(t=this._transform)===null||t===void 0?void 0:t.pos)!==null&&e!==void 0?e:k.Zero}get bounds(){var t,e;const i=this.getColliders();return i.reduce((o,h)=>o.combine(h.bounds),(e=(t=i[0])===null||t===void 0?void 0:t.bounds)!==null&&e!==void 0?e:new nt().translate(this.worldPos))}get localBounds(){var t,e;const i=this.getColliders();return i.reduce((o,h)=>o.combine(h.localBounds),(e=(t=i[0])===null||t===void 0?void 0:t.localBounds)!==null&&e!==void 0?e:new nt)}get axes(){const t=this.getColliders();let e=[];for(const i of t)e=e.concat(i.axes);return e}getFurthestPoint(t){const e=this.getColliders(),i=[];for(const h of e)i.push(h.getFurthestPoint(t));let n=i[0],o=-Number.MAX_VALUE;for(const h of i){const d=h.dot(t);d>o&&(n=h,o=d)}return n}getInertia(t){const e=this.getColliders();let i=0;for(const n of e)i+=n.getInertia(t);return i}collide(t){let e=[t];t instanceof Wt&&(e=t.getColliders());const i=[];for(const o of e)this._dynamicAABBTree.query(o,h=>(i.push(new oe(o,h)),!1));let n=[];for(const o of i)n=n.concat(o.collide());return n}getClosestLineBetween(t){const e=this.getColliders(),i=[];if(t instanceof Wt){const n=t.getColliders();for(const o of e)for(const h of n){const d=o.getClosestLineBetween(h);d&&i.push(d)}}else for(const n of e){const o=t.getClosestLineBetween(n);o&&i.push(o)}if(i.length){let n=i[0].getLength(),o=i[0];for(const h of i){const d=h.getLength();d<n&&(n=d,o=h)}return o}return null}contains(t){const e=this.getColliders();for(const i of e)if(i.contains(t))return!0;return!1}rayCast(t,e){const i=this.getColliders(),n=[];for(const o of i){const h=o.rayCast(t,e);h&&n.push(h)}if(n.length){let o=n[0],h=o.dot(t.dir);for(const d of n){const u=t.dir.dot(d);u<h&&(o=d,h=u)}return o}return null}project(t){const e=this.getColliders(),i=[];for(const n of e){const o=n.project(t);o&&i.push(o)}if(i.length){const n=new $e(i[0].min,i[0].max);for(const o of i)n.min=Math.min(o.min,n.min),n.max=Math.max(o.max,n.max);return n}return null}update(t){if(t){const e=this.getColliders();for(const i of e)i.owner=this.owner,i.update(t)}}debug(t,e){const i=this.getColliders();for(const n of i)n.debug(t,e)}clone(){return new Wt(this._colliders.map(t=>t.clone()))}}class fe{constructor(t,e){this.begin=t,this.end=e}get slope(){return(this.end.y-this.begin.y)/(this.end.x-this.begin.x)}get intercept(){return this.begin.y-this.slope*this.begin.x}normal(){return this._normal?this._normal:this._normal=this.end.sub(this.begin).normal()}dir(){return this._dir?this._dir:this._dir=this.end.sub(this.begin)}getPoints(){return[this.begin,this.end]}getSlope(){if(this._slope)return this._slope;const t=this.begin,e=this.end,i=t.distance(e);return this._slope=e.sub(t).scale(1/i)}getEdge(){const t=this.begin;return this.end.sub(t)}getLength(){if(this._length)return this._length;const t=this.begin,e=this.end,i=t.distance(e);return this._length=i}get midpoint(){return this.begin.add(this.end).scale(.5)}flip(){return new fe(this.end,this.begin)}below(t){return(this.end.x-this.begin.x)*(t.y-this.begin.y)-(this.end.y-this.begin.y)*(t.x-this.begin.x)>=0}clip(t,e){let i=t;i=i.normalize();const n=i.dot(this.begin)-e,o=i.dot(this.end)-e,h=[];if(n<=0&&h.push(this.begin),o<=0&&h.push(this.end),n*o<0){const d=n/(n-o);h.push(this.begin.add(this.end.sub(this.begin).scale(d)))}return h.length!==2?null:new fe(h[0],h[1])}distanceToPoint(t,e=!1){const i=t.x,n=t.y,o=this.getLength(),h=this.end.y-this.begin.y,d=this.end.x-this.begin.x,u=(h*i-d*n+this.end.x*this.begin.y-this.end.y*this.begin.x)/o;return e?u:Math.abs(u)}findVectorToPoint(t){const e=this.begin.sub(t),i=this.getSlope();return e.sub(i.scale(e.dot(i)))}findPoint(t=null,e=null){const i=this.slope,n=this.intercept;if(t!==null)return new k(t,i*t+n);if(e!==null)return new k((e-n)/i,e);throw new Error("You must provide an X or a Y value")}hasPoint(){let t,e=0;if(typeof arguments[0]=="number"&&typeof arguments[1]=="number")t=new k(arguments[0],arguments[1]),e=arguments[2]||0;else if(arguments[0]instanceof k)t=arguments[0],e=arguments[1]||0;else throw"Could not determine the arguments for Vector.hasPoint";const i=t.x-this.begin.x,n=t.y-this.begin.y,o=this.end.x-this.begin.x,h=this.end.y-this.begin.y,d=i*h-n*o;return Math.abs(d)>e?!1:Math.abs(o)>=Math.abs(h)?o>0?this.begin.x<=t.x&&t.x<=this.end.x:this.end.x<=t.x&&t.x<=this.begin.x:h>0?this.begin.y<=t.y&&t.y<=this.end.y:this.end.y<=t.y&&t.y<=this.begin.y}}function en(a,t,e,i){const n=a.sub(e),o=t.dot(t),h=t.dot(i),d=i.dot(i),u=t.dot(n),g=i.dot(n),v=o*d-h*h;let I=v,D=v;if(v===0||v<=.01){const Z=u/h;return new fe(a,e.add(i.scale(Z)))}let U=h*g-d*u,H=o*g-h*u;return U<0?(U=0,H=g,D=d):U>I&&(U=I,H=g+h,D=d),H<0?(H=0,-u<0?U=0:-u>o?U=I:(U=-u,I=o)):H>D&&(H=D,-u+h<0?U=0:-u+h>o?U=I:(U=-u+h,I=o)),U=Math.abs(U)<.001?0:U/I,H=Math.abs(H)<.001?0:H/D,new fe(a.add(t.scale(U)),e.add(i.scale(H)))}const ae={PolygonPolygonClosestLine(a,t){const e=t.worldPos,i=e.sub(a.worldPos),n=i.negate(),o=new _i(a.worldPos,i),h=new _i(e,n),d=a.rayCast(o).add(o.dir.scale(.1)),u=t.rayCast(h).add(h.dir.scale(.1)),g=a.getClosestFace(d),v=t.getClosestFace(u),I=g.face.begin,D=g.face.getEdge(),U=v.face.begin,H=v.face.getEdge();return en(I,D,U,H)},PolygonEdgeClosestLine(a,t){const i=t.worldPos.sub(a.worldPos),n=new _i(a.worldPos,i),o=a.rayCast(n).add(n.dir.scale(.1)),h=a.getClosestFace(o),d=h.face.begin,u=h.face.getEdge(),g=t.asLine(),v=g.begin,I=g.getEdge();return en(d,u,v,I)},PolygonCircleClosestLine(a,t){const e=t.worldPos,i=e.sub(a.worldPos),n=new _i(a.worldPos,i.normalize()),o=a.rayCast(n).add(n.dir.scale(.1)),h=a.getClosestFace(o),d=h.face.begin,u=h.face.getEdge();let g=(u.x*(e.x-d.x)+u.y*(e.y-d.y))/(u.x*u.x+u.y*u.y);g>1?g=1:g<0&&(g=0);const v=Math.sqrt(Math.pow(d.x+u.x*g-e.x,2)+Math.pow(d.y+u.y*g-e.y,2))-t.radius,I=(d.x+u.x*g-e.x)*t.radius/(t.radius+v),D=(d.y+u.y*g-e.y)*t.radius/(t.radius+v);return new fe(u.scale(g).add(d),new k(e.x+I,e.y+D))},CircleCircleClosestLine(a,t){const i=t.worldPos.sub(a.worldPos),o=a.worldPos.sub(t.worldPos),h=new _i(a.worldPos,i),d=new _i(t.worldPos,o),u=a.rayCast(h),g=t.rayCast(d);return new fe(u,g)},CircleEdgeClosestLine(a,t){const e=a.worldPos,i=t.asLine(),n=i.begin,o=i.getEdge(),h=n,d=o;let u=(d.x*(e.x-h.x)+d.y*(e.y-h.y))/(d.x*d.x+d.y*d.y);u>1?u=1:u<0&&(u=0);const g=Math.sqrt(Math.pow(h.x+d.x*u-e.x,2)+Math.pow(h.y+d.y*u-e.y,2))-a.radius,v=(h.x+d.x*u-e.x)*a.radius/(a.radius+g),I=(h.y+d.y*u-e.y)*a.radius/(a.radius+g);return new fe(d.scale(u).add(h),new k(e.x+v,e.y+I))},EdgeEdgeClosestLine(a,t){const e=a.asLine(),i=e.begin,n=e.getEdge(),o=i,h=n,d=t.asLine(),u=d.begin,g=d.getEdge();return en(o,h,u,g)}};class Yt extends Fi{get worldPos(){return this._globalMatrix.getPosition()}get radius(){var t;const e=this._transform,i=(t=e==null?void 0:e.globalScale)!==null&&t!==void 0?t:k.One;return this._naturalRadius*Math.min(i.x,i.y)}set radius(t){var e;const i=this._transform,n=(e=i==null?void 0:i.globalScale)!==null&&e!==void 0?e:k.One;this._naturalRadius=t/Math.min(n.x,n.y)}constructor(t){super(),this.offset=k.Zero,this._globalMatrix=ct.identity(),this.offset=t.offset||k.Zero,this.radius=t.radius||0,this._globalMatrix.translate(this.offset.x,this.offset.y)}clone(){return new Yt({offset:this.offset.clone(),radius:this.radius})}get center(){return this._globalMatrix.getPosition()}contains(t){var e,i;return((i=(e=this._transform)===null||e===void 0?void 0:e.pos)!==null&&i!==void 0?i:this.offset).distance(t)<=this.radius}rayCast(t,e=1/0){const i=this.center,n=t.dir,o=t.pos,h=Math.sqrt(Math.pow(n.dot(o.sub(i)),2)-Math.pow(o.sub(i).distance(),2)+Math.pow(this.radius,2));if(h<0)return null;{let d=0;if(h===0)return d=-n.dot(o.sub(i)),d>0&&d<e?t.getPoint(d):null;{const u=-n.dot(o.sub(i))+h,g=-n.dot(o.sub(i))-h,v=[];u>=0&&v.push(u),g>=0&&v.push(g);const I=Math.min(...v);return I<=e?t.getPoint(I):null}}}getClosestLineBetween(t){if(t instanceof Yt)return ae.CircleCircleClosestLine(this,t);if(t instanceof lt)return ae.PolygonCircleClosestLine(t,this).flip();if(t instanceof ie)return ae.CircleEdgeClosestLine(this,t).flip();throw new Error(`Polygon could not collide with unknown CollisionShape ${typeof t}`)}collide(t){if(t instanceof Yt)return De.CollideCircleCircle(this,t);if(t instanceof lt)return De.CollideCirclePolygon(this,t);if(t instanceof ie)return De.CollideCircleEdge(this,t);throw new Error(`Circle could not collide with unknown CollisionShape ${typeof t}`)}getFurthestPoint(t){return this.center.add(t.normalize().scale(this.radius))}getFurthestLocalPoint(t){return t.normalize().scale(this.radius)}get bounds(){var t,e,i;const n=this._transform,o=(t=n==null?void 0:n.globalScale)!==null&&t!==void 0?t:k.One,h=(e=n==null?void 0:n.globalRotation)!==null&&e!==void 0?e:0,d=(i=n==null?void 0:n.globalPos)!==null&&i!==void 0?i:k.Zero;return new nt(this.offset.x-this._naturalRadius,this.offset.y-this._naturalRadius,this.offset.x+this._naturalRadius,this.offset.y+this._naturalRadius).rotate(h).scale(o).translate(d)}get localBounds(){return new nt(this.offset.x-this._naturalRadius,this.offset.y-this._naturalRadius,this.offset.x+this._naturalRadius,this.offset.y+this._naturalRadius)}get axes(){return[]}getInertia(t){return t*this.radius*this.radius/2}update(t){var e;this._transform=t,((e=t.matrix)!==null&&e!==void 0?e:this._globalMatrix).clone(this._globalMatrix),this._globalMatrix.translate(this.offset.x,this.offset.y)}project(t){const e=[],n=this.center.dot(t);return e.push(n),e.push(n+this.radius),e.push(n-this.radius),new $e(Math.min.apply(Math,e),Math.max.apply(Math,e))}debug(t,e){var i,n,o,h;const d=this._transform,u=(i=d==null?void 0:d.globalScale)!==null&&i!==void 0?i:k.One,g=(n=d==null?void 0:d.globalRotation)!==null&&n!==void 0?n:0,v=(o=d==null?void 0:d.globalPos)!==null&&o!==void 0?o:k.Zero;t.save(),t.translate(v.x,v.y),t.rotate(g),t.scale(u.x,u.y),t.drawCircle((h=this.offset)!==null&&h!==void 0?h:k.Zero,this._naturalRadius,j.Transparent,e,2),t.restore()}}class os{constructor(t,e,i,n,o,h,d,u){var g,v;this._canceled=!1,this.colliderA=t,this.colliderB=e,this.mtv=i,this.normal=n,this.tangent=o,this.points=h,this.localPoints=d,this.info=u,this.id=oe.calculatePairHash(t.id,e.id),(t.__compositeColliderId||e.__compositeColliderId)&&(this.id+="|"+oe.calculatePairHash((g=t.__compositeColliderId)!==null&&g!==void 0?g:t.id,(v=e.__compositeColliderId)!==null&&v!==void 0?v:e.id))}matchAwake(){const t=this.colliderA.owner.get(vt),e=this.colliderB.owner.get(vt);t&&e&&t.sleeping!==e.sleeping&&(t.sleeping&&t.collisionType!==dt.Fixed&&e.sleepMotion>=ot.wakeThreshold&&t.setSleeping(!1),e.sleeping&&e.collisionType!==dt.Fixed&&t.sleepMotion>=ot.wakeThreshold&&e.setSleeping(!1))}isCanceled(){return this._canceled}cancel(){this._canceled=!0}}class Ss{static findPolygonPolygonSeparation(t,e){let i=-Number.MAX_VALUE,n=null,o=null,h=-1,d=null;const u=t.getSides(),g=t.getLocalSides();for(let v=0;v<u.length;v++){const I=u[v],D=I.normal(),U=e.getFurthestPoint(D.negate()),H=I.distanceToPoint(U,!0);H>i&&(i=H,n=I,o=D,h=v,d=U)}return{collider:t,separation:o?i:99,axis:o,side:n,localSide:g[h],sideId:h,point:d,localPoint:o?e.getFurthestLocalPoint(o.negate()):null}}static findCirclePolygonSeparation(t,e){const i=e.axes,o=e.center.sub(t.worldPos),h=e.getFurthestPoint(o.negate());i.push(h.sub(t.worldPos).normalize());let d=Number.MAX_VALUE,u=null,g=-1;for(let v=0;v<i.length;v++){const I=e.project(i[v]),D=t.project(i[v]),U=I.getOverlap(D);if(U<=0)return null;U<d&&(d=U,u=i[v],g=v)}return g<0?null:u.normalize().scale(d)}}const De={CollideCircleCircle(a,t){const e=a.worldPos,i=t.worldPos,n=a.radius+t.radius,o=e.distance(i);if(o>n)return[];const h=n-o,d=i.sub(e).normalize(),u=d.perpendicular(),g=d.scale(h),v=a.getFurthestPoint(d),I=a.getFurthestLocalPoint(d),D={collider:a,separation:h,axis:d,point:v};return[new os(a,t,g,d,u,[v],[I],D)]},CollideCirclePolygon(a,t){var e,i;let n=Ss.findCirclePolygonSeparation(a,t);if(!n)return[];n=n.dot(t.center.sub(a.center))<0?n.negate():n;const h=a.getFurthestPoint(n),u=((i=(e=a.owner)===null||e===void 0?void 0:e.get($))!==null&&i!==void 0?i:new $).applyInverse(h),g=n.normalize(),v={collider:a,separation:-n.size,axis:g,point:h,localPoint:u,side:t.findSide(g.negate()),localSide:t.findLocalSide(g.negate())};return[new os(a,t,n,g,g.perpendicular(),[h],[u],v)]},CollideCircleEdge(a,t){const e=a.center,i=t.asLine(),n=i.end.sub(i.begin),o=n.dot(i.end.sub(e)),h=n.dot(e.sub(i.begin)),d=t.asLine(),u=t.asLocalLine();if(h<=0){const z=i.begin.sub(e),N=z.dot(z);if(N>a.radius*a.radius)return[];const et=z.normalize(),st=a.radius-Math.sqrt(N),ft={collider:a,separation:st,axis:et,point:d.begin,side:d,localSide:u};return[new os(a,t,et.scale(st),et,et.perpendicular(),[d.begin],[u.begin],ft)]}if(o<=0){const z=i.end.sub(e),N=z.dot(z);if(N>a.radius*a.radius)return[];const et=z.normalize(),st=a.radius-Math.sqrt(N),ft={collider:a,separation:st,axis:et,point:d.end,side:d,localSide:u};return[new os(a,t,et.scale(st),et,et.perpendicular(),[d.end],[u.end],ft)]}const g=n.dot(n),v=i.begin.scale(o).add(i.end.scale(h)).scale(1/g),I=e.sub(v),D=I.dot(I);if(D>a.radius*a.radius)return[];let U=n.perpendicular();U.dot(e.sub(i.begin))<0&&(U.x=-U.x,U.y=-U.y),U=U.normalize();const H=a.radius-Math.sqrt(D),Z=U.scale(H),K={collider:a,separation:H,axis:U,point:v,side:d,localSide:u};return[new os(a,t,Z,U.negate(),U.negate().perpendicular(),[v],[v.sub(t.worldPos)],K)]},CollideEdgeEdge(){return[]},CollidePolygonEdge(a,t){var e;const i=a.center,o=t.center.sub(i).normalize(),h=new lt({points:[t.begin,t.end,t.end.add(o.scale(100)),t.begin.add(o.scale(100))],offset:t.offset});h.owner=t.owner,((e=t.owner)===null||e===void 0?void 0:e.get($))&&h.update(t.owner.get($).get());const u=this.CollidePolygonPolygon(a,h);return u.length&&(u[0].colliderB=t,u[0].id=oe.calculatePairHash(a.id,t.id)),u},CollidePolygonPolygon(a,t){var e,i,n,o;const h=Ss.findPolygonPolygonSeparation(a,t);if(h.separation>0)return[];const d=Ss.findPolygonPolygonSeparation(t,a);if(d.separation>0)return[];const u=h.separation>d.separation?h:d,v=(u.collider===a?t:a).findSide(u.axis.negate()),I=u.side,D=I.dir().normalize(),U=v.clip(D.negate(),-D.dot(I.begin));let H=null;if(U&&(H=U.clip(D,D.dot(I.end))),H){const Z=H.getPoints().filter(et=>I.below(et));let K=u.axis,z=K.perpendicular();t.center.sub(a.center).dot(K)<0&&(K=K.negate(),z=K.perpendicular());let N=[];if(u.collider===a){const et=(i=(e=t.owner)===null||e===void 0?void 0:e.get($))!==null&&i!==void 0?i:new $;N=Z.map(st=>et.applyInverse(st))}else{const et=(o=(n=a.owner)===null||n===void 0?void 0:n.get($))!==null&&o!==void 0?o:new $;N=Z.map(st=>et.applyInverse(st))}return[new os(a,t,K.scale(-u.separation),K,z,Z,N,u)]}return[]},FindContactSeparation(a,t){var e,i,n,o;const h=a.colliderA,d=(i=(e=a.colliderA.owner)===null||e===void 0?void 0:e.get($))!==null&&i!==void 0?i:new $,u=a.colliderB,g=(o=(n=a.colliderB.owner)===null||n===void 0?void 0:n.get($))!==null&&o!==void 0?o:new $;if(h instanceof Yt&&u instanceof Yt){const v=h.radius+u.radius,I=d.pos.distance(g.pos);return-(v-I)}if(h instanceof lt&&u instanceof lt&&a.info.localSide){let v,I;return a.info.collider===h?(v=new fe(d.apply(a.info.localSide.begin),d.apply(a.info.localSide.end)),I=g.apply(t)):(v=new fe(g.apply(a.info.localSide.begin),g.apply(a.info.localSide.end)),I=d.apply(t)),v.distanceToPoint(I,!0)}if(h instanceof lt&&u instanceof Yt||u instanceof lt&&h instanceof Yt){const v=d.apply(t);if(a.info.side)return a.info.side.distanceToPoint(v,!0)}if(h instanceof ie&&u instanceof lt||u instanceof ie&&h instanceof lt){let v;if(a.info.collider===h?v=g.apply(t):v=d.apply(t),a.info.side)return a.info.side.distanceToPoint(v,!0)}if(h instanceof Yt&&u instanceof ie||u instanceof Yt&&h instanceof ie){const v=g.apply(t);let I;h instanceof Yt&&(I=h.getFurthestPoint(a.normal));const D=v.distance(I);if(a.info.side)return D>0?-D:0}return 0}};class ie extends Fi{constructor(t){var e;super(),this._globalMatrix=ct.identity(),this.begin=t.begin||k.Zero,this.end=t.end||k.Zero,this.offset=(e=t.offset)!==null&&e!==void 0?e:k.Zero}clone(){return new ie({begin:this.begin.clone(),end:this.end.clone()})}get worldPos(){var t;const e=this._transform;return(t=e==null?void 0:e.globalPos.add(this.offset))!==null&&t!==void 0?t:this.offset}get center(){const t=this._getTransformedBegin(),e=this._getTransformedEnd();return t.average(e)}_getTransformedBegin(){return this._globalMatrix.multiply(this.begin)}_getTransformedEnd(){return this._globalMatrix.multiply(this.end)}getSlope(){const t=this._getTransformedBegin(),e=this._getTransformedEnd(),i=t.distance(e);return e.sub(t).scale(1/i)}getLength(){const t=this._getTransformedBegin(),e=this._getTransformedEnd();return t.distance(e)}contains(){return!1}rayCast(t,e=1/0){const i=this._getTransformedBegin().sub(t.pos);if(t.dir.cross(this.getSlope())===0&&i.cross(t.dir)!==0)return null;const n=t.dir.cross(this.getSlope());if(n===0)return null;const o=i.cross(this.getSlope())/n;if(o>=0&&o<=e){const h=i.cross(t.dir)/n/this.getLength();if(h>=0&&h<=1)return t.getPoint(o)}return null}getClosestLineBetween(t){if(t instanceof Yt)return ae.CircleEdgeClosestLine(t,this);if(t instanceof lt)return ae.PolygonEdgeClosestLine(t,this).flip();if(t instanceof ie)return ae.EdgeEdgeClosestLine(this,t);throw new Error(`Polygon could not collide with unknown CollisionShape ${typeof t}`)}collide(t){if(t instanceof Yt)return De.CollideCircleEdge(t,this);if(t instanceof lt)return De.CollidePolygonEdge(t,this);if(t instanceof ie)return De.CollideEdgeEdge();throw new Error(`Edge could not collide with unknown CollisionShape ${typeof t}`)}getFurthestPoint(t){const e=this._getTransformedBegin(),i=this._getTransformedEnd();return t.dot(e)>0?e:i}_boundsFromBeginEnd(t,e,i=10){return new nt(Math.min(t.x,e.x)-i,Math.min(t.y,e.y)-i,Math.max(t.x,e.x)+i,Math.max(t.y,e.y)+i)}get bounds(){const t=this._getTransformedBegin(),e=this._getTransformedEnd();return this._boundsFromBeginEnd(t,e)}get localBounds(){return this._boundsFromBeginEnd(this.begin,this.end)}asLine(){return new fe(this._getTransformedBegin(),this._getTransformedEnd())}asLocalLine(){return new fe(this.begin,this.end)}get axes(){const e=this._getTransformedEnd().sub(this._getTransformedBegin()).normal(),i=[];return i.push(e),i.push(e.negate()),i.push(e.normal()),i.push(e.normal().negate()),i}getInertia(t){const e=this.end.sub(this.begin).distance()/2;return t*e*e}update(t){var e;this._transform=t,((e=t.matrix)!==null&&e!==void 0?e:this._globalMatrix).clone(this._globalMatrix),this._globalMatrix.translate(this.offset.x,this.offset.y)}project(t){const e=[],i=[this._getTransformedBegin(),this._getTransformedEnd()],n=i.length;for(let o=0;o<n;o++)e.push(i[o].dot(t));return new $e(Math.min.apply(Math,e),Math.max.apply(Math,e))}debug(t,e){const i=this._getTransformedBegin(),n=this._getTransformedEnd();t.drawLine(i,n,e,2),t.drawCircle(i,2,e),t.drawCircle(n,2,e)}}class lt extends Fi{set points(t){this._localBoundsDirty=!0,this._localSidesDirty=!0,this._sidesDirty=!0,this._points=t}get points(){return this._points}constructor(t){var e,i;super(),this._logger=Y.getInstance(),this._transformedPoints=[],this._sides=[],this._localSides=[],this._globalMatrix=ct.identity(),this._transformedPointsDirty=!0,this._sidesDirty=!0,this._localSidesDirty=!0,this._localBoundsDirty=!0,this.offset=(e=t.offset)!==null&&e!==void 0?e:k.Zero,this._globalMatrix.translate(this.offset.x,this.offset.y),this.points=(i=t.points)!==null&&i!==void 0?i:[],this._isCounterClockwiseWinding(this.points)||this.points.reverse(),this.isConvex()||this._logger.warn("Excalibur only supports convex polygon colliders and will not behave properly.Call PolygonCollider.triangulate() to build a new collider composed of smaller convex triangles"),this._calculateTransformation()}_isCounterClockwiseWinding(t){let e=0;for(let i=0;i<t.length;i++)e+=(t[(i+1)%t.length].x-t[i].x)*(t[(i+1)%t.length].y+t[i].y);return e<0}isConvex(){if(this.points.length<3)return!1;let t=this.points[this.points.length-2],e=this.points[this.points.length-1],i=Math.atan2(e.y-t.y,e.x-t.x),n=0,o=0,h=0;for(const[d,u]of this.points.entries()){if(t=e,n=i,e=u,i=Math.atan2(e.y-t.y,e.x-t.x),t.equals(e))return!1;let g=i-n;if(g<=-Math.PI?g+=Math.PI*2:g>Math.PI&&(g-=Math.PI*2),d===0){if(g===0)return!1;o=g>0?1:-1}else if(o*g<=0)return!1;h+=g}return Math.abs(Math.round(h/(Math.PI*2)))===1}tessellate(){const t=[];for(let e=1;e<this.points.length-2;e++)t.push([this.points[0],this.points[e+1],this.points[e+2]]);return t.push([this.points[0],this.points[1],this.points[2]]),new Wt(t.map(e=>Dt.Polygon(e)))}triangulate(){if(this.points.length<3)throw Error("Invalid polygon");function t(h,d){return h>=d.length?d[h%d.length]:h<0?d[h%d.length+d.length]:d[h]}function e(h,d,u,g){const v=u.sub(d),I=g.sub(u),D=d.sub(g),U=h.sub(d),H=h.sub(u),Z=h.sub(g),K=v.cross(U),z=I.cross(H),N=D.cross(Z);return!(K>0||z>0||N>0)}const i=[],n=[...this.points],o=Q(0,this.points.length-1);for(;o.length>3;)for(let h=0;h<o.length;h++){const d=o[h],u=t(h-1,o),g=t(h+1,o),v=n[d],I=n[u],D=n[g],U=I.sub(v);if(!(D.sub(v).cross(U)>0))continue;let K=!0;for(let z=0;z<o.length;z++){const N=o[z];if(N===d||N===u||N===g)continue;const et=n[N];if(e(et,I,v,D)){K=!1;break}}if(K){i.push([I,v,D]),o.splice(h,1);break}}return i.push([n[o[0]],n[o[1]],n[o[2]]]),new Wt(i.map(h=>Dt.Polygon(h)))}clone(){return new lt({offset:this.offset.clone(),points:this.points.map(t=>t.clone())})}get worldPos(){return this._transform?this._transform.pos.add(this.offset):this.offset}get center(){return this.bounds.center}_calculateTransformation(){const t=this.points,e=t.length;this._transformedPoints.length=0;for(let i=0;i<e;i++)this._transformedPoints[i]=this._globalMatrix.multiply(t[i].clone())}getTransformedPoints(){return this._transformedPointsDirty&&(this._calculateTransformation(),this._transformedPointsDirty=!1),this._transformedPoints}getSides(){if(this._sidesDirty){const t=[],e=this.getTransformedPoints(),i=e.length;for(let n=0;n<i;n++)t.push(new fe(e[n],e[(n+1)%i]));this._sides=t,this._sidesDirty=!1}return this._sides}getLocalSides(){if(this._localSidesDirty){const t=[],e=this.points,i=e.length;for(let n=0;n<i;n++)t.push(new fe(e[n],e[(n+1)%i]));this._localSides=t,this._localSidesDirty=!1}return this._localSides}findSide(t){const e=this.getSides();let i=e[0],n=-Number.MAX_VALUE;for(let o=0;o<e.length;o++){const h=e[o],u=h.normal().dot(t);u>n&&(i=h,n=u)}return i}findLocalSide(t){const e=this.getLocalSides();let i=e[0],n=-Number.MAX_VALUE;for(let o=0;o<e.length;o++){const h=e[o],u=h.normal().dot(t);u>n&&(i=h,n=u)}return i}get axes(){const t=[],e=this.getSides();for(let i=0;i<e.length;i++)t.push(e[i].normal());return t}update(t){var e;this._transform=t,this._transformedPointsDirty=!0,this._sidesDirty=!0,((e=t.matrix)!==null&&e!==void 0?e:this._globalMatrix).clone(this._globalMatrix),this._globalMatrix.translate(this.offset.x,this.offset.y)}contains(t){const e=new _i(t,new k(1,0));return this.getSides().reduce(function(n,o){return e.intersect(o)>=0?n+1:n},0)%2!==0}getClosestLineBetween(t){if(t instanceof Yt)return ae.PolygonCircleClosestLine(this,t);if(t instanceof lt)return ae.PolygonPolygonClosestLine(this,t);if(t instanceof ie)return ae.PolygonEdgeClosestLine(this,t);throw new Error(`Polygon could not collide with unknown CollisionShape ${typeof t}`)}collide(t){if(t instanceof Yt)return De.CollideCirclePolygon(t,this);if(t instanceof lt)return De.CollidePolygonPolygon(this,t);if(t instanceof ie)return De.CollidePolygonEdge(this,t);throw new Error(`Polygon could not collide with unknown CollisionShape ${typeof t}`)}getFurthestPoint(t){const e=this.getTransformedPoints();let i=null,n=-Number.MAX_VALUE;for(let o=0;o<e.length;o++){const h=t.dot(e[o]);h>n&&(n=h,i=e[o])}return i}getFurthestLocalPoint(t){const e=this.points;let i=e[0],n=-Number.MAX_VALUE;for(let o=0;o<e.length;o++){const h=t.dot(e[o]);h>n&&(n=h,i=e[o])}return i}getClosestFace(t){const e=this.getSides();let i=Number.POSITIVE_INFINITY,n=-1,o=-1;for(let h=0;h<e.length;h++){const d=e[h].distanceToPoint(t);d<i&&(i=d,n=h,o=d)}return n!==-1?{distance:e[n].normal().scale(o),face:e[n]}:null}get bounds(){return this.localBounds.transform(this._globalMatrix)}get localBounds(){return this._localBoundsDirty&&(this._localBounds=nt.fromPoints(this.points),this._localBoundsDirty=!1),this._localBounds}getInertia(t){if(this._cachedMass===t&&this._cachedInertia)return this._cachedInertia;let e=0,i=0;const n=this.points;for(let o=0;o<n.length;o++){const h=(o+1)%n.length,d=n[h].cross(n[o]);e+=d*(n[o].dot(n[o])+n[o].dot(n[h])+n[h].dot(n[h])),i+=d}return this._cachedMass=t,this._cachedInertia=t/6*(e/i)}rayCast(t,e=1/0){const i=this.getSides(),n=i.length;let o=Number.MAX_VALUE,h=-1;for(let d=0;d<n;d++){const u=t.intersect(i[d]);u>=0&&u<o&&u<=e&&(o=u,h=d)}return h>=0?t.getPoint(o):null}project(t){const e=this.getTransformedPoints(),i=e.length;let n=Number.MAX_VALUE,o=-Number.MAX_VALUE;for(let h=0;h<i;h++){const d=e[h].dot(t);n=Math.min(n,d),o=Math.max(o,d)}return new $e(n,o)}debug(t,e){const i=this.getTransformedPoints()[0],n=[i,...this.getTransformedPoints(),i];for(let o=0;o<n.length-1;o++)t.drawLine(n[o],n[o+1],e,2),t.drawCircle(n[o],2,e),t.drawCircle(n[o+1],2,e)}}class Dt{static Box(t,e,i=k.Half,n=k.Zero){return new lt({points:new nt(-t*i.x,-e*i.y,t-t*i.x,e-e*i.y).getPoints(),offset:n})}static Polygon(t,e=k.Zero){return new lt({points:t,offset:e})}static Circle(t,e=k.Zero){return new Yt({radius:t,offset:e})}static Edge(t,e){return new ie({begin:t,end:e})}static Capsule(t,e,i=k.Zero){const n=Y.getInstance();return t===e&&n.warn("A capsule collider with equal width and height is a circle, consider using a ex.Shape.Circle or ex.CircleCollider"),e>=t?new Wt([Dt.Circle(t/2,B(0,-e/2+t/2).add(i)),Dt.Box(t,e-t,k.Half,i),Dt.Circle(t/2,B(0,e/2-t/2).add(i))]):new Wt([Dt.Circle(e/2,B(-t/2+e/2,0).add(i)),Dt.Box(t-e,e,k.Half,i),Dt.Circle(e/2,B(t/2-e/2,0).add(i))])}}class Kt extends re{constructor(t){super(),this.type="ex.collider",this.events=new Pi,this.$colliderAdded=new ee,this.$colliderRemoved=new ee,this.set(t)}get(){return this._collider}set(t){return this.clear(),t&&(this._collider=t,this._collider.owner=this.owner,this.events.wire(t.events),this.$colliderAdded.notifyAll(t),this.update()),t}clear(){this._collider&&(this.events.unwire(this._collider.events),this.$colliderRemoved.notifyAll(this._collider),this._collider.owner=null,this._collider=null)}get bounds(){var t,e;return(e=(t=this._collider)===null||t===void 0?void 0:t.bounds)!==null&&e!==void 0?e:new nt}get localBounds(){var t,e;return(e=(t=this._collider)===null||t===void 0?void 0:t.localBounds)!==null&&e!==void 0?e:new nt}update(){var t;const e=(t=this.owner)===null||t===void 0?void 0:t.get($);this._collider&&(this._collider.owner=this.owner,e&&this._collider.update(e.get()))}collide(t){let e=this._collider,i=t._collider;if(!e||!i)return[];let n=!1;if(i instanceof Wt&&(e=i,i=this._collider,n=!0),this._collider){const o=e.collide(i);return o?(n&&o.forEach(h=>{h.mtv=h.mtv.negate(),h.normal=h.normal.negate(),h.tangent=h.normal.perpendicular(),h.colliderA=this._collider,h.colliderB=t._collider}),o):[]}return[]}onAdd(t){this._collider&&this.update(),this.events.on("precollision",e=>{const i=e;t.events.emit("precollision",new ze(i.target.owner,i.other.owner,i.side,i.intersection))}),this.events.on("postcollision",e=>{const i=e;t.events.emit("postcollision",new ui(i.target.owner,i.other.owner,i.side,i.intersection))}),this.events.on("collisionstart",e=>{const i=e;t.events.emit("collisionstart",new Ns(i.target.owner,i.other.owner,i.contact))}),this.events.on("collisionend",e=>{const i=e;t.events.emit("collisionend",new pi(i.target.owner,i.other.owner))})}onRemove(){this.events.clear(),this.$colliderRemoved.notifyAll(this._collider)}useBoxCollider(t,e,i=k.Half,n=k.Zero){const o=Dt.Box(t,e,i,n);return this.set(o)}usePolygonCollider(t,e=k.Zero){const i=Dt.Polygon(t,e);return this.set(i)}useCircleCollider(t,e=k.Zero){const i=Dt.Circle(t,e);return this.set(i)}useEdgeCollider(t,e){const i=Dt.Edge(t,e);return this.set(i)}useCompositeCollider(t){return this.set(new Wt(t))}}var _e;(function(a){a.Rotation="rotation",a.X="x",a.Y="y"})(_e||(_e={}));class vt extends re{constructor(t){var e,i,n;super(),this.type="ex.body",this.dependencies=[$,Bt],this.id=P("body",vt._ID++),this.events=new Pi,this._oldTransform=new rs,this.__oldTransformCaptured=!1,this.enableFixedUpdateInterpolate=!0,this.collisionType=dt.PreventCollision,this.group=Pe.All,this._mass=ot.defaultMass,this.sleepMotion=ot.sleepEpsilon*5,this.canSleep=ot.bodiesCanSleepByDefault,this._sleeping=!1,this.bounciness=.2,this.friction=.99,this.useGravity=!0,this.limitDegreeOfFreedom=[],this.oldVel=new k(0,0),this.oldAcc=k.Zero,t&&(this.collisionType=(e=t.type)!==null&&e!==void 0?e:this.collisionType,this.group=(i=t.group)!==null&&i!==void 0?i:this.group,this.useGravity=(n=t.useGravity)!==null&&n!==void 0?n:this.useGravity)}get matrix(){return this.transform.get().matrix}get mass(){return this._mass}set mass(t){this._mass=t,this._cachedInertia=void 0,this._cachedInverseInertia=void 0}get inverseMass(){return this.collisionType===dt.Fixed?0:1/this.mass}get sleeping(){return this._sleeping}setSleeping(t){this._sleeping=t,t?(this.vel=k.Zero,this.acc=k.Zero,this.angularVelocity=0,this.sleepMotion=0):this.sleepMotion=ot.sleepEpsilon*5}updateMotion(){this._sleeping&&this.setSleeping(!0);const t=this.vel.size*this.vel.size+Math.abs(this.angularVelocity*this.angularVelocity),e=ot.sleepBias;this.sleepMotion=e*this.sleepMotion+(1-e)*t,this.sleepMotion=A(this.sleepMotion,0,10*ot.sleepEpsilon),this.canSleep&&this.sleepMotion<ot.sleepEpsilon&&this.setSleeping(!0)}get inertia(){if(this._cachedInertia)return this._cachedInertia;const t=this.owner.get(Kt);if(t){t.$colliderAdded.subscribe(()=>{this._cachedInertia=null}),t.$colliderRemoved.subscribe(()=>{this._cachedInertia=null});const e=t.get();if(e)return this._cachedInertia=e.getInertia(this.mass)}return 0}get inverseInertia(){return this._cachedInverseInertia?this._cachedInverseInertia:this._cachedInverseInertia=this.collisionType===dt.Fixed?0:1/this.inertia}get active(){var t;return!!(!((t=this.owner)===null||t===void 0)&&t.active)}get center(){return this.globalPos}get transform(){var t;return(t=this.owner)===null||t===void 0?void 0:t.get($)}get motion(){var t;return(t=this.owner)===null||t===void 0?void 0:t.get(Bt)}get pos(){return this.transform.pos}set pos(t){this.transform.pos=t}get globalPos(){return this.transform.globalPos}set globalPos(t){this.transform.globalPos=t}get oldPos(){return this._oldTransform.pos}get vel(){return this.motion.vel}set vel(t){this.motion.vel=t}get acc(){return this.motion.acc}set acc(t){this.motion.acc=t}get torque(){return this.motion.torque}set torque(t){this.motion.torque=t}get oldRotation(){return this._oldTransform.rotation}get rotation(){return this.transform.globalRotation}set rotation(t){this.transform.globalRotation=t}get scale(){return this.transform.globalScale}set scale(t){this.transform.globalScale=t}get oldScale(){return this._oldTransform.scale}get scaleFactor(){return this.motion.scaleFactor}set scaleFactor(t){this.motion.scaleFactor=t}get angularVelocity(){return this.motion.angularVelocity}set angularVelocity(t){this.motion.angularVelocity=t}applyImpulse(t,e){if(this.collisionType!==dt.Active)return;const i=e.scale(this.inverseMass);if(this.limitDegreeOfFreedom.includes(_e.X)&&(i.x=0),this.limitDegreeOfFreedom.includes(_e.Y)&&(i.y=0),this.vel.addEqual(i),!this.limitDegreeOfFreedom.includes(_e.Rotation)){const n=t.sub(this.globalPos);this.angularVelocity+=this.inverseInertia*n.cross(e)}}applyLinearImpulse(t){if(this.collisionType!==dt.Active)return;const e=t.scale(this.inverseMass);this.limitDegreeOfFreedom.includes(_e.X)&&(e.x=0),this.limitDegreeOfFreedom.includes(_e.Y)&&(e.y=0),this.vel=this.vel.add(e)}applyAngularImpulse(t,e){if(this.collisionType===dt.Active&&!this.limitDegreeOfFreedom.includes(_e.Rotation)){const i=t.sub(this.globalPos);this.angularVelocity+=this.inverseInertia*i.cross(e)}}captureOldTransform(){this.__oldTransformCaptured=!0,this.transform.get().clone(this._oldTransform),this.oldVel.setTo(this.vel.x,this.vel.y),this.oldAcc.setTo(this.acc.x,this.acc.y)}}vt._ID=0;class Ui{constructor(t){this.data=t,this.type="Component Added"}}function Li(a){return!!a&&a.type==="Component Added"}class Te{constructor(t){this.data=t,this.type="Component Removed"}}function $r(a){return!!a&&a.type==="Component Removed"}class $t extends Re{constructor(t,e){if(super(),this.id=$t._ID++,this.scene=null,this._name="anonymous",this.active=!0,this._componentsToRemove=[],this._componentTypeToInstance=new Map,this._componentStringToInstance=new Map,this._tagsMemo=[],this._typesMemo=[],this.componentAdded$=new ee,this.componentRemoved$=new ee,this._parent=null,this.childrenAdded$=new ee,this.childrenRemoved$=new ee,this._children=[],this._isInitialized=!1,this._setName(e),t)for(const i of t)this.addComponent(i)}_setName(t){t&&(this._name=t)}get name(){return this._name}get events(){return this.eventDispatcher}kill(){this.active&&(this.active=!1,this.unparent())}isKilled(){return!this.active}get tags(){return this._tagsMemo}hasTag(t){return this.tags.includes(t)}addTag(t){return this.addComponent(new En(t))}removeTag(t,e=!1){return this.removeComponent(t,e)}get types(){return this._typesMemo}_rebuildMemos(){this._tagsMemo=Array.from(this._componentStringToInstance.values()).filter(t=>t instanceof En).map(t=>t.type),this._typesMemo=Array.from(this._componentStringToInstance.keys())}getComponents(){return Array.from(this._componentStringToInstance.values())}_notifyAddComponent(t){this._rebuildMemos();const e=new Ui({component:t,entity:this});this.componentAdded$.notifyAll(e)}_notifyRemoveComponent(t){const e=new Te({component:t,entity:this});this.componentRemoved$.notifyAll(e),this._rebuildMemos()}get parent(){return this._parent}get children(){return this._children}unparent(){this._parent&&(this._parent.removeChild(this),this._parent=null)}addChild(t){if(t.parent===null){if(this.getAncestors().includes(t))throw new Error("Cycle detected, cannot add entity");this._children.push(t),t._parent=this,this.childrenAdded$.notifyAll(t)}else throw new Error("Entity already has a parent, cannot add without unparenting");return this}removeChild(t){return t.parent===this&&(Le(t,this._children),t._parent=null,this.childrenRemoved$.notifyAll(t)),this}removeAllChildren(){for(let t=this.children.length-1;t>=0;t--)this.removeChild(this.children[t]);return this}getAncestors(){const t=[this];let e=this.parent;for(;e;)t.push(e),e=e.parent;return t.reverse()}getDescendants(){let t=[this],e=[this];for(;e.length>0;){const i=e.pop();e=e.concat(i.children),t=t.concat(i.children)}return t}clone(){const t=new $t;for(const e of this.types)t.addComponent(this.get(e).clone());for(const e of this.children)t.addChild(e.clone());return t}addTemplate(t,e=!1){for(const i of t.getComponents())this.addComponent(i.clone(),e);for(const i of t.children)this.addChild(i.clone().addTemplate(i));return this}addComponent(t,e=!1){if(this.has(t.type))if(e)this.removeComponent(t);else return this;if(t.dependencies&&t.dependencies.length)for(const n of t.dependencies)this.addComponent(new n);t.owner=this;const i=t.constructor;return this._componentTypeToInstance.set(i,t),this._componentStringToInstance.set(t.type,t),t.onAdd&&t.onAdd(this),this._notifyAddComponent(t),this}removeComponent(t,e=!1){return e?typeof t=="string"?this._removeComponentByType(t):t instanceof re&&this._removeComponentByType(t.type):this._componentsToRemove.push(t),this}_removeComponentByType(t){if(this.has(t)){const e=this.get(t);e.owner=null,e.onRemove&&e.onRemove(this);const i=e.constructor;this._componentTypeToInstance.delete(i),this._componentStringToInstance.delete(e.type),this._notifyRemoveComponent(e)}}processComponentRemoval(){for(const t of this._componentsToRemove){const e=typeof t=="string"?t:t.type;this._removeComponentByType(e)}this._componentsToRemove.length=0}has(t){return typeof t=="string"?this._componentStringToInstance.has(t):this._componentTypeToInstance.has(t)}get(t){return typeof t=="string"?this._componentStringToInstance.get(t):this._componentTypeToInstance.get(t)}get isInitialized(){return this._isInitialized}_initialize(t){this.isInitialized||(this.onInitialize(t),super.emit("initialize",new Ji(t,this)),this._isInitialized=!0)}_preupdate(t,e){this.emit("preupdate",new Ve(t,e,this)),this.onPreUpdate(t,e)}_postupdate(t,e){this.emit("postupdate",new de(t,e,this)),this.onPostUpdate(t,e)}onInitialize(t){}onPreUpdate(t,e){}onPostUpdate(t,e){}update(t,e){this._initialize(t),this._preupdate(t,e);for(const i of this.children)i.update(t,e);this._postupdate(t,e)}}$t._ID=0;function Sn(a){return!!a.tick}class Pn{constructor(t,e){this._options=t,this._graphics=e,this.graphics=[]}get name(){return this._options.name}hide(t){if(!t)this.graphics.length=0;else{let e=null;t instanceof ne?e=t:e=this._graphics.getGraphic(t),this.graphics=this.graphics.filter(i=>i.graphic!==e),this._graphics.recalculateBounds()}}show(t,e){e={...e};let i;return t instanceof ne?i=this._graphics.copyGraphics?t.clone():t:(i=this._graphics.getGraphic(t),i||Y.getInstance().error(`No such graphic added to component named ${t}. These named graphics are available: `,this._graphics.getNames())),i?(this.graphics.push({graphic:i,options:e}),this._graphics.recalculateBounds(),i):null}use(t,e){return e={...e},this.hide(),this.show(t,e)}get order(){return this._options.order}set order(t){this._options.order=t}get offset(){var t;return(t=this._options.offset)!==null&&t!==void 0?t:k.Zero}set offset(t){this._options.offset=t}get currentKeys(){var t;return(t=this.name)!==null&&t!==void 0?t:"anonymous"}}class fr{constructor(t){this._component=t,this._layers=[],this._layerMap={},this.default=new Pn({name:"default",order:0},t),this._maybeAddLayer(this.default)}create(t){const e=new Pn(t,this._component);return this._maybeAddLayer(e)}get(t){return t?this._getLayer(t):this._layers}currentKeys(){const t=[];for(const e of this._layers)t.push(e.currentKeys);return t}has(t){return t in this._layerMap}_maybeAddLayer(t){return this._layerMap[t.name]?this._layerMap[t.name]:(this._layerMap[t.name]=t,this._layers.push(t),this._layers.sort((e,i)=>e.order-i.order),t)}_getLayer(t){return this._layerMap[t]}}class le extends re{getGraphic(t){return this._graphics[t]}getNames(){return Object.keys(this._graphics)}constructor(t){super(),this.type="ex.graphics",this._graphics={},this.visible=!0,this.opacity=1,this.offset=k.Zero,this.anchor=k.Half,this.copyGraphics=!1,this._localBounds=null,t={visible:this.visible,...t};const{current:e,anchor:i,opacity:n,visible:o,graphics:h,offset:d,copyGraphics:u,onPreDraw:g,onPostDraw:v}=t;this._graphics=h||{},this.offset=d??this.offset,this.opacity=n??this.opacity,this.anchor=i??this.anchor,this.copyGraphics=u??this.copyGraphics,this.onPreDraw=g??this.onPreDraw,this.onPostDraw=v??this.onPostDraw,this.visible=!!o,this.layers=new fr(this),e&&this._graphics[e]&&this.show(this._graphics[e])}get current(){return this.layers.default.graphics}get graphics(){return this._graphics}add(t,e){let i="default",n=null;return typeof t=="string"?(i=t,n=e):n=t,this._graphics[i]=this.copyGraphics?n.clone():n,i==="default"&&this.show("default"),n}show(t,e){const i=this.layers.default.show(t,e);return this.recalculateBounds(),i}use(t,e){const i=this.layers.default.use(t,e);return this.recalculateBounds(),i}hide(t){this.layers.default.hide(t)}set localBounds(t){this._localBounds=t}recalculateBounds(){let t=new nt;for(const e of this.layers.get())for(const{graphic:i,options:n}of e.graphics){let o=this.anchor,h=this.offset;n!=null&&n.anchor&&(o=n.anchor),n!=null&&n.offset&&(h=n.offset);const d=i.localBounds,u=-d.width*o.x+h.x,g=-d.height*o.y+h.y;t=i==null?void 0:i.localBounds.translate(B(u+e.offset.x,g+e.offset.y)).combine(t)}this._localBounds=t}get localBounds(){return(!this._localBounds||this._localBounds.hasZeroDimensions())&&this.recalculateBounds(),this._localBounds}update(t,e=0){for(const i of this.layers.get())for(const{graphic:n}of i.graphics)Sn(n)&&(n==null||n.tick(t,e))}}class sn extends Ht{constructor(t){super(t),this.width=t.width,this.height=t.height,this.rasterize()}clone(){return new sn({width:this.width,height:this.height,...this.cloneGraphicOptions(),...this.cloneRasterOptions()})}execute(t){this.color&&t.fillRect(0,0,this.width,this.height),this.strokeColor&&t.strokeRect(0,0,this.width,this.height)}}class nn extends Ht{get radius(){return this._radius}set radius(t){this._radius=t,this.width=this._radius*2,this.height=this._radius*2,this.flagDirty()}constructor(t){var e,i;super(t),this._radius=0,this.padding=(e=t.padding)!==null&&e!==void 0?e:2,this.radius=t.radius,this.filtering=(i=t.filtering)!==null&&i!==void 0?i:te.Blended,this.rasterize()}clone(){return new nn({radius:this.radius,...this.cloneGraphicOptions(),...this.cloneRasterOptions()})}execute(t){this.radius>0&&(t.beginPath(),t.arc(this.radius,this.radius,this.radius,0,Math.PI*2),this.color&&t.fill(),this.strokeColor&&t.stroke())}}class as extends re{constructor(){super(...arguments),this.type="ex.pointer",this.useColliderShape=!0,this.useGraphicsBounds=!1}}class Mt{static CreateReversibleEasingFunction(t){return(e,i,n,o)=>n<i?i-(t(e,n,i,o)-n):t(e,i,n,o)}static CreateVectorEasingFunction(t){return(e,i,n,o)=>new k(t(e,i.x,n.x,o),t(e,i.y,n.y,o))}}Mt.Linear=Mt.CreateReversibleEasingFunction((a,t,e,i)=>(e=e-t,e*a/i+t)),Mt.EaseInQuad=Mt.CreateReversibleEasingFunction((a,t,e,i)=>(e=e-t,a/=i,e*a*a+t)),Mt.EaseOutQuad=Mt.CreateReversibleEasingFunction((a,t,e,i)=>(e=e-t,a/=i,-e*a*(a-2)+t)),Mt.EaseInOutQuad=Mt.CreateReversibleEasingFunction((a,t,e,i)=>(e=e-t,a/=i/2,a<1?e/2*a*a+t:(a--,-e/2*(a*(a-2)-1)+t))),Mt.EaseInCubic=Mt.CreateReversibleEasingFunction((a,t,e,i)=>(e=e-t,a/=i,e*a*a*a+t)),Mt.EaseOutCubic=Mt.CreateReversibleEasingFunction((a,t,e,i)=>(e=e-t,a/=i,a--,e*(a*a*a+1)+t)),Mt.EaseInOutCubic=Mt.CreateReversibleEasingFunction((a,t,e,i)=>(e=e-t,a/=i/2,a<1?e/2*a*a*a+t:(a-=2,e/2*(a*a*a+2)+t)));class _r{constructor(t){this._actions=[],this._completedActions=[],this._entity=t}add(t){this._actions.push(t)}remove(t){const e=this._actions.indexOf(t);this._actions.splice(e,1)}clearActions(){this._actions.length=0,this._completedActions.length=0,this._currentAction&&this._currentAction.stop()}getActions(){return this._actions.concat(this._completedActions)}hasNext(){return this._actions.length>0}isComplete(){return this._actions.length===0}reset(){this._actions=this.getActions();const t=this._actions.length;for(let e=0;e<t;e++)this._actions[e].reset();this._completedActions=[]}update(t){this._actions.length>0&&(this._currentAction=this._actions[0],this._currentAction.update(t),this._currentAction.isComplete(this._entity)&&this._completedActions.push(this._actions.shift()))}}class gr{constructor(t,e,i){this._stopped=!1,this._repeatBuilder=e,this._repeatContext=new Ps(t),this._actionQueue=this._repeatContext.getQueue(),this._repeat=i,this._originalRepeat=i,this._repeatBuilder(this._repeatContext),this._repeat--}update(t){this._actionQueue.isComplete()&&(this._actionQueue.clearActions(),this._repeatBuilder(this._repeatContext),this._repeat--),this._actionQueue.update(t)}isComplete(){return this._stopped||this._repeat<=0&&this._actionQueue.isComplete()}stop(){this._stopped=!0}reset(){this._repeat=this._originalRepeat}}class mr{constructor(t,e){this._stopped=!1,this._repeatBuilder=e,this._repeatContext=new Ps(t),this._actionQueue=this._repeatContext.getQueue(),this._repeatBuilder(this._repeatContext)}update(t){this._stopped||(this._actionQueue.isComplete()&&(this._actionQueue.clearActions(),this._repeatBuilder(this._repeatContext)),this._actionQueue.update(t))}isComplete(){return this._stopped}stop(){this._stopped=!0,this._actionQueue.clearActions()}reset(){}}class vr{constructor(t,e,i,n){if(this._started=!1,this._stopped=!1,this._entity=t,this._tx=t.get($),this._motion=t.get(Bt),this._speed=n,this._offset=new k(e,i),n<=0)throw Y.getInstance().error("Attempted to moveBy with speed less than or equal to zero : "+n),new Error("Speed must be greater than 0 pixels per second")}update(t){this._started||(this._started=!0,this._start=new k(this._tx.pos.x,this._tx.pos.y),this._end=this._start.add(this._offset),this._distance=this._offset.size,this._dir=this._end.sub(this._start).normalize()),this.isComplete(this._entity)?(this._tx.pos=B(this._end.x,this._end.y),this._motion.vel=B(0,0)):this._motion.vel=this._dir.scale(this._speed)}isComplete(t){const e=t.get($);return this._stopped||e.pos.distance(this._start)>=this._distance}stop(){this._motion.vel=B(0,0),this._stopped=!0}reset(){this._started=!1,this._stopped=!1}}class wr{constructor(t,e,i,n){this.entity=t,this._started=!1,this._stopped=!1,this._tx=t.get($),this._motion=t.get(Bt),this._end=new k(e,i),this._speed=n}update(t){this._started||(this._started=!0,this._start=new k(this._tx.pos.x,this._tx.pos.y),this._distance=this._start.distance(this._end),this._dir=this._end.sub(this._start).normalize());const e=this._dir.scale(this._speed);this._motion.vel=B(e.x,e.y),this.isComplete(this.entity)&&(this._tx.pos=B(this._end.x,this._end.y),this._motion.vel=B(0,0))}isComplete(t){const e=t.get($);return this._stopped||new k(e.pos.x,e.pos.y).distance(this._start)>=this._distance}stop(){this._motion.vel=B(0,0),this._stopped=!0}reset(){this._started=!1,this._stopped=!1}}var ye;(function(a){a[a.ShortestPath=0]="ShortestPath",a[a.LongestPath=1]="LongestPath",a[a.Clockwise=2]="Clockwise",a[a.CounterClockwise=3]="CounterClockwise"})(ye||(ye={}));class to{constructor(t,e,i,n){this._started=!1,this._stopped=!1,this._tx=t.get($),this._motion=t.get(Bt),this._end=e,this._speed=i,this._rotationType=n||ye.ShortestPath}update(t){if(!this._started){this._started=!0,this._start=this._tx.rotation,this._currentNonCannonAngle=this._tx.rotation;const e=Math.abs(this._end-this._start),i=F-e;switch(e>i?(this._shortDistance=i,this._longDistance=e):(this._shortDistance=e,this._longDistance=i),this._shortestPathIsPositive=(this._start-this._end+F)%F>=Math.PI,this._rotationType){case ye.ShortestPath:this._distance=this._shortDistance,this._shortestPathIsPositive?this._direction=1:this._direction=-1;break;case ye.LongestPath:this._distance=this._longDistance,this._shortestPathIsPositive?this._direction=-1:this._direction=1;break;case ye.Clockwise:this._direction=1,this._shortestPathIsPositive?this._distance=this._shortDistance:this._distance=this._longDistance;break;case ye.CounterClockwise:this._direction=-1,this._shortestPathIsPositive?this._distance=this._longDistance:this._distance=this._shortDistance;break}}this._motion.angularVelocity=this._direction*this._speed,this._currentNonCannonAngle+=this._direction*this._speed*(t/1e3),this.isComplete()&&(this._tx.rotation=this._end,this._motion.angularVelocity=0,this._stopped=!0)}isComplete(){const t=Math.abs(this._currentNonCannonAngle-this._start);return this._stopped||t>=Math.abs(this._distance)}stop(){this._motion.angularVelocity=0,this._stopped=!0}reset(){this._started=!1,this._stopped=!1}}class Tn{constructor(t,e,i,n){this._started=!1,this._stopped=!1,this._tx=t.get($),this._motion=t.get(Bt),this._speed=i,this._offset=e,this._rotationType=n||ye.ShortestPath}update(t){if(!this._started){this._started=!0,this._start=this._tx.rotation,this._currentNonCannonAngle=this._tx.rotation,this._end=this._start+this._offset;const e=Math.abs(this._end-this._start),i=F-e;switch(e>i?(this._shortDistance=i,this._longDistance=e):(this._shortDistance=e,this._longDistance=i),this._shortestPathIsPositive=(this._start-this._end+F)%F>=Math.PI,this._rotationType){case ye.ShortestPath:this._distance=this._shortDistance,this._shortestPathIsPositive?this._direction=1:this._direction=-1;break;case ye.LongestPath:this._distance=this._longDistance,this._shortestPathIsPositive?this._direction=-1:this._direction=1;break;case ye.Clockwise:this._direction=1,this._shortDistance>=0?this._distance=this._shortDistance:this._distance=this._longDistance;break;case ye.CounterClockwise:this._direction=-1,this._shortDistance<=0?this._distance=this._shortDistance:this._distance=this._longDistance;break}}this._motion.angularVelocity=this._direction*this._speed,this._currentNonCannonAngle+=this._direction*this._speed*(t/1e3),this.isComplete()&&(this._tx.rotation=this._end,this._motion.angularVelocity=0,this._stopped=!0)}isComplete(){const t=Math.abs(this._currentNonCannonAngle-this._start);return this._stopped||t>=Math.abs(this._distance)}stop(){this._motion.angularVelocity=0,this._stopped=!0}reset(){this._started=!1,this._stopped=!1,this._start=void 0,this._currentNonCannonAngle=void 0,this._distance=void 0}}class br{constructor(t,e,i,n,o){this._started=!1,this._stopped=!1,this._tx=t.get($),this._motion=t.get(Bt),this._endX=e,this._endY=i,this._speedX=n,this._speedY=o}update(t){if(this._started||(this._started=!0,this._startX=this._tx.scale.x,this._startY=this._tx.scale.y,this._distanceX=Math.abs(this._endX-this._startX),this._distanceY=Math.abs(this._endY-this._startY)),Math.abs(this._tx.scale.x-this._startX)>=this._distanceX)this._motion.scaleFactor.x=0;else{const e=this._endY<this._startY?-1:1;this._motion.scaleFactor.x=this._speedX*e}if(Math.abs(this._tx.scale.y-this._startY)>=this._distanceY)this._motion.scaleFactor.y=0;else{const e=this._endY<this._startY?-1:1;this._motion.scaleFactor.y=this._speedY*e}this.isComplete()&&(this._tx.scale=B(this._endX,this._endY),this._motion.scaleFactor.x=0,this._motion.scaleFactor.y=0)}isComplete(){return this._stopped||Math.abs(this._tx.scale.x-this._startX)>=this._distanceX-.01&&Math.abs(this._tx.scale.y-this._startY)>=this._distanceY-.01}stop(){this._motion.scaleFactor.x=0,this._motion.scaleFactor.y=0,this._stopped=!0}reset(){this._started=!1,this._stopped=!1}}class kn{constructor(t,e,i,n){this._started=!1,this._stopped=!1,this._tx=t.get($),this._motion=t.get(Bt),this._offset=new k(e,i),this._speedX=this._speedY=n}update(t){this._started||(this._started=!0,this._startScale=this._tx.scale.clone(),this._endScale=this._startScale.add(this._offset),this._distanceX=Math.abs(this._endScale.x-this._startScale.x),this._distanceY=Math.abs(this._endScale.y-this._startScale.y),this._directionX=this._endScale.x<this._startScale.x?-1:1,this._directionY=this._endScale.y<this._startScale.y?-1:1),this._motion.scaleFactor.x=this._speedX*this._directionX,this._motion.scaleFactor.y=this._speedY*this._directionY,this.isComplete()&&(this._tx.scale=this._endScale,this._motion.scaleFactor.x=0,this._motion.scaleFactor.y=0)}isComplete(){return this._stopped||Math.abs(this._tx.scale.x-this._startScale.x)>=this._distanceX-.01&&Math.abs(this._tx.scale.y-this._startScale.y)>=this._distanceY-.01}stop(){this._motion.scaleFactor.x=0,this._motion.scaleFactor.y=0,this._stopped=!0}reset(){this._started=!1,this._stopped=!1}}class xr{constructor(t){this._method=null,this._hasBeenCalled=!1,this._method=t}update(t){this._method(),this._hasBeenCalled=!0}isComplete(){return this._hasBeenCalled}reset(){this._hasBeenCalled=!1}stop(){this._hasBeenCalled=!0}}class yr{constructor(t,e,i,n,o){this.easingFcn=o,this._currentLerpTime=0,this._lerpDuration=1*1e3,this._lerpStart=new k(0,0),this._lerpEnd=new k(0,0),this._initialized=!1,this._stopped=!1,this._tx=t.get($),this._motion=t.get(Bt),this._lerpDuration=n,this._lerpEnd=new k(e,i)}_initialize(){this._lerpStart=new k(this._tx.pos.x,this._tx.pos.y),this._currentLerpTime=0}update(t){this._initialized||(this._initialize(),this._initialized=!0),this._currentLerpTime+=t;let e=this._tx.pos.x,i=this._tx.pos.y;this._currentLerpTime<this._lerpDuration?(this._lerpEnd.x<this._lerpStart.x?e=this._lerpStart.x-(this.easingFcn(this._currentLerpTime,this._lerpEnd.x,this._lerpStart.x,this._lerpDuration)-this._lerpEnd.x):e=this.easingFcn(this._currentLerpTime,this._lerpStart.x,this._lerpEnd.x,this._lerpDuration),this._lerpEnd.y<this._lerpStart.y?i=this._lerpStart.y-(this.easingFcn(this._currentLerpTime,this._lerpEnd.y,this._lerpStart.y,this._lerpDuration)-this._lerpEnd.y):i=this.easingFcn(this._currentLerpTime,this._lerpStart.y,this._lerpEnd.y,this._lerpDuration),this._motion.vel=B((e-this._tx.pos.x)/(t/1e3),(i-this._tx.pos.y)/(t/1e3))):(this._tx.pos=B(this._lerpEnd.x,this._lerpEnd.y),this._motion.vel=k.Zero)}isComplete(){return this._stopped||this._currentLerpTime>=this._lerpDuration}reset(){this._initialized=!1,this._stopped=!1,this._currentLerpTime=0}stop(){this._motion.vel=B(0,0),this._stopped=!0}}class In{constructor(t,e,i,n,o){this.easingFcn=o,this._currentLerpTime=0,this._lerpDuration=1*1e3,this._lerpStart=new k(0,0),this._lerpEnd=new k(0,0),this._initialized=!1,this._stopped=!1,this._tx=t.get($),this._motion=t.get(Bt),this._lerpDuration=n,this._offset=new k(e,i)}_initialize(){this._lerpStart=new k(this._tx.pos.x,this._tx.pos.y),this._currentLerpTime=0,this._lerpEnd=this._lerpStart.add(this._offset)}update(t){this._initialized||(this._initialize(),this._initialized=!0),this._currentLerpTime+=t;let e=this._tx.pos.x,i=this._tx.pos.y;this._currentLerpTime<this._lerpDuration?(this._lerpEnd.x<this._lerpStart.x?e=this._lerpStart.x-(this.easingFcn(this._currentLerpTime,this._lerpEnd.x,this._lerpStart.x,this._lerpDuration)-this._lerpEnd.x):e=this.easingFcn(this._currentLerpTime,this._lerpStart.x,this._lerpEnd.x,this._lerpDuration),this._lerpEnd.y<this._lerpStart.y?i=this._lerpStart.y-(this.easingFcn(this._currentLerpTime,this._lerpEnd.y,this._lerpStart.y,this._lerpDuration)-this._lerpEnd.y):i=this.easingFcn(this._currentLerpTime,this._lerpStart.y,this._lerpEnd.y,this._lerpDuration),this._motion.vel=B((e-this._tx.pos.x)/(t/1e3),(i-this._tx.pos.y)/(t/1e3))):(this._tx.pos=B(this._lerpEnd.x,this._lerpEnd.y),this._motion.vel=k.Zero)}isComplete(){return this._stopped||this._currentLerpTime>=this._lerpDuration}reset(){this._initialized=!1,this._stopped=!1,this._currentLerpTime=0}stop(){this._motion.vel=B(0,0),this._stopped=!0}}class Ar{constructor(t,e,i,n=1){this._timeVisible=0,this._timeNotVisible=0,this._elapsedTime=0,this._totalTime=0,this._stopped=!1,this._started=!1,this._graphics=t.get(le),this._timeVisible=e,this._timeNotVisible=i,this._duration=(e+i)*n}update(t){this._started||(this._started=!0,this._elapsedTime=0,this._totalTime=0),this._graphics&&(this._elapsedTime+=t,this._totalTime+=t,this._graphics.visible&&this._elapsedTime>=this._timeVisible&&(this._graphics.visible=!1,this._elapsedTime=0),!this._graphics.visible&&this._elapsedTime>=this._timeNotVisible&&(this._graphics.visible=!0,this._elapsedTime=0),this.isComplete()&&(this._graphics.visible=!0))}isComplete(){return this._stopped||this._totalTime>=this._duration}stop(){this._graphics&&(this._graphics.visible=!0),this._stopped=!0}reset(){this._started=!1,this._stopped=!1,this._elapsedTime=0,this._totalTime=0}}class eo{constructor(t,e,i){this._multiplier=1,this._started=!1,this._stopped=!1,this._graphics=t.get(le),this._endOpacity=e,this._speed=this._ogspeed=i}update(t){this._graphics&&(this._started||(this._started=!0,this._speed=this._ogspeed,this._endOpacity<this._graphics.opacity?this._multiplier=-1:this._multiplier=1),this._speed>0&&(this._graphics.opacity+=this._multiplier*(Math.abs(this._graphics.opacity-this._endOpacity)*t)/this._speed),this._speed-=t,this.isComplete()&&(this._graphics.opacity=this._endOpacity),Y.getInstance().debug("[Action fade] Actor opacity:",this._graphics.opacity))}isComplete(){return this._stopped||Math.abs(this._graphics.opacity-this._endOpacity)<.05}stop(){this._stopped=!0}reset(){this._started=!1,this._stopped=!1}}class rn{constructor(t){this._elapsedTime=0,this._started=!1,this._stopped=!1,this._delay=t}update(t){this._started||(this._started=!0),this._elapsedTime+=t}isComplete(){return this._stopped||this._elapsedTime>=this._delay}stop(){this._stopped=!0}reset(){this._elapsedTime=0,this._started=!1,this._stopped=!1}}class io{constructor(t){this._stopped=!1,this._entity=t}update(t){this._entity.get(Ts).clearActions(),this._entity.kill(),this._stopped=!0}isComplete(){return this._stopped}stop(){}reset(){}}class Rn{constructor(t,e,i){this._started=!1,this._stopped=!1,this._tx=t.get($),this._motion=t.get(Bt),this._followTx=e.get($),this._followMotion=e.get(Bt),this._current=new k(this._tx.pos.x,this._tx.pos.y),this._end=new k(this._followTx.pos.x,this._followTx.pos.y),this._maximumDistance=i!==void 0?i:this._current.distance(this._end),this._speed=0}update(t){this._started||(this._started=!0,this._distanceBetween=this._current.distance(this._end),this._dir=this._end.sub(this._current).normalize());const e=Math.sqrt(Math.pow(this._followMotion.vel.x,2)+Math.pow(this._followMotion.vel.y,2));if(e!==0&&(this._speed=e),this._current=B(this._tx.pos.x,this._tx.pos.y),this._end=B(this._followTx.pos.x,this._followTx.pos.y),this._distanceBetween=this._current.distance(this._end),this._dir=this._end.sub(this._current).normalize(),this._distanceBetween>=this._maximumDistance){const i=this._dir.scale(this._speed);this._motion.vel=B(i.x,i.y)}else this._motion.vel=B(0,0);this.isComplete()&&(this._tx.pos=B(this._end.x,this._end.y),this._motion.vel=B(0,0))}stop(){this._motion.vel=B(0,0),this._stopped=!0}isComplete(){return this._stopped}reset(){this._started=!1,this._stopped=!1}}class Cr{constructor(t,e,i){this._started=!1,this._stopped=!1,this._speedWasSpecified=!1,this._tx=t.get($),this._motion=t.get(Bt),this._meetTx=e.get($),this._meetMotion=e.get(Bt),this._current=new k(this._tx.pos.x,this._tx.pos.y),this._end=new k(this._meetTx.pos.x,this._meetTx.pos.y),this._speed=i||0,i!==void 0&&(this._speedWasSpecified=!0)}update(t){this._started||(this._started=!0,this._distanceBetween=this._current.distance(this._end),this._dir=this._end.sub(this._current).normalize());const e=Math.sqrt(Math.pow(this._meetMotion.vel.x,2)+Math.pow(this._meetMotion.vel.y,2));e!==0&&!this._speedWasSpecified&&(this._speed=e),this._current=B(this._tx.pos.x,this._tx.pos.y),this._end=B(this._meetTx.pos.x,this._meetTx.pos.y),this._distanceBetween=this._current.distance(this._end),this._dir=this._end.sub(this._current).normalize();const i=this._dir.scale(this._speed);this._motion.vel=B(i.x,i.y),this.isComplete()&&(this._tx.pos=B(this._end.x,this._end.y),this._motion.vel=B(0,0))}isComplete(){return this._stopped||this._distanceBetween<=1}stop(){this._motion.vel=B(0,0),this._stopped=!0}reset(){this._started=!1,this._stopped=!1,this._distanceBetween=void 0}}class Ps{constructor(t){this._entity=t,this._queue=new _r(t)}getQueue(){return this._queue}update(t){this._queue.update(t)}clearActions(){this._queue.clearActions()}runAction(t){return t.reset(),this._queue.add(t),this}easeTo(...t){var e,i;let n=0,o=0,h=0,d=Mt.Linear;return t[0]instanceof k?(n=t[0].x,o=t[0].y,h=t[1],d=(e=t[2])!==null&&e!==void 0?e:d):(n=t[0],o=t[1],h=t[2],d=(i=t[3])!==null&&i!==void 0?i:d),this._queue.add(new yr(this._entity,n,o,h,d)),this}easeBy(...t){var e,i;let n=0,o=0,h=0,d=Mt.Linear;return t[0]instanceof k?(n=t[0].x,o=t[0].y,h=t[1],d=(e=t[2])!==null&&e!==void 0?e:d):(n=t[0],o=t[1],h=t[2],d=(i=t[3])!==null&&i!==void 0?i:d),this._queue.add(new In(this._entity,n,o,h,d)),this}moveTo(t,e,i){let n=0,o=0,h=0;return t instanceof k?(n=t.x,o=t.y,h=e):(n=t,o=e,h=i),this._queue.add(new wr(this._entity,n,o,h)),this}moveBy(t,e,i){let n=0,o=0,h=0;return t instanceof k?(n=t.x,o=t.y,h=e):(n=t,o=e,h=i),this._queue.add(new vr(this._entity,n,o,h)),this}rotateTo(t,e,i){return this._queue.add(new to(this._entity,t,e,i)),this}rotateBy(t,e,i){return this._queue.add(new Tn(this._entity,t,e,i)),this}scaleTo(t,e,i,n){let o=1,h=1,d=0,u=0;return t instanceof k&&e instanceof k&&(o=t.x,h=t.y,d=e.x,u=e.y),typeof t=="number"&&typeof e=="number"&&(o=t,h=e,d=i,u=n),this._queue.add(new br(this._entity,o,h,d,u)),this}scaleBy(t,e,i){let n=1,o=1;return t instanceof k&&(n=t.x,o=t.y,i=e),typeof t=="number"&&typeof e=="number"&&(n=t,o=e),this._queue.add(new kn(this._entity,n,o,i)),this}blink(t,e,i=1){return this._queue.add(new Ar(this._entity,t,e,i)),this}fade(t,e){return this._queue.add(new eo(this._entity,t,e)),this}delay(t){return this._queue.add(new rn(t)),this}die(){return this._queue.add(new io(this._entity)),this}callMethod(t){return this._queue.add(new xr(t)),this}repeat(t,e){return e?(this._queue.add(new gr(this._entity,t,e)),this):(this.repeatForever(t),this)}repeatForever(t){return this._queue.add(new mr(this._entity,t)),this}follow(t,e){return e===void 0?this._queue.add(new Rn(this._entity,t)):this._queue.add(new Rn(this._entity,t,e)),this}meet(t,e){return e===void 0?this._queue.add(new Cr(this._entity,t)):this._queue.add(new Cr(this._entity,t,e)),this}toPromise(){return new Promise(e=>{this._queue.add(new xr(()=>{e()}))})}}class Ts extends re{constructor(){super(...arguments),this.type="ex.actions",this.dependencies=[$,Bt]}onAdd(t){this._ctx=new Ps(t)}onRemove(){this._ctx=null}getQueue(){var t;return(t=this._ctx)===null||t===void 0?void 0:t.getQueue()}runAction(t){var e;return(e=this._ctx)===null||e===void 0?void 0:e.runAction(t)}update(t){var e;return(e=this._ctx)===null||e===void 0?void 0:e.update(t)}clearActions(){var t;(t=this._ctx)===null||t===void 0||t.clearActions()}easeTo(...t){return this._ctx.easeTo.apply(this._ctx,t)}easeBy(...t){return this._ctx.easeBy.apply(this._ctx,t)}moveTo(t,e,i){return this._ctx.moveTo.apply(this._ctx,[t,e,i])}moveBy(t,e,i){return this._ctx.moveBy.apply(this._ctx,[t,e,i])}rotateTo(t,e,i){return this._ctx.rotateTo(t,e,i)}rotateBy(t,e,i){return this._ctx.rotateBy(t,e,i)}scaleTo(t,e,i,n){return this._ctx.scaleTo.apply(this._ctx,[t,e,i,n])}scaleBy(t,e,i){return this._ctx.scaleBy.apply(this._ctx,[t,e,i])}blink(t,e,i){return this._ctx.blink(t,e,i)}fade(t,e){return this._ctx.fade(t,e)}delay(t){return this._ctx.delay(t)}die(){return this._ctx.die()}callMethod(t){return this._ctx.callMethod(t)}repeat(t,e){return this._ctx.repeat(t,e)}repeatForever(t){return this._ctx.repeatForever(t)}follow(t,e){return this._ctx.follow(t,e)}meet(t,e){return this._ctx.meet(t,e)}toPromise(){return this._ctx.toPromise()}}var Bn;(function(a){a.Em="em",a.Rem="rem",a.Px="px",a.Pt="pt",a.Percent="%"})(Bn||(Bn={}));var ks;(function(a){a.Left="left",a.Right="right",a.Center="center",a.Start="start",a.End="end"})(ks||(ks={}));var Vi;(function(a){a.Top="top",a.Hanging="hanging",a.Middle="middle",a.Alphabetic="alphabetic",a.Ideographic="ideographic",a.Bottom="bottom"})(Vi||(Vi={}));var Dn;(function(a){a.Normal="normal",a.Italic="italic",a.Oblique="oblique"})(Dn||(Dn={}));var Mn;(function(a){a.LeftToRight="ltr",a.RightToLeft="rtl"})(Mn||(Mn={}));class Xe{constructor(t,e,i,n){this.font=t,this.text=e,this.color=i,this.maxWidth=n,this._textFragments=[],this.disposed=!1,this._dirty=!0,this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),this.dimensions=this.measureText(e),this._setDimension(this.dimensions,this.ctx),this._lastHashCode=this.getHashCode()}measureText(t,e){if(this.disposed)throw Error("Accessing disposed text instance! "+this.text);let i=null;e!=null?i=this._getLinesFromText(t,e):i=t.split(`
`);const n=i.reduce((D,U)=>D.length>U.length?D:U);this._applyFont(this.ctx);const o=this.ctx.measureText(n);let h=Math.abs(o.actualBoundingBoxAscent)+Math.abs(o.actualBoundingBoxDescent);const d=h*i.length;h=d;const u=d-Math.abs(o.actualBoundingBoxAscent),g=0,v=0;return new nt({left:g-Math.abs(o.actualBoundingBoxLeft)-this.font.padding,top:v-Math.abs(o.actualBoundingBoxAscent)-this.font.padding,bottom:v+u+this.font.padding,right:g+Math.abs(o.actualBoundingBoxRight)+this.font.padding})}_setDimension(t,e){e.canvas.width=(t.width+this.font.padding*2)*2*this.font.quality,e.canvas.height=(t.height+this.font.padding*2)*2*this.font.quality}static getHashCode(t,e,i){var n;return e+"__hashcode__"+t.fontString+t.showDebug+t.textAlign+t.baseAlign+t.direction+JSON.stringify(t.shadow)+(t.padding.toString()+t.smoothing.toString()+t.lineWidth.toString()+t.lineDash.toString()+((n=t.strokeColor)===null||n===void 0?void 0:n.toString())+(i?i.toString():t.color.toString()))}getHashCode(t=!0){return Xe.getHashCode(this.font,this.text,t?this.color:void 0)}_applyRasterProperties(t){var e,i;t.translate(this.font.padding,this.font.padding),t.imageSmoothingEnabled=this.font.smoothing,t.lineWidth=this.font.lineWidth,t.setLineDash((e=this.font.lineDash)!==null&&e!==void 0?e:t.getLineDash()),t.strokeStyle=(i=this.font.strokeColor)===null||i===void 0?void 0:i.toString(),t.fillStyle=this.color.toString()}_applyFont(t){t.resetTransform(),t.translate(this.font.padding+t.canvas.width/2,this.font.padding+t.canvas.height/2),t.scale(this.font.quality,this.font.quality),t.textAlign=this.font.textAlign,t.textBaseline=this.font.baseAlign,t.font=this.font.fontString,t.direction=this.font.direction,this.font.shadow&&(t.shadowColor=this.font.shadow.color.toString(),t.shadowBlur=this.font.shadow.blur,t.shadowOffsetX=this.font.shadow.offset.x,t.shadowOffsetY=this.font.shadow.offset.y)}_drawText(t,e,i){this._applyRasterProperties(t),this._applyFont(t);for(let n=0;n<e.length;n++){const o=e[n];this.color&&t.fillText(o,0,n*i),this.font.strokeColor&&t.strokeText(o,0,n*i)}this.font.showDebug&&(cr(t,j.Green,-t.canvas.width/2,0,t.canvas.width/2,0,2),cr(t,j.Red,0,-t.canvas.height/2,0,t.canvas.height/2,2))}_splitTextBitmap(t){const e=[];let i=0,n=0;const o=Math.min(4096,t.canvas.width),h=Math.min(4096,t.canvas.height);for(;i<t.canvas.width;){for(;n<t.canvas.height;){const d=document.createElement("canvas");d.width=o,d.height=h,d.getContext("2d").drawImage(t.canvas,i,n,o,h,0,0,o,h),e.push({x:i,y:n,canvas:d}),n+=h}i+=o,n=0}return e}flagDirty(){this._dirty=!0}render(t,e,i,n){if(this.disposed)throw Error("Accessing disposed text instance! "+this.text);const o=this.getHashCode();if(this._lastHashCode!==o&&(this._dirty=!0),this._dirty){this.dimensions=this.measureText(this.text,n),this._setDimension(this.dimensions,this.ctx);const h=this._getLinesFromText(this.text,n),d=this.dimensions.height/h.length;this._drawText(this.ctx,h,d);for(const u of this._textFragments)At.delete(u.canvas);this._textFragments=this._splitTextBitmap(this.ctx);for(const u of this._textFragments)At.load(u.canvas,this.font.filtering,!0);this._lastHashCode=o,this._dirty=!1}for(const h of this._textFragments)t.drawImage(h.canvas,0,0,h.canvas.width,h.canvas.height,h.x/this.font.quality+e-this.ctx.canvas.width/this.font.quality/2,h.y/this.font.quality+i-this.ctx.canvas.height/this.font.quality/2,h.canvas.width/this.font.quality,h.canvas.height/this.font.quality)}dispose(){this.disposed=!0,this.dimensions=void 0,this.canvas=void 0,this.ctx=void 0;for(const t of this._textFragments)At.delete(t.canvas);this._textFragments.length=0}_getLinesFromText(t,e){if(this._chachedText===t&&this._cachedRenderWidth===e)return this._chachedLines;const i=t.split(`
`);if(e==null)return i;for(let n=0;n<i.length;n++){let o=i[n],h="";if(this.measureText(o).width>e){for(;this.measureText(o).width>e;)h=o[o.length-1]+h,o=o.slice(0,-1);i[n]=o,i[n+1]=h}}return this._chachedText=t,this._chachedLines=i,this._cachedRenderWidth=e,i}}class Pt{static measureText(t,e,i){const n=Xe.getHashCode(e,t);if(Pt._MEASURE_CACHE.has(n))return Pt._MEASURE_CACHE.get(n);Pt._LOGGER.debug("Font text measurement cache miss");const o=e.measureTextWithoutCache(t,i);return Pt._MEASURE_CACHE.set(n,o),o}static getTextInstance(t,e,i){const n=Xe.getHashCode(e,t,i);let o=Pt._TEXT_CACHE.get(n);return o||(o=new Xe(e,t,i),Pt._TEXT_CACHE.set(n,o),Pt._LOGGER.debug("Font text instance cache miss")),Pt._TEXT_USAGE.set(o,performance.now()),o}static checkAndClearCache(){const t=[],e=new Set;for(const[n,o]of Pt._TEXT_USAGE.entries())if(o+100<performance.now())Pt._LOGGER.debug(`Text cache entry timed out ${n.text}`),t.push(n),n.dispose();else{const h=n.getHashCode(!1);e.add(h)}t.forEach(n=>{Pt._TEXT_USAGE.delete(n)}),this._TEXT_CACHE.clear();for(const[n]of this._TEXT_USAGE.entries())this._TEXT_CACHE.set(n.getHashCode(),n);const i=new Map;for(const n of e)Pt._MEASURE_CACHE.has(n)&&i.set(n,Pt._MEASURE_CACHE.get(n));this._MEASURE_CACHE.clear(),this._MEASURE_CACHE=i}static get cacheSize(){return Pt._TEXT_USAGE.size}static clearCache(){for(const[t]of Pt._TEXT_USAGE.entries())t.dispose();Pt._TEXT_USAGE.clear(),Pt._TEXT_CACHE.clear(),Pt._MEASURE_CACHE.clear()}}Pt._LOGGER=Y.getInstance(),Pt._TEXT_USAGE=new Map,Pt._TEXT_CACHE=new Map,Pt._MEASURE_CACHE=new Map;class Is extends ne{constructor(t={}){var e,i,n,o,h,d,u,g,v,I,D,U,H,Z,K,z,N,et,st;super(t),this.filtering=te.Blended,this.quality=2,this.padding=2,this.smoothing=!1,this.lineWidth=1,this.lineDash=[],this.color=j.Black,this.family="sans-serif",this.style=Dn.Normal,this.bold=!1,this.unit=Bn.Px,this.textAlign=ks.Left,this.baseAlign=Vi.Alphabetic,this.direction=Mn.LeftToRight,this.size=10,this.shadow=null,this._textBounds=new nt,this._textMeasurement=new Xe(this,"",j.Black),this.smoothing=(e=t==null?void 0:t.smoothing)!==null&&e!==void 0?e:this.smoothing,this.padding=(i=t==null?void 0:t.padding)!==null&&i!==void 0?i:this.padding,this.color=(n=t==null?void 0:t.color)!==null&&n!==void 0?n:this.color,this.strokeColor=(o=t==null?void 0:t.strokeColor)!==null&&o!==void 0?o:this.strokeColor,this.lineDash=(h=t==null?void 0:t.lineDash)!==null&&h!==void 0?h:this.lineDash,this.lineWidth=(d=t==null?void 0:t.lineWidth)!==null&&d!==void 0?d:this.lineWidth,this.filtering=(u=t==null?void 0:t.filtering)!==null&&u!==void 0?u:this.filtering,this.family=(g=t==null?void 0:t.family)!==null&&g!==void 0?g:this.family,this.style=(v=t==null?void 0:t.style)!==null&&v!==void 0?v:this.style,this.bold=(I=t==null?void 0:t.bold)!==null&&I!==void 0?I:this.bold,this.size=(D=t==null?void 0:t.size)!==null&&D!==void 0?D:this.size,this.unit=(U=t==null?void 0:t.unit)!==null&&U!==void 0?U:this.unit,this.textAlign=(H=t==null?void 0:t.textAlign)!==null&&H!==void 0?H:this.textAlign,this.baseAlign=(Z=t==null?void 0:t.baseAlign)!==null&&Z!==void 0?Z:this.baseAlign,this.direction=(K=t==null?void 0:t.direction)!==null&&K!==void 0?K:this.direction,this.quality=(z=t==null?void 0:t.quality)!==null&&z!==void 0?z:this.quality,t!=null&&t.shadow&&(this.shadow={},this.shadow.blur=(N=t.shadow.blur)!==null&&N!==void 0?N:this.shadow.blur,this.shadow.offset=(et=t.shadow.offset)!==null&&et!==void 0?et:this.shadow.offset,this.shadow.color=(st=t.shadow.color)!==null&&st!==void 0?st:this.shadow.color)}clone(){return new Is({...this.cloneGraphicOptions(),size:this.size,unit:this.unit,family:this.family,style:this.style,bold:this.bold,textAlign:this.textAlign,baseAlign:this.baseAlign,direction:this.direction,shadow:this.shadow?{blur:this.shadow.blur,offset:this.shadow.offset,color:this.shadow.color}:null})}get fontString(){return`${this.style} ${this.bold?"bold":""} ${this.size}${this.unit} ${this.family}`}get localBounds(){return this._textBounds}_drawImage(t,e,i){}_rotate(t){var e;const i=(e=this.origin)!==null&&e!==void 0?e:this._textBounds.center;t.translate(i.x,i.y),t.rotate(this.rotation),t.translate(-i.x,-i.y)}_flip(t){this.flipHorizontal&&(t.translate(this._textBounds.width/this.scale.x,0),t.scale(-1,1)),this.flipVertical&&(t.translate(0,-this._textBounds.height/2/this.scale.y),t.scale(1,-1))}measureTextWithoutCache(t,e){return this._textMeasurement.measureText(t,e)}measureText(t,e){return Pt.measureText(t,this,e)}_postDraw(t){t.restore()}render(t,e,i,n,o,h){const d=Pt.getTextInstance(e,this,i);this._textBounds=d.dimensions,this._preDraw(t,n,o),d.render(t,n,o,h),this._postDraw(t)}}class ls extends ne{constructor(t){var e,i;super(t),this._text="",this._textWidth=0,this._textHeight=0,this.font=(e=t.font)!==null&&e!==void 0?e:new Is,this.color=(i=t.color)!==null&&i!==void 0?i:this.color,this.text=t.text,this.maxWidth=t.maxWidth}clone(){var t,e;return new ls({text:this.text.slice(),color:(e=(t=this.color)===null||t===void 0?void 0:t.clone())!==null&&e!==void 0?e:j.Black,font:this.font.clone(),maxWidth:this.maxWidth})}get text(){return this._text}set text(t){this._text=t,this._calculateDimension()}get font(){return this._font}set font(t){this._font=t}get width(){return this._textWidth===0&&this._calculateDimension(),this._textWidth*this.scale.x}get height(){return this._textHeight===0&&this._calculateDimension(),this._textHeight*this.scale.y}_calculateDimension(){const{width:t,height:e}=this.font.measureText(this._text,this.maxWidth);this._textWidth=t,this._textHeight=e}get localBounds(){return this.font.measureText(this._text,this.maxWidth).scale(this.scale)}_rotate(t){}_flip(t){}_drawImage(t,e,i){var n;let o=j.Black;this.font instanceof Is&&(o=(n=this.color)!==null&&n!==void 0?n:this.font.color),(this.isStale()||this.font.isStale())&&(this.font.flipHorizontal=this.flipHorizontal,this.font.flipVertical=this.flipVertical,this.font.rotation=this.rotation,this.font.origin=this.origin,this.font.opacity=this.opacity),this.font.tint=this.tint;const{width:h,height:d}=this.font.measureText(this._text,this.maxWidth);this._textWidth=h,this._textHeight=d,this.font.render(t,this._text,o,e,i,this.maxWidth),this.font.showDebug&&(t.debug.drawRect(e-h,i-d,h*2,d*2),this.maxWidth!=null&&t.debug.drawRect(e,i,this.maxWidth,this.height,{color:j.Yellow}))}}class gi extends $t{get body(){return this.get(vt)}get transform(){return this.get($)}get motion(){return this.get(Bt)}get graphics(){return this.get(le)}get collider(){return this.get(Kt)}get pointer(){return this.get(as)}get actions(){return this.get(Ts)}get pos(){return this.transform.pos}set pos(t){this.transform.pos=t.clone()}get oldPos(){return this.body.oldPos}set oldPos(t){this.body.oldPos.setTo(t.x,t.y)}get vel(){return this.motion.vel}set vel(t){this.motion.vel=t.clone()}get oldVel(){return this.body.oldVel}set oldVel(t){this.body.oldVel.setTo(t.x,t.y)}get acc(){return this.motion.acc}set acc(t){this.motion.acc=t.clone()}set oldAcc(t){this.body.oldAcc.setTo(t.x,t.y)}get oldAcc(){return this.body.oldAcc}get rotation(){return this.transform.rotation}set rotation(t){this.transform.rotation=t}get angularVelocity(){return this.motion.angularVelocity}set angularVelocity(t){this.motion.angularVelocity=t}get scale(){return this.get($).scale}set scale(t){this.get($).scale=t}get anchor(){return this._anchor}set anchor(t){this._anchor=ki(t,e=>this._handleAnchorChange(e)),this._handleAnchorChange(t)}_handleAnchorChange(t){this.graphics&&(this.graphics.anchor=t)}get isOffScreen(){return this.hasTag("ex.offscreen")}get draggable(){return this._draggable}set draggable(t){t&&(t&&!this._draggable?(this.on("pointerdragstart",this._pointerDragStartHandler),this.on("pointerdragend",this._pointerDragEndHandler),this.on("pointerdragmove",this._pointerDragMoveHandler),this.on("pointerdragleave",this._pointerDragLeaveHandler)):!t&&this._draggable&&(this.off("pointerdragstart",this._pointerDragStartHandler),this.off("pointerdragend",this._pointerDragEndHandler),this.off("pointerdragmove",this._pointerDragMoveHandler),this.off("pointerdragleave",this._pointerDragLeaveHandler)),this._draggable=t)}get color(){return this._color}set color(t){var e;this._color=t.clone();const n=(e=this.graphics.layers.default.graphics[0])===null||e===void 0?void 0:e.graphic;(n instanceof Ht||n instanceof ls)&&(n.color=this._color)}constructor(t){super(),this._anchor=ki(k.Half,q=>this._handleAnchorChange(q)),this.logger=Y.getInstance(),this._draggable=!1,this._dragging=!1,this._pointerDragStartHandler=()=>{this._dragging=!0},this._pointerDragEndHandler=()=>{this._dragging=!1},this._pointerDragMoveHandler=q=>{this._dragging&&(this.pos=q.worldPos)},this._pointerDragLeaveHandler=q=>{this._dragging&&(this.pos=q.worldPos)};const{name:e,x:i,y:n,pos:o,coordPlane:h,scale:d,width:u,height:g,radius:v,collider:I,vel:D,acc:U,rotation:H,angularVelocity:Z,z:K,color:z,visible:N,anchor:et,collisionType:st,collisionGroup:ft}={...t};this._setName(e),this.anchor=et??gi.defaults.anchor.clone();const at=new $;this.addComponent(at),this.pos=o??B(i??0,n??0),this.rotation=H??0,this.scale=d??B(1,1),this.z=K??0,at.coordPlane=h??xe.World,this.addComponent(new as),this.addComponent(new le({anchor:this.anchor})),this.addComponent(new Bt),this.vel=D??k.Zero,this.acc=U??k.Zero,this.angularVelocity=Z??0,this.addComponent(new Ts),this.addComponent(new vt),this.body.collisionType=st??dt.Passive,ft&&(this.body.group=ft),I?this.addComponent(new Kt(I)):v?this.addComponent(new Kt(Dt.Circle(v))):u>0&&g>0?this.addComponent(new Kt(Dt.Box(u,g,this.anchor))):this.addComponent(new Kt),this.graphics.visible=N??!0,z&&(this.color=z,u&&g?this.graphics.add(new sn({color:z,width:u,height:g})):v&&this.graphics.add(new nn({color:z,radius:v})))}onInitialize(t){}_initialize(t){super._initialize(t);for(const e of this.children)e._initialize(t)}on(t,e){super.on(t,e)}once(t,e){super.once(t,e)}off(t,e){super.off(t,e)}_prekill(t){super.emit("prekill",new Qe(this)),this.onPreKill(t)}onPreKill(t){}_postkill(t){super.emit("postkill",new li(this)),this.onPostKill(t)}onPostKill(t){}kill(){this.scene?(this._prekill(this.scene),this.emit("kill",new se(this)),super.kill(),this._postkill(this.scene)):this.logger.warn(`Cannot kill actor named "${this.name}", it was never added to the Scene`)}unkill(){this.active=!0}isKilled(){return!this.active}get z(){return this.get($).z}set z(t){this.get($).z=t}get center(){const t=this.getGlobalPos();return new k(t.x+this.width/2-this.anchor.x*this.width,t.y+this.height/2-this.anchor.y*this.height)}get localCenter(){return new k(this.pos.x+this.width/2-this.anchor.x*this.width,this.pos.y+this.height/2-this.anchor.y*this.height)}get width(){return this.collider.localBounds.width*this.getGlobalScale().x}get height(){return this.collider.localBounds.height*this.getGlobalScale().y}getGlobalRotation(){return this.get($).globalRotation}getGlobalPos(){return this.get($).globalPos}getGlobalScale(){return this.get($).globalScale}contains(t,e,i=!1){const n=B(t,e),o=this.get(Kt);o.update();const h=o.get();if(!h)return!1;const d=h.contains(n);return i?d||this.children.some(u=>u.contains(t,e,!0)):d}within(t,e){const i=this.get(Kt),n=t.get(Kt),o=i.get(),h=n.get();return o&&h?o.getClosestLineBetween(h).getLength()<=e:!1}update(t,e){this._initialize(t),this._preupdate(t,e),this._postupdate(t,e)}onPreUpdate(t,e){}onPostUpdate(t,e){}_preupdate(t,e){this.emit("preupdate",new Ve(t,e,this)),this.onPreUpdate(t,e)}_postupdate(t,e){this.emit("postupdate",new de(t,e,this)),this.onPostUpdate(t,e)}}gi.defaults={anchor:k.Half};function Fn(a){return a instanceof Er}class Er extends gi{constructor(t){super({...t}),this.get($).coordPlane=xe.Screen,this.anchor=B(0,0),this.body.collisionType=dt.PreventCollision,this.collider.useBoxCollider(this.width,this.height,this.anchor)}_initialize(t){this._engine=t,super._initialize(t)}contains(t,e,i=!0){if(i)return super.contains(t,e);const n=this._engine.worldToScreenCoordinates(new k(t,e));return super.contains(n.x,n.y)}}class Rs{get complete(){return this._complete}constructor(t,e,i,n,o,h){if(this._logger=Y.getInstance(),this.id=0,this._elapsedTime=0,this._totalTimeAlive=0,this._running=!1,this._numberOfTicks=0,this.interval=10,this.repeats=!1,this.maxNumberOfRepeats=-1,this.randomRange=[0,0],this._baseInterval=10,this._generateRandomInterval=()=>this._baseInterval+this.random.integer(this.randomRange[0],this.randomRange[1]),this._complete=!1,this.scene=null,typeof t!="function"){const d=t;t=d.fcn,e=d.interval,i=d.repeats,n=d.numberOfRepeats,o=d.randomRange,h=d.random}if(n&&n>=0&&(this.maxNumberOfRepeats=n,!i))throw new Error("repeats must be set to true if numberOfRepeats is set");if(this.id=Rs._MAX_ID++,this._callbacks=[],this._baseInterval=this.interval=e,o){if(o[0]>o[1])throw new Error("min value must be lower than max value for range");this.random=h??new R,this.randomRange=o,this.interval=this._generateRandomInterval(),this.on(()=>{this.interval=this._generateRandomInterval()})}this.repeats=i||this.repeats,t&&this.on(t)}on(t){this._callbacks.push(t)}off(t){const e=this._callbacks.indexOf(t);this._callbacks.splice(e,1)}update(t){this._running&&(this._totalTimeAlive+=t,this._elapsedTime+=t,this.maxNumberOfRepeats>-1&&this._numberOfTicks>=this.maxNumberOfRepeats&&(this._complete=!0,this._running=!1,this._elapsedTime=0),!this.complete&&this._elapsedTime>=this.interval&&(this._callbacks.forEach(e=>{e.call(this)}),this._numberOfTicks++,this.repeats?this._elapsedTime=0:(this._complete=!0,this._running=!1,this._elapsedTime=0)))}reset(t,e){if(t&&t>=0&&(this._baseInterval=this.interval=t),this.maxNumberOfRepeats&&this.maxNumberOfRepeats>=0&&(this.maxNumberOfRepeats=e,!this.repeats))throw new Error("repeats must be set to true if numberOfRepeats is set");this._complete=!1,this._elapsedTime=0,this._numberOfTicks=0}get timesRepeated(){return this._numberOfTicks}getTimeRunning(){return this._totalTimeAlive}get timeToNextAction(){return this.complete?0:this.interval-this._elapsedTime}get timeElapsedTowardNextAction(){return this._elapsedTime}get isRunning(){return this._running}pause(){return this._running=!1,this}resume(){return this._running=!0,this}start(){return this.scene||this._logger.warn("Cannot start a timer not part of a scene, timer wont start until added"),this._running=!0,this.complete&&(this._complete=!1,this._elapsedTime=0,this._numberOfTicks=0),this}stop(){return this._running=!1,this._elapsedTime=0,this._numberOfTicks=0,this}cancel(){this.pause(),this.scene&&this.scene.cancelTimer(this)}}Rs._MAX_ID=0;class Bs extends re{constructor(t){super(),this.type="ex.parallax",this.parallaxFactor=B(1,1),this.parallaxFactor=t??this.parallaxFactor}}class Un extends re{constructor(t,e=!0){super(),this.draw=t,this.useTransform=e,this.type="ex.debuggraphics"}}class so extends $t{flagCollidersDirty(){this._collidersDirty=!0}get x(){var t;return(t=this._transform.pos.x)!==null&&t!==void 0?t:0}set x(t){var e;!((e=this._transform)===null||e===void 0)&&e.pos&&(this.get($).pos=B(t,this.y))}get y(){var t,e;return(e=(t=this._transform)===null||t===void 0?void 0:t.pos.y)!==null&&e!==void 0?e:0}set y(t){var e;!((e=this._transform)===null||e===void 0)&&e.pos&&(this._transform.pos=B(this.x,t))}get z(){var t;return(t=this._transform.z)!==null&&t!==void 0?t:0}set z(t){this._transform&&(this._transform.z=t)}get rotation(){var t,e;return(e=(t=this._transform)===null||t===void 0?void 0:t.rotation)!==null&&e!==void 0?e:0}set rotation(t){var e;!((e=this._transform)===null||e===void 0)&&e.rotation&&(this._transform.rotation=t)}get scale(){var t,e;return(e=(t=this._transform)===null||t===void 0?void 0:t.scale)!==null&&e!==void 0?e:k.One}set scale(t){var e;!((e=this._transform)===null||e===void 0)&&e.scale&&(this._transform.scale=t)}get pos(){return this._transform.pos}set pos(t){this._transform.pos=t}get vel(){return this._motion.vel}set vel(t){this._motion.vel=t}on(t,e){super.on(t,e)}constructor(t){var e,i;super(null,t.name),this._token=0,this._onScreenXStart=0,this._onScreenXEnd=Number.MAX_VALUE,this._onScreenYStart=0,this._onScreenYEnd=Number.MAX_VALUE,this.logger=Y.getInstance(),this.tiles=[],this._rows=[],this._cols=[],this.renderFromTopOfGraphic=!1,this._collidersDirty=!0,this._originalOffsets=new WeakMap,this.addComponent(new $),this.addComponent(new Bt),this.addComponent(new vt({type:dt.Fixed})),this.addComponent(new le({onPostDraw:(o,h)=>this.draw(o,h)})),this.addComponent(new Un(o=>this.debug(o))),this.addComponent(new Kt),this._graphics=this.get(le),this._transform=this.get($),this._motion=this.get(Bt),this._collider=this.get(Kt),this._composite=this._collider.useCompositeCollider([]),this._transform.pos=(e=t.pos)!==null&&e!==void 0?e:k.Zero,this._oldPos=this._transform.pos,this.renderFromTopOfGraphic=(i=t.renderFromTopOfGraphic)!==null&&i!==void 0?i:this.renderFromTopOfGraphic,this.tileWidth=t.tileWidth,this.tileHeight=t.tileHeight,this.rows=t.rows,this.columns=t.columns,this.tiles=new Array(this.rows*this.columns),this._rows=new Array(this.rows),this._cols=new Array(this.columns);let n=[];for(let o=0;o<this.columns;o++){for(let h=0;h<this.rows;h++){const d=new no({x:o,y:h,map:this});d.map=this,this.tiles[o+h*this.columns]=d,n.push(d),this._rows[h]||(this._rows[h]=[]),this._rows[h].push(d)}this._cols[o]=n,n=[]}this._graphics.localBounds=new nt({left:0,top:0,right:this.columns*this.tileWidth,bottom:this.rows*this.tileHeight})}_initialize(t){super._initialize(t)}_getOrSetColliderOriginalOffset(t){if(this._originalOffsets.has(t))return this._originalOffsets.get(t);{const e=t.offset;return this._originalOffsets.set(t,e),e}}_updateColliders(){this._collider.$colliderRemoved.notifyAll(this._composite),this._composite.clearColliders();const t=[];this._composite=this._collider.useCompositeCollider([]);let e;for(let i=0;i<this.columns;i++){for(let n=0;n<this.rows;n++){n===0&&(e=null);const o=this.tiles[i+n*this.columns];if(o.solid)if(o.getColliders().length>0){for(const h of o.getColliders()){const d=this._getOrSetColliderOriginalOffset(h);h.offset=B(o.x*this.tileWidth,o.y*this.tileHeight).add(d),h.owner=this,this._composite.addCollider(h)}e=null}else e?e=e.combine(o.bounds):e=o.bounds;else e&&t.push(e),e=null}if(e){const n=t[t.length-1];n&&n.top===e.top&&n.bottom===e.bottom?t[t.length-1]=n.combine(e):t.push(e)}}for(const i of t){const n=Dt.Box(i.width,i.height,k.Zero,B(i.left-this.pos.x,i.top-this.pos.y));n.owner=this,this._composite.addCollider(n)}this._collider.update(),this._collider.$colliderAdded.notifyAll(this._composite)}getTileByIndex(t){return this.tiles[t]}getTile(t,e){return t<0||e<0||t>=this.columns||e>=this.rows?null:this.tiles[t+e*this.columns]}getTileByPoint(t){const e=Math.floor((t.x-this.pos.x)/this.tileWidth),i=Math.floor((t.y-this.pos.y)/this.tileHeight),n=this.getTile(e,i);return e>=0&&i>=0&&e<this.columns&&i<this.rows&&n?n:null}getRows(){return this._rows}getColumns(){return this._cols}update(t,e){if(this.onPreUpdate(t,e),this.emit("preupdate",new Ve(t,e,this)),!this._oldPos.equals(this.pos)){this.flagCollidersDirty();for(let g=0;g<this.tiles.length;g++)this.tiles[g]&&this.tiles[g].flagDirty()}this._collidersDirty&&(this._collidersDirty=!1,this._updateColliders()),this._token++;const i=t.getWorldBounds(),n=B(i.left,i.top),o=B(i.right,i.bottom);let h=this.pos;const d=this.get(Bs);let u=k.One;if(d){const g=k.One.sub(d.parallaxFactor);u=t.currentScene.camera.pos.scale(g),h=h.add(u)}this._onScreenXStart=Math.max(Math.floor((n.x-h.x)/this.tileWidth)-2,0),this._onScreenYStart=Math.max(Math.floor((n.y-h.y)/this.tileHeight)-2,0),this._onScreenXEnd=Math.max(Math.floor((o.x-h.x)/this.tileWidth)+2,0),this._onScreenYEnd=Math.max(Math.floor((o.y-h.y)/this.tileHeight)+2,0),this._transform.pos=B(this.x,this.y),this.onPostUpdate(t,e),this.emit("postupdate",new de(t,e,this))}draw(t,e){this.emit("predraw",new ke(t,e,this));let i=this._onScreenXStart;const n=Math.min(this._onScreenXEnd,this.columns);let o=this._onScreenYStart;const h=Math.min(this._onScreenYEnd,this.rows);let d,u,g;for(i;i<n;i++){for(o;o<h;o++)for(d=this.getTile(i,o).getGraphics(),u=0,g=d.length;u<g;u++){const v=d[u];if(v){Sn(v)&&(v==null||v.tick(e,this._token));const I=this.renderFromTopOfGraphic?0:v.height-this.tileHeight;v.draw(t,i*this.tileWidth,o*this.tileHeight-I)}}o=this._onScreenYStart}this.emit("postdraw",new hi(t,e,this))}debug(t){const e=this.tileWidth*this.columns,i=this.tileHeight*this.rows,n=k.Zero;for(let h=0;h<this.rows+1;h++){const d=B(0,h*this.tileHeight);t.drawLine(n.add(d),n.add(B(e,d.y)),j.Red,2)}for(let h=0;h<this.columns+1;h++){const d=B(h*this.tileWidth,0);t.drawLine(n.add(d),n.add(B(d.x,i)),j.Red,2)}const o=this._composite.getColliders();for(const h of o){const d=j.Gray;d.a=.5;const u=h.localBounds,g=h.worldPos.sub(this.pos);t.drawRectangle(g,u.width,u.height,d)}}}class no extends $t{get pos(){return this._posDirty&&(this._recalculate(),this._posDirty=!1),this._pos}get solid(){return this._solid}set solid(t){var e;(e=this.map)===null||e===void 0||e.flagCollidersDirty(),this._solid=t}getGraphics(){return this._graphics}addGraphic(t){this._graphics.push(t)}removeGraphic(t){Le(t,this._graphics)}clearGraphics(){this._graphics.length=0}getColliders(){return this._colliders}addCollider(t){this._colliders.push(t),this.map.flagCollidersDirty()}removeCollider(t){const e=this._colliders.indexOf(t);e>-1&&this._colliders.splice(e,1),this.map.flagCollidersDirty()}clearColliders(){this._colliders.length=0,this.map.flagCollidersDirty()}constructor(t){var e,i;super(),this._posDirty=!1,this._solid=!1,this._graphics=[],this._colliders=[],this.data=new Map,this.x=t.x,this.y=t.y,this.map=t.map,this.width=t.map.tileWidth,this.height=t.map.tileHeight,this.solid=(e=t.solid)!==null&&e!==void 0?e:this.solid,this._graphics=(i=t.graphics)!==null&&i!==void 0?i:[],this._recalculate()}flagDirty(){return this._posDirty=!0}_recalculate(){this._pos=this.map.pos.add(B(this.x*this.map.tileWidth,this.y*this.map.tileHeight)),this._bounds=new nt(this._pos.x,this._pos.y,this._pos.x+this.width,this._pos.y+this.height),this._posDirty=!1}get bounds(){return this._posDirty&&this._recalculate(),this._bounds}get center(){return this._posDirty&&this._recalculate(),new k(this._pos.x+this.width/2,this._pos.y+this.height/2)}}class Ln{constructor(t){this.camera=t}lockToActor(t){this.camera.addStrategy(new ro(t))}lockToActorAxis(t,e){this.camera.addStrategy(new On(t,e))}elasticToActor(t,e,i){this.camera.addStrategy(new oo(t,e,i))}radiusAroundActor(t,e){this.camera.addStrategy(new ao(t,e))}limitCameraBounds(t){this.camera.addStrategy(new lo(t))}}var Vn;(function(a){a[a.X=0]="X",a[a.Y=1]="Y"})(Vn||(Vn={}));class ro{constructor(t){this.target=t,this.action=(e,i,n,o)=>e.center}}class On{constructor(t,e){this.target=t,this.axis=e,this.action=(i,n,o,h)=>{const d=i.center,u=n.getFocus();return this.axis===Vn.X?new k(d.x,u.y):new k(u.x,d.y)}}}class oo{constructor(t,e,i){this.target=t,this.cameraElasticity=e,this.cameraFriction=i,this.action=(n,o,h,d)=>{const u=n.center;let g=o.getFocus(),v=o.vel.clone();const I=u.sub(g).scale(this.cameraElasticity);v=v.add(I);const D=v.scale(-1).scale(this.cameraFriction);return v=v.add(D),g=g.add(v),g}}}class ao{constructor(t,e){this.target=t,this.radius=e,this.action=(i,n,o,h)=>{const d=i.center,u=n.getFocus(),g=d.sub(u),v=g.size;if(v>=this.radius){const I=v-this.radius;return u.add(g.normalize().scale(I))}return u}}}class lo{constructor(t){this.target=t,this.boundSizeChecked=!1,this.action=(e,i,n,o)=>{const h=i.getFocus();this.boundSizeChecked||((e.bottom-e.top<n.drawHeight||e.right-e.left<n.drawWidth)&&Y.getInstance().warn("Camera bounds should not be smaller than the engine viewport"),this.boundSizeChecked=!0);let d=h.x,u=h.y;return h.x<e.left+n.halfDrawWidth?d=e.left+n.halfDrawWidth:h.x>e.right-n.halfDrawWidth&&(d=e.right-n.halfDrawWidth),h.y<e.top+n.halfDrawHeight?u=e.top+n.halfDrawHeight:h.y>e.bottom-n.halfDrawHeight&&(u=e.bottom-n.halfDrawHeight),B(d,u)}}}class ho extends Re{constructor(){super(...arguments),this.transform=ct.identity(),this.inverse=ct.identity(),this._cameraStrategies=[],this.strategy=new Ln(this),this._z=1,this.dz=0,this.az=0,this.rotation=0,this._angularVelocity=0,this._posChanged=!1,this._pos=Hr(k.Zero,()=>this._posChanged=!0),this.vel=k.Zero,this.acc=k.Zero,this._cameraMoving=!1,this._currentLerpTime=0,this._lerpDuration=1e3,this._lerpStart=null,this._lerpEnd=null,this._isShaking=!1,this._shakeMagnitudeX=0,this._shakeMagnitudeY=0,this._shakeDuration=0,this._elapsedShakeTime=0,this._xShake=0,this._yShake=0,this._isZooming=!1,this._zoomStart=1,this._zoomEnd=1,this._currentZoomTime=0,this._zoomDuration=0,this._zoomEasing=Mt.EaseInOutCubic,this._easing=Mt.EaseInOutCubic,this._halfWidth=0,this._halfHeight=0,this._viewport=null,this._isInitialized=!1}get zoom(){return this._z}set zoom(t){this._z=t,this._engine&&(this._halfWidth=this._engine.halfDrawWidth,this._halfHeight=this._engine.halfDrawHeight)}get angularVelocity(){return this._angularVelocity}set angularVelocity(t){this._angularVelocity=t}get pos(){return this._pos}set pos(t){this._pos=Hr(t,()=>this._posChanged=!0),this._posChanged=!0}get x(){return this.pos.x}set x(t){!this._follow&&!this._cameraMoving&&(this.pos=B(t,this.pos.y))}get y(){return this.pos.y}set y(t){!this._follow&&!this._cameraMoving&&(this.pos=B(this.pos.x,t))}get dx(){return this.vel.x}set dx(t){this.vel=B(t,this.vel.y)}get dy(){return this.vel.y}set dy(t){this.vel=B(this.vel.x,t)}get ax(){return this.acc.x}set ax(t){this.acc=B(t,this.acc.y)}get ay(){return this.acc.y}set ay(t){this.acc=B(this.acc.x,t)}getFocus(){return this.pos}move(t,e,i=Mt.EaseInOutCubic){if(typeof i!="function")throw"Please specify an EasingFunction";return this._follow?Promise.reject(t):(this._lerpPromise&&this._lerpResolve&&this._lerpResolve(t),this._lerpPromise=new Promise(n=>{this._lerpResolve=n}),this._lerpStart=this.getFocus().clone(),this._lerpDuration=e,this._lerpEnd=t,this._currentLerpTime=0,this._cameraMoving=!0,this._easing=i,this._lerpPromise)}shake(t,e,i){this._isShaking=!0,this._shakeMagnitudeX=t,this._shakeMagnitudeY=e,this._shakeDuration=i}zoomOverTime(t,e=0,i=Mt.EaseInOutCubic){if(this._zoomPromise=new Promise(n=>{this._zoomResolve=n}),e)this._isZooming=!0,this._zoomEasing=i,this._currentZoomTime=0,this._zoomDuration=e,this._zoomStart=this.zoom,this._zoomEnd=t;else return this._isZooming=!1,this.zoom=t,Promise.resolve(!0);return this._zoomPromise}get viewport(){return this._viewport?this._viewport:new nt(0,0,0,0)}addStrategy(t){this._cameraStrategies.push(t)}removeStrategy(t){Le(t,this._cameraStrategies)}clearAllStrategies(){this._cameraStrategies.length=0}_preupdate(t,e){this.emit("preupdate",new Ve(t,e,this)),this.onPreUpdate(t,e)}onPreUpdate(t,e){}_postupdate(t,e){this.emit("postupdate",new de(t,e,this)),this.onPostUpdate(t,e)}onPostUpdate(t,e){}get isInitialized(){return this._isInitialized}_initialize(t){if(!this.isInitialized){this._engine=t,this._screen=t.screen;const e=this._screen.contentArea;let i=B(e.width/2,e.height/2);if(!this._engine.loadingComplete){const n=this._screen.peekResolution();n&&(i=B(n.width/2,n.height/2))}this._halfWidth=i.x,this._halfHeight=i.y,this._posChanged||(this.pos=i),this.updateTransform(),this.runStrategies(t,t.clock.elapsed()),this.updateViewport(),this.updateTransform(),this.onInitialize(t),super.emit("initialize",new Ji(t,this)),this._isInitialized=!0}}onInitialize(t){}on(t,e){super.on(t,e)}off(t,e){super.off(t,e)}once(t,e){super.once(t,e)}runStrategies(t,e){for(const i of this._cameraStrategies)this.pos=i.action.call(i,i.target,this,t,e)}updateViewport(){this._viewport=new nt(this.x-this._halfWidth,this.y-this._halfHeight,this.x+this._halfWidth,this.y+this._halfHeight)}update(t,e){if(this._initialize(t),this._preupdate(t,e),this.pos=this.pos.add(this.vel.scale(e/1e3)),this.zoom+=this.dz*e/1e3,this.vel=this.vel.add(this.acc.scale(e/1e3)),this.dz+=this.az*e/1e3,this.rotation+=this.angularVelocity*e/1e3,this._isZooming)if(this._currentZoomTime<this._zoomDuration){const i=this._zoomEasing,n=i(this._currentZoomTime,this._zoomStart,this._zoomEnd,this._zoomDuration);this.zoom=n,this._currentZoomTime+=e}else this._isZooming=!1,this.zoom=this._zoomEnd,this._currentZoomTime=0,this._zoomResolve(!0);if(this._cameraMoving)if(this._currentLerpTime<this._lerpDuration){const n=Mt.CreateVectorEasingFunction(this._easing)(this._currentLerpTime,this._lerpStart,this._lerpEnd,this._lerpDuration);this.pos=n,this._currentLerpTime+=e}else{this.pos=this._lerpEnd;const i=this._lerpEnd.clone();this._lerpStart=null,this._lerpEnd=null,this._currentLerpTime=0,this._cameraMoving=!1,this._lerpResolve(i)}this._isDoneShaking()?(this._isShaking=!1,this._elapsedShakeTime=0,this._shakeMagnitudeX=0,this._shakeMagnitudeY=0,this._shakeDuration=0,this._xShake=0,this._yShake=0):(this._elapsedShakeTime+=e,this._xShake=(Math.random()*this._shakeMagnitudeX|0)+1,this._yShake=(Math.random()*this._shakeMagnitudeY|0)+1),this.runStrategies(t,e),this.updateViewport(),this.updateTransform(),this._postupdate(t,e)}draw(t){t.multiply(this.transform)}updateTransform(){const t=this._screen.resolution.width/this.zoom,e=this._screen.resolution.height/this.zoom,i=B(-this.x+t/2+this._xShake,-this.y+e/2+this._yShake);this.transform.reset(),this.transform.scale(this.zoom,this.zoom),this.transform.translate(i.x,i.y),this.transform.inverse(this.inverse)}_isDoneShaking(){return!this._isShaking||this._elapsedShakeTime>=this._shakeDuration}}const Sr={pos:k.Zero,width:10,height:10,visible:!1,action:()=>{},filter:()=>!0,repeat:-1};class co extends gi{constructor(t){super({x:t.pos.x,y:t.pos.y,width:t.width,height:t.height}),this.action=()=>{},this.filter=()=>!0,this.repeat=-1,t={...Sr,...t},this.filter=t.filter||this.filter,this.repeat=t.repeat||this.repeat,this.action=t.action||this.action,t.target&&(this.target=t.target),this.graphics.visible=t.visible,this.body.collisionType=dt.Passive,this.eventDispatcher=new Pi,this.events.on("collisionstart",e=>{this.filter(e.other)&&(this.emit("enter",new Ws(this,e.other)),this._dispatchAction(),this.repeat===0&&this.kill())}),this.events.on("collisionend",e=>{this.filter(e.other)&&this.emit("exit",new nr(this,e.other))})}set target(t){this._target=t,this.filter=e=>e===t}get target(){return this._target}_initialize(t){super._initialize(t)}_dispatchAction(){this.repeat!==0&&(this.action.call(this),this.repeat--)}}var Ae;(function(a){a.Update="update",a.Draw="draw"})(Ae||(Ae={}));class We{constructor(){this.priority=0}notify(t){}}class uo{constructor(t){this.data=t,this.type="Entity Added"}}function on(a){return!!a&&a.type==="Entity Added"}class po{constructor(t){this.data=t,this.type="Entity Removed"}}function Oi(a){return!!a&&a.type==="Entity Removed"}class Pr{constructor(t){this._world=t,this.entities=[],this._entityIndex={},this._entitiesToRemove=[]}updateEntities(t,e){for(const i of this.entities)i.update(t.engine,e),i.active||this.removeEntity(i)}findEntitiesForRemoval(){for(const t of this.entities)t.active||this.removeEntity(t)}notify(t){Li(t)&&this._world.queryManager.addEntity(t.data.entity),$r(t)&&this._world.queryManager.removeComponent(t.data.entity,t.data.component)}addEntity(t){t.active=!0,t.scene=this._world.context,t&&!this._entityIndex[t.id]&&(this._entityIndex[t.id]=t,this.entities.push(t),this._world.queryManager.addEntity(t),t.componentAdded$.register(this),t.componentRemoved$.register(this),t.children.forEach(e=>{e.scene=t.scene,this.addEntity(e)}),t.childrenAdded$.register({notify:e=>{this.addEntity(e)}}),t.childrenRemoved$.register({notify:e=>{this.removeEntity(e,!1)}}))}removeEntity(t,e=!0){var i;let n=0;t instanceof $t?n=t.id:n=t;const o=this._entityIndex[n];if(o&&o.active&&(o.active=!1),o&&e){this._entitiesToRemove.push(o);return}delete this._entityIndex[n],o&&(o.scene=null,Le(o,this.entities),this._world.queryManager.removeEntity(o),o.componentAdded$.unregister(this),o.componentRemoved$.unregister(this),o.children.forEach(h=>{h.scene=null,this.removeEntity(h,e)}),o.childrenAdded$.clear(),o.childrenRemoved$.clear(),!((i=this._world.context)===null||i===void 0)&&i.engine&&this._world.context.engine.stats.currFrame.actors.killed++)}processEntityRemovals(){for(const t of this._entitiesToRemove)t.active||this.removeEntity(t,!1)}processComponentRemovals(){for(const t of this.entities)t.processComponentRemoval()}getById(t){return this._entityIndex[t]}getByName(t){return this.entities.filter(e=>e.name===t)}clear(){for(const t of this.entities)this.removeEntity(t)}}const zn=a=>[...a].sort((e,i)=>e.localeCompare(i)).join("+");class Nn extends ee{get key(){return this._key?this._key:this._key=zn(this.types)}constructor(t){super(),this._entities=[],t[0]instanceof Function?this.types=t.map(e=>new e().type):this.types=t}getEntities(t){return t&&this._entities.sort(t),this._entities}addEntity(t){!us(this._entities,t)&&this.matches(t)&&(this._entities.push(t),this.notifyAll(new uo(t)))}removeEntity(t){Le(t,this._entities)&&this.notifyAll(new po(t))}clear(){this._entities.length=0;for(const t of this.observers)this.unregister(t)}matches(t){let e=[];t instanceof $t?e=t.types:e=t;let i=!0;for(const n of this.types)if(i=i&&e.indexOf(n)>-1,!i)return!1;return i}contain(t){return this.types.indexOf(t)>-1}}class Tr{constructor(t){this._world=t,this._queries={}}_addQuery(t){this._queries[zn(t.types)]=t;for(const e of this._world.entityManager.entities)t.addEntity(e)}maybeRemoveQuery(t){t.observers.length===0&&(t.clear(),delete this._queries[zn(t.types)])}addEntity(t){for(const e in this._queries)this._queries[e]&&this._queries[e].addEntity(t)}removeComponent(t,e){for(const i in this._queries)this._queries[i].contain(e.type)&&this._queries[i].removeEntity(t)}removeEntity(t){for(const e in this._queries)this._queries[e].removeEntity(t)}createQuery(t){const e=this.getQuery(t);if(e)return e;const i=new Nn(t);return this._addQuery(i),i}getQuery(t){const e=zn(t);return this._queries[e]?this._queries[e]:null}}class kr{constructor(t){this._world=t,this.systems=[],this.initialized=!1}get(t){return this.systems.find(e=>e instanceof t)}addSystem(t){if(!t.types||t.types.length===0)throw new Error("Attempted to add a System without any types");const e=this._world.queryManager.createQuery(t.types);this.systems.push(t),this.systems.sort((i,n)=>i.priority-n.priority),e.register(t),this.initialized&&t.initialize&&t.initialize(this._world.context)}removeSystem(t){Le(t,this.systems);const e=this._world.queryManager.getQuery(t.types);e&&(e.unregister(t),this._world.queryManager.maybeRemoveQuery(e))}initialize(){if(!this.initialized){this.initialized=!0;for(const t of this.systems)t.initialize&&t.initialize(this._world.context)}}updateSystems(t,e,i){const n=this.systems.filter(o=>o.systemType===t);for(const o of n)o.preupdate&&o.preupdate(e,i);for(const o of n){const h=this._world.queryManager.getQuery(o.types).getEntities(o.sort);if(e instanceof ei)for(const d of h)d._initialize(e==null?void 0:e.engine);o.update(h,i)}for(const o of n)o.postupdate&&o.postupdate(e,i)}clear(){for(const t of this.systems)this.removeSystem(t)}}class fo{constructor(t){this.context=t,this.queryManager=new Tr(this),this.entityManager=new Pr(this),this.systemManager=new kr(this)}update(t,e){t===Ae.Update&&this.entityManager.updateEntities(this.context,e),this.systemManager.updateSystems(t,this.context,e),this.entityManager.findEntitiesForRemoval(),this.entityManager.processComponentRemovals(),this.entityManager.processEntityRemovals()}add(t){t instanceof $t&&this.entityManager.addEntity(t),t instanceof We&&this.systemManager.addSystem(t)}remove(t,e=!0){t instanceof $t&&this.entityManager.removeEntity(t,e),t instanceof We&&this.systemManager.removeSystem(t)}clearEntities(){this.entityManager.clear()}clearSystems(){this.systemManager.clear()}}class ge{static integrate(t,e,i,n){const o=n/1e3;e.vel.addEqual(i.scale(o,ge._ACC)),t.pos.add(e.vel.scale(o,ge._VEL),ge._POS).addEqual(i.scale(.5*o*o,ge._VEL_ACC)),e.angularVelocity+=e.torque*(1/e.inertia)*o;const h=t.rotation+e.angularVelocity*o;t.scale.add(e.scaleFactor.scale(o,this._SCALE_FACTOR),ge._SCALE),t.get().setTransform(ge._POS,h,ge._SCALE)}}ge._POS=new k(0,0),ge._SCALE=new k(1,1),ge._ACC=new k(0,0),ge._VEL=new k(0,0),ge._VEL_ACC=new k(0,0),ge._SCALE_FACTOR=new k(0,0);class mi extends We{constructor(){super(...arguments),this.types=["ex.transform","ex.motion"],this.systemType=Ae.Update,this.priority=-1}update(t,e){let i,n;for(let o=0;o<t.length;o++){i=t[o].get($),n=t[o].get(Bt);const h=t[o].get(vt);if(h!=null&&h.sleeping)continue;const d=n.acc.clone();(h==null?void 0:h.collisionType)===dt.Active&&(h!=null&&h.useGravity)&&d.addEqual(ot.gravity),h==null||h.captureOldTransform(),ge.integrate(i,n,d,e)}}}class Ir{constructor(){this.directionMap=new Map,this.distanceMap=new Map}solve(t){this.preSolve(t),t=t.filter(e=>!e.isCanceled()),t.sort((e,i)=>{const n=this.distanceMap.get(e.id),o=this.distanceMap.get(i.id);return n-o});for(const e of t)this.solvePosition(e),this.solveVelocity(e);return this.postSolve(t),t}preSolve(t){for(const i of t){if(Math.abs(i.mtv.x)<1e-4&&Math.abs(i.mtv.y)<1e-4){i.cancel();continue}const n=ht.fromDirection(i.mtv),o=i.mtv.negate(),h=i.colliderA.worldPos.squareDistance(i.colliderB.worldPos);this.distanceMap.set(i.id,h),i.colliderA.events.emit("precollision",new ze(i.colliderA,i.colliderB,n,o)),i.colliderB.events.emit("precollision",new ze(i.colliderB,i.colliderA,ht.getOpposite(n),o.negate()))}}postSolve(t){var e,i;for(const n of t){if(n.isCanceled())continue;const o=n.colliderA,h=n.colliderB,d=(e=o.owner)===null||e===void 0?void 0:e.get(vt),u=(i=h.owner)===null||i===void 0?void 0:i.get(vt);if(d&&u&&(d.collisionType===dt.Passive||u.collisionType===dt.Passive))continue;const g=ht.fromDirection(n.mtv),v=n.mtv.negate();n.colliderA.events.emit("postcollision",new ui(n.colliderA,n.colliderB,g,v)),n.colliderB.events.emit("postcollision",new ui(n.colliderB,n.colliderA,ht.getOpposite(g),v.negate()))}}solvePosition(t){var e,i;if(!t.colliderA.bounds.overlaps(t.colliderB.bounds,1e-4)){t.cancel();return}if(Math.abs(t.mtv.x)<1e-4&&Math.abs(t.mtv.y)<1e-4){t.cancel();return}let o=t.mtv;const h=t.colliderA,d=t.colliderB,u=(e=h.owner)===null||e===void 0?void 0:e.get(vt),g=(i=d.owner)===null||i===void 0?void 0:i.get(vt);if(u&&g){if(u.collisionType===dt.Passive||g.collisionType===dt.Passive)return;u.collisionType===dt.Active&&g.collisionType===dt.Active&&(o=o.scale(.5)),u.collisionType===dt.Active&&(u.globalPos.x-=o.x,u.globalPos.y-=o.y,h.update(u.transform.get())),g.collisionType===dt.Active&&(g.globalPos.x+=o.x,g.globalPos.y+=o.y,d.update(g.transform.get()))}}solveVelocity(t){var e,i;if(t.isCanceled())return;const n=t.colliderA,o=t.colliderB,h=(e=n.owner)===null||e===void 0?void 0:e.get(vt),d=(i=o.owner)===null||i===void 0?void 0:i.get(vt);if(h&&d){if(h.collisionType===dt.Passive||d.collisionType===dt.Passive)return;const u=t.normal,g=u.negate();if(h.collisionType===dt.Active&&h.vel.normalize().dot(g)<0){const v=u.scale(u.dot(h.vel.negate()));h.vel=h.vel.add(v)}if(d.collisionType===dt.Active&&d.vel.normalize().dot(u)<0){const v=g.scale(g.dot(d.vel.negate()));d.vel=d.vel.add(v)}}}}class hs{constructor(t,e,i){this.point=t,this.local=e,this.contact=i,this.normalImpulse=0,this.tangentImpulse=0,this.normalMass=0,this.tangentMass=0,this.aToContact=new k(0,0),this.bToContact=new k(0,0),this.originalVelocityAndRestitution=0,this.update()}update(){var t,e;const i=(t=this.contact.colliderA.owner)===null||t===void 0?void 0:t.get(vt),n=(e=this.contact.colliderB.owner)===null||e===void 0?void 0:e.get(vt);if(i&&n){const o=this.contact.normal,h=this.contact.tangent;this.aToContact=this.point.sub(i.globalPos),this.bToContact=this.point.sub(n.globalPos);const d=this.aToContact.cross(o),u=this.bToContact.cross(o);this.normalMass=i.inverseMass+n.inverseMass+i.inverseInertia*d*d+n.inverseInertia*u*u;const g=this.aToContact.cross(h),v=this.bToContact.cross(h);this.tangentMass=i.inverseMass+n.inverseMass+i.inverseInertia*g*g+n.inverseInertia*v*v}return this}getRelativeVelocity(){var t,e;const i=(t=this.contact.colliderA.owner)===null||t===void 0?void 0:t.get(vt),n=(e=this.contact.colliderB.owner)===null||e===void 0?void 0:e.get(vt);if(i&&n){const o=i.vel.add(k.cross(i.angularVelocity,this.aToContact));return n.vel.add(k.cross(n.angularVelocity,this.bToContact)).sub(o)}return k.Zero}}class _o{constructor(){this.lastFrameContacts=new Map,this.idToContactConstraint=new Map}getContactConstraints(t){var e;return(e=this.idToContactConstraint.get(t))!==null&&e!==void 0?e:[]}solve(t){return this.preSolve(t),t=t.filter(e=>!e.isCanceled()),this.solveVelocity(t),this.solvePosition(t),this.postSolve(t),t}preSolve(t){var e,i,n;for(const d of t){if(Math.abs(d.mtv.x)<1e-4&&Math.abs(d.mtv.y)<1e-4){d.cancel();continue}const u=ht.fromDirection(d.mtv);d.colliderA.events.emit("precollision",new ze(d.colliderA,d.colliderB,u,d.mtv)),d.colliderA.events.emit("beforecollisionresolve",new vs(d.colliderA,d.colliderB,u,d.mtv,d)),d.colliderB.events.emit("precollision",new ze(d.colliderB,d.colliderA,ht.getOpposite(u),d.mtv.negate())),d.colliderB.events.emit("beforecollisionresolve",new vs(d.colliderB,d.colliderA,ht.getOpposite(u),d.mtv.negate(),d)),d.matchAwake()}const h=Array.from(this.idToContactConstraint.keys());for(const d of t){const u=h.indexOf(d.id);u>-1&&h.splice(u,1);const g=(e=this.idToContactConstraint.get(d.id))!==null&&e!==void 0?e:[];let v=0;const I=d.colliderA.owner.get(vt),D=d.colliderB.owner.get(vt);if(I&&D)for(const U of d.points){const H=d.normal,Z=d.tangent,K=U.sub(I.globalPos),z=U.sub(D.globalPos),N=K.cross(H),et=z.cross(H),st=I.inverseMass+D.inverseMass+I.inverseInertia*N*N+D.inverseInertia*et*et,ft=K.cross(Z),at=z.cross(Z),q=I.inverseMass+D.inverseMass+I.inverseInertia*ft*ft+D.inverseInertia*at*at;g[v]&&((n=(i=g[v])===null||i===void 0?void 0:i.point)===null||n===void 0?void 0:n.squareDistance(U))<4?(g[v].point=U,g[v].local=d.localPoints[v]):g[v]=new hs(U,d.localPoints[v],d),g[v].aToContact=K,g[v].bToContact=z,g[v].normalMass=1/st,g[v].tangentMass=1/q;const It=I.bounciness>D.bounciness?I.bounciness:D.bounciness,Tt=d.normal.dot(g[v].getRelativeVelocity());g[v].originalVelocityAndRestitution=0,Tt<-.1&&(g[v].originalVelocityAndRestitution=-It*Tt),v++}this.idToContactConstraint.set(d.id,g)}for(const d of h)this.idToContactConstraint.delete(d);if(ot.warmStart)this.warmStart(t);else for(const d of t){const u=this.getContactConstraints(d.id);for(const g of u)g.normalImpulse=0,g.tangentImpulse=0}}postSolve(t){for(const e of t){const i=e.colliderA.owner.get(vt),n=e.colliderB.owner.get(vt);if(i&&n){if(i.collisionType===dt.Passive||n.collisionType===dt.Passive)continue;i.updateMotion(),n.updateMotion()}const o=ht.fromDirection(e.mtv);e.colliderA.events.emit("postcollision",new ui(e.colliderA,e.colliderB,o,e.mtv)),e.colliderA.events.emit("aftercollisionresolve",new Ne(e.colliderA,e.colliderB,o,e.mtv,e)),e.colliderB.events.emit("postcollision",new ui(e.colliderB,e.colliderA,ht.getOpposite(o),e.mtv.negate())),e.colliderB.events.emit("aftercollisionresolve",new Ne(e.colliderB,e.colliderA,ht.getOpposite(o),e.mtv.negate(),e))}this.lastFrameContacts.clear();for(const e of t)this.lastFrameContacts.set(e.id,e)}warmStart(t){var e,i,n;for(const o of t){const h=(e=o.colliderA.owner)===null||e===void 0?void 0:e.get(vt),d=(i=o.colliderB.owner)===null||i===void 0?void 0:i.get(vt);if(h&&d){const u=(n=this.idToContactConstraint.get(o.id))!==null&&n!==void 0?n:[];for(const g of u)if(ot.warmStart){const v=o.normal.scale(g.normalImpulse),I=o.tangent.scale(g.tangentImpulse),D=v.add(I);h.applyImpulse(g.point,D.negate()),d.applyImpulse(g.point,D)}else g.normalImpulse=0,g.tangentImpulse=0}}}solvePosition(t){var e,i,n;for(let o=0;o<ot.positionIterations;o++)for(const h of t){const d=(e=h.colliderA.owner)===null||e===void 0?void 0:e.get(vt),u=(i=h.colliderB.owner)===null||i===void 0?void 0:i.get(vt);if(d&&u){if(d.collisionType===dt.Passive||u.collisionType===dt.Passive)continue;const g=(n=this.idToContactConstraint.get(h.id))!==null&&n!==void 0?n:[];for(const v of g){const I=h.normal,D=De.FindContactSeparation(h,v.local),U=ot.steeringFactor,H=-5,Z=ot.slop,K=A(U*(D+Z),H,0),z=I.scale(-K*v.normalMass);if(d.collisionType===dt.Active){const N=z.negate().scale(d.inverseMass);d.limitDegreeOfFreedom.includes(_e.X)&&(N.x=0),d.limitDegreeOfFreedom.includes(_e.Y)&&(N.y=0),d.globalPos=d.globalPos.add(N),d.limitDegreeOfFreedom.includes(_e.Rotation)||(d.rotation-=v.aToContact.cross(z)*d.inverseInertia)}if(u.collisionType===dt.Active){const N=z.scale(u.inverseMass);u.limitDegreeOfFreedom.includes(_e.X)&&(N.x=0),u.limitDegreeOfFreedom.includes(_e.Y)&&(N.y=0),u.globalPos=u.globalPos.add(N),u.limitDegreeOfFreedom.includes(_e.Rotation)||(u.rotation+=v.bToContact.cross(z)*u.inverseInertia)}}}}}solveVelocity(t){var e,i,n;for(let o=0;o<ot.velocityIterations;o++)for(const h of t){const d=(e=h.colliderA.owner)===null||e===void 0?void 0:e.get(vt),u=(i=h.colliderB.owner)===null||i===void 0?void 0:i.get(vt);if(d&&u){if(d.collisionType===dt.Passive||u.collisionType===dt.Passive)continue;const g=Math.min(d.friction,u.friction),v=(n=this.idToContactConstraint.get(h.id))!==null&&n!==void 0?n:[];for(const I of v){let H=-I.getRelativeVelocity().dot(h.tangent)*I.tangentMass;const Z=g*I.normalImpulse,K=A(I.tangentImpulse+H,-Z,Z);H=K-I.tangentImpulse,I.tangentImpulse=K;const z=h.tangent.scale(H);d.applyImpulse(I.point,z.negate()),u.applyImpulse(I.point,z)}for(const I of v){const U=I.getRelativeVelocity().dot(h.normal);let H=-I.normalMass*(U-I.originalVelocityAndRestitution);const Z=Math.max(I.normalImpulse+H,0);H=Z-I.normalImpulse,I.normalImpulse=Z;const K=h.normal.scale(H);d.applyImpulse(I.point,K.negate()),u.applyImpulse(I.point,K)}}}}}class ti extends We{constructor(t){super(),this.types=["ex.transform","ex.motion","ex.collider"],this.systemType=Ae.Update,this.priority=-1,this._realisticSolver=new _o,this._arcadeSolver=new Ir,this._lastFrameContacts=new Map,this._currentFrameContacts=new Map,this._processor=t.collisionProcessor,this._trackCollider=e=>this._processor.track(e),this._untrackCollider=e=>this._processor.untrack(e)}notify(t){if(on(t)){const e=t.data.get(Kt);e.$colliderAdded.subscribe(this._trackCollider),e.$colliderRemoved.subscribe(this._untrackCollider);const i=e.get();i&&this._processor.track(i)}else{const e=t.data.get(Kt),i=e.get();e&&i&&this._processor.untrack(i)}}initialize(t){this._engine=t.engine}update(t,e){var i,n,o,h;if(!ot.enabled)return;let d=[];for(const I of t){const D=I.get(Kt),U=D==null?void 0:D.get();if(D&&(!((i=D.owner)===null||i===void 0)&&i.active)&&U)if(D.update(),U instanceof Wt){const H=U.getColliders();d=d.concat(H)}else d.push(U)}this._processor.update(d);const u=this._processor.broadphase(d,e);this._currentFrameContacts.clear();let g=this._processor.narrowphase(u,(h=(o=(n=this._engine)===null||n===void 0?void 0:n.debug)===null||o===void 0?void 0:o.stats)===null||h===void 0?void 0:h.currFrame);g=this.getSolver().solve(g);for(const I of g){const D=I.id.indexOf("|");if(D>0){const U=I.id.substring(D+1);this._currentFrameContacts.set(U,I)}else this._currentFrameContacts.set(I.id,I)}this.runContactStartEnd(),this._lastFrameContacts.clear(),this._lastFrameContacts=new Map(this._currentFrameContacts)}getSolver(){return ot.collisionResolutionStrategy===ns.Realistic?this._realisticSolver:this._arcadeSolver}debug(t){this._processor.debug(t)}runContactStartEnd(){for(const[t,e]of this._currentFrameContacts)if(!this._lastFrameContacts.has(t)){const i=e.colliderA,n=e.colliderB;i.events.emit("collisionstart",new Ns(i,n,e)),i.events.emit("contactstart",new ms(i,n,e)),n.events.emit("collisionstart",new Ns(n,i,e)),n.events.emit("contactstart",new ms(n,i,e))}for(const[t,e]of this._lastFrameContacts)if(!this._currentFrameContacts.has(t)){const i=e.colliderA,n=e.colliderB;i.events.emit("collisionend",new pi(i,n)),i.events.emit("contactend",new Se(i,n)),n.events.emit("collisionend",new pi(n,i)),n.events.emit("contactend",new Se(n,i))}}}var an;(function(a){a.Forward="forward",a.Backward="backward"})(an||(an={}));var Me;(function(a){a.End="end",a.Loop="loop",a.PingPong="pingpong",a.Freeze="freeze"})(Me||(Me={}));class zi extends ne{constructor(t){var e,i;super(t),this.events=new Pi,this.frames=[],this.strategy=Me.Loop,this.frameDuration=100,this.timeScale=1,this._idempotencyToken=-1,this._firstTick=!0,this._currentFrame=0,this._timeLeftInFrame=0,this._direction=1,this._done=!1,this._playing=!0,this._reversed=!1,this.frames=t.frames,this.strategy=(e=t.strategy)!==null&&e!==void 0?e:this.strategy,this.frameDuration=t.totalDuration?t.totalDuration/this.frames.length:(i=t.frameDuration)!==null&&i!==void 0?i:this.frameDuration,t.reverse&&this.reverse(),this.goToFrame(0)}clone(){return new zi({frames:this.frames.map(t=>({...t})),frameDuration:this.frameDuration,reverse:this._reversed,strategy:this.strategy,...this.cloneGraphicOptions()})}get width(){const t=this.currentFrame;return t?Math.abs(t.graphic.width*this.scale.x):0}get height(){const t=this.currentFrame;return t?Math.abs(t.graphic.height*this.scale.y):0}static fromSpriteSheet(t,e,i,n=Me.Loop){const o=t.sprites.length-1,h=e.filter(d=>d<0||d>o);return h.length&&zi._LOGGER.warn(`Indices into SpriteSheet were provided that don't exist: ${h.join(",")} no frame will be shown`),new zi({frames:t.sprites.filter((d,u)=>e.indexOf(u)>-1).map(d=>({graphic:d,duration:i})),strategy:n})}get currentFrame(){return this._currentFrame>=0&&this._currentFrame<this.frames.length?this.frames[this._currentFrame]:null}get currentFrameIndex(){return this._currentFrame}get isPlaying(){return this._playing}reverse(){this.frames=this.frames.slice().reverse(),this._reversed=!this._reversed}get direction(){return!!(this._reversed&&this._direction===1)?an.Backward:an.Forward}play(){this._playing=!0}pause(){this._playing=!1,this._firstTick=!0}reset(){this._done=!1,this._firstTick=!0,this._currentFrame=0}get canFinish(){switch(this.strategy){case Me.End:case Me.Freeze:return!0;default:return!1}}get done(){return this._done}goToFrame(t){this._currentFrame=t,this._timeLeftInFrame=this.frameDuration;const e=this.frames[this._currentFrame];e&&!this._done&&(this._timeLeftInFrame=(e==null?void 0:e.duration)||this.frameDuration,this.events.emit("frame",e))}_nextFrame(){const t=this._currentFrame;if(this._done)return t;let e=-1;switch(this.strategy){case Me.Loop:{e=(t+1)%this.frames.length,e===0&&this.events.emit("loop",this);break}case Me.End:{e=t+1,e>=this.frames.length&&(this._done=!0,this._currentFrame=this.frames.length,this.events.emit("end",this));break}case Me.Freeze:{e=A(t+1,0,this.frames.length-1),e>=this.frames.length-1&&(this._done=!0,this.events.emit("end",this));break}case Me.PingPong:{t+this._direction>=this.frames.length&&(this._direction=-1,this.events.emit("loop",this)),t+this._direction<0&&(this._direction=1,this.events.emit("loop",this)),e=t+this._direction%this.frames.length;break}}return e}tick(t,e=0){this._idempotencyToken!==e&&(this._idempotencyToken=e,this._playing&&(this._firstTick&&(this._firstTick=!1,this.events.emit("frame",this.currentFrame)),this._timeLeftInFrame-=t*this.timeScale,this._timeLeftInFrame<=0&&this.goToFrame(this._nextFrame())))}_drawImage(t,e,i){this.currentFrame&&this.currentFrame.graphic.draw(t,e,i)}}zi._LOGGER=Y.getInstance();class ln extends ne{constructor(t){super(t),this.members=[],this.members=t.members,this._updateDimensions()}clone(){return new ln({members:[...this.members],...this.cloneGraphicOptions()})}_updateDimensions(){let t=new nt;for(const{graphic:e,pos:i}of this.members)t=e.localBounds.translate(i).combine(t);return this.width=t.width,this.height=t.height,t}get localBounds(){let t=new nt;for(const{graphic:e,pos:i}of this.members)t=e.localBounds.translate(i).combine(t);return t}_isAnimationOrGroup(t){return t instanceof zi||t instanceof ln}tick(t,e){for(const i of this.members){const n=i.graphic;this._isAnimationOrGroup(n)&&n.tick(t,e)}}reset(){for(const t of this.members){const e=t.graphic;this._isAnimationOrGroup(e)&&e.reset()}}_preDraw(t,e,i){this._updateDimensions(),super._preDraw(t,e,i)}_drawImage(t,e,i){for(const n of this.members)t.save(),t.translate(e,i),n.graphic.draw(t,n.pos.x,n.pos.y),this.showDebug&&t.debug.drawRect(0,0,this.width,this.height),t.restore()}}function go(a){return class extends a{assign(t){for(const e in t)typeof this[e]!="function"&&(this[e]=t[e])}constructor(...t){super(...t),t.filter(function(i){return i!==void 0}).length===1&&t[0]&&typeof t[0]=="object"&&!(t[0]instanceof Array)&&this.assign(t[0])}}}var Ds;(function(a){a[a.Circle=0]="Circle",a[a.Rectangle=1]="Rectangle"})(Ds||(Ds={}));class vi extends $t{constructor(t,e,i,n,o,h,d,u,g,v){super(),this.position=new k(0,0),this.velocity=new k(0,0),this.acceleration=new k(0,0),this.particleRotationalVelocity=0,this.currentRotation=0,this.focus=null,this.focusAccel=0,this.opacity=1,this.beginColor=j.White,this.endColor=j.White,this.life=300,this.fadeFlag=!1,this._rRate=1,this._gRate=1,this._bRate=1,this._aRate=0,this._currentColor=j.White,this.emitter=null,this.particleSize=5,this.particleSprite=null,this.sizeRate=0,this.elapsedMultiplier=0,this.visible=!0,this.isOffscreen=!1;let I=t;if(I&&!(t instanceof Rr)){const D=t;I=D.emitter,e=D.life,i=D.opacity,o=D.endColor,n=D.beginColor,h=D.position,d=D.velocity,u=D.acceleration,g=D.startSize,v=D.endSize}if(this.emitter=I,this.life=e||this.life,this.opacity=i||this.opacity,this.endColor=o||this.endColor.clone(),this.beginColor=n||this.beginColor.clone(),this._currentColor=this.beginColor.clone(),this.emitter.particleTransform===Ms.Global){const D=this.emitter.transform.globalPos;this.position=(h||this.position).add(D),this.velocity=(d||this.velocity).rotate(this.emitter.transform.globalRotation)}else this.velocity=d||this.velocity,this.position=h||this.position;this.acceleration=u||this.acceleration,this._rRate=(this.endColor.r-this.beginColor.r)/this.life,this._gRate=(this.endColor.g-this.beginColor.g)/this.life,this._bRate=(this.endColor.b-this.beginColor.b)/this.life,this._aRate=this.opacity/this.life,this.startSize=g||0,this.endSize=v||0,this.endSize>0&&this.startSize>0&&(this.sizeRate=(this.endSize-this.startSize)/this.life,this.particleSize=this.startSize),this.addComponent(this.transform=new $),this.addComponent(this.graphics=new le),this.transform.pos=this.position,this.transform.rotation=this.currentRotation,this.transform.scale=B(1,1),this.particleSprite?(this.graphics.opacity=this.opacity,this.graphics.use(this.particleSprite)):(this.graphics.localBounds=nt.fromDimension(this.particleSize,this.particleSize,k.Half),this.graphics.onPostDraw=D=>{D.save(),this.graphics.opacity=this.opacity;const U=this._currentColor.clone();U.a=1,D.debug.drawPoint(B(0,0),{color:U,size:this.particleSize}),D.restore()})}kill(){this.emitter.removeParticle(this)}update(t,e){if(this.life=this.life-e,this.elapsedMultiplier=this.elapsedMultiplier+e,this.life<0&&this.kill(),this.fadeFlag&&(this.opacity=A(this._aRate*this.life,1e-4,1)),this.startSize>0&&this.endSize>0&&(this.particleSize=A(this.sizeRate*e+this.particleSize,Math.min(this.startSize,this.endSize),Math.max(this.startSize,this.endSize))),this._currentColor.r=A(this._currentColor.r+this._rRate*e,0,255),this._currentColor.g=A(this._currentColor.g+this._gRate*e,0,255),this._currentColor.b=A(this._currentColor.b+this._bRate*e,0,255),this._currentColor.a=A(this.opacity,1e-4,1),this.focus){const i=this.focus.sub(this.position).normalize().scale(this.focusAccel).scale(e/1e3);this.velocity=this.velocity.add(i)}else this.velocity=this.velocity.add(this.acceleration.scale(e/1e3));this.position=this.position.add(this.velocity.scale(e/1e3)),this.particleRotationalVelocity&&(this.currentRotation=(this.currentRotation+this.particleRotationalVelocity*e/1e3)%(2*Math.PI)),this.transform.pos=this.position,this.transform.rotation=this.currentRotation,this.transform.scale=B(1,1),this.graphics.opacity=this.opacity}}class hn extends go(vi){constructor(t,e,i,n,o,h,d,u,g,v){super(t,e,i,n,o,h,d,u,g,v)}}var Ms;(function(a){a.Global="global",a.Local="local"})(Ms||(Ms={}));class Rr extends gi{get opacity(){return super.graphics.opacity}set opacity(t){super.graphics.opacity=t}get particleSprite(){return this._sprite}set particleSprite(t){t&&(this._sprite=t)}constructor(t){var e,i;super({width:(e=t.width)!==null&&e!==void 0?e:0,height:(i=t.height)!==null&&i!==void 0?i:0}),this._particlesToEmit=0,this.numParticles=0,this.isEmitting=!0,this.particles=[],this.deadParticles=[],this.minVel=0,this.maxVel=0,this.acceleration=new k(0,0),this.minAngle=0,this.maxAngle=0,this.emitRate=1,this.particleLife=2e3,this.fadeFlag=!1,this.focus=null,this.focusAccel=null,this.startSize=null,this.endSize=null,this.minSize=5,this.maxSize=5,this.beginColor=j.White,this.endColor=j.White,this._sprite=null,this.emitterType=Ds.Rectangle,this.radius=0,this.particleRotationalVelocity=0,this.randomRotation=!1,this.particleTransform=Ms.Global;const{x:n,y:o,pos:h,isEmitting:d,minVel:u,maxVel:g,acceleration:v,minAngle:I,maxAngle:D,emitRate:U,particleLife:H,opacity:Z,fadeFlag:K,focus:z,focusAccel:N,startSize:et,endSize:st,minSize:ft,maxSize:at,beginColor:q,endColor:It,particleSprite:Tt,emitterType:Lt,radius:Et,particleRotationalVelocity:me,particleTransform:bi,randomRotation:xi,random:yi}={...t};this.pos=h??B(n??0,o??0),this.isEmitting=d??this.isEmitting,this.minVel=u??this.minVel,this.maxVel=g??this.maxVel,this.acceleration=v??this.acceleration,this.minAngle=I??this.minAngle,this.maxAngle=D??this.maxAngle,this.emitRate=U??this.emitRate,this.particleLife=H??this.particleLife,this.opacity=Z??this.opacity,this.fadeFlag=K??this.fadeFlag,this.focus=z??this.focus,this.focusAccel=N??this.focusAccel,this.startSize=et??this.startSize,this.endSize=st??this.endSize,this.minSize=ft??this.minSize,this.maxSize=at??this.maxSize,this.beginColor=q??this.beginColor,this.endColor=It??this.endColor,this.particleSprite=Tt??this.particleSprite,this.emitterType=Lt??this.emitterType,this.radius=Et??this.radius,this.particleRotationalVelocity=me??this.particleRotationalVelocity,this.randomRotation=xi??this.randomRotation,this.particleTransform=bi??this.particleTransform,this.body.collisionType=dt.PreventCollision,this.random=yi??new R}removeParticle(t){this.deadParticles.push(t)}emitParticles(t){var e;for(let i=0;i<t;i++){const n=this._createParticle();this.particles.push(n),!((e=this===null||this===void 0?void 0:this.scene)===null||e===void 0)&&e.world&&(this.particleTransform===Ms.Global?this.scene.world.add(n):this.addChild(n))}}clearParticles(){this.particles.length=0}_createParticle(){let t=0,e=0;const i=rt(this.minAngle,this.maxAngle,this.random),n=rt(this.minVel,this.maxVel,this.random),o=this.startSize||rt(this.minSize,this.maxSize,this.random),h=n*Math.cos(i),d=n*Math.sin(i);if(this.emitterType===Ds.Rectangle)t=rt(0,this.width,this.random),e=rt(0,this.height,this.random);else if(this.emitterType===Ds.Circle){const g=rt(0,this.radius,this.random);t=g*Math.cos(i),e=g*Math.sin(i)}const u=new hn(this,this.particleLife,this.opacity,this.beginColor,this.endColor,new k(t,e),new k(h,d),this.acceleration,this.startSize,this.endSize);return u.fadeFlag=this.fadeFlag,u.particleSize=o,this.particleSprite&&(u.particleSprite=this.particleSprite,u.graphics.opacity=this.opacity,u.graphics.use(this._sprite)),u.particleRotationalVelocity=this.particleRotationalVelocity,this.randomRotation&&(u.currentRotation=rt(0,Math.PI*2,this.random)),this.focus&&(u.focus=this.focus.add(new k(this.pos.x,this.pos.y)),u.focusAccel=this.focusAccel),u}update(t,e){var i;super.update(t,e),this.isEmitting&&(this._particlesToEmit+=this.emitRate*(e/1e3),this._particlesToEmit>1&&(this.emitParticles(Math.floor(this._particlesToEmit)),this._particlesToEmit=this._particlesToEmit-Math.floor(this._particlesToEmit)));for(let n=0;n<this.deadParticles.length;n++)Le(this.deadParticles[n],this.particles),!((i=this===null||this===void 0?void 0:this.scene)===null||i===void 0)&&i.world&&this.scene.world.remove(this.deadParticles[n],!1);this.deadParticles.length=0}}class mo extends We{constructor(){super(...arguments),this.types=["ex.transform","ex.graphics"],this.systemType=Ae.Draw,this.priority=0,this._token=0,this._sortedTransforms=[],this._zHasChanged=!1,this._zIndexUpdate=()=>{this._zHasChanged=!0}}get sortedTransforms(){return this._sortedTransforms}initialize(t){this._camera=t.camera,this._engine=t.engine}preupdate(){this._graphicsContext=this._engine.graphicsContext,this._zHasChanged&&(this._sortedTransforms.sort((t,e)=>t.z-e.z),this._zHasChanged=!1)}notify(t){if(on(t)){const e=t.data.get($);this._sortedTransforms.push(e),e.zIndexChanged$.subscribe(this._zIndexUpdate),this._zHasChanged=!0}else{const e=t.data.get($);e.zIndexChanged$.unsubscribe(this._zIndexUpdate);const i=this._sortedTransforms.indexOf(e);i>-1&&this._sortedTransforms.splice(i,1)}}update(t,e){this._token++;let i;Pt.checkAndClearCache(),this._graphicsContext.save(),this._camera&&this._camera.draw(this._graphicsContext);for(const n of this._sortedTransforms){const o=n.owner;if(o.hasTag("ex.offscreen")||(i=o.get(le),!i.visible))continue;n.coordPlane===xe.Screen&&this._graphicsContext.restore(),this._graphicsContext.save(),n.coordPlane===xe.Screen&&this._graphicsContext.translate(this._engine.screen.contentArea.left,this._engine.screen.contentArea.top),i.update(e,this._token);const h=o.get(Bs);if(h){const u=k.One.sub(h.parallaxFactor),g=this._camera.pos.scale(u);this._graphicsContext.translate(g.x,g.y)}this._applyTransform(o),i.onPreDraw&&i.onPreDraw(this._graphicsContext,e);const d=o instanceof hn?o.opacity:1;this._graphicsContext.opacity*=i.opacity*d,this._drawGraphicsComponent(i),i.onPostDraw&&i.onPostDraw(this._graphicsContext,e),this._graphicsContext.restore(),n.coordPlane===xe.Screen&&(this._graphicsContext.save(),this._camera&&this._camera.draw(this._graphicsContext))}this._graphicsContext.restore()}_drawGraphicsComponent(t){var e,i;if(t.visible)for(const n of t.layers.get())for(const{graphic:o,options:h}of n.graphics){let d=t.anchor,u=t.offset;h!=null&&h.anchor&&(d=h.anchor),h!=null&&h.offset&&(u=h.offset);const g=-o.width*d.x+u.x,v=-o.height*d.y+u.y;if(o==null||o.draw(this._graphicsContext,g+n.offset.x,v+n.offset.y),!((e=this._engine)===null||e===void 0)&&e.isDebug&&this._engine.debug.graphics.showBounds){const I=B(g+n.offset.x,v+n.offset.y);if(o instanceof ln)for(const D of o.members)(i=D.graphic)===null||i===void 0||i.localBounds.translate(I.add(D.pos)).draw(this._graphicsContext,this._engine.debug.graphics.boundsColor);else o==null||o.localBounds.translate(I).draw(this._graphicsContext,this._engine.debug.graphics.boundsColor)}}}_applyTransform(t){const e=t.getAncestors();for(const i of e){const n=i==null?void 0:i.get($),o=i==null?void 0:i.get(vt);let h=n.pos,d=n.scale,u=n.rotation;if(o&&this._engine.fixedUpdateFps&&o.__oldTransformCaptured&&o.enableFixedUpdateInterpolate){const g=this._engine.currentFrameLagMs/(1e3/this._engine.fixedUpdateFps);h=n.pos.scale(g).add(o.oldPos.scale(1-g)),d=n.scale.scale(g).add(o.oldScale.scale(1-g));const v=(1-g)*Math.cos(o.oldRotation)+g*Math.cos(n.rotation),I=(1-g)*Math.sin(o.oldRotation)+g*Math.sin(n.rotation);u=Math.atan2(I,v)}n&&(this._graphicsContext.z=n.z,this._graphicsContext.translate(h.x,h.y),this._graphicsContext.scale(d.x,d.y),this._graphicsContext.rotate(u))}}}class vo extends We{constructor(){super(...arguments),this.types=["ex.transform"],this.systemType=Ae.Draw,this.priority=999}initialize(t){this._graphicsContext=t.engine.graphicsContext,this._camera=t.camera,this._engine=t.engine,this._collisionSystem=t.world.systemManager.get(ti)}update(t,e){var i;if(!this._engine.isDebug)return;const n=this._engine.debug.filter;let o,h;const d=this._engine.debug.entity;let u;const g=this._engine.debug.transform;let v;const I=this._engine.debug.motion;let D;const U=this._engine.debug.collider,H=this._engine.debug.physics;let Z;const K=this._engine.debug.graphics;let z,N;const et=this._engine.debug.body,st=this._engine.debug.camera;for(const ft of t){if(ft.hasTag("offscreen")||ft instanceof hn||n.useFilter&&(!(n.ids.length===0||n.ids.includes(ft.id))||!(n.nameQuery===""||ft.name.includes(n.nameQuery))))continue;let at=k.Zero;const q=B(0,16);if(o=ft.id,h=ft.name,u=ft.get($),this._pushCameraTransform(u),this._graphicsContext.save(),this._applyTransform(ft),u&&((g.showAll||g.showPosition)&&this._graphicsContext.debug.drawPoint(k.Zero,{size:4,color:g.positionColor}),(g.showAll||g.showPositionLabel)&&(this._graphicsContext.debug.drawText(`pos${u.pos.toString(2)}`,at),at=at.add(q)),(g.showAll||g.showZIndex)&&(this._graphicsContext.debug.drawText(`z(${u.z.toFixed(1)})`,at),at=at.add(q)),(d.showAll||d.showId)&&(this._graphicsContext.debug.drawText(`id(${o}) ${ft.parent?"child of id("+((i=ft.parent)===null||i===void 0?void 0:i.id)+")":""}`,at),at=at.add(q)),(d.showAll||d.showName)&&(this._graphicsContext.debug.drawText(`name(${h})`,at),at=at.add(q)),(g.showAll||g.showRotation)&&(this._graphicsContext.drawLine(k.Zero,k.fromAngle(u.rotation).scale(50).add(k.Zero),g.rotationColor,2),this._graphicsContext.debug.drawText(`rot deg(${V(u.rotation).toFixed(2)})`,at),at=at.add(q)),(g.showAll||g.showScale)&&this._graphicsContext.drawLine(k.Zero,u.scale.add(k.Zero),g.scaleColor,2)),Z=ft.get(le),Z&&(K.showAll||K.showBounds)&&Z.localBounds.draw(this._graphicsContext,K.boundsColor),z=ft.get(Un),z&&(z.useTransform||this._graphicsContext.restore(),z.draw(this._graphicsContext),z.useTransform||(this._graphicsContext.save(),this._applyTransform(ft))),N=ft.get(vt),N&&((et.showAll||et.showCollisionGroup)&&(this._graphicsContext.debug.drawText(`collision group(${N.group.name})`,at),at=at.add(q)),(et.showAll||et.showCollisionType)&&(this._graphicsContext.debug.drawText(`collision type(${N.collisionType})`,at),at=at.add(q)),(et.showAll||et.showMass)&&(this._graphicsContext.debug.drawText(`mass(${N.mass})`,at),at=at.add(q)),(et.showAll||et.showMotion)&&(this._graphicsContext.debug.drawText(`motion(${N.sleepMotion})`,at),at=at.add(q)),(et.showAll||et.showSleeping)&&(this._graphicsContext.debug.drawText(`sleeping(${N.canSleep?N.sleeping:"cant sleep"})`,at),at=at.add(q))),this._graphicsContext.restore(),v=ft.get(Bt),v&&((I.showAll||I.showVelocity)&&(this._graphicsContext.debug.drawText(`vel${v.vel.toString(2)}`,at.add(u.globalPos)),this._graphicsContext.drawLine(u.globalPos,u.globalPos.add(v.vel),I.velocityColor,2),at=at.add(q)),(I.showAll||I.showAcceleration)&&this._graphicsContext.drawLine(u.globalPos,u.globalPos.add(v.acc),I.accelerationColor,2)),D=ft.get(Kt),D){const It=D.get();if((U.showAll||U.showGeometry)&&It&&It.debug(this._graphicsContext,U.geometryColor),U.showAll||U.showBounds){if(It instanceof Wt){const Tt=It.getColliders();for(const Lt of Tt){const Et=Lt.bounds,me=B(Et.left,Et.top);this._graphicsContext.debug.drawRect(me.x,me.y,Et.width,Et.height,{color:U.boundsColor}),(U.showAll||U.showOwner)&&this._graphicsContext.debug.drawText(`owner id(${Lt.owner.id})`,me)}D.bounds.draw(this._graphicsContext,U.boundsColor)}else if(It){const Tt=D.bounds,Lt=B(Tt.left,Tt.top);this._graphicsContext.debug.drawRect(Lt.x,Lt.y,Tt.width,Tt.height,{color:U.boundsColor}),(U.showAll||U.showOwner)&&this._graphicsContext.debug.drawText(`owner id(${D.owner.id})`,Lt)}}}this._popCameraTransform(u)}if(this._graphicsContext.save(),this._camera.draw(this._graphicsContext),(H.showAll||H.showBroadphaseSpacePartitionDebug)&&this._collisionSystem.debug(this._graphicsContext),H.showAll||H.showCollisionContacts||H.showCollisionNormals)for(const[ft,at]of this._engine.debug.stats.currFrame.physics.contacts){if(H.showAll||H.showCollisionContacts)for(const q of at.points)this._graphicsContext.debug.drawPoint(q,{size:5,color:H.collisionContactColor});if(H.showAll||H.showCollisionNormals)for(const q of at.points)this._graphicsContext.debug.drawLine(q,at.normal.scale(30).add(q),{color:H.collisionNormalColor})}this._graphicsContext.restore(),st&&(this._graphicsContext.save(),this._camera.draw(this._graphicsContext),(st.showAll||st.showFocus)&&this._graphicsContext.drawCircle(this._camera.pos,4,st.focusColor),(st.showAll||st.showZoom)&&this._graphicsContext.debug.drawText(`zoom(${this._camera.zoom})`,this._camera.pos),this._graphicsContext.restore()),this._graphicsContext.flush()}_applyTransform(t){const e=t.getAncestors();for(const i of e){const n=i==null?void 0:i.get($);n&&(this._graphicsContext.translate(n.pos.x,n.pos.y),this._graphicsContext.scale(n.scale.x,n.scale.y),this._graphicsContext.rotate(n.rotation))}}_pushCameraTransform(t){t.coordPlane===xe.World&&(this._graphicsContext.save(),this._camera&&this._camera.draw(this._graphicsContext))}_popCameraTransform(t){t.coordPlane===xe.World&&this._graphicsContext.restore()}}class wi extends We{constructor(){super(...arguments),this.types=["ex.transform","ex.pointer"],this.systemType=Ae.Update,this.priority=-1,this.overrideUseColliderShape=!1,this.overrideUseGraphicsBounds=!1,this.lastFrameEntityToPointers=new Map,this.currentFrameEntityToPointers=new Map,this._sortedTransforms=[],this._sortedEntities=[],this._zHasChanged=!1,this._zIndexUpdate=()=>{this._zHasChanged=!0}}initialize(t){this._engine=t.engine}preupdate(){this._receiver=this._engine.input.pointers,this._zHasChanged&&(this._sortedTransforms.sort((t,e)=>e.z-t.z),this._sortedEntities=this._sortedTransforms.map(t=>t.owner),this._zHasChanged=!1)}notify(t){if(on(t)){const e=t.data.get($);this._sortedTransforms.push(e),this._sortedEntities.push(e.owner),e.zIndexChanged$.subscribe(this._zIndexUpdate),this._zHasChanged=!0}else{const e=t.data.get($);e.zIndexChanged$.unsubscribe(this._zIndexUpdate);const i=this._sortedTransforms.indexOf(e);i>-1&&(this._sortedTransforms.splice(i,1),this._sortedEntities.splice(i,1))}}entityCurrentlyUnderPointer(t,e){return this.currentFrameEntityToPointers.has(t.id)&&this.currentFrameEntityToPointers.get(t.id).includes(e)}entityWasUnderPointer(t,e){return this.lastFrameEntityToPointers.has(t.id)&&this.lastFrameEntityToPointers.get(t.id).includes(e)}entered(t,e){return this.entityCurrentlyUnderPointer(t,e)&&!this.lastFrameEntityToPointers.has(t.id)}left(t,e){return!this.currentFrameEntityToPointers.has(t.id)&&this.entityWasUnderPointer(t,e)}addPointerToEntity(t,e){if(!this.currentFrameEntityToPointers.has(t.id)){this.currentFrameEntityToPointers.set(t.id,[e]);return}const i=this.currentFrameEntityToPointers.get(t.id);this.currentFrameEntityToPointers.set(t.id,i.concat(e))}update(t){this._processPointerToEntity(this._sortedEntities),this._dispatchEvents(this._sortedEntities),this._receiver.update(),this.lastFrameEntityToPointers.clear(),this.lastFrameEntityToPointers=new Map(this.currentFrameEntityToPointers),this.currentFrameEntityToPointers.clear(),this._receiver.clear()}_processPointerToEntity(t){var e;let i,n,o,h;for(const d of t){if(i=d.get($),h=(e=d.get(as))!==null&&e!==void 0?e:new as,n=d.get(Kt),n&&(h.useColliderShape||this.overrideUseColliderShape)){n.update();const u=n.get();if(u)for(const[g,v]of this._receiver.currentFramePointerCoords.entries())u.contains(i.coordPlane===xe.World?v.worldPos:v.screenPos)&&this.addPointerToEntity(d,g)}if(o=d.get(le),o&&(h.useGraphicsBounds||this.overrideUseGraphicsBounds)){const u=o.localBounds.transform(i.get().matrix);for(const[g,v]of this._receiver.currentFramePointerCoords.entries())u.contains(i.coordPlane===xe.World?v.worldPos:v.screenPos)&&this.addPointerToEntity(d,g)}}}_processDownAndEmit(t){const e=new Map;for(const i of this._receiver.currentFrameDown)i.active&&t.active&&this.entityCurrentlyUnderPointer(t,i.pointerId)&&(t.events.emit("pointerdown",i),this._receiver.isDragStart(i.pointerId)&&t.events.emit("pointerdragstart",i)),e.set(i.pointerId,i);return e}_processUpAndEmit(t){const e=new Map;for(const i of this._receiver.currentFrameUp)i.active&&t.active&&this.entityCurrentlyUnderPointer(t,i.pointerId)&&(t.events.emit("pointerup",i),this._receiver.isDragEnd(i.pointerId)&&t.events.emit("pointerdragend",i)),e.set(i.pointerId,i);return e}_processMoveAndEmit(t){const e=new Map;for(const i of this._receiver.currentFrameMove)i.active&&t.active&&this.entityCurrentlyUnderPointer(t,i.pointerId)&&(t.events.emit("pointermove",i),this._receiver.isDragging(i.pointerId)&&t.events.emit("pointerdragmove",i)),e.set(i.pointerId,i);return e}_processEnterLeaveAndEmit(t,e){for(const i of e){if(i.active&&t.active&&this.entered(t,i.pointerId)){t.events.emit("pointerenter",i),this._receiver.isDragging(i.pointerId)&&t.events.emit("pointerdragenter",i);break}if(i.active&&t.active&&(this.left(t,i.pointerId)||this.entityCurrentlyUnderPointer(t,i.pointerId)&&i.type==="up")){t.events.emit("pointerleave",i),this._receiver.isDragging(i.pointerId)&&t.events.emit("pointerdragleave",i);break}}}_processCancelAndEmit(t){for(const e of this._receiver.currentFrameCancel)e.active&&t.active&&this.entityCurrentlyUnderPointer(t,e.pointerId)&&t.events.emit("pointercancel",e)}_processWheelAndEmit(t){for(const e of this._receiver.currentFrameWheel)e.active&&t.active&&this.entityCurrentlyUnderPointer(t,0)&&t.events.emit("pointerwheel",e)}_dispatchEvents(t){const e=new Set(this.lastFrameEntityToPointers.keys()),i=new Set(this.currentFrameEntityToPointers.keys()),n=t.filter(u=>e.has(u.id)||i.has(u.id));let o,h,d;for(const u of n){d=this._processDownAndEmit(u),h=this._processUpAndEmit(u),o=this._processMoveAndEmit(u);const g=[...o.values(),...d.values(),...h.values()];this._processEnterLeaveAndEmit(u,g),this._processCancelAndEmit(u),this._processWheelAndEmit(u)}}}class Br extends We{constructor(){super(...arguments),this.types=["ex.actions"],this.systemType=Ae.Update,this.priority=-1,this._actions=[]}notify(t){if(on(t)){const e=t.data.get(Ts);this._actions.push(e)}else{const e=t.data.get(Ts),i=this._actions.indexOf(e);i>-1&&this._actions.splice(i,1)}}update(t,e){for(const i of this._actions)i.update(e)}}class Hn extends re{constructor(t){super(),this.type="ex.isometricentity",this.elevation=0,this.map=t}}class wo extends We{constructor(){super(...arguments),this.types=["ex.transform","ex.isometricentity"],this.systemType=Ae.Update,this.priority=99}update(t,e){let i,n;for(const o of t){i=o.get($),n=o.get(Hn);const d=Math.max(n.map.columns*n.map.tileWidth,n.map.rows*n.map.tileHeight)*n.elevation+i.pos.y;i.z=d}}}class Xn extends We{constructor(){super(...arguments),this.types=["ex.transform","ex.graphics"],this.systemType=Ae.Draw,this.priority=-1}initialize(t){this._camera=t.camera}update(t){let e,i,n;for(const o of t){i=o.get(le),e=o.get($),n=o.get(Bs);let h;if(n){const u=k.One.sub(n.parallaxFactor);h=this._camera.pos.scale(u)}const d=this._isOffscreen(e,i,h);d&&!o.hasTag("ex.offscreen")&&(o.eventDispatcher.emit("exitviewport",new Xs(o)),o.addTag("ex.offscreen")),!d&&o.hasTag("ex.offscreen")&&(o.eventDispatcher.emit("enterviewport",new sr(o)),o.removeTag("ex.offscreen"))}}_isOffscreen(t,e,i){if(t.coordPlane===xe.World){let n=e.localBounds;i&&(n=n.translate(i));const o=n.transform(t.get().matrix);return!this._camera.viewport.overlaps(o)}else return!1}}class bo{constructor(){this.collisionProcessor=new pr}rayCast(t,e){return this.collisionProcessor.rayCast(t,e)}}class ei extends Re{get actors(){return this.world.entityManager.entities.filter(t=>t instanceof gi)}get entities(){return this.world.entityManager.entities}get triggers(){return this.world.entityManager.entities.filter(t=>t instanceof co)}get tileMaps(){return this.world.entityManager.entities.filter(t=>t instanceof so)}get timers(){return this._timers}constructor(){super(),this._logger=Y.getInstance(),this.camera=new ho,this.world=new fo(this),this.physics=new bo,this._isInitialized=!1,this._timers=[],this._cancelQueue=[],this.world.add(new Br),this.world.add(new mi),this.world.add(new ti(this.physics)),this.world.add(new wi),this.world.add(new wo),this.world.add(new Xn),this.world.add(new mo),this.world.add(new vo)}on(t,e){super.on(t,e)}once(t,e){super.once(t,e)}off(t,e){super.off(t,e)}onInitialize(t){}onActivate(t){}onDeactivate(t){}onPreUpdate(t,e){}onPostUpdate(t,e){}onPreDraw(t,e){}onPostDraw(t,e){}_initializeChildren(){for(const t of this.entities)t._initialize(this.engine)}get isInitialized(){return this._isInitialized}_initialize(t){this.isInitialized||(this.engine=t,this.camera._initialize(t),this.world.systemManager.initialize(),this.onInitialize.call(this,t),this._initializeChildren(),this._logger.debug("Scene.onInitialize",this,t),this.eventDispatcher.emit("initialize",new Ji(t,this)),this._isInitialized=!0)}_activate(t){this._logger.debug("Scene.onActivate",this),this.onActivate(t)}_deactivate(t){this._logger.debug("Scene.onDeactivate",this),this.onDeactivate(t)}_preupdate(t,e){this.emit("preupdate",new Ve(t,e,this)),this.onPreUpdate(t,e)}_postupdate(t,e){this.emit("postupdate",new de(t,e,this)),this.onPostUpdate(t,e)}_predraw(t,e){this.emit("predraw",new ke(t,e,this)),this.onPreDraw(t,e)}_postdraw(t,e){this.emit("postdraw",new hi(t,e,this)),this.onPostDraw(t,e)}update(t,e){this._preupdate(t,e);let i,n;for(i=0,n=this._cancelQueue.length;i<n;i++)this.removeTimer(this._cancelQueue[i]);this._cancelQueue.length=0;for(const o of this._timers)o.update(e);this.world.update(Ae.Update,e),this.camera&&this.camera.update(t,e),this._collectActorStats(t),this._postupdate(t,e)}draw(t,e){var i;this._predraw(t,e),this.world.update(Ae.Draw,e),!((i=this.engine)===null||i===void 0)&&i.isDebug&&this.debugDraw(t),this._postdraw(t,e)}debugDraw(t){this.emit("predebugdraw",new fs(t,this)),this.emit("postdebugdraw",new Zi(t,this))}contains(t){return this.actors.indexOf(t)>-1}add(t){if(this.emit("entityadded",{target:t}),this.world.add(t),t.scene=this,t instanceof Rs){us(this._timers,t)||this.addTimer(t);return}}remove(t){t instanceof $t&&(this.emit("entityremoved",{target:t}),t.active&&t.kill(),this.world.remove(t)),t instanceof Rs&&this.removeTimer(t)}clear(t=!0){for(const e of this.entities)this.world.remove(e,t);for(const e of this.timers)this.removeTimer(e)}addTimer(t){return this._timers.push(t),t.scene=this,t}removeTimer(t){const e=this._timers.indexOf(t);return e!==-1&&this._timers.splice(e,1),t}cancelTimer(t){return this._cancelQueue.push(t),t}isTimerActive(t){return this._timers.indexOf(t)>-1&&!t.complete}isCurrentScene(){return this.engine?this.engine.currentScene===this:!1}_collectActorStats(t){const e=this.actors.filter(i=>i instanceof Er);for(const i of e)t.stats.currFrame.actors.ui++;for(const i of this.actors){t.stats.currFrame.actors.alive++;for(const n of i.children)Fn(n)?t.stats.currFrame.actors.ui++:t.stats.currFrame.actors.alive++}}}var Ni;(function(a){a.Protanope="Protanope",a.Deuteranope="Deuteranope",a.Tritanope="Tritanope"})(Ni||(Ni={}));const Ko=`#version 300 es
precision mediump float;
// our texture
uniform sampler2D u_image;
// the texCoords passed in from the vertex shader.
in vec2 v_texcoord;

// color blind type
uniform int u_type;

// simulation?
uniform bool u_simulate;

out vec4 fragColor;

void main() {
  vec4 o =  texture(u_image, v_texcoord);
  // RGB to LMS matrix conversion
  float L = (17.8824 * o.r) + (43.5161 * o.g) + (4.11935 * o.b);
  float M = (3.45565 * o.r) + (27.1554 * o.g) + (3.86714 * o.b);
  float S = (0.0299566 * o.r) + (0.184309 * o.g) + (1.46709 * o.b);
  // Simulate color blindness
  float l;
  float m;
  float s;
  //MODE CODE//
  if (u_type == 0) {
    // Protanope
    l = 0.0 * L + 2.02344 * M + -2.52581 * S;
    m = 0.0 * L + 1.0 * M + 0.0 * S;
    s = 0.0 * L + 0.0 * M + 1.0 * S;;
  } else if (u_type == 1) {
    // Deuteranope
    l = 1.0 * L + 0.0 * M + 0.0 * S;
    m = 0.494207 * L + 0.0 * M + 1.24827 * S;
    s = 0.0 * L + 0.0 * M + 1.0 * S;
  } else if (u_type == 2) {
    // Tritanope
    l = 1.0 * L + 0.0 * M + 0.0 * S;
    m = 0.0 * L + 1.0 * M + 0.0 * S;
    s = -0.395913 * L + 0.801109 * M + 0.0 * S;
  }

  // LMS to RGB matrix conversion
  vec4 error; // simulate the colors
  error.r = (0.0809444479 * l) + (-0.130504409 * m) + (0.116721066 * s);
  error.g = (-0.0102485335 * l) + (0.0540193266 * m) + (-0.113614708 * s);
  error.b = (-0.000365296938 * l) + (-0.00412161469 * m) + (0.693511405 * s);
  error.a = 1.0;
  vec4 diff = o - error;
  vec4 correction; // correct the colors
  correction.r = 0.0;
  correction.g =  (diff.r * 0.7) + (diff.g * 1.0);
  correction.b =  (diff.r * 0.7) + (diff.b * 1.0);
  correction = o + correction;
  correction.a = o.a;
  //SIMULATE//

  // sim 
  if (u_simulate) {
    fragColor = error.rgba;
  } else {
    fragColor = correction.rgba;
  }
}`;class xo{constructor(t){this._shader=new Ie({vertexSource:`#version 300 es
      in vec2 a_position;
      in vec2 a_texcoord;
      out vec2 v_texcoord;

      void main() {
        gl_Position = vec4(a_position, 0.0, 1.0);
        // Pass the texcoord to the fragment shader.
        v_texcoord = a_texcoord;
      }`,fragmentSource:t}),this._shader.compile(),this._buffer=new He({type:"static",data:new Float32Array([-1,-1,0,0,-1,1,0,1,1,-1,1,0,1,-1,1,0,-1,1,0,1,1,1,1,1])}),this._layout=new Ii({shader:this._shader,vertexBuffer:this._buffer,attributes:[["a_position",2],["a_texcoord",2]]}),this._buffer.upload()}getShader(){return this._shader}getLayout(){return this._layout}}class yo{constructor(t,e=!1){this._colorBlindnessMode=t,this._simulate=!1,this._simulate=e}initialize(t){this._shader=new xo(Ko),this.simulate=this._simulate,this.colorBlindnessMode=this._colorBlindnessMode}getShader(){return this._shader.getShader()}getLayout(){return this._shader.getLayout()}set colorBlindnessMode(t){if(this._colorBlindnessMode=t,this._shader){const e=this._shader.getShader();e.use(),this._colorBlindnessMode===Ni.Protanope?e.setUniformInt("u_type",0):this._colorBlindnessMode===Ni.Deuteranope?e.setUniformInt("u_type",1):this._colorBlindnessMode===Ni.Tritanope&&e.setUniformInt("u_type",2)}}get colorBlindnessMode(){return this._colorBlindnessMode}set simulate(t){if(this._simulate=t,this._shader){const e=this._shader.getShader();e.use(),e.setUniformBoolean("u_simulate",t)}}get simulate(){return this._simulate}}class Ao{constructor(t){this._engine=t,this._colorBlindPostProcessor=new yo(Ni.Protanope)}correct(t){this._engine.graphicsContext instanceof Ks&&(this.clear(),this._colorBlindPostProcessor.colorBlindnessMode=t,this._colorBlindPostProcessor.simulate=!1,this._engine.graphicsContext.addPostProcessor(this._colorBlindPostProcessor))}simulate(t){this._engine.graphicsContext instanceof Ks&&(this.clear(),this._colorBlindPostProcessor.colorBlindnessMode=t,this._colorBlindPostProcessor.simulate=!0,this._engine.graphicsContext.addPostProcessor(this._colorBlindPostProcessor))}clear(){this._engine.graphicsContext.removePostProcessor(this._colorBlindPostProcessor)}}class Fs{constructor(t){this.stats={currFrame:new Us,prevFrame:new Us},this.filter={useFilter:!1,nameQuery:"",ids:[]},this.entity={showAll:!1,showId:!0,showName:!1},this.transform={showAll:!1,showPosition:!1,showPositionLabel:!1,positionColor:j.Yellow,showZIndex:!1,showScale:!1,scaleColor:j.Green,showRotation:!1,rotationColor:j.Blue},this.graphics={showAll:!1,showBounds:!0,boundsColor:j.Yellow},this.collider={showAll:!1,showBounds:!0,boundsColor:j.Blue,showOwner:!1,showGeometry:!0,geometryColor:j.Green},this.physics={showAll:!1,showBroadphaseSpacePartitionDebug:!1,showCollisionNormals:!1,collisionNormalColor:j.Cyan,showCollisionContacts:!0,collisionContactColor:j.Red},this.motion={showAll:!1,showVelocity:!1,velocityColor:j.Yellow,showAcceleration:!1,accelerationColor:j.Red},this.body={showAll:!1,showCollisionGroup:!1,showCollisionType:!1,showSleeping:!1,showMotion:!1,showMass:!1},this.camera={showAll:!1,showFocus:!1,focusColor:j.Red,showZoom:!1},this._engine=t,this.colorBlindMode=new Ao(this._engine)}useTestClock(){const t=this._engine.clock,e=t.isRunning();t.stop();const i=t.toTestClock();return e&&i.start(),this._engine.clock=i,i}useStandardClock(){const t=this._engine.clock,e=t.isRunning();t.stop();const i=t.toStandardClock();return e&&i.start(),this._engine.clock=i,i}}class Us{constructor(){this._id=0,this._delta=0,this._fps=0,this._actorStats={alive:0,killed:0,ui:0,get remaining(){return this.alive-this.killed},get total(){return this.remaining+this.ui}},this._durationStats={update:0,draw:0,get total(){return this.update+this.draw}},this._physicsStats=new Wn,this._graphicsStats={drawCalls:0,drawnImages:0}}reset(t){t?(this.id=t.id,this.delta=t.delta,this.fps=t.fps,this.actors.alive=t.actors.alive,this.actors.killed=t.actors.killed,this.actors.ui=t.actors.ui,this.duration.update=t.duration.update,this.duration.draw=t.duration.draw,this._physicsStats.reset(t.physics),this.graphics.drawCalls=t.graphics.drawCalls,this.graphics.drawnImages=t.graphics.drawnImages):(this.id=this.delta=this.fps=0,this.actors.alive=this.actors.killed=this.actors.ui=0,this.duration.update=this.duration.draw=0,this._physicsStats.reset(),this.graphics.drawnImages=this.graphics.drawCalls=0)}clone(){const t=new Us;return t.reset(this),t}get id(){return this._id}set id(t){this._id=t}get delta(){return this._delta}set delta(t){this._delta=t}get fps(){return this._fps}set fps(t){this._fps=t}get actors(){return this._actorStats}get duration(){return this._durationStats}get physics(){return this._physicsStats}get graphics(){return this._graphicsStats}}class Wn{constructor(){this._pairs=0,this._collisions=0,this._contacts=new Map,this._fastBodies=0,this._fastBodyCollisions=0,this._broadphase=0,this._narrowphase=0}reset(t){t?(this.pairs=t.pairs,this.collisions=t.collisions,this.contacts=t.contacts,this.fastBodies=t.fastBodies,this.fastBodyCollisions=t.fastBodyCollisions,this.broadphase=t.broadphase,this.narrowphase=t.narrowphase):(this.pairs=this.collisions=this.fastBodies=0,this.fastBodyCollisions=this.broadphase=this.narrowphase=0,this.contacts.clear())}clone(){const t=new Wn;return t.reset(this),t}get pairs(){return this._pairs}set pairs(t){this._pairs=t}get collisions(){return this._collisions}set collisions(t){this._collisions=t}get contacts(){return this._contacts}set contacts(t){this._contacts=t}get fastBodies(){return this._fastBodies}set fastBodies(t){this._fastBodies=t}get fastBodyCollisions(){return this._fastBodyCollisions}set fastBodyCollisions(t){this._fastBodyCollisions=t}get broadphase(){return this._broadphase}set broadphase(t){this._broadphase=t}get narrowphase(){return this._narrowphase}set narrowphase(t){this._narrowphase=t}}var Hi;(function(a){a.Canvas="Canvas",a.Document="Document"})(Hi||(Hi={}));var Gn;(function(a){a.Num0="Numpad0",a.Num1="Numpad1",a.Num2="Numpad2",a.Num3="Numpad3",a.Num4="Numpad4",a.Num5="Numpad5",a.Num6="Numpad6",a.Num7="Numpad7",a.Num8="Numpad8",a.Num9="Numpad9",a.NumAdd="NumpadAdd",a.NumSubtract="NumpadSubtract",a.NumMultiply="NumpadMultiply",a.NumDivide="NumpadDivide",a.NumDecimal="NumpadDecimal",a.Numpad0="Numpad0",a.Numpad1="Numpad1",a.Numpad2="Numpad2",a.Numpad3="Numpad3",a.Numpad4="Numpad4",a.Numpad5="Numpad5",a.Numpad6="Numpad6",a.Numpad7="Numpad7",a.Numpad8="Numpad8",a.Numpad9="Numpad9",a.NumpadAdd="NumpadAdd",a.NumpadSubtract="NumpadSubtract",a.NumpadMultiply="NumpadMultiply",a.NumpadDivide="NumpadDivide",a.NumpadDecimal="NumpadDecimal",a.NumLock="NumLock",a.ShiftLeft="ShiftLeft",a.ShiftRight="ShiftRight",a.AltLeft="AltLeft",a.AltRight="AltRight",a.ControlLeft="ControlLeft",a.ControlRight="ControlRight",a.MetaLeft="MetaLeft",a.MetaRight="MetaRight",a.Key0="Digit0",a.Key1="Digit1",a.Key2="Digit2",a.Key3="Digit3",a.Key4="Digit4",a.Key5="Digit5",a.Key6="Digit6",a.Key7="Digit7",a.Key8="Digit8",a.Key9="Digit9",a.Digit0="Digit0",a.Digit1="Digit1",a.Digit2="Digit2",a.Digit3="Digit3",a.Digit4="Digit4",a.Digit5="Digit5",a.Digit6="Digit6",a.Digit7="Digit7",a.Digit8="Digit8",a.Digit9="Digit9",a.F1="F1",a.F2="F2",a.F3="F3",a.F4="F4",a.F5="F5",a.F6="F6",a.F7="F7",a.F8="F8",a.F9="F9",a.F10="F10",a.F11="F11",a.F12="F12",a.A="KeyA",a.B="KeyB",a.C="KeyC",a.D="KeyD",a.E="KeyE",a.F="KeyF",a.G="KeyG",a.H="KeyH",a.I="KeyI",a.J="KeyJ",a.K="KeyK",a.L="KeyL",a.M="KeyM",a.N="KeyN",a.O="KeyO",a.P="KeyP",a.Q="KeyQ",a.R="KeyR",a.S="KeyS",a.T="KeyT",a.U="KeyU",a.V="KeyV",a.W="KeyW",a.X="KeyX",a.Y="KeyY",a.Z="KeyZ",a.KeyA="KeyA",a.KeyB="KeyB",a.KeyC="KeyC",a.KeyD="KeyD",a.KeyE="KeyE",a.KeyF="KeyF",a.KeyG="KeyG",a.KeyH="KeyH",a.KeyI="KeyI",a.KeyJ="KeyJ",a.KeyK="KeyK",a.KeyL="KeyL",a.KeyM="KeyM",a.KeyN="KeyN",a.KeyO="KeyO",a.KeyP="KeyP",a.KeyQ="KeyQ",a.KeyR="KeyR",a.KeyS="KeyS",a.KeyT="KeyT",a.KeyU="KeyU",a.KeyV="KeyV",a.KeyW="KeyW",a.KeyX="KeyX",a.KeyY="KeyY",a.KeyZ="KeyZ",a.Semicolon="Semicolon",a.Quote="Quote",a.Comma="Comma",a.Minus="Minus",a.Period="Period",a.Slash="Slash",a.Equal="Equal",a.BracketLeft="BracketLeft",a.Backslash="Backslash",a.BracketRight="BracketRight",a.Backquote="Backquote",a.Up="ArrowUp",a.Down="ArrowDown",a.Left="ArrowLeft",a.Right="ArrowRight",a.ArrowUp="ArrowUp",a.ArrowDown="ArrowDown",a.ArrowLeft="ArrowLeft",a.ArrowRight="ArrowRight",a.Space="Space",a.Backspace="Backspace",a.Delete="Delete",a.Esc="Escape",a.Escape="Escape",a.Enter="Enter",a.NumpadEnter="NumpadEnter",a.ContextMenu="ContextMenu"})(Gn||(Gn={}));class qn extends pt{constructor(t,e,i){super(),this.key=t,this.value=e,this.originalEvent=i}}class jn extends Re{constructor(){super(),this._keys=[],this._keysUp=[],this._keysDown=[],this._handleKeyDown=t=>{const e=t.code;if(this._keys.indexOf(e)===-1){this._keys.push(e),this._keysDown.push(e);const i=new qn(e,t.key,t);this.eventDispatcher.emit("down",i),this.eventDispatcher.emit("press",i)}},this._handleKeyUp=t=>{const e=t.code,i=this._keys.indexOf(e);this._keys.splice(i,1),this._keysUp.push(e);const n=new qn(e,t.key,t);this.eventDispatcher.emit("up",n),this.eventDispatcher.emit("release",n)}}on(t,e){super.on(t,e)}init(t){if(!t)try{const e=()=>{};window.top.addEventListener("blur",e),window.top.removeEventListener("blur",e),t=window.top}catch{t=window,Y.getInstance().warn("Failed to bind to keyboard events to top frame. If you are trying to embed Excalibur in a cross-origin iframe, keyboard events will not fire.")}t.addEventListener("blur",()=>{this._keys.length=0}),t.addEventListener("keyup",this._handleKeyUp),t.addEventListener("keydown",this._handleKeyDown)}update(){this._keysDown.length=0,this._keysUp.length=0;for(let t=0;t<this._keys.length;t++)this.eventDispatcher.emit("hold",new qn(this._keys[t]))}getKeys(){return this._keys}wasPressed(t){return this._keysDown.indexOf(t)>-1}isHeld(t){return this._keys.indexOf(t)>-1}wasReleased(t){return this._keysUp.indexOf(t)>-1}triggerEvent(t,e,i){t==="down"&&this._handleKeyDown(new KeyboardEvent("keydown",{code:e,key:i??null})),t==="up"&&this._handleKeyUp(new KeyboardEvent("keyup",{code:e,key:i??null}))}}class Qn extends Re{constructor(){super(),this.enabled=!1,this.supported=!!navigator.getGamepads,this._gamePadTimeStamps=[0,0,0,0],this._oldPads=[],this._pads=[],this._initSuccess=!1,this._navigator=navigator,this._minimumConfiguration=null}init(){this.supported&&(this._initSuccess||(this._oldPads=this._clonePads(this._navigator.getGamepads()),this._oldPads.length&&this._oldPads[0]&&(this._initSuccess=!0)))}setMinimumGamepadConfiguration(t){this._enableAndUpdate(),this._minimumConfiguration=t}_enableAndUpdate(){this.enabled||(this.enabled=!0,this.update())}_isGamepadValid(t){if(!this._minimumConfiguration)return!0;if(!t)return!1;const e=t.axes.filter(n=>typeof n!==void 0).length,i=t.buttons.filter(n=>typeof n!==void 0).length;return e>=this._minimumConfiguration.axis&&i>=this._minimumConfiguration.buttons&&t.connected}on(t,e){this._enableAndUpdate(),super.on(t,e)}off(t,e){this._enableAndUpdate(),super.off(t,e)}update(){if(!this.enabled||!this.supported)return;this.init();const t=this._navigator.getGamepads();for(let e=0;e<t.length;e++){if(t[e])!this.at(e).connected&&this._isGamepadValid(t[e])&&this.eventDispatcher.emit("connect",new zs(e,this.at(e))),this.at(e).connected=!0;else{const u=this.at(e);u.connected&&this.eventDispatcher.emit("disconnect",new Oe(e,u)),u.connected=!1;continue}if(this.at(e).update(),t[e].timestamp&&t[e].timestamp===this._gamePadTimeStamps[e])continue;this._gamePadTimeStamps[e]=t[e].timestamp,this.at(e).navigatorGamepad=t[e];let i,n,o,h,d;for(i in cn)n=cn[i],typeof n=="number"&&t[e].buttons[n]&&(d=t[e].buttons[n].value,d!==this._oldPads[e].getButton(n)&&(t[e].buttons[n].pressed?(this.at(e).updateButton(n,d),this.at(e).eventDispatcher.emit("button",new di(n,d,this.at(e)))):this.at(e).updateButton(n,0)));for(o in dn)h=dn[o],typeof h=="number"&&(d=t[e].axes[h],d!==this._oldPads[e].getAxes(h)&&(this.at(e).updateAxes(h,d),this.at(e).eventDispatcher.emit("axis",new Ke(h,d,this.at(e)))));this._oldPads[e]=this._clonePad(t[e])}}at(t){if(this._enableAndUpdate(),t>=this._pads.length)for(let e=this._pads.length-1,i=t;e<i;e++)this._pads.push(new Ge),this._oldPads.push(new Ge);return this._pads[t]}getValidGamepads(){this._enableAndUpdate();const t=[];for(let e=0;e<this._pads.length;e++)this._isGamepadValid(this.at(e).navigatorGamepad)&&this.at(e).connected&&t.push(this.at(e));return t}count(){return this._pads.filter(t=>t.connected).length}_clonePads(t){const e=[];for(let i=0,n=t.length;i<n;i++)e.push(this._clonePad(t[i]));return e}_clonePad(t){let e,i;const n=new Ge;if(!t)return n;for(e=0,i=t.buttons.length;e<i;e++)t.buttons[e]&&n.updateButton(e,t.buttons[e].value);for(e=0,i=t.axes.length;e<i;e++)n.updateAxes(e,t.axes[e]);return n}}Qn.MinAxisMoveThreshold=.05;class Ge extends Re{constructor(){super(),this.connected=!1,this._axes=new Array(4),this._buttons=new Array(16),this._buttonsUp=new Array(16),this._buttonsDown=new Array(16);for(let t=0;t<this._buttons.length;t++)this._buttons[t]=0;for(let t=0;t<this._axes.length;t++)this._axes[t]=0}update(){this._buttonsDown=new Array(16),this._buttonsUp=new Array(16)}isButtonPressed(t,e=1){return this._buttons[t]>=e}isButtonHeld(t,e=1){return this._buttons[t]>=e}wasButtonPressed(t,e=1){return this._buttonsDown[t]>=e}wasButtonReleased(t){return Boolean(this._buttonsUp[t])}getButton(t){return this._buttons[t]}getAxes(t){const e=this._axes[t];return Math.abs(e)<Qn.MinAxisMoveThreshold?0:e}updateButton(t,e){e===0&&this._buttons[t]?this._buttonsUp[t]=1:this._buttonsDown[t]=e,this._buttons[t]=e}updateAxes(t,e){this._axes[t]=e}}var cn;(function(a){a[a.Face1=0]="Face1",a[a.Face2=1]="Face2",a[a.Face3=2]="Face3",a[a.Face4=3]="Face4",a[a.LeftBumper=4]="LeftBumper",a[a.RightBumper=5]="RightBumper",a[a.LeftTrigger=6]="LeftTrigger",a[a.RightTrigger=7]="RightTrigger",a[a.Select=8]="Select",a[a.Start=9]="Start",a[a.LeftStick=10]="LeftStick",a[a.RightStick=11]="RightStick",a[a.DpadUp=12]="DpadUp",a[a.DpadDown=13]="DpadDown",a[a.DpadLeft=14]="DpadLeft",a[a.DpadRight=15]="DpadRight"})(cn||(cn={}));var dn;(function(a){a[a.LeftStickX=0]="LeftStickX",a[a.LeftStickY=1]="LeftStickY",a[a.RightStickX=2]="RightStickX",a[a.RightStickY=3]="RightStickY"})(dn||(dn={}));class un{on(t,e){this._nativeHandlers[t]&&this.off(t,this._nativeHandlers[t]),this._nativeHandlers[t]=this._decorate(e),this.nativeComponent.addEventListener(t,this._nativeHandlers[t])}off(t,e){e||(e=this._nativeHandlers[t]),this.nativeComponent.removeEventListener(t,e),this._nativeHandlers[t]=null}_decorate(t){return e=>{this._paused||t(e)}}pause(){this._paused=!0}resume(){this._paused=!1}clear(){for(const t in this._nativeHandlers)this.off(t)}constructor(t){this.nativeComponent=t,this._paused=!1,this._nativeHandlers={}}}class Dr{constructor(t,e){this._windowGlobal=t,this._documentGlobal=e,this._windowComponent=new un(this._windowGlobal),this._documentComponent=new un(this._documentGlobal)}get window(){return this._windowComponent}get document(){return this._documentComponent}pause(){this.window.pause(),this.document.pause()}resume(){this.window.resume(),this.document.resume()}clear(){this.window.clear(),this.document.clear()}}class pn{static fromPagePosition(t,e,i){let n,o,h,d;arguments.length===3?(n=t,o=e,h=new k(n,o),d=i):(h=t,n=h.x,o=h.y,d=e);const u=d.screen.pageToScreenCoordinates(h),g=d.screen.screenToWorldCoordinates(u);return new pn(g,h,u)}constructor(t,e,i){this.worldPos=t,this.pagePos=e,this.screenPos=i}}class fn{cancel(){this.active=!1}get pagePos(){return this.coordinates.pagePos}get screenPos(){return this.coordinates.screenPos}get worldPos(){return this.coordinates.worldPos}constructor(t,e,i,n,o,h){this.type=t,this.pointerId=e,this.button=i,this.pointerType=n,this.coordinates=o,this.nativeEvent=h,this.active=!0}}class Co{cancel(){this.active=!1}constructor(t,e,i,n,o,h,d,u,g,v,I,D){this.x=t,this.y=e,this.pageX=i,this.pageY=n,this.screenX=o,this.screenY=h,this.index=d,this.deltaX=u,this.deltaY=g,this.deltaZ=v,this.deltaMode=I,this.ev=D,this.active=!0}}class Eo extends Re{constructor(){super(),this.lastPagePos=k.Zero,this.lastScreenPos=k.Zero,this.lastWorldPos=k.Zero,this._onPointerMove=t=>{this.lastPagePos=new k(t.pagePos.x,t.pagePos.y),this.lastScreenPos=new k(t.screenPos.x,t.screenPos.y),this.lastWorldPos=new k(t.worldPos.x,t.worldPos.y)},this._onPointerDown=t=>{this.lastPagePos=new k(t.pagePos.x,t.pagePos.y),this.lastScreenPos=new k(t.screenPos.x,t.screenPos.y),this.lastWorldPos=new k(t.worldPos.x,t.worldPos.y)},this.on("move",this._onPointerMove),this.on("down",this._onPointerDown)}on(t,e){super.on(t,e)}once(t,e){super.once(t,e)}off(t,e){super.off(t,e)}}var Ls;(function(a){a.Pixel="Pixel",a.Line="Line",a.Page="Page"})(Ls||(Ls={}));var Xi;(function(a){a[a.NoButton=-1]="NoButton",a[a.Left=0]="Left",a[a.Middle=1]="Middle",a[a.Right=2]="Right",a[a.Unknown=3]="Unknown"})(Xi||(Xi={}));var ii;(function(a){a.Left="Left",a.Middle="Middle",a.Right="Right",a.Unknown="Unknown",a.NoButton="NoButton"})(ii||(ii={}));var si;(function(a){a.Touch="Touch",a.Mouse="Mouse",a.Pen="Pen",a.Unknown="Unknown"})(si||(si={}));function So(a){return globalThis.TouchEvent&&a instanceof globalThis.TouchEvent}function Zo(a){return globalThis.PointerEvent&&a instanceof globalThis.PointerEvent}class Kn extends Re{constructor(t,e){super(),this.target=t,this.engine=e,this.primary=new Eo,this._activeNativePointerIdsToNormalized=new Map,this.lastFramePointerCoords=new Map,this.currentFramePointerCoords=new Map,this.currentFramePointerDown=new Map,this.lastFramePointerDown=new Map,this.currentFrameDown=[],this.currentFrameUp=[],this.currentFrameMove=[],this.currentFrameCancel=[],this.currentFrameWheel=[],this._pointers=[this.primary],this._boundHandle=this._handle.bind(this),this._boundWheel=this._handleWheel.bind(this)}recreate(t,e){const i=new Kn(t,e);return i.primary=this.primary,i._pointers=this._pointers,i}at(t){if(t>=this._pointers.length)for(let e=this._pointers.length-1,i=t;e<i;e++)this._pointers.push(new Eo);return this._pointers[t]}count(){return this._pointers.length}isDown(t){var e;return(e=this.currentFramePointerDown.get(t))!==null&&e!==void 0?e:!1}wasDown(t){var e;return(e=this.lastFramePointerDown.get(t))!==null&&e!==void 0?e:!1}isDragging(t){return this.isDown(t)}isDragStart(t){return this.isDown(t)&&!this.wasDown(t)}isDragEnd(t){return!this.isDown(t)&&this.wasDown(t)}on(t,e){super.on(t,e)}once(t,e){super.once(t,e)}off(t,e){super.off(t,e)}update(){this.lastFramePointerDown=new Map(this.currentFramePointerDown),this.lastFramePointerCoords=new Map(this.currentFramePointerCoords);for(const t of this.currentFrameDown)this.emit("down",t),this.at(t.pointerId).emit("down",t),this.primary.emit("pointerdown",t);for(const t of this.currentFrameUp)this.emit("up",t),this.at(t.pointerId).emit("up",t);for(const t of this.currentFrameMove)this.emit("move",t),this.at(t.pointerId).emit("move",t);for(const t of this.currentFrameCancel)this.emit("cancel",t),this.at(t.pointerId).emit("cancel",t);for(const t of this.currentFrameWheel)this.emit("wheel",t),this.primary.emit("pointerwheel",t)}clear(){for(const t of this.currentFrameUp){this.currentFramePointerCoords.delete(t.pointerId);const e=this._activeNativePointerIdsToNormalized.entries();for(const[i,n]of e)n===t.pointerId&&this._activeNativePointerIdsToNormalized.delete(i)}this.currentFrameDown.length=0,this.currentFrameUp.length=0,this.currentFrameMove.length=0,this.currentFrameCancel.length=0,this.currentFrameWheel.length=0}init(){this.target===this.engine.canvas?this.engine.canvas.style.touchAction="none":document.body.style.touchAction="none",window.PointerEvent?(this.target.addEventListener("pointerdown",this._boundHandle),this.target.addEventListener("pointerup",this._boundHandle),this.target.addEventListener("pointermove",this._boundHandle),this.target.addEventListener("pointercancel",this._boundHandle)):(this.target.addEventListener("touchstart",this._boundHandle),this.target.addEventListener("touchend",this._boundHandle),this.target.addEventListener("touchmove",this._boundHandle),this.target.addEventListener("touchcancel",this._boundHandle),this.target.addEventListener("mousedown",this._boundHandle),this.target.addEventListener("mouseup",this._boundHandle),this.target.addEventListener("mousemove",this._boundHandle));const t={passive:!(this.engine.pageScrollPreventionMode===s.All||this.engine.pageScrollPreventionMode===s.Canvas)};"onwheel"in document.createElement("div")?this.target.addEventListener("wheel",this._boundWheel,t):document.onmousewheel!==void 0?this.target.addEventListener("mousewheel",this._boundWheel,t):this.target.addEventListener("MozMousePixelScroll",this._boundWheel,t)}detach(){window.PointerEvent?(this.target.removeEventListener("pointerdown",this._boundHandle),this.target.removeEventListener("pointerup",this._boundHandle),this.target.removeEventListener("pointermove",this._boundHandle),this.target.removeEventListener("pointercancel",this._boundHandle)):(this.target.removeEventListener("touchstart",this._boundHandle),this.target.removeEventListener("touchend",this._boundHandle),this.target.removeEventListener("touchmove",this._boundHandle),this.target.removeEventListener("touchcancel",this._boundHandle),this.target.removeEventListener("mousedown",this._boundHandle),this.target.removeEventListener("mouseup",this._boundHandle),this.target.removeEventListener("mousemove",this._boundHandle)),"onwheel"in document.createElement("div")?this.target.removeEventListener("wheel",this._boundWheel):document.onmousewheel!==void 0?this.target.addEventListener("mousewheel",this._boundWheel):this.target.addEventListener("MozMousePixelScroll",this._boundWheel)}_normalizePointerId(t){this._activeNativePointerIdsToNormalized.set(t,-1);const i=Array.from(this._activeNativePointerIdsToNormalized.keys()).sort((n,o)=>n-o).findIndex(n=>n===t);return this._activeNativePointerIdsToNormalized.set(t,i),i}_handle(t){t.preventDefault();const e=new Map;let i,n;if(So(t)){i=ii.Unknown,n=si.Touch;for(let o=0;o<t.changedTouches.length;o++){const h=t.changedTouches[o],d=pn.fromPagePosition(h.pageX,h.pageY,this.engine),u=o+1,g=this._normalizePointerId(u);this.currentFramePointerCoords.set(g,d),e.set(g,d)}}else{i=this._nativeButtonToPointerButton(t.button),n=si.Mouse;const o=pn.fromPagePosition(t.pageX,t.pageY,this.engine);let h=1;Zo(t)&&(h=t.pointerId,n=this._stringToPointerType(t.pointerType));const d=this._normalizePointerId(h);this.currentFramePointerCoords.set(d,o),e.set(d,o)}for(const[o,h]of e.entries())switch(t.type){case"mousedown":case"pointerdown":case"touchstart":this.currentFrameDown.push(new fn("down",o,i,n,h,t)),this.currentFramePointerDown.set(o,!0);break;case"mouseup":case"pointerup":case"touchend":this.currentFrameUp.push(new fn("up",o,i,n,h,t)),this.currentFramePointerDown.set(o,!1);break;case"mousemove":case"pointermove":case"touchmove":this.currentFrameMove.push(new fn("move",o,i,n,h,t));break;case"touchcancel":case"pointercancel":this.currentFrameCancel.push(new fn("cancel",o,i,n,h,t));break}}_handleWheel(t){(this.engine.pageScrollPreventionMode===s.All||this.engine.pageScrollPreventionMode===s.Canvas&&t.target===this.engine.canvas)&&t.preventDefault();const e=this.engine.screen.pageToScreenCoordinates(B(t.pageX,t.pageY)),i=this.engine.screen.screenToWorldCoordinates(e),n=-1/40,o=t.deltaX||t.wheelDeltaX*n||0,h=t.deltaY||t.wheelDeltaY*n||t.wheelDelta*n||t.detail||0,d=t.deltaZ||0;let u=Ls.Pixel;t.deltaMode&&(t.deltaMode===1?u=Ls.Line:t.deltaMode===2&&(u=Ls.Page));const g=new Co(i.x,i.y,t.pageX,t.pageY,e.x,e.y,0,o,h,d,u,t);this.currentFrameWheel.push(g)}triggerEvent(t,e){const i=this.engine.screen.worldToPageCoordinates(e);window.PointerEvent?this._handle(new window.PointerEvent("pointer"+t,{pointerId:0,clientX:i.x,clientY:i.y})):this._handle(new window.MouseEvent("mouse"+t,{clientX:i.x,clientY:i.y}));const n=this.engine.currentScene.world.systemManager.get(wi),o=this.engine.currentScene.world.queryManager.createQuery(n.types);n.preupdate(),n.update(o.getEntities())}_nativeButtonToPointerButton(t){switch(t){case Xi.NoButton:return ii.NoButton;case Xi.Left:return ii.Left;case Xi.Middle:return ii.Middle;case Xi.Right:return ii.Right;case Xi.Unknown:return ii.Unknown;default:return Ot(t)}}_stringToPointerType(t){switch(t){case"touch":return si.Touch;case"mouse":return si.Mouse;case"pen":return si.Pen;default:return si.Unknown}}}class Po{constructor(t){var e;this._samplePeriod=100,this._currentFrameTime=0,this._frames=0,this._previousSampleTime=0,this._beginFrameTime=0,this._fps=t.initialFps,this._samplePeriod=(e=t.samplePeriod)!==null&&e!==void 0?e:this._samplePeriod,this._currentFrameTime=1e3/t.initialFps,this._nowFn=t.nowFn,this._previousSampleTime=this._nowFn()}start(){this._beginFrameTime=this._nowFn()}end(){this._frames++;const t=this._nowFn();this._currentFrameTime=t-this._beginFrameTime,t>=this._previousSampleTime+this._samplePeriod&&(this._fps=this._frames*1e3/(t-this._previousSampleTime),this._previousSampleTime=t,this._frames=0)}get fps(){return this._fps}get instant(){return 1e3/this._currentFrameTime}}class Mr{constructor(t){var e,i,n;this._onFatalException=()=>{},this._maxFps=1/0,this._lastTime=0,this._elapsed=1,this._scheduledCbs=[],this._totalElapsed=0,this._options=t,this.tick=t.tick,this._lastTime=(e=this.now())!==null&&e!==void 0?e:0,this._maxFps=(i=t.maxFps)!==null&&i!==void 0?i:this._maxFps,this._onFatalException=(n=t.onFatalException)!==null&&n!==void 0?n:this._onFatalException,this.fpsSampler=new Po({initialFps:60,nowFn:()=>this.now()})}elapsed(){return this._elapsed}now(){return performance.now()}toTestClock(){return new Ur({...this._options,defaultUpdateMs:16.6})}toStandardClock(){return new Fr({...this._options})}setFatalExceptionHandler(t){this._onFatalException=t}schedule(t,e=0){const i=this._totalElapsed+e;this._scheduledCbs.push([t,i])}_runScheduledCbs(){for(let t=this._scheduledCbs.length-1;t>-1;t--)this._scheduledCbs[t][1]<=this._totalElapsed&&(this._scheduledCbs[t][0](),this._scheduledCbs.splice(t,1))}update(t){try{this.fpsSampler.start();const e=this.now();let i=e-this._lastTime||1;const n=1e3/this._maxFps;if(i>=n){let o=0;n!==0&&(o=i%n,i=i-o),i>200&&(i=1),this._elapsed=t||i,this._totalElapsed+=this._elapsed,this._runScheduledCbs(),this.tick(t||i),n!==0?this._lastTime=e-o:this._lastTime=e,this.fpsSampler.end()}}catch(e){this._onFatalException(e),this.stop()}}}class Fr extends Mr{constructor(t){super(t),this._running=!1}isRunning(){return this._running}start(){if(this._running)return;this._running=!0;const t=()=>{if(this._running)try{this._requestId=window.requestAnimationFrame(t),this.update()}catch(e){throw window.cancelAnimationFrame(this._requestId),e}};t()}stop(){this._running=!1}}class Ur extends Mr{constructor(t){super({...t}),this._logger=Y.getInstance(),this._running=!1,this._currentTime=0,this._updateMs=t.defaultUpdateMs}now(){var t;return(t=this._currentTime)!==null&&t!==void 0?t:0}isRunning(){return this._running}start(){this._running=!0}stop(){this._running=!1}step(t){const e=t??this._updateMs;this._running?(this.update(e),this._currentTime+=e):this._logger.warn("The clock is not running, no step will be performed")}run(t,e){for(let i=0;i<t;i++)this.step(e??this._updateMs)}}var Jo=Gt(7379);class l{constructor(){this._toasterCss=Jo.Z.toString(),this._isInitialized=!1}_initialize(){this._isInitialized||(this._container=document.createElement("div"),this._container.id="ex-toast-container",document.body.appendChild(this._container),this._isInitialized=!0,this._styleBlock=document.createElement("style"),this._styleBlock.textContent=this._toasterCss,document.head.appendChild(this._styleBlock))}dispose(){this._container.parentElement.removeChild(this._container),this._styleBlock.parentElement.removeChild(this._styleBlock),this._isInitialized=!1}_createFragment(t){const e=document.createElement("span");return e.innerText=t,e}toast(t,e,i){this._initialize();const n=document.createElement("div");n.className="ex-toast-message";const o=t.split("[LINK]").map(v=>this._createFragment(v));if(e){const v=document.createElement("a");v.href=e,i?v.innerText=i:v.innerText=e,o.splice(1,0,v)}const h=document.createElement("div");o.forEach(v=>{h.appendChild(v)}),n.appendChild(h);const d=document.createElement("button");d.innerText="x",d.addEventListener("click",()=>{this._container.removeChild(n)}),n.appendChild(d);const u=v=>{if(v.key==="Escape")try{this._container.removeChild(n)}catch{}document.removeEventListener("keydown",u)};document.addEventListener("keydown",u);const g=this._container.firstChild;this._container.insertBefore(n,g)}}b();var s;(function(a){a[a.None=0]="None",a[a.Canvas=1]="Canvas",a[a.All=2]="All"})(s||(s={}));class r extends Re{get canvasWidth(){return this.screen.canvasWidth}get halfCanvasWidth(){return this.screen.halfCanvasWidth}get canvasHeight(){return this.screen.canvasHeight}get halfCanvasHeight(){return this.screen.halfCanvasHeight}get drawWidth(){return this.screen.drawWidth}get halfDrawWidth(){return this.screen.halfDrawWidth}get drawHeight(){return this.screen.drawHeight}get halfDrawHeight(){return this.screen.halfDrawHeight}get isHiDpi(){return this.screen.isHiDpi}get stats(){return this.debug.stats}get isFullscreen(){return this.screen.isFullScreen}get displayMode(){return this.screen.displayMode}get pixelRatio(){return this.screen.pixelRatio}get isDebug(){return this._isDebug}get snapToPixel(){return this.graphicsContext.snapToPixel}set snapToPixel(t){this.graphicsContext.snapToPixel=t}on(t,e){super.on(t,e)}once(t,e){super.once(t,e)}off(t,e){super.off(t,e)}constructor(t){var e,i,n,o,h,d;super(),this.maxFps=Number.POSITIVE_INFINITY,this.scenes={},this._suppressPlayButton=!1,this.pauseAudioWhenHidden=!0,this._isDebug=!1,this.enableCanvasTransparency=!0,this.onFatalException=I=>{Y.getInstance().fatal(I)},this._toaster=new l,this._timescale=1,this._isInitialized=!1,this._deferredGoTo=null,this._originalOptions={},this._performanceThresholdTriggered=!1,this._fpsSamples=[],this._loadingComplete=!1,this._isReady=!1,this._isReadyPromise=new Promise(I=>{this._isReadyResolve=I}),this.currentFrameElapsedMs=0,this.currentFrameLagMs=0,this._lagMs=0,this._screenShotRequests=[],t={...r._DEFAULT_ENGINE_OPTIONS,...t},this._originalOptions=t,T.freeze(),this.browser=new Dr(window,document);const u=new dr;if(!t.suppressMinimumBrowserFeatureDetection&&!(this._compatible=u.test())){const I=document.createElement("div");if(I.innerText="Sorry, your browser does not support all the features needed for Excalibur",document.body.appendChild(I),u.failedTests.forEach(function(D){const U=document.createElement("div");U.innerText="Browser feature missing "+D,document.body.appendChild(U)}),t.canvasElementId){const D=document.getElementById(t.canvasElementId);D&&D.parentElement.removeChild(D)}return}else this._compatible=!0;console.log&&!t.suppressConsoleBootMessage&&(console.log(`%cPowered by Excalibur.js (v${la})`,"background: #176BAA; color: white; border-radius: 5px; padding: 15px; font-size: 1.5em; line-height: 80px;"),console.log(`
      /| ________________
O|===|* >________________>
      \\|`),console.log("Visit","http://excaliburjs.com","for more information")),t.suppressPlayButton&&(this._suppressPlayButton=!0),this._logger=Y.getInstance(),this._logger.defaultLevel===tt.Debug&&u.logBrowserFeatures(),this._logger.debug("Building engine..."),this.canvasElementId=t.canvasElementId,t.canvasElementId?(this._logger.debug("Using Canvas element specified: "+t.canvasElementId),this.canvas=document.getElementById(t.canvasElementId)):t.canvasElement?(this._logger.debug("Using Canvas element specified:",t.canvasElement),this.canvas=t.canvasElement):(this._logger.debug("Using generated canvas element"),this.canvas=document.createElement("canvas"));let g=(e=t.displayMode)!==null&&e!==void 0?e:Ut.Fixed;t.width&&t.height||t.viewport?(t.displayMode===void 0&&(g=Ut.Fixed),this._logger.debug("Engine viewport is size "+t.width+" x "+t.height)):t.displayMode||(this._logger.debug("Engine viewport is fit"),g=Ut.FitScreen),this._originalDisplayMode=g;let v=T.isEnabled("use-canvas-context");if(!v)try{this.graphicsContext=new Ks({canvasElement:this.canvas,enableTransparency:this.enableCanvasTransparency,smoothing:t.antialiasing,backgroundColor:t.backgroundColor,snapToPixel:t.snapToPixel,useDrawSorting:t.useDrawSorting})}catch(I){this._logger.warn(`Excalibur could not load webgl for some reason (${I.message}) and loaded a Canvas 2D fallback. Some features of Excalibur will not work in this mode. 

Read more about this issue at https://excaliburjs.com/docs/webgl`),v=!0}v&&(this.graphicsContext=new xs({canvasElement:this.canvas,enableTransparency:this.enableCanvasTransparency,smoothing:t.antialiasing,backgroundColor:t.backgroundColor,snapToPixel:t.snapToPixel,useDrawSorting:t.useDrawSorting})),this.screen=new Zs({canvas:this.canvas,context:this.graphicsContext,antialiasing:(i=t.antialiasing)!==null&&i!==void 0?i:!0,browser:this.browser,viewport:(n=t.viewport)!==null&&n!==void 0?n:t.width&&t.height?{width:t.width,height:t.height}:es.SVGA,resolution:t.resolution,displayMode:g,pixelRatio:t.suppressHiDPIScaling?1:(o=t.pixelRatio)!==null&&o!==void 0?o:null}),At.filtering=t.antialiasing?te.Blended:te.Pixel,t.backgroundColor&&(this.backgroundColor=t.backgroundColor.clone()),this.maxFps=(h=t.maxFps)!==null&&h!==void 0?h:this.maxFps,this.fixedUpdateFps=(d=t.fixedUpdateFps)!==null&&d!==void 0?d:this.fixedUpdateFps,this.clock=new Fr({maxFps:this.maxFps,tick:this._mainloop.bind(this),onFatalException:I=>this.onFatalException(I)}),this.enableCanvasTransparency=t.enableCanvasTransparency,this._loader=new As,this._loader.wireEngine(this),this.debug=new Fs(this),this._initialize(t),this.rootScene=this.currentScene=new ei,this.addScene("root",this.rootScene),window.___EXCALIBUR_DEVTOOL=this}_monitorPerformanceThresholdAndTriggerFallback(){const{allow:t}=this._originalOptions.configurePerformanceCanvas2DFallback;let{threshold:e,showPlayerMessage:i}=this._originalOptions.configurePerformanceCanvas2DFallback;if(e===void 0&&(e=r._DEFAULT_ENGINE_OPTIONS.configurePerformanceCanvas2DFallback.threshold),i===void 0&&(i=r._DEFAULT_ENGINE_OPTIONS.configurePerformanceCanvas2DFallback.showPlayerMessage),!T.isEnabled("use-canvas-context")&&t&&this.ready&&!this._performanceThresholdTriggered){this._fpsSamples.length===e.numberOfFrames&&this._fpsSamples.splice(0,1),this._fpsSamples.push(this.clock.fpsSampler.fps);let n=0;for(let h=0;h<this._fpsSamples.length;h++)n+=this._fpsSamples[h];const o=n/this._fpsSamples.length;this._fpsSamples.length===e.numberOfFrames&&o<=e.fps&&(this._performanceThresholdTriggered=!0,this._logger.warn(`Switching to browser 2D Canvas fallback due to performance. Some features of Excalibur will not work in this mode.
this might mean your browser doesn't have webgl enabled or hardware acceleration is unavailable.

If in Chrome:
  * Visit Settings > Advanced > System, and ensure "Use Hardware Acceleration" is checked.
  * Visit chrome://flags/#ignore-gpu-blocklist and ensure "Override software rendering list" is "enabled"
If in Firefox, visit about:config
  * Ensure webgl.disabled = false
  * Ensure webgl.force-enabled = true
  * Ensure layers.acceleration.force-enabled = true

Read more about this issue at https://excaliburjs.com/docs/performance`),i&&this._toaster.toast("Excalibur is encountering performance issues. It's possible that your browser doesn't have hardware acceleration enabled. Visit [LINK] for more information and potential solutions.","https://excaliburjs.com/docs/performance"),this.useCanvas2DFallback(),this.emit("fallbackgraphicscontext",this.graphicsContext))}}useCanvas2DFallback(){var t,e,i;const n=this.canvas.cloneNode(!1);this.canvas.parentNode.replaceChild(n,this.canvas),this.canvas=n;const o=this._originalOptions,h=this._originalDisplayMode;this.graphicsContext=new xs({canvasElement:this.canvas,enableTransparency:this.enableCanvasTransparency,smoothing:o.antialiasing,backgroundColor:o.backgroundColor,snapToPixel:o.snapToPixel,useDrawSorting:o.useDrawSorting}),this.screen&&this.screen.dispose(),this.screen=new Zs({canvas:this.canvas,context:this.graphicsContext,antialiasing:(t=o.antialiasing)!==null&&t!==void 0?t:!0,browser:this.browser,viewport:(e=o.viewport)!==null&&e!==void 0?e:o.width&&o.height?{width:o.width,height:o.height}:es.SVGA,resolution:o.resolution,displayMode:h,pixelRatio:o.suppressHiDPIScaling?1:(i=o.pixelRatio)!==null&&i!==void 0?i:null}),this.screen.setCurrentCamera(this.currentScene.camera),this.input.pointers.detach();const d=o&&o.pointerScope===Hi.Document?document:this.canvas;this.input.pointers=this.input.pointers.recreate(d,this),this.input.pointers.init()}getWorldBounds(){return this.screen.getWorldBounds()}get timescale(){return this._timescale}set timescale(t){if(t<=0){Y.getInstance().error("Cannot set engine.timescale to a value of 0 or less than 0.");return}this._timescale=t}addTimer(t){return this.currentScene.addTimer(t)}removeTimer(t){return this.currentScene.removeTimer(t)}addScene(t,e){this.scenes[t]&&this._logger.warn("Scene",t,"already exists overwriting"),this.scenes[t]=e}removeScene(t){if(t instanceof ei)for(const e in this.scenes)this.scenes.hasOwnProperty(e)&&this.scenes[e]===t&&delete this.scenes[e];typeof t=="string"&&delete this.scenes[t]}add(t){if(arguments.length===2){this.addScene(arguments[0],arguments[1]);return}this._deferredGoTo&&this.scenes[this._deferredGoTo]?this.scenes[this._deferredGoTo].add(t):this.currentScene.add(t)}remove(t){t instanceof $t&&this.currentScene.remove(t),t instanceof ei&&this.removeScene(t),typeof t=="string"&&this.removeScene(t)}goToScene(t,e){if(!this.isInitialized){this._deferredGoTo=t;return}if(this.scenes[t]){const i=this.currentScene,n=this.scenes[t];if(this._logger.debug("Going to scene:",t),this.currentScene.isInitialized){const h={engine:this,previousScene:i,nextScene:n};this.currentScene._deactivate.apply(this.currentScene,[h,n]),this.currentScene.eventDispatcher.emit("deactivate",new Hs(h,this.currentScene))}this.currentScene=n,this.screen.setCurrentCamera(n.camera),this.currentScene._initialize(this);const o={engine:this,previousScene:i,nextScene:n,data:e};this.currentScene._activate.apply(this.currentScene,[o,n]),this.currentScene.eventDispatcher.emit("activate",new ws(o,this.currentScene))}else this._logger.error("Scene",t,"does not exist!")}screenToWorldCoordinates(t){return this.screen.screenToWorldCoordinates(t)}worldToScreenCoordinates(t){return this.screen.worldToScreenCoordinates(t)}_initialize(t){this.pageScrollPreventionMode=t.scrollPreventionMode;const e=t&&t.pointerScope===Hi.Document?document:this.canvas;this.input={keyboard:new jn,pointers:new Kn(e,this),gamepads:new Qn},this.input.keyboard.init(),this.input.pointers.init(),this.input.gamepads.init(),this.browser.document.on("visibilitychange",()=>{document.visibilityState==="hidden"?(this.eventDispatcher.emit("hidden",new Si(this)),this._logger.debug("Window hidden")):document.visibilityState==="visible"&&(this.eventDispatcher.emit("visible",new gs(this)),this._logger.debug("Window visible"))}),!this.canvasElementId&&!t.canvasElement&&document.body.appendChild(this.canvas)}onInitialize(t){}setAntialiasing(t){this.screen.antialiasing=t}getAntialiasing(){return this.screen.antialiasing}get isInitialized(){return this._isInitialized}_overrideInitialize(t){if(!this.isInitialized)if(this.onInitialize(t),super.emit("initialize",new Ji(t,this)),this._isInitialized=!0,this._deferredGoTo){const e=this._deferredGoTo;this._deferredGoTo=null,this.goToScene(e)}else this.goToScene("root")}_update(t){if(!this.ready){this._loader.update(this,t),this.input.keyboard.update(),this.input.gamepads.update();return}this._preupdate(t),this.currentScene.update(this,t),this._postupdate(t),this.input.keyboard.update(),this.input.gamepads.update()}_preupdate(t){this.emit("preupdate",new Ve(this,t,this)),this.onPreUpdate(this,t)}onPreUpdate(t,e){}_postupdate(t){this.emit("postupdate",new de(this,t,this)),this.onPostUpdate(this,t)}onPostUpdate(t,e){}_draw(t){if(this.graphicsContext.beginDrawLifecycle(),this.graphicsContext.clear(),this._predraw(this.graphicsContext,t),!this._isReady){this._loader.canvas.draw(this.graphicsContext,0,0),this.graphicsContext.flush();return}this.graphicsContext.backgroundColor=this.backgroundColor,this.currentScene.draw(this.graphicsContext,t),this._postdraw(this.graphicsContext,t),this.graphicsContext.flush(),this.graphicsContext.endDrawLifecycle(),this._checkForScreenShots()}_predraw(t,e){this.emit("predraw",new ke(t,e,this)),this.onPreDraw(t,e)}onPreDraw(t,e){}_postdraw(t,e){this.emit("postdraw",new hi(t,e,this)),this.onPostDraw(t,e)}onPostDraw(t,e){}showDebug(t){this._isDebug=t}toggleDebug(){return this._isDebug=!this._isDebug,this._isDebug}get loadingComplete(){return this._loadingComplete}get ready(){return this._isReady}isReady(){return this._isReadyPromise}async start(t){if(!this._compatible)throw new Error("Excalibur is incompatible with your browser");return t&&(this.screen.pushResolutionAndViewport(),this.screen.resolution=this.screen.viewport,this.screen.applyResolutionAndViewport(),this._loader=t,this._loader.suppressPlayButton=this._suppressPlayButton||this._loader.suppressPlayButton,this._loader.wireEngine(this)),this._logger.debug("Starting game clock..."),this.browser.resume(),this.clock.start(),this._logger.debug("Game clock started"),t&&(await this.load(this._loader),this._loadingComplete=!0,this.screen.popResolutionAndViewport(),this.screen.applyResolutionAndViewport()),this._loadingComplete=!0,this._overrideInitialize(this),this._isReady=!0,this._isReadyResolve(),this.emit("start",new Qi(this)),this._isReadyPromise}_mainloop(t){this.emit("preframe",new _s(this,this.stats.prevFrame));const e=t*this.timescale;this.currentFrameElapsedMs=e;const i=this.stats.prevFrame.id+1;this.stats.currFrame.reset(),this.stats.currFrame.id=i,this.stats.currFrame.delta=e,this.stats.currFrame.fps=this.clock.fpsSampler.fps,zt.clear();const n=this.clock.now(),o=1e3/this.fixedUpdateFps;if(this.fixedUpdateFps)for(this._lagMs+=e;this._lagMs>=o;)this._update(o),this._lagMs-=o;else this._update(e);const h=this.clock.now();this.currentFrameLagMs=this._lagMs,this._draw(e);const d=this.clock.now();this.stats.currFrame.duration.update=h-n,this.stats.currFrame.duration.draw=d-h,this.stats.currFrame.graphics.drawnImages=zt.DrawnImagesCount,this.stats.currFrame.graphics.drawCalls=zt.DrawCallCount,this.emit("postframe",new ci(this,this.stats.currFrame)),this.stats.prevFrame.reset(this.stats.currFrame),this._monitorPerformanceThresholdAndTriggerFallback()}stop(){this.clock.isRunning()&&(this.emit("stop",new Ki(this)),this.browser.pause(),this.clock.stop(),this._logger.debug("Game stopped"))}isRunning(){return this.clock.isRunning()}screenshot(t=!1){return new Promise(i=>{this._screenShotRequests.push({preserveHiDPIResolution:t,resolve:i})})}_checkForScreenShots(){for(const t of this._screenShotRequests){const e=t.preserveHiDPIResolution?this.canvas.width:this.screen.resolution.width,i=t.preserveHiDPIResolution?this.canvas.height:this.screen.resolution.height,n=document.createElement("canvas");n.width=e,n.height=i;const o=n.getContext("2d");o.imageSmoothingEnabled=this.screen.antialiasing,o.drawImage(this.canvas,0,0,e,i);const h=new Image,d=n.toDataURL("image/png");h.src=d,t.resolve(h)}this._screenShotRequests.length=0}async load(t){try{await t.load()}catch(e){this._logger.error("Error loading resources, things may not behave properly",e),await Promise.resolve()}}}r._DEFAULT_ENGINE_OPTIONS={width:0,height:0,enableCanvasTransparency:!0,useDrawSorting:!0,configurePerformanceCanvas2DFallback:{allow:!0,showPlayerMessage:!1,threshold:{fps:20,numberOfFrames:100}},canvasElementId:"",canvasElement:void 0,snapToPixel:!1,pointerScope:Hi.Canvas,suppressConsoleBootMessage:null,suppressMinimumBrowserFeatureDetection:null,suppressHiDPIScaling:null,suppressPlayButton:null,scrollPreventionMode:s.Canvas,backgroundColor:j.fromHex("#2185d0")};class c extends gi{get font(){return this._font}set font(t){this._font=t,this._text.font=t}get text(){return this._text.text}set text(t){this._text.text=t}get color(){return this._text.color}set color(t){this._text&&(this._text.color=t)}get opacity(){return this._text.opacity}set opacity(t){this._text.opacity=t}get spriteFont(){return this._spriteFont}set spriteFont(t){t&&(this._spriteFont=t,this._text.font=this._spriteFont)}constructor(t){super(t),this._font=new Is,this._text=new ls({text:"",font:this._font});const{text:e,pos:i,x:n,y:o,spriteFont:h,font:d,color:u}=t;this.pos=i??(n&&o?B(n,o):this.pos),this.text=e??this.text,this.font=d??this.font,this.spriteFont=h??this.spriteFont,this._text.color=u??this.color;const g=this.get(le);g.anchor=k.Zero,g.use(this._text)}_initialize(t){super._initialize(t)}getTextWidth(){return this._text.width}}class _ extends $t{getGraphics(){return this._graphics}addGraphic(t){this._graphics.push(t),this._gfx.visible=!0,this._gfx.localBounds=this._recalculateBounds()}_recalculateBounds(){let t=this._tileBounds.clone();for(const e of this._graphics){const i=B(this.map.graphicsOffset.x-this.map.tileWidth/2,this.map.graphicsOffset.y-(this.map.renderFromTopOfGraphic?0:e.height-this.map.tileHeight));t=t.combine(e.localBounds.translate(i))}return t}removeGraphic(t){const e=this._graphics.indexOf(t);e>-1&&this._graphics.splice(e,1),this._gfx.localBounds=this._recalculateBounds()}clearGraphics(){this._graphics.length=0,this._gfx.visible=!1,this._gfx.localBounds=this._recalculateBounds()}getColliders(){return this._colliders}addCollider(t){this._colliders.push(t),this.map.flagCollidersDirty()}removeCollider(t){const e=this._colliders.indexOf(t);e>-1&&this._colliders.splice(e,1),this.map.flagCollidersDirty()}clearColliders(){this._colliders.length=0,this.map.flagCollidersDirty()}get pos(){return this.map.tileToWorld(B(this.x,this.y))}get center(){return this.pos.add(B(0,this.map.tileHeight/2))}constructor(t,e,i,n){super([new $,new le({offset:i??k.Zero,onPostDraw:(D,U)=>this.draw(D,U)}),new Hn(n)]),this.solid=!1,this._tileBounds=new nt,this._graphics=[],this._colliders=[],this.x=t,this.y=e,this.map=n,this._transform=this.get($),this._isometricEntityComponent=this.get(Hn);const o=this.map.tileWidth/2,h=this.map.tileHeight/2,d=(this.x-this.y)*o,u=(this.x+this.y)*h;this._transform.pos=B(d,u),this._isometricEntityComponent.elevation=0,this._gfx=this.get(le),this._gfx.visible=!1;const g=this.map.tileWidth,v=this.map.tileHeight,I=B(0,this.map.renderFromTopOfGraphic?v:0);this._gfx.localBounds=this._tileBounds=new nt({left:-g/2,top:-v,right:g/2,bottom:v}).translate(I)}draw(t,e){const i=this.map.tileWidth/2;t.save(),t.translate(-i,0);for(const n of this._graphics)n.draw(t,this.map.graphicsOffset.x,this.map.graphicsOffset.y-(this.map.renderFromTopOfGraphic?0:n.height-this.map.tileHeight));t.restore()}}class x extends $t{constructor(t){super([new $,new vt({type:dt.Fixed}),new Kt,new Un(g=>this.debug(g),!1)],t.name),this.renderFromTopOfGraphic=!1,this.graphicsOffset=B(0,0),this._collidersDirty=!1,this._originalOffsets=new WeakMap;const{pos:e,tileWidth:i,tileHeight:n,columns:o,rows:h,renderFromTopOfGraphic:d,graphicsOffset:u}=t;this.transform=this.get($),e&&(this.transform.pos=e),this.collider=this.get(Kt),this.collider&&this.collider.set(this._composite=new Wt([])),this.renderFromTopOfGraphic=d??this.renderFromTopOfGraphic,this.graphicsOffset=u??this.graphicsOffset,this.tileWidth=i,this.tileHeight=n,this.columns=o,this.rows=h,this.tiles=new Array(o*h);for(let g=0;g<h;g++)for(let v=0;v<o;v++){const I=new _(v,g,this.graphicsOffset,this);this.tiles[v+g*o]=I,this.addChild(I)}}update(){this._collidersDirty&&(this.updateColliders(),this._collidersDirty=!1)}flagCollidersDirty(){this._collidersDirty=!0}_getOrSetColliderOriginalOffset(t){if(this._originalOffsets.has(t))return this._originalOffsets.get(t);{const e=t.offset;return this._originalOffsets.set(t,e),e}}updateColliders(){this._composite.clearColliders();const t=this.get($).pos;for(const e of this.tiles)if(e.solid)for(const i of e.getColliders()){const n=this._getOrSetColliderOriginalOffset(i);i.offset=this.tileToWorld(B(e.x,e.y)).sub(t).add(n).sub(B(this.tileWidth/2,this.tileHeight)),i.owner=this,this._composite.addCollider(i)}this.collider.update()}worldToTile(t){t=t.sub(this.transform.globalPos);const e=this.tileWidth/2,i=this.tileHeight/2;return B(~~((t.x/e+t.y/i)/2),~~((t.y/i-t.x/e)/2))}tileToWorld(t){const e=this.tileWidth/2,i=this.tileHeight/2,n=(t.x-t.y)*e,o=(t.x+t.y)*i;return B(n,o).add(this.transform.pos)}getTile(t,e){return t<0||e<0||t>=this.columns||e>=this.rows?null:this.tiles[t+e*this.columns]}getTileByPoint(t){const e=this.worldToTile(t);return this.getTile(e.x,e.y)}_getMaxZIndex(){let t=Number.NEGATIVE_INFINITY;for(const e of this.tiles){const i=e.get($).z;i>t&&(t=i)}return t}debug(t){t.save(),t.z=this._getMaxZIndex()+.5;for(let e=0;e<this.rows+1;e++){const i=this.tileToWorld(B(0,e)),n=this.tileToWorld(B(this.columns,e));t.drawLine(i,n,j.Red,2)}for(let e=0;e<this.columns+1;e++){const i=this.tileToWorld(B(e,0)),n=this.tileToWorld(B(e,this.rows));t.drawLine(i,n,j.Red,2)}for(const e of this.tiles)t.drawCircle(this.tileToWorld(B(e.x,e.y)),3,j.Yellow);t.restore()}}class S{constructor(t,e){this._stopped=!1,this._sequenceBuilder=e,this._sequenceContext=new Ps(t),this._actionQueue=this._sequenceContext.getQueue(),this._sequenceBuilder(this._sequenceContext)}update(t){this._actionQueue.update(t)}isComplete(){return this._stopped||this._actionQueue.isComplete()}stop(){this._stopped=!0}reset(){this._stopped=!1,this._actionQueue.reset()}clone(t){return new S(t,this._sequenceBuilder)}}class O{constructor(t){this._actions=t}update(t){for(let e=0;e<this._actions.length;e++)this._actions[e].update(t)}isComplete(t){return this._actions.every(e=>e.isComplete(t))}reset(){this._actions.forEach(t=>t.reset())}stop(){this._actions.forEach(t=>t.stop())}}class G{static create(t,e){if(this._CURRENT_GROUP>this._MAX_GROUPS)throw new Error(`Cannot have more than ${this._MAX_GROUPS} collision groups`);if(this._GROUPS.get(t))throw new Error(`Collision group ${t} already exists`);const i=new Pe(t,this._CURRENT_BIT,e!==void 0?e:~this._CURRENT_BIT);return this._CURRENT_BIT=this._CURRENT_BIT<<1|0,this._CURRENT_GROUP++,this._GROUPS.set(t,i),i}static get groups(){return Array.from(this._GROUPS.values())}static groupByName(t){return this._GROUPS.get(t)}static reset(){this._GROUPS=new Map,this._CURRENT_BIT=this._STARTING_BIT,this._CURRENT_GROUP=1}}G._STARTING_BIT=1,G._MAX_GROUPS=32,G._CURRENT_GROUP=1,G._CURRENT_BIT=G._STARTING_BIT,G._GROUPS=new Map;function it(a){return!!a._initialize}function xt(a){return!!a.onInitialize}function Zt(a){return!!a._preupdate}function Fe(a){return!!a.onPreUpdate}function Ce(a){return!!a.onPostUpdate}function Wi(a){return!!a.onPostUpdate}function Zn(a){return!!a.onPreDraw}function Lr(a){return!!a.onPostDraw}class Vr{constructor(t,e=j.Magenta,i=!0){this.path=t,this.color=e,this.bustCache=i,this._stream=null,this._gif=null,this._textures=[],this._animation=null,this._transparentColor=null,this._resource=new Ti(t,"arraybuffer",i),this._transparentColor=e}async load(){const t=await this._resource.load();this._stream=new To(t),this._gif=new ko(this._stream,this._transparentColor);const e=this._gif.images.map(i=>new vn(i.src,!1));return await Promise.all(e.map(i=>i.load())),this.data=this._textures=e}isLoaded(){return!!this.data}toSprite(t=0){return this._textures[t].toSprite()}toSpriteSheet(){const t=this._textures.map(e=>e.toSprite());return new $i({sprites:t})}toAnimation(t){const e=this.toSpriteSheet(),i=e.sprites.length;return this._animation=zi.fromSpriteSheet(e,Q(0,i),t),this._animation}get readCheckBytes(){return this._gif.checkBytes}}const cs=a=>a.reduce(function(t,e){return t*2+e},0),Vs=a=>{const t=[];for(let e=7;e>=0;e--)t.push(!!(a&1<<e));return t};class To{constructor(t){if(this.data=null,this.len=0,this.position=0,this.readByte=()=>{if(this.position>=this.data.byteLength)throw new Error("Attempted to read past end of stream.");return this.data[this.position++]},this.readBytes=e=>{const i=[];for(let n=0;n<e;n++)i.push(this.readByte());return i},this.read=e=>{let i="";for(let n=0;n<e;n++)i+=String.fromCharCode(this.readByte());return i},this.readUnsigned=()=>{const e=this.readBytes(2);return(e[1]<<8)+e[0]},this.data=new Uint8Array(t),this.len=this.data.byteLength,this.len===0)throw new Error("No data loaded from file")}}const Yo=function(a,t){let e=0;const i=function(D){let U=0;for(let H=0;H<D;H++)t.charCodeAt(e>>3)&1<<(e&7)&&(U|=1<<H),e++;return U},n=[],o=1<<a,h=o+1;let d=a+1,u=[];const g=function(){u=[],d=a+1;for(let D=0;D<o;D++)u[D]=[D];u[o]=[],u[h]=null};let v,I;for(;;){if(I=v,v=i(d),v===o){g();continue}if(v===h)break;if(v<u.length)I!==o&&u.push(u[I].concat(u[v][0]));else{if(v!==u.length)throw new Error("Invalid LZW code.");u.push(u[I].concat(u[I][0]))}n.push.apply(n,u[v]),u.length===1<<d&&d<12&&d++}return n};class ko{constructor(t,e=j.Magenta){this._st=null,this._handler={},this._transparentColor=null,this.frames=[],this.images=[],this.globalColorTable=[],this.checkBytes=[],this.parseColorTable=i=>{const n=[];for(let o=0;o<i;o++){const d="#"+this._st.readBytes(3).map(u=>{const g=u.toString(16);return g.length===1?"0"+g:g}).join("");n.push(d)}return n},this.readSubBlocks=()=>{let i,n;n="";do i=this._st.readByte(),n+=this._st.read(i);while(i!==0);return n},this.parseHeader=()=>{const i={sig:null,ver:null,width:null,height:null,colorRes:null,globalColorTableSize:null,gctFlag:null,sorted:null,globalColorTable:[],bgColor:null,pixelAspectRatio:null};if(i.sig=this._st.read(3),i.ver=this._st.read(3),i.sig!=="GIF")throw new Error("Not a GIF file.");i.width=this._st.readUnsigned(),i.height=this._st.readUnsigned();const n=Vs(this._st.readByte());i.gctFlag=n.shift(),i.colorRes=cs(n.splice(0,3)),i.sorted=n.shift(),i.globalColorTableSize=cs(n.splice(0,3)),i.bgColor=this._st.readByte(),i.pixelAspectRatio=this._st.readByte(),i.gctFlag&&(i.globalColorTable=this.parseColorTable(1<<i.globalColorTableSize+1),this.globalColorTable=i.globalColorTable),this._handler.hdr&&this._handler.hdr(i)&&this.checkBytes.push(this._handler.hdr)},this.parseExt=i=>{const n=g=>{this.checkBytes.push(this._st.readByte());const v=Vs(this._st.readByte());g.reserved=v.splice(0,3),g.disposalMethod=cs(v.splice(0,3)),g.userInput=v.shift(),g.transparencyGiven=v.shift(),g.delayTime=this._st.readUnsigned(),g.transparencyIndex=this._st.readByte(),g.terminator=this._st.readByte(),this._handler.gce&&this._handler.gce(g)&&this.checkBytes.push(this._handler.gce)},o=g=>{g.comment=this.readSubBlocks(),this._handler.com&&this._handler.com(g)&&this.checkBytes.push(this._handler.com)},h=g=>{this.checkBytes.push(this._st.readByte()),g.ptHeader=this._st.readBytes(12),g.ptData=this.readSubBlocks(),this._handler.pte&&this._handler.pte(g)&&this.checkBytes.push(this._handler.pte)},d=g=>{const v=D=>{this.checkBytes.push(this._st.readByte()),D.unknown=this._st.readByte(),D.iterations=this._st.readUnsigned(),D.terminator=this._st.readByte(),this._handler.app&&this._handler.app.NETSCAPE&&this._handler.app.NETSCAPE(D)&&this.checkBytes.push(this._handler.app)},I=D=>{D.appData=this.readSubBlocks(),this._handler.app&&this._handler.app[D.identifier]&&this._handler.app[D.identifier](D)&&this.checkBytes.push(this._handler.app[D.identifier])};switch(this.checkBytes.push(this._st.readByte()),g.identifier=this._st.read(8),g.authCode=this._st.read(3),g.identifier){case"NETSCAPE":v(g);break;default:I(g);break}},u=g=>{g.data=this.readSubBlocks(),this._handler.unknown&&this._handler.unknown(g)&&this.checkBytes.push(this._handler.unknown)};switch(i.label=this._st.readByte(),i.label){case 249:i.extType="gce",n(i);break;case 254:i.extType="com",o(i);break;case 1:i.extType="pte",h(i);break;case 255:i.extType="app",d(i);break;default:i.extType="unknown",u(i);break}},this.parseImg=i=>{const n=(d,u)=>{const g=new Array(d.length),v=d.length/u,I=(Z,K)=>{const z=d.slice(K*u,(K+1)*u);g.splice.apply(g,[Z*u,u].concat(z))},D=[0,4,2,1],U=[8,8,4,2];let H=0;for(let Z=0;Z<4;Z++)for(let K=D[Z];K<v;K+=U[Z])I(K,H),H++;return g};i.leftPos=this._st.readUnsigned(),i.topPos=this._st.readUnsigned(),i.width=this._st.readUnsigned(),i.height=this._st.readUnsigned();const o=Vs(this._st.readByte());i.lctFlag=o.shift(),i.interlaced=o.shift(),i.sorted=o.shift(),i.reserved=o.splice(0,2),i.lctSize=cs(o.splice(0,3)),i.lctFlag&&(i.lct=this.parseColorTable(1<<i.lctSize+1)),i.lzwMinCodeSize=this._st.readByte();const h=this.readSubBlocks();i.pixels=Yo(i.lzwMinCodeSize,h),i.interlaced&&(i.pixels=n(i.pixels,i.width)),this.frames.push(i),this.arrayToImage(i),this._handler.img&&this._handler.img(i)&&this.checkBytes.push(this._handler)},this.parseBlock=()=>{const i={sentinel:this._st.readByte(),type:""};switch(String.fromCharCode(i.sentinel)){case"!":i.type="ext",this.parseExt(i);break;case",":i.type="img",this.parseImg(i);break;case";":i.type="eof",this._handler.eof&&this._handler.eof(i)&&this.checkBytes.push(this._handler.eof);break;default:throw new Error("Unknown block: 0x"+i.sentinel.toString(16))}i.type!=="eof"&&this.parseBlock()},this.arrayToImage=i=>{let n=0;const o=document.createElement("canvas");o.id=n.toString(),o.width=i.width,o.height=i.height,n++;const h=o.getContext("2d"),d=1;let u=0,g=0;for(let I=0;I<i.pixels.length;I++)g%i.width===0&&(u++,g=0),this.globalColorTable[i.pixels[I]]===this._transparentColor.toHex()?h.fillStyle="rgba(0, 0, 0, 0)":h.fillStyle=this.globalColorTable[i.pixels[I]],h.fillRect(g,u,d,d),g++;const v=new Image;v.src=o.toDataURL(),this.images.push(v)},this._st=t,this._handler={},this._transparentColor=e,this.parseHeader(),this.parseBlock()}}class $o extends ne{constructor(t){super(),this.color=j.Black,this.thickness=1;const{start:e,end:i,color:n,thickness:o}=t;this.start=e,this.end=i,this.color=n??this.color,this.thickness=o??this.thickness;const{width:h,height:d}=nt.fromPoints([e,i]);this.width=h,this.height=d}_drawImage(t,e,i){t.drawLine(this.start,this.end,this.color,this.thickness)}clone(){return new $o({start:this.start,end:this.end,color:this.color,thickness:this.thickness})}}class ta extends Ht{get points(){return this._points}set points(t){this._points=t;const e=this.minPoint;this.width=this._points.reduce((i,n)=>Math.max(n.x,i),0)-e.x,this.height=this._points.reduce((i,n)=>Math.max(n.y,i),0)-e.y,this.flagDirty()}get minPoint(){const t=this._points.reduce((i,n)=>Math.min(n.x,i),1/0),e=this._points.reduce((i,n)=>Math.min(n.y,i),1/0);return B(t,e)}constructor(t){super(t),this.points=t.points,this.filtering=te.Blended,this.rasterize()}clone(){return new ta({points:this.points.map(t=>t.clone()),...this.cloneGraphicOptions(),...this.cloneRasterOptions()})}execute(t){if(this.points&&this.points.length){t.beginPath();const e=this.minPoint.negate(),i=this.points[0].add(e);t.moveTo(i.x,i.y),this.points.forEach(n=>{t.lineTo(n.x+e.x,n.y+e.y)}),t.lineTo(i.x,i.y),t.closePath(),this.color&&t.fill(),this.strokeColor&&t.stroke()}}}class Ta{constructor(){this._queue=[]}get length(){return this._queue.length}enqueue(){const t=new Ft;return this._queue.push(t),t.promise}dequeue(t){this._queue.shift().resolve(t)}}class ka{constructor(t){this._count=t,this._waitQueue=new Ta}get count(){return this._count}get waiting(){return this._waitQueue.length}async enter(){return this._count!==0?(this._count--,Promise.resolve()):this._waitQueue.enqueue()}exit(t=1){if(t!==0){for(;t!==0&&this._waitQueue.length!==0;)this._waitQueue.dequeue(null),t--;this._count+=t}}}const la="0.28.0-alpha.627+4b1f36b";b()})();var Da=C.fWn,Ma=C.Ia8,Fa=C.rqv,Ua=C.hLI,La=C.yyv,Va=C.tX5,Ei=C.vtX,Oa=C.r7K,za=C.lCh,Na=C.cE4,ds=C.fwF,Ha=C.sce,ia=C._c7,Xa=C.KUs,Wa=C.Ajp,Ga=C.RDh,$n=C._H9,qa=C.mxs,ja=C.OmD,Qa=C.kBf,Ka=C.C4F,Za=C.NQt,Ja=C.JjN,Ya=C.V1s,$a=C.Xz7,tl=C.Cdc,el=C.FKn,il=C.wTW,sl=C.SUY,nl=C.ab2,rl=C.GfZ,ol=C.YMS,al=C.oyv,ll=C.aUb,hl=C.SdD,cl=C.JUv,dl=C.jEj,ul=C.TFq,pl=C.HDU,fl=C.R_y,_l=C.ydN,gl=C.t50,ml=C.s$$,qi=C.v2G,Ai=C.Ilk,vl=C.s9i,wl=C.dxL,bl=C.LLX,xl=C.wA2,yl=C.R_p,Al=C.IQ$,Cl=C.I5F,El=C.X8$,Sl=C.FR6,Pl=C.U8o,Tl=C.kbG,kl=C.iS_,Il=C.cGG,Rl=C.RPN,Bl=C.skb,Dl=C.SLU,Ml=C.RdJ,Fl=C.cNu,Ul=C.gU7,Ll=C.LSk,Ro=C.Nmp,ga=C.d1Y,Vl=C.xrL,Ol=C.sRW,zl=C.cmV,Nl=C.qWz,Hl=C.N0Q,Xl=C.q8b,Wl=C.ynB,Gl=C.jT9,ql=C.wAz,ma=C.D4V,jl=C.N6H,Ql=C.W1A,Kl=C.JHW,Zl=C.v2K,Jl=C.pBf,Yl=C.GMl,$l=C.zW2,th=C.B0K,eh=C.Nv7,ih=C.C_p,sh=C.iqw,nh=C.MUA,rh=C.xqU,oh=C.pTp,ah=C.vUK,lh=C.j9l,Ci=C.Zxw,hh=C.v51,tr=C.Hdx,ch=C.Z$d,dh=C.iqV,uh=C.o$7,ph=C.olM,fh=C.Zm$,_h=C.$QH,gh=C.i78,mh=C.h6u,vh=C.hts,wh=C.j88,bh=C.VME,xh=C.nt,yh=C.Ukr,Ah=C.zsu,Ch=C.oA6,Eh=C.TVh,Sh=C.TwZ,Ph=C.GTT,Th=C.xxj,kh=C.XdK,Ih=C.Jmb,St=C.cXo,Rh=C.Dm5,je=C.IIB,Bh=C.zI0,Dh=C.LYD,Mh=C.cEG,Fh=C.SEl,Uh=C.t9V,Lh=C.SKZ,Bo=C.__J,Vh=C.RI$,Oh=C.x12,zh=C.ccz,va=C.aNw,Nh=C.xwn,Hh=C.dNK,Xh=C.ini,Wh=C.YdH,Gh=C.y3G,qh=C.l57,jh=C.xn0,Qh=C.t2V,Kh=C.uxB,Zh=C.cpd,Jh=C.fiy,Yh=C.$XZ,$h=C.uqK,tc=C.STE,ec=C.y$z,ic=C.mAD,sc=C.sOq,nc=C.hUw,rc=C._0G,oc=C.Sqs,ac=C.hpZ,lc=C.Vol,hc=C.vYX,cc=C.wIZ,dc=C.cBi,uc=C.c30,pc=C.RFv,fc=C.kfC,_c=C.mgq,gc=C.YVA,mc=C.Kgp,vc=C.HH$,wc=C.M_d,bc=C.rgh,xc=C.Ra6,yc=C.KhR,Ac=C.BS5,Cc=C.xhz,Ec=C.xOq,Sc=C.a9j,Pc=C.bHk,Tc=C.CgK,kc=C.cuY,Ic=C.kvE,Rc=C.SBu,Bc=C.AE_,Dc=C.ctO,Mc=C.OLH,Fc=C.kky,Uc=C.nSF,Lc=C.zHn,Vc=C.zwx,Oc=C.AeJ,zc=C.hLz,Nc=C.D9g,Hc=C.wA,Xc=C.jhr,wa=C.GVs,Wc=C._zO,Gc=C.w6$,qc=C.mhV,ba=C.MOD,jc=C.kwd,Qc=C.Lmr,Mo=C.xsS,Kc=C.lLr,Zc=C.Z$r,Ee=C.IXb,Jc=C.SGH,Yc=C.SMj,$c=C.L34,td=C.exe,zr=C.bnF,ed=C.MFA,ni=C.$uU,Jn=C.jyi,id=C.E03,ji=C.V6q,sd=C.rg2,nd=C.DVW,rd=C.nVo,od=C.F6N,ad=C.xP7,ld=C.Odq,hd=C.Zif,cd=C.ZGJ,dd=C.MJk,Os=C.xvT,er=C.PHM,ud=C.dpR,pd=C.n9L,xa=C.KwO,fd=C.B7y,_d=C.x7r,gd=C.wx7,md=C.Uvn,vd=C.OFT,wd=C.xzN,bd=C.M5Z,xd=C.ZrN,bt=C.OWs,yd=C.dF9,Ad=C.oZy,Cd=C.rD2,Ed=C.VHo,Sd=C.ohE,Pd=C.R$E,Td=C.q3I,kd=C.Pab,Id=C.uZ5,Rd=C.McK,Bd=C.F9c,Dd=C.k0b,Md=C.hnT,Fd=C.RSJ,Ud=C.Mku,Ld=C.h90,Vd=C.rms,Od=C.ErP,zd=C.aVg,Nd=C.lPc,Hd=C.Z8E,Xd=C._N2,Wd=C.yFn,Gd=C.lNv,qd=C.cu9,jd=C.MZQ,Qd=C.FUM,Kd=C.BxR,we=C.vdf,Zd=C.iaL,ya=C.w6H,Jd=C.Q4c,Yd=C.Xxe,$d=C.Uxb,tu=C.Yr5,Rt=C.Bhw,eu=C.yOA;const iu=Object.freeze(Object.defineProperty({__proto__:null,ActionContext:Da,ActionQueue:Ma,ActionSequence:Fa,ActionsComponent:Ua,ActionsSystem:La,ActivateEvent:Va,Actor:Ei,AddedComponent:Oa,AddedEntity:za,AffineMatrix:Na,Animation:ds,AnimationDirection:Ha,AnimationStrategy:ia,ArcadeSolver:Xa,AudioContextFactory:Wa,Axis:Ga,BaseAlign:$n,Blink:qa,BodyComponent:ja,BoundingBox:Qa,BroadphaseStrategy:Ka,BrowserComponent:Za,BrowserEvents:Ja,Camera:Ya,Canvas:$a,Circle:tl,CircleCollider:el,Class:il,Clock:sl,ClosestLine:nl,ClosestLineJumpTable:rl,Collider:ol,ColliderComponent:al,CollisionContact:ll,CollisionEndEvent:hl,CollisionGroup:cl,CollisionGroupManager:dl,CollisionJumpTable:ul,CollisionPostSolveEvent:pl,CollisionPreSolveEvent:fl,CollisionResolutionStrategy:_l,CollisionStartEvent:gl,CollisionSystem:ml,CollisionType:qi,Color:Ai,ColorBlindFlags:vl,ColorBlindnessMode:wl,ColorBlindnessPostProcessor:bl,Component:xl,CompositeCollider:yl,Configurable:Al,ConsoleAppender:Cl,ContactConstraintPoint:El,ContactEndEvent:Sl,ContactStartEvent:Pl,CoordPlane:Tl,DeactivateEvent:kl,Debug:Il,DebugGraphicsComponent:Rl,DebugSystem:Bl,DebugText:Dl,DegreeOfFreedom:Ml,Delay:Fl,Detector:Ul,Die:Ll,Direction:Ro,DisplayMode:ga,DynamicTree:Vl,DynamicTreeCollisionProcessor:Ol,EX_VERSION:zl,EaseBy:Nl,EaseTo:Hl,EasingFunctions:Xl,EdgeCollider:Wl,ElasticToActorStrategy:Gl,EmitterType:ql,Engine:ma,EnterTriggerEvent:jl,EnterViewPortEvent:Ql,Entity:Kl,EntityManager:Zl,EventDispatcher:Jl,EventTypes:Yl,Events:$l,ExResponse:th,ExcaliburGraphicsContext2DCanvas:eh,ExcaliburGraphicsContextWebGL:ih,ExcaliburWebGLContextAccessor:sh,ExitTriggerEvent:nh,ExitViewPortEvent:rh,Fade:oh,Flags:ah,Follow:lh,Font:Ci,FontCache:hh,FontStyle:tr,FontUnit:ch,FpsSampler:dh,FrameStats:uh,Future:ph,GameEvent:fh,GameStartEvent:_h,GameStopEvent:gh,GamepadAxisEvent:mh,GamepadButtonEvent:vh,GamepadConnectEvent:wh,GamepadDisconnectEvent:bh,Gif:xh,GlobalCoordinates:yh,Graphic:Ah,GraphicsComponent:Ch,GraphicsGroup:Eh,GraphicsLayer:Sh,GraphicsLayers:Ph,GraphicsSystem:Th,HiddenEvent:kh,ImageFiltering:Ih,ImageSource:St,InitializeEvent:Rh,Input:je,Integrator:Bh,IsometricEntityComponent:Dh,IsometricEntitySystem:Mh,IsometricMap:Fh,IsometricTile:Uh,KillEvent:Lh,Label:Bo,LimitCameraBoundsStrategy:Vh,Line:Oh,LineSegment:zh,Loader:va,LockCameraToActorAxisStrategy:Nh,LockCameraToActorStrategy:Hh,LogLevel:Xh,Logger:Wh,Matrix:Gh,MatrixLocations:qh,MediaEvent:jh,Meet:Qh,MotionComponent:Kh,MotionSystem:Zh,MoveBy:Jh,MoveTo:Yh,NativeSoundEvent:$h,NativeSoundProcessedEvent:tc,Observable:ec,OffscreenSystem:ic,Pair:sc,ParallaxComponent:nc,ParallelActions:rc,ParseGif:oc,Particle:ac,ParticleEmitter:lc,ParticleTransform:hc,Physics:cc,PhysicsStats:dc,PhysicsWorld:uc,PointerComponent:pc,PointerSystem:fc,Polygon:_c,PolygonCollider:gc,Pool:mc,PostCollisionEvent:vc,PostDebugDrawEvent:wc,PostDrawEvent:bc,PostFrameEvent:xc,PostKillEvent:yc,PostUpdateEvent:Ac,PreCollisionEvent:Cc,PreDebugDrawEvent:Ec,PreDrawEvent:Sc,PreFrameEvent:Pc,PreKillEvent:Tc,PreUpdateEvent:kc,Projection:Ic,QuadIndexBuffer:Rc,Query:Bc,QueryManager:Dc,RadiusAroundActorStrategy:Mc,Random:Fc,Raster:Uc,Ray:Lc,RealisticSolver:Vc,Rectangle:Oc,RemovedComponent:zc,RemovedEntity:Nc,Repeat:Hc,RepeatForever:Xc,Resolution:wa,Resource:Wc,RotateBy:Gc,RotateTo:qc,RotationType:ba,ScaleBy:jc,ScaleTo:Qc,Scene:Mo,Screen:Kc,ScreenAppender:Zc,ScreenElement:Ee,ScreenShader:Jc,ScrollPreventionMode:Yc,Semaphore:$c,Shader:td,Shape:zr,Side:ed,Sound:ni,Sprite:Jn,SpriteFont:id,SpriteSheet:ji,StandardClock:sd,StateMachine:nd,StrategyContainer:rd,Stream:od,System:ad,SystemManager:ld,SystemType:hd,TagComponent:cd,TestClock:dd,Text:Os,TextAlign:er,TextureLoader:ud,Tile:pd,TileMap:xa,Timer:fd,Toaster:_d,Transform:gd,TransformComponent:md,TreeNode:vd,Trigger:wd,TwoPI:bd,Util:xd,Vector:bt,VectorView:yd,VertexBuffer:Ad,VertexLayout:Cd,VisibleEvent:Ed,WebAudio:Sd,WebAudioInstance:Pd,World:Td,canonicalizeAngle:kd,clamp:Id,createId:Rd,frac:Bd,hasGraphicsTick:Dd,hasOnInitialize:Md,hasOnPostUpdate:Fd,hasOnPreUpdate:Ud,hasPostDraw:Ld,hasPreDraw:Vd,has_initialize:Od,has_postupdate:zd,has_preupdate:Nd,isAddedComponent:Hd,isAddedSystemEntity:Xd,isRemoveSystemEntity:Wd,isRemovedComponent:Gd,isScreenElement:qd,maxMessages:jd,obsolete:Qd,pixelSnapEpsilon:Kd,randomInRange:we,randomIntInRange:Zd,range:ya,resetObsoleteCounter:Jd,sign:Yd,toDegrees:$d,toRadians:tu,vec:Rt,webgl:eu},Symbol.toStringTag,{value:"Module"})),Aa=`game-canvas-${Math.random()*1e4}`,da={width:16,height:16},ve=100,su=700,ri={offset:10,width:20,height:20,duration:200,cooldown:200,screenshakeDistance:5,screenshakeDuration:100},Yn={width:5,height:5,velocity:200,cooldown:1500,rotateSpeed:Math.PI*4},nu={health:100,attack:10,speed:100},Do={health:30,attack:10,speed:30},ru={health:Do.health*2,attack:Do.attack*2,speed:Do.speed*2},Vt={minStateChangeCooldown:0,maxStateChangeCooldown:5e3,minMeleeAttackCooldown:50,maxMeleeAttackCooldown:5e3,minPreMeleeAttackWait:500,maxPreMeleeAttackWait:2e3,minRangedAttackCooldown:50,maxRangedAttackCooldown:5e3,minWanderCooldown:50,maxWanderCooldown:5e3,chanceToStayStill:.3,chaseSpeed:75,normalSpeed:30,detectionRange:150,hitRange:20,dashChance:.01,rangedAttackChance:.01,minDashCooldown:2e3,maxDashCooldown:1e4,dashSpeed:5e3,navigationDirectionThreshold:5},qe={height:75,textYOffset:50,fieldWidth:400,fontSize:40,z:1e3,fontZ:1001};var kt=(p=>(p.Menu="menu",p.Level1="level1",p.Dialog1="dialog1",p.Level2="level2",p.Dialog2="dialog2",p.Level3="level3",p.Dialog3="dialog3",p))(kt||{});const ou=()=>{const p=new au;return p.input.keyboard.on("press",y=>{y.key==="Escape"&&p.goToScene(kt.Menu)}),p};class au extends ma{constructor(){super({displayMode:ga.FitScreen,resolution:wa.Standard,canvasElementId:Aa,backgroundColor:Ai.fromHex("#ffffff")})}start(y){return super.start(y).then(()=>{this.goToScene(kt.Menu)})}}function Ca(p,y,f){if(p===0&&y===0)return Rt(0,0);const w=Rt(p,y).normalize(),m=w.x*f,b=w.y*f;return Rt(m,b)}const lu=p=>p.equals(bt.Up)?Math.PI/2:p.equals(bt.Down)?3*Math.PI/2:p.equals(bt.Left)?Math.PI:(p.equals(bt.Right),0);function hu(){const p=Ca(this.vel.x,this.vel.y,this.stats.speed/10);this.pos=this.pos.add(p)}const cu="/fgj-2023/assets/viiskauttaviis1-118eafd8.mp3",du="/fgj-2023/assets/FGJ2023-game-music-d6603473.wav",uu="/fgj-2023/assets/FGJ2023-main-menu-db8819cb.wav",pu="/fgj-2023/assets/Hit001-b60c3d5f.wav",fu="/fgj-2023/assets/Hit002-80aed3b1.wav",_u="/fgj-2023/assets/Hit003-8f976cdb.wav",gu="/fgj-2023/assets/Hit004-02fa400a.wav",mu="/fgj-2023/assets/Whoosh 004-8135af0d.wav",vu="/fgj-2023/assets/Whoosh 005-96b7e367.wav",wu="/fgj-2023/assets/Whoosh 006-6b88ae3d.wav",bu="/fgj-2023/assets/Whoosh 007-c039bac5.wav",Ea=()=>{const p=new ni(du);p.loop=!0,p.volume=.2;const y=new ni(uu);return y.loop=!0,y.volume=.2,{viisKauttaViis:new ni(cu),hit1:new ni(pu),hit2:new ni(fu),hit3:new ni(_u),hit4:new ni(gu),whoosh1:new ni(mu),whoosh2:new ni(vu),whoosh3:new ni(wu),whoosh4:new ni(bu),gameMusicLoop:p,menuMusicLoop:y}},Or=class{constructor(){Or.init()}static getSounds(){return this.sounds}static playRandomHitSound(){const y=[this.sounds.hit1,this.sounds.hit2,this.sounds.hit3,this.sounds.hit4],f=Math.floor(Math.random()*4);y[f].play()}static playRandomWhooshSound(){const y=[this.sounds.whoosh1,this.sounds.whoosh2,this.sounds.whoosh3,this.sounds.whoosh4],f=Math.floor(Math.random()*4);y[f].play()}};let he=Or;jt(he,"sounds"),jt(he,"init",()=>{Or.sounds=Ea()}),jt(he,"playSound",y=>{Or.sounds[y].play()});function xu(p,y){const f=Rt(this.pos.x+this.currentDirection.x*ri.offset,this.pos.y+this.currentDirection.y*ri.offset),w=new Ei({pos:f,width:ri.width,height:ri.height,collisionType:qi.Passive,vel:this.vel}),m=y.melee();(this.currentDirection.equals(bt.Up)||this.currentDirection.equals(bt.Down))&&(m.flipVertical=!0),m.rotation=lu(this.currentDirection)+Math.PI/2,w.graphics.use(m),w.on("collisionstart",b=>{if(b.other.id===this.id||b.other.name!=="Player"&&b.other.name!=="enemy"&&b.other.name!=="boss")return;const T=new Ei({pos:f,scale:Rt(.5,.5)});T.graphics.use(y.blood()),T.actions.delay(500).die(),he.playRandomHitSound(),p.currentScene.camera.shake(ri.screenshakeDistance,ri.screenshakeDistance,ri.screenshakeDuration);const P=b.other;P.changeHealth(-this.stats.attack),T.pos=P.center,p.currentScene.add(T)}),w.actions.delay(ri.duration).die(),he.playRandomWhooshSound(),p.currentScene.add(w)}function yu(p,y,f,w){let m=this.currentDirection;if(w){const P=p.currentScene.actors.find(M=>M.name==="Player");P&&(m=P.pos.sub(this.pos).normalize())}const b=new Ei({pos:this.pos,width:Yn.width,height:Yn.height,collisionType:qi.Passive,vel:m.scale(Yn.velocity)});b.sender=this.id;const T=f.rocks.Rock2;T.scale=Rt(.3,.3),b.graphics.use(T),b.on("collisionstart",P=>{if(P.other.id===b.sender)return;let M=!1;if((w&&P.other.name==="Player"||!w&&(P.other.name==="enemy"||P.other.name==="boss"))&&(M=!0),M){const F=new Ei({pos:P.other.center,scale:Rt(.5,.5)});F.graphics.use(y.blood()),F.actions.delay(500).die(),p.currentScene.add(F),he.playRandomHitSound();const X=P.other;X.stats!=null&&X.changeHealth(-this.stats.attack)}p.currentScene.camera.shake(ri.screenshakeDistance,ri.screenshakeDistance,ri.screenshakeDuration),(!["enemy","boss","Player"].includes(P.other.name)||M)&&b.kill()}),b.actions.rotateTo(Yn.rotateSpeed,Yn.rotateSpeed,ba.Clockwise).die(),he.playRandomWhooshSound(),p.currentScene.add(b)}const yt=class{constructor(){yt.Init()}static Init(){yt.enemyStats=Do,yt.bossStats=ru,yt.playerStats=nu}static Reset(){yt.Init()}static FloorStats(){yt.playerStats.attack=Math.floor(yt.playerStats.attack),yt.playerStats.health=Math.floor(yt.playerStats.health),yt.playerStats.speed=Math.floor(yt.playerStats.speed),yt.enemyStats.attack=Math.floor(yt.enemyStats.attack),yt.enemyStats.health=Math.floor(yt.enemyStats.health),yt.enemyStats.speed=Math.floor(yt.enemyStats.speed),yt.bossStats.attack=Math.floor(yt.bossStats.attack),yt.bossStats.health=Math.floor(yt.bossStats.health),yt.bossStats.speed=Math.floor(yt.bossStats.speed)}static LevelUp(){yt.enemyStats.attack*=1.5,yt.enemyStats.health*=1.5,yt.enemyStats.speed*=1.5,yt.bossStats.attack*=1.5,yt.bossStats.health*=1.5,yt.bossStats.speed*=1.5,yt.FloorStats();const y=Math.random()*3;if(1>y&&y>0){const f=Math.floor(yt.playerStats.attack*1.5);return yt.playerStats.attack+=f,`Attack was increased by ${f}!`}if(2>y&&y>1){const f=Math.floor(yt.playerStats.health*1.5);return yt.playerStats.health+=f,`Health was increased by ${f}!`}if(3>y&&y>2){const f=Math.floor(yt.playerStats.speed*1.5);return yt.playerStats.speed+=f,`Speed was increased by ${f}!`}else return"Level up!"}};let Ue=yt;jt(Ue,"enemyStats"),jt(Ue,"bossStats"),jt(Ue,"playerStats");class Au extends Ei{constructor(f,w,m){const b=zr.Circle(10);b.offset=new bt(0,16);super({name:"Player",collider:b,collisionType:qi.Active,...f});jt(this,"animations");jt(this,"animation");jt(this,"animationProps");jt(this,"spritesheetProps");jt(this,"preUpdateLogic",null);jt(this,"currentDirection",bt.Down);jt(this,"dashTime",0);jt(this,"dashCooldown",0);jt(this,"isAi",!1);jt(this,"meleeAttackCooldown",ri.cooldown);jt(this,"meleeAttackCurrentCooldown",0);jt(this,"meleeAttackReset",!0);jt(this,"rangedAttackCooldown",Yn.cooldown);jt(this,"rangedAttackCurrentCooldown",0);jt(this,"rangedAttackReset",!0);jt(this,"stats",{...Ue.playerStats});this.animations=f.animations,this.animation="left",this.animationProps=w,this.spritesheetProps=m}AddLogic(f){this.preUpdateLogic=f}AddStatefulLogic(f){this.preUpdateLogic=(f==null?void 0:f())??null}onInitialize(){const f=this.animations[this.animation];this.graphics.use(f)}normalizeAndSetVelocity(f,w=this.stats.speed){const m=Ca(f.x,f.y,w);this.vel.x=m.x,this.vel.y=m.y}setAnimation(){this.graphics.use(this.animations[this.animation])}changeHealth(f){this.stats.health+=f,this.isAi||(Ue.playerStats.health+=f)}onPreUpdate(f,w){var M;super.onPreUpdate(f,w);let m=(M=this.preUpdateLogic)==null?void 0:M.call(this,f,w);if(typeof m=="function"){const R=m.bind(this);m=R==null?void 0:R(f,w)}if(!m)return;this.dashCooldown>0?this.dashCooldown-=w:this.rotation=0,this.meleeAttackCurrentCooldown>0&&(this.meleeAttackCurrentCooldown-=w),this.rangedAttackCurrentCooldown>0&&(this.rangedAttackCurrentCooldown-=w),m.actions.meleeAttack||(this.meleeAttackReset=!0),m.actions.rangedAttack||(this.rangedAttackReset=!0),this.normalizeAndSetVelocity(Rt(m.input.x,m.input.y),m.speed);const b=this.animation,T=this.vel.toAngle(),P=Math.PI;this.vel.x===0&&this.vel.y===0?this.animation="idle":T>=-P/4&&T<=P/4?(this.animation="right",this.currentDirection=bt.Right):T>-3*P/4&&T<-P/4?(this.animation="up",this.currentDirection=bt.Up):T<=-3*P/4||T>=3*P/4?(this.animation="left",this.currentDirection=bt.Left):T>P/4&&T<3*P/4&&(this.animation="down",this.currentDirection=bt.Down),b!==this.animation&&this.setAnimation(),m.actions.dash&&this.dashCooldown<=0&&(hu.bind(this)(),this.dashCooldown=500,this.animation=="left"?this.rotation=3*P/2:this.rotation=P/2),m.actions.meleeAttack&&this.meleeAttackReset&&this.meleeAttackCurrentCooldown<=0&&(xu.bind(this)(f,this.animationProps),this.meleeAttackCurrentCooldown=this.meleeAttackCooldown,this.meleeAttackReset=!1),m.actions.rangedAttack&&this.rangedAttackReset&&this.rangedAttackCurrentCooldown<=0&&(yu.bind(this)(f,this.animationProps,this.spritesheetProps,this.isAi),this.rangedAttackCurrentCooldown=this.rangedAttackCooldown,this.rangedAttackReset=!1)}onPostUpdate(f,w){if(super.onPostUpdate(f,w),this.stats.health<=0){this.kill();return}}}const Cu=(p,y)=>{const f={};return Object.entries(p.characters).forEach(([w,m])=>{const b=T=>new Au({scale:Rt(.5,.5),animations:{idle:new ds({frames:[{graphic:m.getSprite(1,0),duration:ve}]}),left:new ds({frames:[{graphic:m.getSprite(1,1),duration:ve},{graphic:m.getSprite(0,1),duration:ve},{graphic:m.getSprite(1,1),duration:ve},{graphic:m.getSprite(2,1),duration:ve}]}),right:new ds({frames:[{graphic:m.getSprite(1,2),duration:ve},{graphic:m.getSprite(0,2),duration:ve},{graphic:m.getSprite(1,2),duration:ve},{graphic:m.getSprite(2,2),duration:ve}]}),up:new ds({frames:[{graphic:m.getSprite(1,3),duration:ve},{graphic:m.getSprite(0,3),duration:ve},{graphic:m.getSprite(1,3),duration:ve},{graphic:m.getSprite(2,3),duration:ve}]}),down:new ds({frames:[{graphic:m.getSprite(1,0),duration:ve},{graphic:m.getSprite(0,0),duration:ve},{graphic:m.getSprite(1,0),duration:ve},{graphic:m.getSprite(2,0),duration:ve}]})},...T},y,p);f[w]=b}),f},Eu=p=>{const y=new Ei({name:"niilo-duck",pos:new bt(300,275),scale:new bt(.25,.25)}),f=p.images.duckImage.toSprite();return y.graphics.use(f),y},Su=p=>y=>{const f=new Ei({name:"house",pos:y,width:80,height:80,collisionType:qi.Fixed}),w=p.house.getSprite(0,0);return f.graphics.use(w),f},Pu=p=>{const y={},f=["Rock2","Rock3","Rock5","Rock6"];return Object.entries(p.rocks).forEach(([w,m])=>{y[w]=b=>{const T=zr.Box(20,20),P=f.includes(w),M=new Ei({name:w,pos:b,collider:T,collisionType:P?qi.Fixed:qi.PreventCollision});return M.graphics.use(m),P&&(M.z=32),M}}),y},Tu=p=>y=>{const f=ds.fromSpriteSheet(p.treeBoy,ya(0,4),su),w=zr.Box(48/2,48/2);w.offset=new bt(0,16);const m=new Ei({name:"house",pos:y,scale:new bt(.5,.5),collider:w,collisionType:qi.Fixed});return m.graphics.use(f),m},ku=p=>{const y={};return Object.entries(p.trees).forEach(([f,w])=>{y[f]=m=>{const b=zr.Box(20,20);b.offset=new bt(0,40);const T=new Ei({name:f,pos:m,collider:b,collisionType:qi.Fixed});return T.graphics.use(w),T.z=69,T}}),y},Iu=(p,y,f,w)=>{const m=Eu(y),b=Cu(f,w),T=Su(f),P=ku(f),M=Tu(f),R=Pu(f);return{duck:m,characters:b,trees:P,rocks:R,house:T,treeBoy:M}};var Ru=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Bu(p){if(p.__esModule)return p;var y=p.default;if(typeof y=="function"){var f=function w(){if(this instanceof w){var m=[null];m.push.apply(m,arguments);var b=Function.bind.apply(y,m);return new b}return y.apply(this,arguments)};f.prototype=y.prototype}else f={};return Object.defineProperty(f,"__esModule",{value:!0}),Object.keys(p).forEach(function(w){var m=Object.getOwnPropertyDescriptor(p,w);Object.defineProperty(f,w,m.get?m:{enumerable:!0,get:function(){return p[w]}})}),f}var ua={},Du={get exports(){return ua},set exports(p){ua=p}};const Mu=Bu(iu);/*! For license information please see dev-tools.js.LICENSE.txt */(function(p,y){(function(f,w){p.exports=w(Mu)})(self,f=>(()=>{var w={"./picker-system.ts":(P,M,R)=>{R.r(M),R.d(M,{PickerSystem:()=>X});var F=R("excalibur");class X extends F.System{constructor(){super(...arguments),this.types=["ex.transform"],this.systemType=F.SystemType.Update,this.priority=99,this.lastFrameEntityToPointers=new Map,this.currentFrameEntityToPointers=new Map}initialize(A){this._engine=A.engine,this._receiver=this._engine.input.pointers}addPointerToEntity(A,L){if(!this.currentFrameEntityToPointers.has(A.id))return void this.currentFrameEntityToPointers.set(A.id,[L]);const V=this.currentFrameEntityToPointers.get(A.id);this.currentFrameEntityToPointers.set(A.id,V.concat(L))}_processPointerToEntity(A){var L;let V,W,Q;for(const rt of A)if(!(rt instanceof F.Particle)){if(V=rt.get(F.TransformComponent),W=rt.get(F.ColliderComponent),W){const J=W.get();if(J)for(const[k,B]of this._receiver.currentFramePointerCoords.entries())J.contains(V.coordPlane===F.CoordPlane.World?B.worldPos:B.screenPos)&&this.addPointerToEntity(rt,k)}if(Q=rt.get(F.GraphicsComponent),Q){const J=Q.localBounds.transform(V.get().matrix);for(const[k,B]of this._receiver.currentFramePointerCoords.entries())J.contains(V.coordPlane===F.CoordPlane.World?B.worldPos:B.screenPos)&&this.addPointerToEntity(rt,k)}if(!(!((L=Q==null?void 0:Q.current)===null||L===void 0)&&L.length)&&!(W!=null&&W.get())||rt instanceof F.ParticleEmitter){const J=F.BoundingBox.fromDimension(100,100).transform(V.get().matrix);for(const[k,B]of this._receiver.currentFramePointerCoords.entries())J.contains(V.coordPlane===F.CoordPlane.World?B.worldPos:B.screenPos)&&this.addPointerToEntity(rt,k)}}}update(A,L){this._processPointerToEntity(A),this.lastFrameEntityToPointers.clear(),this.lastFrameEntityToPointers=new Map(this.currentFrameEntityToPointers),this.currentFrameEntityToPointers.clear()}}},"./node_modules/tweakpane/dist/tweakpane.js":function(P,M){(function(R){class F{constructor(s){this.controller_=s}get element(){return this.controller_.view.element}get disabled(){return this.controller_.viewProps.get("disabled")}set disabled(s){this.controller_.viewProps.set("disabled",s)}get hidden(){return this.controller_.viewProps.get("hidden")}set hidden(s){this.controller_.viewProps.set("hidden",s)}dispose(){this.controller_.viewProps.set("disposed",!0)}}class X{constructor(s){this.target=s}}class E extends X{constructor(s,r,c,_){super(s),this.value=r,this.presetKey=c,this.last=_==null||_}}class A extends X{constructor(s,r,c){super(s),this.value=r,this.presetKey=c}}class L extends X{constructor(s,r){super(s),this.expanded=r}}class V extends X{constructor(s,r){super(s),this.index=r}}function W(l){return l==null}function Q(l,s){if(l.length!==s.length)return!1;for(let r=0;r<l.length;r++)if(l[r]!==s[r])return!1;return!0}const rt={alreadydisposed:()=>"View has been already disposed",invalidparams:l=>`Invalid parameters for '${l.name}'`,nomatchingcontroller:l=>`No matching controller for '${l.key}'`,nomatchingview:l=>`No matching view for '${JSON.stringify(l.params)}'`,notbindable:()=>"Value is not bindable",propertynotfound:l=>`Property '${l.name}' not found`,shouldneverhappen:()=>"This error should never happen"};class J{constructor(s){var r;this.message=(r=rt[s.type](s.context))!==null&&r!==void 0?r:"Unexpected error",this.name=this.constructor.name,this.stack=new Error(this.message).stack,this.type=s.type}static alreadyDisposed(){return new J({type:"alreadydisposed"})}static notBindable(){return new J({type:"notbindable"})}static propertyNotFound(s){return new J({type:"propertynotfound",context:{name:s}})}static shouldNeverHappen(){return new J({type:"shouldneverhappen"})}}class k{constructor(s,r,c){this.obj_=s,this.key_=r,this.presetKey_=c??r}static isBindable(s){return s!==null&&typeof s=="object"}get key(){return this.key_}get presetKey(){return this.presetKey_}read(){return this.obj_[this.key_]}write(s){this.obj_[this.key_]=s}writeProperty(s,r){const c=this.read();if(!k.isBindable(c))throw J.notBindable();if(!(s in c))throw J.propertyNotFound(s);c[s]=r}}class B extends F{get label(){return this.controller_.props.get("label")}set label(s){this.controller_.props.set("label",s)}get title(){var s;return(s=this.controller_.valueController.props.get("title"))!==null&&s!==void 0?s:""}set title(s){this.controller_.valueController.props.set("title",s)}on(s,r){const c=r.bind(this);return this.controller_.valueController.emitter.on(s,()=>{c(new X(this))}),this}}class tt{constructor(){this.observers_={}}on(s,r){let c=this.observers_[s];return c||(c=this.observers_[s]=[]),c.push({handler:r}),this}off(s,r){const c=this.observers_[s];return c&&(this.observers_[s]=c.filter(_=>_.handler!==r)),this}emit(s,r){const c=this.observers_[s];c&&c.forEach(_=>{_.handler(r)})}}const Y="tp";function ut(l){return(s,r)=>[Y,"-",l,"v",s?`_${s}`:"",r?`-${r}`:""].join("")}function oi(l){return l.rawValue}function j(l,s){var r,c;l.emitter.on("change",(r=oi,c=s,_=>c(r(_)))),s(l.rawValue)}function mt(l,s,r){j(l.value(s),r)}function ht(l,s){return r=>{(function(c,_,x){x?c.classList.add(_):c.classList.remove(_)})(l,s,r)}}function nt(l,s){j(l,r=>{s.textContent=r??""})}const Ft=ut("btn");class ce{constructor(s,r){this.element=s.createElement("div"),this.element.classList.add(Ft()),r.viewProps.bindClassModifiers(this.element);const c=s.createElement("button");c.classList.add(Ft("b")),r.viewProps.bindDisabled(c),this.element.appendChild(c),this.buttonElement=c;const _=s.createElement("div");_.classList.add(Ft("t")),nt(r.props.value("title"),_),this.buttonElement.appendChild(_)}}class qt{constructor(s,r){this.emitter=new tt,this.onClick_=this.onClick_.bind(this),this.props=r.props,this.viewProps=r.viewProps,this.view=new ce(s,{props:this.props,viewProps:this.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}}class Le{constructor(s,r){var c;this.constraint_=r==null?void 0:r.constraint,this.equals_=(c=r==null?void 0:r.equals)!==null&&c!==void 0?c:(_,x)=>_===x,this.emitter=new tt,this.rawValue_=s}get constraint(){return this.constraint_}get rawValue(){return this.rawValue_}set rawValue(s){this.setRawValue(s,{forceEmit:!1,last:!0})}setRawValue(s,r){const c=r??{forceEmit:!1,last:!0},_=this.constraint_?this.constraint_.constrain(s):s;(!this.equals_(this.rawValue_,_)||c.forceEmit)&&(this.emitter.emit("beforechange",{sender:this}),this.rawValue_=_,this.emitter.emit("change",{options:c,rawValue:_,sender:this}))}}class us{constructor(s){this.emitter=new tt,this.value_=s}get rawValue(){return this.value_}set rawValue(s){this.setRawValue(s,{forceEmit:!1,last:!0})}setRawValue(s,r){const c=r??{forceEmit:!1,last:!0};(this.value_!==s||c.forceEmit)&&(this.emitter.emit("beforechange",{sender:this}),this.value_=s,this.emitter.emit("change",{options:c,rawValue:this.value_,sender:this}))}}function Ot(l,s){const r=s==null?void 0:s.constraint,c=s==null?void 0:s.equals;return r||c?new Le(l,s):new us(l)}class _t{constructor(s){this.emitter=new tt,this.valMap_=s;for(const r in this.valMap_)this.valMap_[r].emitter.on("change",()=>{this.emitter.emit("change",{key:r,sender:this})})}static createCore(s){return Object.keys(s).reduce((r,c)=>Object.assign(r,{[c]:Ot(s[c])}),{})}static fromObject(s){const r=this.createCore(s);return new _t(r)}get(s){return this.valMap_[s].rawValue}set(s,r){this.valMap_[s].rawValue=r}value(s){return this.valMap_[s]}}function be(l){return s=>r=>{if(!s&&r===void 0)return{succeeded:!1,value:void 0};if(s&&r===void 0)return{succeeded:!0,value:void 0};const c=l(r);return c!==void 0?{succeeded:!0,value:c}:{succeeded:!1,value:void 0}}}function Jt(l){return{custom:s=>be(s)(l),boolean:be(s=>typeof s=="boolean"?s:void 0)(l),number:be(s=>typeof s=="number"?s:void 0)(l),string:be(s=>typeof s=="string"?s:void 0)(l),function:be(s=>typeof s=="function"?s:void 0)(l),constant:s=>be(r=>r===s?s:void 0)(l),raw:be(s=>s)(l),object:s=>be(r=>{if((c=r)!==null&&typeof c=="object")return function(_,x){return Object.keys(x).reduce((S,O)=>{if(S===void 0)return;const G=(0,x[O])(_[O]);return G.succeeded?Object.assign(Object.assign({},S),{[O]:G.value}):void 0},{})}(r,s);var c})(l),array:s=>be(r=>{if(Array.isArray(r))return c=s,r.reduce((_,x)=>{if(_===void 0)return;const S=c(x);return S.succeeded&&S.value!==void 0?[..._,S.value]:void 0},[]);var c})(l)}}const ct={optional:Jt(!0),required:Jt(!1)};function Qt(l,s){const r=ct.required.object(s)(l);return r.succeeded?r.value:void 0}const ps=ut(""),ai={veryfirst:"vfst",first:"fst",last:"lst",verylast:"vlst"};class pt{constructor(s){this.parent_=null,this.blade=s.blade,this.view=s.view,this.viewProps=s.viewProps;const r=this.view.element;this.blade.value("positions").emitter.on("change",()=>{["veryfirst","first","last","verylast"].forEach(c=>{r.classList.remove(ps(void 0,ai[c]))}),this.blade.get("positions").forEach(c=>{r.classList.add(ps(void 0,ai[c]))})}),this.viewProps.handleDispose(()=>{(function(c){c&&c.parentElement&&c.parentElement.removeChild(c)})(r)})}get parent(){return this.parent_}}const se="http://www.w3.org/2000/svg";function Qe(l){l.offsetHeight}function li(l){return l.ontouchstart!==void 0}function Qi(){return new Function("return this")().document}const Ki={check:'<path d="M2 8l4 4l8 -8"/>',dropdown:'<path d="M5 7h6l-3 3 z"/>',p2dpad:'<path d="M8 4v8"/><path d="M4 8h8"/><circle cx="12" cy="12" r="1.2"/>'};function ke(l,s){const r=l.createElementNS(se,"svg");return r.innerHTML=Ki[s],r}function hi(l,s,r){l.insertBefore(s,l.children[r])}function fs(l){l.parentElement&&l.parentElement.removeChild(l)}function Zi(l){for(;l.children.length>0;)l.removeChild(l.children[0])}function Ve(l){return l.relatedTarget?l.relatedTarget:"explicitOriginalTarget"in l?l.explicitOriginalTarget:null}const de=ut("lbl");class _s{constructor(s,r){this.element=s.createElement("div"),this.element.classList.add(de()),r.viewProps.bindClassModifiers(this.element);const c=s.createElement("div");c.classList.add(de("l")),mt(r.props,"label",x=>{W(x)?this.element.classList.add(de(void 0,"nol")):(this.element.classList.remove(de(void 0,"nol")),function(S){for(;S.childNodes.length>0;)S.removeChild(S.childNodes[0])}(c),c.appendChild(function(S,O){const G=S.createDocumentFragment();return O.split(`
`).map(it=>S.createTextNode(it)).forEach((it,xt)=>{xt>0&&G.appendChild(S.createElement("br")),G.appendChild(it)}),G}(s,x)))}),this.element.appendChild(c),this.labelElement=c;const _=s.createElement("div");_.classList.add(de("v")),this.element.appendChild(_),this.valueElement=_}}class ci extends pt{constructor(s,r){const c=r.valueController.viewProps;super(Object.assign(Object.assign({},r),{view:new _s(s,{props:r.props,viewProps:c}),viewProps:c})),this.props=r.props,this.valueController=r.valueController,this.view.valueElement.appendChild(this.valueController.view.element)}}const zs={id:"button",type:"blade",accept(l){const s=ct,r=Qt(l,{title:s.required.string,view:s.required.constant("button"),label:s.optional.string});return r?{params:r}:null},controller:l=>new ci(l.document,{blade:l.blade,props:_t.fromObject({label:l.params.label}),valueController:new qt(l.document,{props:_t.fromObject({title:l.params.title}),viewProps:l.viewProps})}),api:l=>l.controller instanceof ci&&l.controller.valueController instanceof qt?new B(l.controller):null};class Oe extends pt{constructor(s){super(s),this.value=s.value}}function di(){return new _t({positions:Ot([],{equals:Q})})}class Ke extends _t{constructor(s){super(s)}static create(s){const r={completed:!0,expanded:s,expandedHeight:null,shouldFixHeight:!1,temporaryExpanded:null},c=_t.createCore(r);return new Ke(c)}get styleExpanded(){var s;return(s=this.get("temporaryExpanded"))!==null&&s!==void 0?s:this.get("expanded")}get styleHeight(){if(!this.styleExpanded)return"0";const s=this.get("expandedHeight");return this.get("shouldFixHeight")&&!W(s)?`${s}px`:"auto"}bindExpandedClass(s,r){const c=()=>{this.styleExpanded?s.classList.add(r):s.classList.remove(r)};mt(this,"expanded",c),mt(this,"temporaryExpanded",c)}cleanUpTransition(){this.set("shouldFixHeight",!1),this.set("expandedHeight",null),this.set("completed",!0)}}function gs(l,s){s.style.height=l.styleHeight}function Si(l,s){l.value("expanded").emitter.on("beforechange",()=>{l.set("completed",!1),W(l.get("expandedHeight"))&&l.set("expandedHeight",function(r,c){let _=0;return function(x,S){const O=x.style.transition;x.style.transition="none",S(),x.style.transition=O}(c,()=>{r.set("expandedHeight",null),r.set("temporaryExpanded",!0),Qe(c),_=c.clientHeight,r.set("temporaryExpanded",null),Qe(c)}),_}(l,s)),l.set("shouldFixHeight",!0),Qe(s)}),l.emitter.on("change",()=>{gs(l,s)}),gs(l,s),s.addEventListener("transitionend",r=>{r.propertyName==="height"&&l.cleanUpTransition()})}class ze extends F{constructor(s,r){super(s),this.rackApi_=r}}class ui{constructor(s){this.emitter=new tt,this.items_=[],this.cache_=new Set,this.onSubListAdd_=this.onSubListAdd_.bind(this),this.onSubListRemove_=this.onSubListRemove_.bind(this),this.extract_=s}get items(){return this.items_}allItems(){return Array.from(this.cache_)}find(s){for(const r of this.allItems())if(s(r))return r;return null}includes(s){return this.cache_.has(s)}add(s,r){if(this.includes(s))throw J.shouldNeverHappen();const c=r!==void 0?r:this.items_.length;this.items_.splice(c,0,s),this.cache_.add(s);const _=this.extract_(s);_&&(_.emitter.on("add",this.onSubListAdd_),_.emitter.on("remove",this.onSubListRemove_),_.allItems().forEach(x=>{this.cache_.add(x)})),this.emitter.emit("add",{index:c,item:s,root:this,target:this})}remove(s){const r=this.items_.indexOf(s);if(r<0)return;this.items_.splice(r,1),this.cache_.delete(s);const c=this.extract_(s);c&&(c.emitter.off("add",this.onSubListAdd_),c.emitter.off("remove",this.onSubListRemove_)),this.emitter.emit("remove",{index:r,item:s,root:this,target:this})}onSubListAdd_(s){this.cache_.add(s.item),this.emitter.emit("add",{index:s.index,item:s.item,root:this,target:s.target})}onSubListRemove_(s){this.cache_.delete(s.item),this.emitter.emit("remove",{index:s.index,item:s.item,root:this,target:s.target})}}class ms extends F{constructor(s){super(s),this.onBindingChange_=this.onBindingChange_.bind(this),this.emitter_=new tt,this.controller_.binding.emitter.on("change",this.onBindingChange_)}get label(){return this.controller_.props.get("label")}set label(s){this.controller_.props.set("label",s)}on(s,r){const c=r.bind(this);return this.emitter_.on(s,_=>{c(_.event)}),this}refresh(){this.controller_.binding.read()}onBindingChange_(s){const r=s.sender.target.read();this.emitter_.emit("change",{event:new E(this,r,this.controller_.binding.target.presetKey,s.options.last)})}}class Se extends ci{constructor(s,r){super(s,r),this.binding=r.binding}}class vs extends F{constructor(s){super(s),this.onBindingUpdate_=this.onBindingUpdate_.bind(this),this.emitter_=new tt,this.controller_.binding.emitter.on("update",this.onBindingUpdate_)}get label(){return this.controller_.props.get("label")}set label(s){this.controller_.props.set("label",s)}on(s,r){const c=r.bind(this);return this.emitter_.on(s,_=>{c(_.event)}),this}refresh(){this.controller_.binding.read()}onBindingUpdate_(s){const r=s.sender.target.read();this.emitter_.emit("update",{event:new A(this,r,this.controller_.binding.target.presetKey)})}}class Ne extends ci{constructor(s,r){super(s,r),this.binding=r.binding,this.viewProps.bindDisabled(this.binding.ticker),this.viewProps.handleDispose(()=>{this.binding.dispose()})}}function Ns(l){return l instanceof ws?l.apiSet_:l instanceof ze?l.rackApi_.apiSet_:null}function pi(l,s){const r=l.find(c=>c.controller_===s);if(!r)throw J.shouldNeverHappen();return r}function Ji(l,s,r){if(!k.isBindable(l))throw J.notBindable();return new k(l,s,r)}class ws extends F{constructor(s,r){super(s),this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this),this.onRackInputChange_=this.onRackInputChange_.bind(this),this.onRackMonitorUpdate_=this.onRackMonitorUpdate_.bind(this),this.emitter_=new tt,this.apiSet_=new ui(Ns),this.pool_=r;const c=this.controller_.rack;c.emitter.on("add",this.onRackAdd_),c.emitter.on("remove",this.onRackRemove_),c.emitter.on("inputchange",this.onRackInputChange_),c.emitter.on("monitorupdate",this.onRackMonitorUpdate_),c.children.forEach(_=>{this.setUpApi_(_)})}get children(){return this.controller_.rack.children.map(s=>pi(this.apiSet_,s))}addInput(s,r,c){const _=c??{},x=this.controller_.view.element.ownerDocument,S=this.pool_.createInput(x,Ji(s,r,_.presetKey),_),O=new ms(S);return this.add(O,_.index)}addMonitor(s,r,c){const _=c??{},x=this.controller_.view.element.ownerDocument,S=this.pool_.createMonitor(x,Ji(s,r),_),O=new vs(S);return this.add(O,_.index)}addFolder(s){return function(r,c){return r.addBlade(Object.assign(Object.assign({},c),{view:"folder"}))}(this,s)}addButton(s){return function(r,c){return r.addBlade(Object.assign(Object.assign({},c),{view:"button"}))}(this,s)}addSeparator(s){return function(r,c){const _=c??{};return r.addBlade(Object.assign(Object.assign({},_),{view:"separator"}))}(this,s)}addTab(s){return function(r,c){return r.addBlade(Object.assign(Object.assign({},c),{view:"tab"}))}(this,s)}add(s,r){this.controller_.rack.add(s.controller_,r);const c=this.apiSet_.find(_=>_.controller_===s.controller_);return c&&this.apiSet_.remove(c),this.apiSet_.add(s),s}remove(s){this.controller_.rack.remove(s.controller_)}addBlade(s){const r=this.controller_.view.element.ownerDocument,c=this.pool_.createBlade(r,s),_=this.pool_.createBladeApi(c);return this.add(_,s.index)}on(s,r){const c=r.bind(this);return this.emitter_.on(s,_=>{c(_.event)}),this}setUpApi_(s){this.apiSet_.find(r=>r.controller_===s)||this.apiSet_.add(this.pool_.createBladeApi(s))}onRackAdd_(s){this.setUpApi_(s.bladeController)}onRackRemove_(s){if(s.isRoot){const r=pi(this.apiSet_,s.bladeController);this.apiSet_.remove(r)}}onRackInputChange_(s){const r=s.bladeController;if(r instanceof Se){const c=pi(this.apiSet_,r),_=r.binding;this.emitter_.emit("change",{event:new E(c,_.target.read(),_.target.presetKey,s.options.last)})}else if(r instanceof Oe){const c=pi(this.apiSet_,r);this.emitter_.emit("change",{event:new E(c,r.value.rawValue,void 0,s.options.last)})}}onRackMonitorUpdate_(s){if(!(s.bladeController instanceof Ne))throw J.shouldNeverHappen();const r=pi(this.apiSet_,s.bladeController),c=s.bladeController.binding;this.emitter_.emit("update",{event:new A(r,c.target.read(),c.target.presetKey)})}}class Hs extends ze{constructor(s,r){super(s,new ws(s.rackController,r)),this.emitter_=new tt,this.controller_.foldable.value("expanded").emitter.on("change",c=>{this.emitter_.emit("fold",{event:new L(this,c.sender.rawValue)})}),this.rackApi_.on("change",c=>{this.emitter_.emit("change",{event:c})}),this.rackApi_.on("update",c=>{this.emitter_.emit("update",{event:c})})}get expanded(){return this.controller_.foldable.get("expanded")}set expanded(s){this.controller_.foldable.set("expanded",s)}get title(){return this.controller_.props.get("title")}set title(s){this.controller_.props.set("title",s)}get children(){return this.rackApi_.children}addInput(s,r,c){return this.rackApi_.addInput(s,r,c)}addMonitor(s,r,c){return this.rackApi_.addMonitor(s,r,c)}addFolder(s){return this.rackApi_.addFolder(s)}addButton(s){return this.rackApi_.addButton(s)}addSeparator(s){return this.rackApi_.addSeparator(s)}addTab(s){return this.rackApi_.addTab(s)}add(s,r){return this.rackApi_.add(s,r)}remove(s){this.rackApi_.remove(s)}addBlade(s){return this.rackApi_.addBlade(s)}on(s,r){const c=r.bind(this);return this.emitter_.on(s,_=>{c(_.event)}),this}}class Xs extends pt{constructor(s){super({blade:s.blade,view:s.view,viewProps:s.rackController.viewProps}),this.rackController=s.rackController}}class sr{constructor(s,r){const c=ut(r.viewName);this.element=s.createElement("div"),this.element.classList.add(c()),r.viewProps.bindClassModifiers(this.element)}}function Ws(l){return l instanceof Ti?l.rack:l instanceof Xs?l.rackController.rack:null}function nr(l){const s=Ws(l);return s?s.bcSet_:null}class Pi{constructor(s){var r;this.onBladePositionsChange_=this.onBladePositionsChange_.bind(this),this.onSetAdd_=this.onSetAdd_.bind(this),this.onSetRemove_=this.onSetRemove_.bind(this),this.onChildDispose_=this.onChildDispose_.bind(this),this.onChildPositionsChange_=this.onChildPositionsChange_.bind(this),this.onChildInputChange_=this.onChildInputChange_.bind(this),this.onChildMonitorUpdate_=this.onChildMonitorUpdate_.bind(this),this.onChildValueChange_=this.onChildValueChange_.bind(this),this.onChildViewPropsChange_=this.onChildViewPropsChange_.bind(this),this.onDescendantLayout_=this.onDescendantLayout_.bind(this),this.onDescendantInputChange_=this.onDescendantInputChange_.bind(this),this.onDescendantMonitorUpdate_=this.onDescendantMonitorUpdate_.bind(this),this.emitter=new tt,this.blade_=s??null,(r=this.blade_)===null||r===void 0||r.value("positions").emitter.on("change",this.onBladePositionsChange_),this.bcSet_=new ui(nr),this.bcSet_.emitter.on("add",this.onSetAdd_),this.bcSet_.emitter.on("remove",this.onSetRemove_)}get children(){return this.bcSet_.items}add(s,r){s.parent&&s.parent.remove(s),s.parent_=this,this.bcSet_.add(s,r)}remove(s){s.parent_=null,this.bcSet_.remove(s)}find(s){return this.bcSet_.allItems().filter(r=>r instanceof s)}onSetAdd_(s){this.updatePositions_();const r=s.target===s.root;if(this.emitter.emit("add",{bladeController:s.item,index:s.index,isRoot:r,sender:this}),!r)return;const c=s.item;if(c.viewProps.emitter.on("change",this.onChildViewPropsChange_),c.blade.value("positions").emitter.on("change",this.onChildPositionsChange_),c.viewProps.handleDispose(this.onChildDispose_),c instanceof Se)c.binding.emitter.on("change",this.onChildInputChange_);else if(c instanceof Ne)c.binding.emitter.on("update",this.onChildMonitorUpdate_);else if(c instanceof Oe)c.value.emitter.on("change",this.onChildValueChange_);else{const _=Ws(c);if(_){const x=_.emitter;x.on("layout",this.onDescendantLayout_),x.on("inputchange",this.onDescendantInputChange_),x.on("monitorupdate",this.onDescendantMonitorUpdate_)}}}onSetRemove_(s){this.updatePositions_();const r=s.target===s.root;if(this.emitter.emit("remove",{bladeController:s.item,isRoot:r,sender:this}),!r)return;const c=s.item;if(c instanceof Se)c.binding.emitter.off("change",this.onChildInputChange_);else if(c instanceof Ne)c.binding.emitter.off("update",this.onChildMonitorUpdate_);else if(c instanceof Oe)c.value.emitter.off("change",this.onChildValueChange_);else{const _=Ws(c);if(_){const x=_.emitter;x.off("layout",this.onDescendantLayout_),x.off("inputchange",this.onDescendantInputChange_),x.off("monitorupdate",this.onDescendantMonitorUpdate_)}}}updatePositions_(){const s=this.bcSet_.items.filter(_=>!_.viewProps.get("hidden")),r=s[0],c=s[s.length-1];this.bcSet_.items.forEach(_=>{const x=[];_===r&&(x.push("first"),this.blade_&&!this.blade_.get("positions").includes("veryfirst")||x.push("veryfirst")),_===c&&(x.push("last"),this.blade_&&!this.blade_.get("positions").includes("verylast")||x.push("verylast")),_.blade.set("positions",x)})}onChildPositionsChange_(){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildViewPropsChange_(s){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildDispose_(){this.bcSet_.items.filter(s=>s.viewProps.get("disposed")).forEach(s=>{this.bcSet_.remove(s)})}onChildInputChange_(s){const r=function(c,_){for(let x=0;x<c.length;x++){const S=c[x];if(S instanceof Se&&S.binding===_)return S}return null}(this.find(Se),s.sender);if(!r)throw J.shouldNeverHappen();this.emitter.emit("inputchange",{bladeController:r,options:s.options,sender:this})}onChildMonitorUpdate_(s){const r=function(c,_){for(let x=0;x<c.length;x++){const S=c[x];if(S instanceof Ne&&S.binding===_)return S}return null}(this.find(Ne),s.sender);if(!r)throw J.shouldNeverHappen();this.emitter.emit("monitorupdate",{bladeController:r,sender:this})}onChildValueChange_(s){const r=function(c,_){for(let x=0;x<c.length;x++){const S=c[x];if(S instanceof Oe&&S.value===_)return S}return null}(this.find(Oe),s.sender);if(!r)throw J.shouldNeverHappen();this.emitter.emit("inputchange",{bladeController:r,options:s.options,sender:this})}onDescendantLayout_(s){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onDescendantInputChange_(s){this.emitter.emit("inputchange",{bladeController:s.bladeController,options:s.options,sender:this})}onDescendantMonitorUpdate_(s){this.emitter.emit("monitorupdate",{bladeController:s.bladeController,sender:this})}onBladePositionsChange_(){this.updatePositions_()}}class Ti extends pt{constructor(s,r){super(Object.assign(Object.assign({},r),{view:new sr(s,{viewName:"brk",viewProps:r.viewProps})})),this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this);const c=new Pi(r.root?void 0:r.blade);c.emitter.on("add",this.onRackAdd_),c.emitter.on("remove",this.onRackRemove_),this.rack=c,this.viewProps.handleDispose(()=>{for(let _=this.rack.children.length-1;_>=0;_--)this.rack.children[_].viewProps.set("disposed",!0)})}onRackAdd_(s){s.isRoot&&hi(this.view.element,s.bladeController.view.element,s.index)}onRackRemove_(s){s.isRoot&&fs(s.bladeController.view.element)}}const ki=ut("cnt");class Hr{constructor(s,r){var c;this.className_=ut((c=r.viewName)!==null&&c!==void 0?c:"fld"),this.element=s.createElement("div"),this.element.classList.add(this.className_(),ki()),r.viewProps.bindClassModifiers(this.element),this.foldable_=r.foldable,this.foldable_.bindExpandedClass(this.element,this.className_(void 0,"expanded")),mt(this.foldable_,"completed",ht(this.element,this.className_(void 0,"cpl")));const _=s.createElement("button");_.classList.add(this.className_("b")),mt(r.props,"title",G=>{W(G)?this.element.classList.add(this.className_(void 0,"not")):this.element.classList.remove(this.className_(void 0,"not"))}),r.viewProps.bindDisabled(_),this.element.appendChild(_),this.buttonElement=_;const x=s.createElement("div");x.classList.add(this.className_("t")),nt(r.props.value("title"),x),this.buttonElement.appendChild(x),this.titleElement=x;const S=s.createElement("div");S.classList.add(this.className_("m")),this.buttonElement.appendChild(S);const O=r.containerElement;O.classList.add(this.className_("c")),this.element.appendChild(O),this.containerElement=O}}class ne extends Xs{constructor(s,r){var c;const _=Ke.create((c=r.expanded)===null||c===void 0||c),x=new Ti(s,{blade:r.blade,root:r.root,viewProps:r.viewProps});super(Object.assign(Object.assign({},r),{rackController:x,view:new Hr(s,{containerElement:x.view.element,foldable:_,props:r.props,viewName:r.root?"rot":void 0,viewProps:r.viewProps})})),this.onTitleClick_=this.onTitleClick_.bind(this),this.props=r.props,this.foldable=_,Si(this.foldable,this.view.containerElement),this.rackController.rack.emitter.on("add",()=>{this.foldable.cleanUpTransition()}),this.rackController.rack.emitter.on("remove",()=>{this.foldable.cleanUpTransition()}),this.view.buttonElement.addEventListener("click",this.onTitleClick_)}get document(){return this.view.element.ownerDocument}onTitleClick_(){this.foldable.set("expanded",!this.foldable.get("expanded"))}}const Yi={id:"folder",type:"blade",accept(l){const s=ct,r=Qt(l,{title:s.required.string,view:s.required.constant("folder"),expanded:s.optional.boolean});return r?{params:r}:null},controller:l=>new ne(l.document,{blade:l.blade,expanded:l.params.expanded,props:_t.fromObject({title:l.params.title}),viewProps:l.viewProps}),api:l=>l.controller instanceof ne?new Hs(l.controller,l.pool):null};class te extends Oe{constructor(s,r){const c=r.valueController.viewProps;super(Object.assign(Object.assign({},r),{value:r.valueController.value,view:new _s(s,{props:r.props,viewProps:c}),viewProps:c})),this.props=r.props,this.valueController=r.valueController,this.view.valueElement.appendChild(this.valueController.view.element)}}class At extends F{}const vn=ut("spr");class $i{constructor(s,r){this.element=s.createElement("div"),this.element.classList.add(vn()),r.viewProps.bindClassModifiers(this.element);const c=s.createElement("hr");c.classList.add(vn("r")),this.element.appendChild(c)}}class Gs extends pt{constructor(s,r){super(Object.assign(Object.assign({},r),{view:new $i(s,{viewProps:r.viewProps})}))}}const Fo={id:"separator",type:"blade",accept(l){const s=Qt(l,{view:ct.required.constant("separator")});return s?{params:s}:null},controller:l=>new Gs(l.document,{blade:l.blade,viewProps:l.viewProps}),api:l=>l.controller instanceof Gs?new At(l.controller):null},rr=ut("");function Xr(l,s){return ht(l,rr(void 0,s))}class Ze extends _t{constructor(s){super(s)}static create(s){var r,c;const _=s??{},x={disabled:(r=_.disabled)!==null&&r!==void 0&&r,disposed:!1,hidden:(c=_.hidden)!==null&&c!==void 0&&c},S=_t.createCore(x);return new Ze(S)}bindClassModifiers(s){mt(this,"disabled",Xr(s,"disabled")),mt(this,"hidden",Xr(s,"hidden"))}bindDisabled(s){mt(this,"disabled",r=>{s.disabled=r})}bindTabIndex(s){mt(this,"disabled",r=>{s.tabIndex=r?-1:0})}handleDispose(s){this.value("disposed").emitter.on("change",r=>{r&&s()})}}const ue=ut("tbi");class Uo{constructor(s,r){this.element=s.createElement("div"),this.element.classList.add(ue()),r.viewProps.bindClassModifiers(this.element),mt(r.props,"selected",x=>{x?this.element.classList.add(ue(void 0,"sel")):this.element.classList.remove(ue(void 0,"sel"))});const c=s.createElement("button");c.classList.add(ue("b")),r.viewProps.bindDisabled(c),this.element.appendChild(c),this.buttonElement=c;const _=s.createElement("div");_.classList.add(ue("t")),nt(r.props.value("title"),_),this.buttonElement.appendChild(_),this.titleElement=_}}class Lo{constructor(s,r){this.emitter=new tt,this.onClick_=this.onClick_.bind(this),this.props=r.props,this.viewProps=r.viewProps,this.view=new Uo(s,{props:r.props,viewProps:r.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}}class wn{constructor(s,r){this.onItemClick_=this.onItemClick_.bind(this),this.ic_=new Lo(s,{props:r.itemProps,viewProps:Ze.create()}),this.ic_.emitter.on("click",this.onItemClick_),this.cc_=new Ti(s,{blade:di(),viewProps:Ze.create()}),this.props=r.props,mt(this.props,"selected",c=>{this.itemController.props.set("selected",c),this.contentController.viewProps.set("hidden",!c)})}get itemController(){return this.ic_}get contentController(){return this.cc_}onItemClick_(){this.props.set("selected",!0)}}class or{constructor(s,r){this.controller_=s,this.rackApi_=r}get title(){var s;return(s=this.controller_.itemController.props.get("title"))!==null&&s!==void 0?s:""}set title(s){this.controller_.itemController.props.set("title",s)}get selected(){return this.controller_.props.get("selected")}set selected(s){this.controller_.props.set("selected",s)}get children(){return this.rackApi_.children}addButton(s){return this.rackApi_.addButton(s)}addFolder(s){return this.rackApi_.addFolder(s)}addSeparator(s){return this.rackApi_.addSeparator(s)}addTab(s){return this.rackApi_.addTab(s)}add(s,r){this.rackApi_.add(s,r)}remove(s){this.rackApi_.remove(s)}addInput(s,r,c){return this.rackApi_.addInput(s,r,c)}addMonitor(s,r,c){return this.rackApi_.addMonitor(s,r,c)}addBlade(s){return this.rackApi_.addBlade(s)}}class ar extends ze{constructor(s,r){super(s,new ws(s.rackController,r)),this.onPageAdd_=this.onPageAdd_.bind(this),this.onPageRemove_=this.onPageRemove_.bind(this),this.onSelect_=this.onSelect_.bind(this),this.emitter_=new tt,this.pageApiMap_=new Map,this.rackApi_.on("change",c=>{this.emitter_.emit("change",{event:c})}),this.rackApi_.on("update",c=>{this.emitter_.emit("update",{event:c})}),this.controller_.tab.selectedIndex.emitter.on("change",this.onSelect_),this.controller_.pageSet.emitter.on("add",this.onPageAdd_),this.controller_.pageSet.emitter.on("remove",this.onPageRemove_),this.controller_.pageSet.items.forEach(c=>{this.setUpPageApi_(c)})}get pages(){return this.controller_.pageSet.items.map(s=>{const r=this.pageApiMap_.get(s);if(!r)throw J.shouldNeverHappen();return r})}addPage(s){const r=this.controller_.view.element.ownerDocument,c=new wn(r,{itemProps:_t.fromObject({selected:!1,title:s.title}),props:_t.fromObject({selected:!1})});this.controller_.add(c,s.index);const _=this.pageApiMap_.get(c);if(!_)throw J.shouldNeverHappen();return _}removePage(s){this.controller_.remove(s)}on(s,r){const c=r.bind(this);return this.emitter_.on(s,_=>{c(_.event)}),this}setUpPageApi_(s){const r=this.rackApi_.apiSet_.find(_=>_.controller_===s.contentController);if(!r)throw J.shouldNeverHappen();const c=new or(s,r);this.pageApiMap_.set(s,c)}onPageAdd_(s){this.setUpPageApi_(s.item)}onPageRemove_(s){if(!this.pageApiMap_.get(s.item))throw J.shouldNeverHappen();this.pageApiMap_.delete(s.item)}onSelect_(s){this.emitter_.emit("select",{event:new V(this,s.rawValue)})}}class Ie{constructor(){this.onItemSelectedChange_=this.onItemSelectedChange_.bind(this),this.empty=Ot(!0),this.selectedIndex=Ot(-1),this.items_=[]}add(s,r){const c=r??this.items_.length;this.items_.splice(c,0,s),s.emitter.on("change",this.onItemSelectedChange_),this.keepSelection_()}remove(s){const r=this.items_.indexOf(s);r<0||(this.items_.splice(r,1),s.emitter.off("change",this.onItemSelectedChange_),this.keepSelection_())}keepSelection_(){if(this.items_.length===0)return this.selectedIndex.rawValue=-1,void(this.empty.rawValue=!0);const s=this.items_.findIndex(r=>r.rawValue);s<0?(this.items_.forEach((r,c)=>{r.rawValue=c===0}),this.selectedIndex.rawValue=0):(this.items_.forEach((r,c)=>{r.rawValue=c===s}),this.selectedIndex.rawValue=s),this.empty.rawValue=!1}onItemSelectedChange_(s){if(s.rawValue){const r=this.items_.findIndex(c=>c===s.sender);this.items_.forEach((c,_)=>{c.rawValue=_===r}),this.selectedIndex.rawValue=r}else this.keepSelection_()}}const He=ut("tab");class Ii{constructor(s,r){this.element=s.createElement("div"),this.element.classList.add(He(),ki()),r.viewProps.bindClassModifiers(this.element),j(r.empty,ht(this.element,He(void 0,"nop")));const c=s.createElement("div");c.classList.add(He("i")),this.element.appendChild(c),this.itemsElement=c;const _=r.contentsElement;_.classList.add(He("c")),this.element.appendChild(_),this.contentsElement=_}}class zt extends Xs{constructor(s,r){const c=new Ti(s,{blade:r.blade,viewProps:r.viewProps}),_=new Ie;super({blade:r.blade,rackController:c,view:new Ii(s,{contentsElement:c.view.element,empty:_.empty,viewProps:r.viewProps})}),this.onPageAdd_=this.onPageAdd_.bind(this),this.onPageRemove_=this.onPageRemove_.bind(this),this.pageSet_=new ui(()=>null),this.pageSet_.emitter.on("add",this.onPageAdd_),this.pageSet_.emitter.on("remove",this.onPageRemove_),this.tab=_}get pageSet(){return this.pageSet_}add(s,r){this.pageSet_.add(s,r)}remove(s){this.pageSet_.remove(this.pageSet_.items[s])}onPageAdd_(s){const r=s.item;hi(this.view.itemsElement,r.itemController.view.element,s.index),this.rackController.rack.add(r.contentController,s.index),this.tab.add(r.props.value("selected"))}onPageRemove_(s){const r=s.item;fs(r.itemController.view.element),this.rackController.rack.remove(r.contentController),this.tab.remove(r.props.value("selected"))}}const Wr={id:"tab",type:"blade",accept(l){const s=ct,r=Qt(l,{pages:s.required.array(s.required.object({title:s.required.string})),view:s.required.constant("tab")});return r&&r.pages.length!==0?{params:r}:null},controller(l){const s=new zt(l.document,{blade:l.blade,viewProps:l.viewProps});return l.params.pages.forEach(r=>{const c=new wn(l.document,{itemProps:_t.fromObject({selected:!1,title:r.title}),props:_t.fromObject({selected:!1})});s.add(c)}),s},api:l=>l.controller instanceof zt?new ar(l.controller,l.pool):null};class Vo{constructor(){this.disabled=!1,this.emitter=new tt}dispose(){}tick(){this.disabled||this.emitter.emit("tick",{sender:this})}}class Oo{constructor(s,r){this.disabled_=!1,this.timerId_=null,this.onTick_=this.onTick_.bind(this),this.doc_=s,this.emitter=new tt,this.interval_=r,this.setTimer_()}get disabled(){return this.disabled_}set disabled(s){this.disabled_=s,this.disabled_?this.clearTimer_():this.setTimer_()}dispose(){this.clearTimer_()}clearTimer_(){if(this.timerId_===null)return;const s=this.doc_.defaultView;s&&s.clearInterval(this.timerId_),this.timerId_=null}setTimer_(){if(this.clearTimer_(),this.interval_<=0)return;const s=this.doc_.defaultView;s&&(this.timerId_=s.setInterval(this.onTick_,this.interval_))}onTick_(){this.disabled_||this.emitter.emit("tick",{sender:this})}}class qs{constructor(s){this.constraints=s}constrain(s){return this.constraints.reduce((r,c)=>c.constrain(r),s)}}function Je(l,s){if(l instanceof s)return l;if(l instanceof qs){const r=l.constraints.reduce((c,_)=>c||(_ instanceof s?_:null),null);if(r)return r}return null}class js{constructor(s){this.options=s}constrain(s){const r=this.options;return r.length===0||r.filter(c=>c.value===s).length>0?s:r[0].value}}class bs{constructor(s){this.maxValue=s.max,this.minValue=s.min}constrain(s){let r=s;return W(this.minValue)||(r=Math.max(r,this.minValue)),W(this.maxValue)||(r=Math.min(r,this.maxValue)),r}}class ts{constructor(s,r=0){this.step=s,this.origin=r}constrain(s){const r=this.origin%this.step;return r+Math.round((s-r)/this.step)*this.step}}const lr=ut("lst");class zo{constructor(s,r){this.onValueChange_=this.onValueChange_.bind(this),this.props_=r.props,this.element=s.createElement("div"),this.element.classList.add(lr()),r.viewProps.bindClassModifiers(this.element);const c=s.createElement("select");c.classList.add(lr("s")),mt(this.props_,"options",x=>{Zi(c),x.forEach((S,O)=>{const G=s.createElement("option");G.dataset.index=String(O),G.textContent=S.text,G.value=String(S.value),c.appendChild(G)})}),r.viewProps.bindDisabled(c),this.element.appendChild(c),this.selectElement=c;const _=s.createElement("div");_.classList.add(lr("m")),_.appendChild(ke(s,"dropdown")),this.element.appendChild(_),r.value.emitter.on("change",this.onValueChange_),this.value_=r.value,this.update_()}update_(){this.selectElement.value=String(this.value_.rawValue)}onValueChange_(){this.update_()}}class Qs{constructor(s,r){this.onSelectChange_=this.onSelectChange_.bind(this),this.props=r.props,this.value=r.value,this.viewProps=r.viewProps,this.view=new zo(s,{props:this.props,value:this.value,viewProps:this.viewProps}),this.view.selectElement.addEventListener("change",this.onSelectChange_)}onSelectChange_(s){const r=s.currentTarget.selectedOptions.item(0);if(!r)return;const c=Number(r.dataset.index);this.value.rawValue=this.props.get("options")[c].value}}const Gr=ut("pop");class No{constructor(s,r){this.element=s.createElement("div"),this.element.classList.add(Gr()),r.viewProps.bindClassModifiers(this.element),j(r.shows,ht(this.element,Gr(void 0,"v")))}}class qr{constructor(s,r){this.shows=Ot(!1),this.viewProps=r.viewProps,this.view=new No(s,{shows:this.shows,viewProps:this.viewProps})}}const jr=ut("txt");class Ho{constructor(s,r){this.onChange_=this.onChange_.bind(this),this.element=s.createElement("div"),this.element.classList.add(jr()),r.viewProps.bindClassModifiers(this.element),this.props_=r.props,this.props_.emitter.on("change",this.onChange_);const c=s.createElement("input");c.classList.add(jr("i")),c.type="text",r.viewProps.bindDisabled(c),this.element.appendChild(c),this.inputElement=c,r.value.emitter.on("change",this.onChange_),this.value_=r.value,this.refresh()}refresh(){const s=this.props_.get("formatter");this.inputElement.value=s(this.value_.rawValue)}onChange_(){this.refresh()}}class bn{constructor(s,r){this.onInputChange_=this.onInputChange_.bind(this),this.parser_=r.parser,this.props=r.props,this.value=r.value,this.viewProps=r.viewProps,this.view=new Ho(s,{props:r.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(s){const r=s.currentTarget.value,c=this.parser_(r);W(c)||(this.value.rawValue=c),this.view.refresh()}}function hr(l){return l!=="false"&&!!l}function Qr(l){return function(s){return String(s)}(l)}class wt{constructor(s){this.text=s}evaluate(){return Number(this.text)}toString(){return this.text}}const Xo={"**":(l,s)=>Math.pow(l,s),"*":(l,s)=>l*s,"/":(l,s)=>l/s,"%":(l,s)=>l%s,"+":(l,s)=>l+s,"-":(l,s)=>l-s,"<<":(l,s)=>l<<s,">>":(l,s)=>l>>s,">>>":(l,s)=>l>>>s,"&":(l,s)=>l&s,"^":(l,s)=>l^s,"|":(l,s)=>l|s};class Ks{constructor(s,r,c){this.left=r,this.operator=s,this.right=c}evaluate(){const s=Xo[this.operator];if(!s)throw new Error(`unexpected binary operator: '${this.operator}`);return s(this.left.evaluate(),this.right.evaluate())}toString(){return["b(",this.left.toString(),this.operator,this.right.toString(),")"].join(" ")}}const Nt={"+":l=>l,"-":l=>-l,"~":l=>~l};class Wo{constructor(s,r){this.operator=s,this.expression=r}evaluate(){const s=Nt[this.operator];if(!s)throw new Error(`unexpected unary operator: '${this.operator}`);return s(this.expression.evaluate())}toString(){return["u(",this.operator,this.expression.toString(),")"].join(" ")}}function xs(l){return(s,r)=>{for(let c=0;c<l.length;c++){const _=l[c](s,r);if(_!=="")return _}return""}}function Ut(l,s){var r;const c=l.substr(s).match(/^\s+/);return(r=c&&c[0])!==null&&r!==void 0?r:""}function es(l,s){var r;const c=l.substr(s).match(/^[0-9]+/);return(r=c&&c[0])!==null&&r!==void 0?r:""}function Zs(l,s){const r=l.substr(s,1);if(s+=1,r.toLowerCase()!=="e")return"";const c=function(_,x){const S=es(_,x);if(S!=="")return S;const O=_.substr(x,1);if(O!=="-"&&O!=="+")return"";const G=es(_,x+=1);return G===""?"":O+G}(l,s);return c===""?"":r+c}function is(l,s){const r=l.substr(s,1);if(r==="0")return r;const c=function(_,x){const S=_.substr(x,1);return S.match(/^[1-9]$/)?S:""}(l,s);return s+=c.length,c===""?"":c+es(l,s)}const Go=xs([function(l,s){const r=is(l,s);if(s+=r.length,r==="")return"";const c=l.substr(s,1);if(s+=c.length,c!==".")return"";const _=es(l,s);return r+c+_+Zs(l,s+=_.length)},function(l,s){const r=l.substr(s,1);if(s+=r.length,r!==".")return"";const c=es(l,s);return s+=c.length,c===""?"":r+c+Zs(l,s)},function(l,s){const r=is(l,s);return s+=r.length,r===""?"":r+Zs(l,s)}]),ss=xs([function(l,s){const r=l.substr(s,2);if(s+=r.length,r.toLowerCase()!=="0b")return"";const c=function(_,x){var S;const O=_.substr(x).match(/^[01]+/);return(S=O&&O[0])!==null&&S!==void 0?S:""}(l,s);return c===""?"":r+c},function(l,s){const r=l.substr(s,2);if(s+=r.length,r.toLowerCase()!=="0o")return"";const c=function(_,x){var S;const O=_.substr(x).match(/^[0-7]+/);return(S=O&&O[0])!==null&&S!==void 0?S:""}(l,s);return c===""?"":r+c},function(l,s){const r=l.substr(s,2);if(s+=r.length,r.toLowerCase()!=="0x")return"";const c=function(_,x){var S;const O=_.substr(x).match(/^[0-9a-f]+/i);return(S=O&&O[0])!==null&&S!==void 0?S:""}(l,s);return c===""?"":r+c}]),Re=xs([ss,Go]);function cr(l,s){var r;return(r=function(c,_){const x=Re(c,_);return _+=x.length,x===""?null:{evaluable:new wt(x),cursor:_}}(l,s))!==null&&r!==void 0?r:function(c,_){const x=c.substr(_,1);if(_+=x.length,x!=="(")return null;const S=xn(c,_);if(!S)return null;_=S.cursor,_+=Ut(c,_).length;const O=c.substr(_,1);return _+=O.length,O!==")"?null:{evaluable:S.evaluable,cursor:_}}(l,s)}function qo(l,s,r){r+=Ut(s,r).length;const c=l.filter(_=>s.startsWith(_,r))[0];return c?(r+=c.length,{cursor:r+=Ut(s,r).length,operator:c}):null}const jo=[["**"],["*","/","%"],["+","-"],["<<",">>>",">>"],["&"],["^"],["|"]].reduce((l,s)=>function(r,c){return(_,x)=>{const S=r(_,x);if(!S)return null;x=S.cursor;let O=S.evaluable;for(;;){const G=qo(c,_,x);if(!G)break;x=G.cursor;const it=r(_,x);if(!it)return null;x=it.cursor,O=new Ks(G.operator,O,it.evaluable)}return O?{cursor:x,evaluable:O}:null}}(l,s),function l(s,r){const c=cr(s,r);if(c)return c;const _=s.substr(r,1);if(r+=_.length,_!=="+"&&_!=="-"&&_!=="~")return null;const x=l(s,r);return x?{cursor:r=x.cursor,evaluable:new Wo(_,x.evaluable)}:null});function xn(l,s){return s+=Ut(l,s).length,jo(l,s)}function fi(l){var s;const r=function(c){const _=xn(c,0);return _?_.cursor+Ut(c,_.cursor).length!==c.length?null:_.evaluable:null}(l);return(s=r==null?void 0:r.evaluate())!==null&&s!==void 0?s:null}function Kr(l){if(typeof l=="number")return l;if(typeof l=="string"){const s=fi(l);if(!W(s))return s}return 0}function Qo(l){return String(l)}function Ht(l){return s=>s.toFixed(Math.max(Math.min(l,20),0))}const yn=Ht(0);function ys(l){return yn(l)+"%"}function Js(l){return String(l)}function An(l){return l}function Cn(l,s){for(;l.length<s;)l.push(void 0)}function Ri(l){const s=[];return Cn(s,l),Ot(s)}function Zr(l){const s=l.indexOf(void 0);return s<0?l:l.slice(0,s)}function Ys({primary:l,secondary:s,forward:r,backward:c}){let _=!1;function x(S){_||(_=!0,S(),_=!1)}l.emitter.on("change",S=>{x(()=>{s.setRawValue(r(l,s),S.options)})}),s.emitter.on("change",S=>{x(()=>{l.setRawValue(c(l,s),S.options)}),x(()=>{s.setRawValue(r(l,s),S.options)})}),x(()=>{s.setRawValue(r(l,s),{forceEmit:!1,last:!0})})}function pe(l,s){const r=l*(s.altKey?.1:1)*(s.shiftKey?10:1);return s.upKey?+r:s.downKey?-r:0}function As(l){return{altKey:l.altKey,downKey:l.key==="ArrowDown",shiftKey:l.shiftKey,upKey:l.key==="ArrowUp"}}function Ye(l){return{altKey:l.altKey,downKey:l.key==="ArrowLeft",shiftKey:l.shiftKey,upKey:l.key==="ArrowRight"}}function dr(l){return function(s){return s==="ArrowUp"||s==="ArrowDown"}(l)||l==="ArrowLeft"||l==="ArrowRight"}function dt(l,s){var r,c;const _=s.ownerDocument.defaultView,x=s.getBoundingClientRect();return{x:l.pageX-(((r=_&&_.scrollX)!==null&&r!==void 0?r:0)+x.left),y:l.pageY-(((c=_&&_.scrollY)!==null&&c!==void 0?c:0)+x.top)}}class Bi{constructor(s){this.lastTouch_=null,this.onDocumentMouseMove_=this.onDocumentMouseMove_.bind(this),this.onDocumentMouseUp_=this.onDocumentMouseUp_.bind(this),this.onMouseDown_=this.onMouseDown_.bind(this),this.onTouchEnd_=this.onTouchEnd_.bind(this),this.onTouchMove_=this.onTouchMove_.bind(this),this.onTouchStart_=this.onTouchStart_.bind(this),this.elem_=s,this.emitter=new tt,s.addEventListener("touchstart",this.onTouchStart_,{passive:!1}),s.addEventListener("touchmove",this.onTouchMove_,{passive:!0}),s.addEventListener("touchend",this.onTouchEnd_),s.addEventListener("mousedown",this.onMouseDown_)}computePosition_(s){const r=this.elem_.getBoundingClientRect();return{bounds:{width:r.width,height:r.height},point:s?{x:s.x,y:s.y}:null}}onMouseDown_(s){var r;s.preventDefault(),(r=s.currentTarget)===null||r===void 0||r.focus();const c=this.elem_.ownerDocument;c.addEventListener("mousemove",this.onDocumentMouseMove_),c.addEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("down",{altKey:s.altKey,data:this.computePosition_(dt(s,this.elem_)),sender:this,shiftKey:s.shiftKey})}onDocumentMouseMove_(s){this.emitter.emit("move",{altKey:s.altKey,data:this.computePosition_(dt(s,this.elem_)),sender:this,shiftKey:s.shiftKey})}onDocumentMouseUp_(s){const r=this.elem_.ownerDocument;r.removeEventListener("mousemove",this.onDocumentMouseMove_),r.removeEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("up",{altKey:s.altKey,data:this.computePosition_(dt(s,this.elem_)),sender:this,shiftKey:s.shiftKey})}onTouchStart_(s){s.preventDefault();const r=s.targetTouches.item(0),c=this.elem_.getBoundingClientRect();this.emitter.emit("down",{altKey:s.altKey,data:this.computePosition_(r?{x:r.clientX-c.left,y:r.clientY-c.top}:void 0),sender:this,shiftKey:s.shiftKey}),this.lastTouch_=r}onTouchMove_(s){const r=s.targetTouches.item(0),c=this.elem_.getBoundingClientRect();this.emitter.emit("move",{altKey:s.altKey,data:this.computePosition_(r?{x:r.clientX-c.left,y:r.clientY-c.top}:void 0),sender:this,shiftKey:s.shiftKey}),this.lastTouch_=r}onTouchEnd_(s){var r;const c=(r=s.targetTouches.item(0))!==null&&r!==void 0?r:this.lastTouch_,_=this.elem_.getBoundingClientRect();this.emitter.emit("up",{altKey:s.altKey,data:this.computePosition_(c?{x:c.clientX-_.left,y:c.clientY-_.top}:void 0),sender:this,shiftKey:s.shiftKey})}}function Ct(l,s,r,c,_){return c+(l-s)/(r-s)*(_-c)}function Jr(l){return String(l.toFixed(10)).split(".")[1].replace(/0+$/,"").length}function Xt(l,s,r){return Math.min(Math.max(l,s),r)}function ur(l,s){return(l%s+s)%s}const Be=ut("txt");class ns{constructor(s,r){this.onChange_=this.onChange_.bind(this),this.props_=r.props,this.props_.emitter.on("change",this.onChange_),this.element=s.createElement("div"),this.element.classList.add(Be(),Be(void 0,"num")),r.arrayPosition&&this.element.classList.add(Be(void 0,r.arrayPosition)),r.viewProps.bindClassModifiers(this.element);const c=s.createElement("input");c.classList.add(Be("i")),c.type="text",r.viewProps.bindDisabled(c),this.element.appendChild(c),this.inputElement=c,this.onDraggingChange_=this.onDraggingChange_.bind(this),this.dragging_=r.dragging,this.dragging_.emitter.on("change",this.onDraggingChange_),this.element.classList.add(Be()),this.inputElement.classList.add(Be("i"));const _=s.createElement("div");_.classList.add(Be("k")),this.element.appendChild(_),this.knobElement=_;const x=s.createElementNS(se,"svg");x.classList.add(Be("g")),this.knobElement.appendChild(x);const S=s.createElementNS(se,"path");S.classList.add(Be("gb")),x.appendChild(S),this.guideBodyElem_=S;const O=s.createElementNS(se,"path");O.classList.add(Be("gh")),x.appendChild(O),this.guideHeadElem_=O;const G=s.createElement("div");G.classList.add(ut("tt")()),this.knobElement.appendChild(G),this.tooltipElem_=G,r.value.emitter.on("change",this.onChange_),this.value=r.value,this.refresh()}onDraggingChange_(s){if(s.rawValue===null)return void this.element.classList.remove(Be(void 0,"drg"));this.element.classList.add(Be(void 0,"drg"));const r=s.rawValue/this.props_.get("draggingScale"),c=r+(r>0?-1:r<0?1:0),_=Xt(-c,-4,4);this.guideHeadElem_.setAttributeNS(null,"d",[`M ${c+_},0 L${c},4 L${c+_},8`,`M ${r},-1 L${r},9`].join(" ")),this.guideBodyElem_.setAttributeNS(null,"d",`M 0,4 L${r},4`);const x=this.props_.get("formatter");this.tooltipElem_.textContent=x(this.value.rawValue),this.tooltipElem_.style.left=`${r}px`}refresh(){const s=this.props_.get("formatter");this.inputElement.value=s(this.value.rawValue)}onChange_(){this.refresh()}}class Di{constructor(s,r){var c;this.originRawValue_=0,this.onInputChange_=this.onInputChange_.bind(this),this.onInputKeyDown_=this.onInputKeyDown_.bind(this),this.onInputKeyUp_=this.onInputKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.baseStep_=r.baseStep,this.parser_=r.parser,this.props=r.props,this.sliderProps_=(c=r.sliderProps)!==null&&c!==void 0?c:null,this.value=r.value,this.viewProps=r.viewProps,this.dragging_=Ot(null),this.view=new ns(s,{arrayPosition:r.arrayPosition,dragging:this.dragging_,props:this.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_),this.view.inputElement.addEventListener("keydown",this.onInputKeyDown_),this.view.inputElement.addEventListener("keyup",this.onInputKeyUp_);const _=new Bi(this.view.knobElement);_.emitter.on("down",this.onPointerDown_),_.emitter.on("move",this.onPointerMove_),_.emitter.on("up",this.onPointerUp_)}constrainValue_(s){var r,c;const _=(r=this.sliderProps_)===null||r===void 0?void 0:r.get("minValue"),x=(c=this.sliderProps_)===null||c===void 0?void 0:c.get("maxValue");let S=s;return _!==void 0&&(S=Math.max(S,_)),x!==void 0&&(S=Math.min(S,x)),S}onInputChange_(s){const r=s.currentTarget.value,c=this.parser_(r);W(c)||(this.value.rawValue=this.constrainValue_(c)),this.view.refresh()}onInputKeyDown_(s){const r=pe(this.baseStep_,As(s));r!==0&&this.value.setRawValue(this.constrainValue_(this.value.rawValue+r),{forceEmit:!1,last:!1})}onInputKeyUp_(s){pe(this.baseStep_,As(s))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}onPointerDown_(){this.originRawValue_=this.value.rawValue,this.dragging_.rawValue=0}computeDraggingValue_(s){if(!s.point)return null;const r=s.point.x-s.bounds.width/2;return this.constrainValue_(this.originRawValue_+r*this.props.get("draggingScale"))}onPointerMove_(s){const r=this.computeDraggingValue_(s.data);r!==null&&(this.value.setRawValue(r,{forceEmit:!1,last:!1}),this.dragging_.rawValue=this.value.rawValue-this.originRawValue_)}onPointerUp_(s){const r=this.computeDraggingValue_(s.data);r!==null&&(this.value.setRawValue(r,{forceEmit:!0,last:!0}),this.dragging_.rawValue=null)}}const Cs=ut("sld");class ot{constructor(s,r){this.onChange_=this.onChange_.bind(this),this.props_=r.props,this.props_.emitter.on("change",this.onChange_),this.element=s.createElement("div"),this.element.classList.add(Cs()),r.viewProps.bindClassModifiers(this.element);const c=s.createElement("div");c.classList.add(Cs("t")),r.viewProps.bindTabIndex(c),this.element.appendChild(c),this.trackElement=c;const _=s.createElement("div");_.classList.add(Cs("k")),this.trackElement.appendChild(_),this.knobElement=_,r.value.emitter.on("change",this.onChange_),this.value=r.value,this.update_()}update_(){const s=Xt(Ct(this.value.rawValue,this.props_.get("minValue"),this.props_.get("maxValue"),0,100),0,100);this.knobElement.style.width=`${s}%`}onChange_(){this.update_()}}class xe{constructor(s,r){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDownOrMove_=this.onPointerDownOrMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.baseStep_=r.baseStep,this.value=r.value,this.viewProps=r.viewProps,this.props=r.props,this.view=new ot(s,{props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Bi(this.view.trackElement),this.ptHandler_.emitter.on("down",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("move",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.trackElement.addEventListener("keydown",this.onKeyDown_),this.view.trackElement.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(s,r){s.point&&this.value.setRawValue(Ct(Xt(s.point.x,0,s.bounds.width),0,s.bounds.width,this.props.get("minValue"),this.props.get("maxValue")),r)}onPointerDownOrMove_(s){this.handlePointerEvent_(s.data,{forceEmit:!1,last:!1})}onPointerUp_(s){this.handlePointerEvent_(s.data,{forceEmit:!0,last:!0})}onKeyDown_(s){const r=pe(this.baseStep_,Ye(s));r!==0&&this.value.setRawValue(this.value.rawValue+r,{forceEmit:!1,last:!1})}onKeyUp_(s){pe(this.baseStep_,Ye(s))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const $s=ut("sldtxt");class Yr{constructor(s,r){this.element=s.createElement("div"),this.element.classList.add($s());const c=s.createElement("div");c.classList.add($s("s")),this.sliderView_=r.sliderView,c.appendChild(this.sliderView_.element),this.element.appendChild(c);const _=s.createElement("div");_.classList.add($s("t")),this.textView_=r.textView,_.appendChild(this.textView_.element),this.element.appendChild(_)}}class rs{constructor(s,r){this.value=r.value,this.viewProps=r.viewProps,this.sliderC_=new xe(s,{baseStep:r.baseStep,props:r.sliderProps,value:r.value,viewProps:this.viewProps}),this.textC_=new Di(s,{baseStep:r.baseStep,parser:r.parser,props:r.textProps,sliderProps:r.sliderProps,value:r.value,viewProps:r.viewProps}),this.view=new Yr(s,{sliderView:this.sliderC_.view,textView:this.textC_.view})}get sliderController(){return this.sliderC_}get textController(){return this.textC_}}function tn(l,s){l.write(s)}function re(l){const s=ct;return Array.isArray(l)?s.required.array(s.required.object({text:s.required.string,value:s.required.raw}))(l).value:typeof l=="object"?s.required.raw(l).value:void 0}function En(l){if(l==="inline"||l==="popup")return l}function ee(l){const s=ct;return s.required.object({max:s.optional.number,min:s.optional.number,step:s.optional.number})(l).value}function $(l){if(Array.isArray(l))return l;const s=[];return Object.keys(l).forEach(r=>{s.push({text:r,value:l[r]})}),s}function Bt(l){return W(l)?null:new js($(l))}function Pe(l){const s=l?Je(l,js):null;return s?s.options:null}function oe(l,s){const r=l&&Je(l,ts);return r?Jr(r.step):Math.max(Jr(s),2)}function $e(l){const s=function(r){const c=r?Je(r,ts):null;return c?c.step:null}(l);return s??1}function Mi(l,s){var r;const c=l&&Je(l,ts),_=Math.abs((r=c==null?void 0:c.step)!==null&&r!==void 0?r:s);return _===0?.1:Math.pow(10,Math.floor(Math.log10(_))-1)}const Es=ut("ckb");class _i{constructor(s,r){this.onValueChange_=this.onValueChange_.bind(this),this.element=s.createElement("div"),this.element.classList.add(Es()),r.viewProps.bindClassModifiers(this.element);const c=s.createElement("label");c.classList.add(Es("l")),this.element.appendChild(c);const _=s.createElement("input");_.classList.add(Es("i")),_.type="checkbox",c.appendChild(_),this.inputElement=_,r.viewProps.bindDisabled(this.inputElement);const x=s.createElement("div");x.classList.add(Es("w")),c.appendChild(x);const S=ke(s,"check");x.appendChild(S),r.value.emitter.on("change",this.onValueChange_),this.value=r.value,this.update_()}update_(){this.inputElement.checked=this.value.rawValue}onValueChange_(){this.update_()}}class pr{constructor(s,r){this.onInputChange_=this.onInputChange_.bind(this),this.value=r.value,this.viewProps=r.viewProps,this.view=new _i(s,{value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(s){const r=s.currentTarget;this.value.rawValue=r.checked}}const Fi={id:"input-bool",type:"input",accept:(l,s)=>{if(typeof l!="boolean")return null;const r=Qt(s,{options:ct.optional.custom(re)});return r?{initialValue:l,params:r}:null},binding:{reader:l=>hr,constraint:l=>function(s){const r=[],c=Bt(s.options);return c&&r.push(c),new qs(r)}(l.params),writer:l=>tn},controller:l=>{var s;const r=l.document,c=l.value,_=l.constraint;return _&&Je(_,js)?new Qs(r,{props:_t.fromObject({options:(s=Pe(_))!==null&&s!==void 0?s:[]}),value:c,viewProps:l.viewProps}):new pr(r,{value:c,viewProps:l.viewProps})}},Wt=ut("col");class fe{constructor(s,r){this.element=s.createElement("div"),this.element.classList.add(Wt()),r.foldable.bindExpandedClass(this.element,Wt(void 0,"expanded")),mt(r.foldable,"completed",ht(this.element,Wt(void 0,"cpl")));const c=s.createElement("div");c.classList.add(Wt("h")),this.element.appendChild(c);const _=s.createElement("div");_.classList.add(Wt("s")),c.appendChild(_),this.swatchElement=_;const x=s.createElement("div");if(x.classList.add(Wt("t")),c.appendChild(x),this.textElement=x,r.pickerLayout==="inline"){const S=s.createElement("div");S.classList.add(Wt("p")),this.element.appendChild(S),this.pickerElement=S}else this.pickerElement=null}}function en(l,s,r){const c=ur(l,360),_=Xt(s/100,0,1),x=Xt(r/100,0,1),S=x*_,O=S*(1-Math.abs(c/60%2-1)),G=x-S;let it,xt,Zt;return[it,xt,Zt]=c>=0&&c<60?[S,O,0]:c>=60&&c<120?[O,S,0]:c>=120&&c<180?[0,S,O]:c>=180&&c<240?[0,O,S]:c>=240&&c<300?[O,0,S]:[S,0,O],[255*(it+G),255*(xt+G),255*(Zt+G)]}function ae(l){return[l[0],l[1],l[2]]}function Yt(l,s){return[l[0],l[1],l[2],s]}const os={hsl:{hsl:(l,s,r)=>[l,s,r],hsv:function(l,s,r){const c=r+s*(100-Math.abs(2*r-100))/200;return[l,c!==0?s*(100-Math.abs(2*r-100))/c:0,r+s*(100-Math.abs(2*r-100))/200]},rgb:function(l,s,r){const c=(l%360+360)%360,_=Xt(s/100,0,1),x=Xt(r/100,0,1),S=(1-Math.abs(2*x-1))*_,O=S*(1-Math.abs(c/60%2-1)),G=x-S/2;let it,xt,Zt;return[it,xt,Zt]=c>=0&&c<60?[S,O,0]:c>=60&&c<120?[O,S,0]:c>=120&&c<180?[0,S,O]:c>=180&&c<240?[0,O,S]:c>=240&&c<300?[O,0,S]:[S,0,O],[255*(it+G),255*(xt+G),255*(Zt+G)]}},hsv:{hsl:function(l,s,r){const c=100-Math.abs(r*(200-s)/100-100);return[l,c!==0?s*r/c:0,r*(200-s)/200]},hsv:(l,s,r)=>[l,s,r],rgb:en},rgb:{hsl:function(l,s,r){const c=Xt(l/255,0,1),_=Xt(s/255,0,1),x=Xt(r/255,0,1),S=Math.max(c,_,x),O=Math.min(c,_,x),G=S-O;let it=0,xt=0;const Zt=(O+S)/2;return G!==0&&(xt=G/(1-Math.abs(S+O-1)),it=c===S?(_-x)/G:_===S?2+(x-c)/G:4+(c-_)/G,it=it/6+(it<0?1:0)),[360*it,100*xt,100*Zt]},hsv:function(l,s,r){const c=Xt(l/255,0,1),_=Xt(s/255,0,1),x=Xt(r/255,0,1),S=Math.max(c,_,x),O=S-Math.min(c,_,x);let G;return G=O===0?0:S===c?((_-x)/O%6+6)%6*60:S===_?60*((x-c)/O+2):60*((c-_)/O+4),[G,100*(S===0?0:O/S),100*S]},rgb:(l,s,r)=>[l,s,r]}};function Ss(l,s){return[s==="float"?1:l==="rgb"?255:360,s==="float"?1:l==="rgb"?255:100,s==="float"?1:l==="rgb"?255:100]}function De(l,s,r,c){const _=Ss(s,r),x=Ss(s,c);return l.map((S,O)=>S/_[O]*x[O])}function ie(l,s){return typeof l=="object"&&!W(l)&&s in l&&typeof l[s]=="number"}class lt{constructor(s,r,c="int"){this.mode=r,this.type=c,this.comps_=function(_,x,S){var O;const G=Ss(x,S);return[x==="rgb"?Xt(_[0],0,G[0]):ur(_[0],G[0]),Xt(_[1],0,G[1]),Xt(_[2],0,G[2]),Xt((O=_[3])!==null&&O!==void 0?O:1,0,1)]}(s,r,c)}static black(s="int"){return new lt([0,0,0],"rgb",s)}static fromObject(s,r="int"){const c="a"in s?[s.r,s.g,s.b,s.a]:[s.r,s.g,s.b];return new lt(c,"rgb",r)}static toRgbaObject(s,r="int"){return s.toRgbaObject(r)}static isRgbColorObject(s){return ie(s,"r")&&ie(s,"g")&&ie(s,"b")}static isRgbaColorObject(s){return this.isRgbColorObject(s)&&ie(s,"a")}static isColorObject(s){return this.isRgbColorObject(s)}static equals(s,r){if(s.mode!==r.mode)return!1;const c=s.comps_,_=r.comps_;for(let x=0;x<c.length;x++)if(c[x]!==_[x])return!1;return!0}getComponents(s,r="int"){return Yt(function(c,_,x){const S=De(c,_.mode,_.type,"int");return De(os[_.mode][x.mode](...S),x.mode,"int",x.type)}(ae(this.comps_),{mode:this.mode,type:this.type},{mode:s??this.mode,type:r}),this.comps_[3])}toRgbaObject(s="int"){const r=this.getComponents("rgb",s);return{r:r[0],g:r[1],b:r[2],a:r[3]}}}const Dt=ut("colp");class Kt{constructor(s,r){this.alphaViews_=null,this.element=s.createElement("div"),this.element.classList.add(Dt());const c=s.createElement("div");c.classList.add(Dt("hsv"));const _=s.createElement("div");_.classList.add(Dt("sv")),this.svPaletteView_=r.svPaletteView,_.appendChild(this.svPaletteView_.element),c.appendChild(_);const x=s.createElement("div");x.classList.add(Dt("h")),this.hPaletteView_=r.hPaletteView,x.appendChild(this.hPaletteView_.element),c.appendChild(x),this.element.appendChild(c);const S=s.createElement("div");if(S.classList.add(Dt("rgb")),this.textView_=r.textView,S.appendChild(this.textView_.element),this.element.appendChild(S),r.alphaViews){this.alphaViews_={palette:r.alphaViews.palette,text:r.alphaViews.text};const O=s.createElement("div");O.classList.add(Dt("a"));const G=s.createElement("div");G.classList.add(Dt("ap")),G.appendChild(this.alphaViews_.palette.element),O.appendChild(G);const it=s.createElement("div");it.classList.add(Dt("at")),it.appendChild(this.alphaViews_.text.element),O.appendChild(it),this.element.appendChild(O)}}get allFocusableElements(){const s=[this.svPaletteView_.element,this.hPaletteView_.element,this.textView_.modeSelectElement,...this.textView_.textViews.map(r=>r.inputElement)];return this.alphaViews_&&s.push(this.alphaViews_.palette.element,this.alphaViews_.text.inputElement),s}}function _e(l){return l==="int"?"int":l==="float"?"float":void 0}function vt(l){const s=ct;return Qt(l,{alpha:s.optional.boolean,color:s.optional.object({alpha:s.optional.boolean,type:s.optional.custom(_e)}),expanded:s.optional.boolean,picker:s.optional.custom(En)})}function Ui(l){return l?.1:1}function Li(l){var s;return(s=l.color)===null||s===void 0?void 0:s.type}function Te(l,s){const r=l.match(/^(.+)%$/);return Math.min(r?.01*parseFloat(r[1])*s:parseFloat(l),s)}const $r={deg:l=>l,grad:l=>360*l/400,rad:l=>360*l/(2*Math.PI),turn:l=>360*l};function $t(l){const s=l.match(/^([0-9.]+?)(deg|grad|rad|turn)$/);if(!s)return parseFloat(l);const r=parseFloat(s[1]),c=s[2];return $r[c](r)}function Sn(l){const s=l.match(/^rgb\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!s)return null;const r=[Te(s[1],255),Te(s[2],255),Te(s[3],255)];return isNaN(r[0])||isNaN(r[1])||isNaN(r[2])?null:r}function Pn(l){return s=>{const r=Sn(s);return r?new lt(r,"rgb",l):null}}function fr(l){const s=l.match(/^rgba\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!s)return null;const r=[Te(s[1],255),Te(s[2],255),Te(s[3],255),Te(s[4],1)];return isNaN(r[0])||isNaN(r[1])||isNaN(r[2])||isNaN(r[3])?null:r}function le(l){return s=>{const r=fr(s);return r?new lt(r,"rgb",l):null}}function sn(l){const s=l.match(/^hsl\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!s)return null;const r=[$t(s[1]),Te(s[2],100),Te(s[3],100)];return isNaN(r[0])||isNaN(r[1])||isNaN(r[2])?null:r}function nn(l){return s=>{const r=sn(s);return r?new lt(r,"hsl",l):null}}function as(l){const s=l.match(/^hsla\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!s)return null;const r=[$t(s[1]),Te(s[2],100),Te(s[3],100),Te(s[4],1)];return isNaN(r[0])||isNaN(r[1])||isNaN(r[2])||isNaN(r[3])?null:r}function Mt(l){return s=>{const r=as(s);return r?new lt(r,"hsl",l):null}}function _r(l){const s=l.match(/^#([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(s)return[parseInt(s[1]+s[1],16),parseInt(s[2]+s[2],16),parseInt(s[3]+s[3],16)];const r=l.match(/^(?:#|0x)([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return r?[parseInt(r[1],16),parseInt(r[2],16),parseInt(r[3],16)]:null}function gr(l){const s=l.match(/^#?([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(s)return[parseInt(s[1]+s[1],16),parseInt(s[2]+s[2],16),parseInt(s[3]+s[3],16),Ct(parseInt(s[4]+s[4],16),0,255,0,1)];const r=l.match(/^(?:#|0x)?([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return r?[parseInt(r[1],16),parseInt(r[2],16),parseInt(r[3],16),Ct(parseInt(r[4],16),0,255,0,1)]:null}function mr(l){const s=l.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!s)return null;const r=[parseFloat(s[1]),parseFloat(s[2]),parseFloat(s[3])];return isNaN(r[0])||isNaN(r[1])||isNaN(r[2])?null:r}function vr(l){return s=>{const r=mr(s);return r?new lt(r,"rgb",l):null}}function wr(l){const s=l.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*a\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!s)return null;const r=[parseFloat(s[1]),parseFloat(s[2]),parseFloat(s[3]),parseFloat(s[4])];return isNaN(r[0])||isNaN(r[1])||isNaN(r[2])||isNaN(r[3])?null:r}function ye(l){return s=>{const r=wr(s);return r?new lt(r,"rgb",l):null}}const to=[{parser:_r,result:{alpha:!1,mode:"rgb",notation:"hex"}},{parser:gr,result:{alpha:!0,mode:"rgb",notation:"hex"}},{parser:Sn,result:{alpha:!1,mode:"rgb",notation:"func"}},{parser:fr,result:{alpha:!0,mode:"rgb",notation:"func"}},{parser:sn,result:{alpha:!1,mode:"hsl",notation:"func"}},{parser:as,result:{alpha:!0,mode:"hsl",notation:"func"}},{parser:mr,result:{alpha:!1,mode:"rgb",notation:"object"}},{parser:wr,result:{alpha:!0,mode:"rgb",notation:"object"}}];function Tn(l,s="int"){const r=function(c){return to.reduce((_,{parser:x,result:S})=>_||(x(c)?S:null),null)}(l);return r?r.notation==="hex"&&s!=="float"?Object.assign(Object.assign({},r),{type:"int"}):r.notation==="func"?Object.assign(Object.assign({},r),{type:s}):null:null}const br={int:[function(l){const s=_r(l);return s?new lt(s,"rgb","int"):null},function(l){const s=gr(l);return s?new lt(s,"rgb","int"):null},Pn("int"),le("int"),nn("int"),Mt("int"),vr("int"),ye("int")],float:[Pn("float"),le("float"),nn("float"),Mt("float"),vr("float"),ye("float")]};function kn(l){const s=br[l];return r=>s.reduce((c,_)=>c||_(r),null)}function xr(l){const s=Xt(Math.floor(l),0,255).toString(16);return s.length===1?`0${s}`:s}function yr(l,s="#"){return`${s}${ae(l.getComponents("rgb")).map(xr).join("")}`}function In(l,s="#"){const r=l.getComponents("rgb");return`${s}${[r[0],r[1],r[2],255*r[3]].map(xr).join("")}`}function Ar(l,s){const r=Ht(s==="float"?2:0);return`rgb(${ae(l.getComponents("rgb",s)).map(c=>r(c)).join(", ")})`}function eo(l){return s=>Ar(s,l)}function rn(l,s){const r=Ht(2),c=Ht(s==="float"?2:0);return`rgba(${l.getComponents("rgb",s).map((_,x)=>(x===3?r:c)(_)).join(", ")})`}function io(l){return s=>rn(s,l)}function Rn(l,s){const r=Ht(s==="float"?2:0),c=["r","g","b"];return`{${ae(l.getComponents("rgb",s)).map((_,x)=>`${c[x]}: ${r(_)}`).join(", ")}}`}function Cr(l){return s=>Rn(s,l)}function Ps(l,s){const r=Ht(2),c=Ht(s==="float"?2:0),_=["r","g","b","a"];return`{${l.getComponents("rgb",s).map((x,S)=>`${_[S]}: ${(S===3?r:c)(x)}`).join(", ")}}`}function Ts(l){return s=>Ps(s,l)}const Bn=[{format:{alpha:!1,mode:"rgb",notation:"hex",type:"int"},stringifier:yr},{format:{alpha:!0,mode:"rgb",notation:"hex",type:"int"},stringifier:In},{format:{alpha:!1,mode:"hsl",notation:"func",type:"int"},stringifier:function(l){const s=[Ht(0),ys,ys];return`hsl(${ae(l.getComponents("hsl")).map((r,c)=>s[c](r)).join(", ")})`}},{format:{alpha:!0,mode:"hsl",notation:"func",type:"int"},stringifier:function(l){const s=[Ht(0),ys,ys,Ht(2)];return`hsla(${l.getComponents("hsl").map((r,c)=>s[c](r)).join(", ")})`}},...["int","float"].reduce((l,s)=>[...l,{format:{alpha:!1,mode:"rgb",notation:"func",type:s},stringifier:eo(s)},{format:{alpha:!0,mode:"rgb",notation:"func",type:s},stringifier:io(s)},{format:{alpha:!1,mode:"rgb",notation:"object",type:s},stringifier:Cr(s)},{format:{alpha:!0,mode:"rgb",notation:"object",type:s},stringifier:Ts(s)}],[])];function ks(l){return Bn.reduce((s,r)=>{return s||(c=r.format,_=l,c.alpha===_.alpha&&c.mode===_.mode&&c.notation===_.notation&&c.type===_.type?r.stringifier:null);var c,_},null)}const Vi=ut("apl");class Dn{constructor(s,r){this.onValueChange_=this.onValueChange_.bind(this),this.value=r.value,this.value.emitter.on("change",this.onValueChange_),this.element=s.createElement("div"),this.element.classList.add(Vi()),r.viewProps.bindTabIndex(this.element);const c=s.createElement("div");c.classList.add(Vi("b")),this.element.appendChild(c);const _=s.createElement("div");_.classList.add(Vi("c")),c.appendChild(_),this.colorElem_=_;const x=s.createElement("div");x.classList.add(Vi("m")),this.element.appendChild(x),this.markerElem_=x;const S=s.createElement("div");S.classList.add(Vi("p")),this.markerElem_.appendChild(S),this.previewElem_=S,this.update_()}update_(){const s=this.value.rawValue,r=s.getComponents("rgb"),c=new lt([r[0],r[1],r[2],0],"rgb"),_=new lt([r[0],r[1],r[2],255],"rgb"),x=["to right",rn(c),rn(_)];this.colorElem_.style.background=`linear-gradient(${x.join(",")})`,this.previewElem_.style.backgroundColor=rn(s);const S=Ct(r[3],0,1,0,100);this.markerElem_.style.left=`${S}%`}onValueChange_(){this.update_()}}class Mn{constructor(s,r){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=r.value,this.viewProps=r.viewProps,this.view=new Dn(s,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Bi(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(s,r){if(!s.point)return;const c=s.point.x/s.bounds.width,_=this.value.rawValue,[x,S,O]=_.getComponents("hsv");this.value.setRawValue(new lt([x,S,O,c],"hsv"),r)}onPointerDown_(s){this.handlePointerEvent_(s.data,{forceEmit:!1,last:!1})}onPointerMove_(s){this.handlePointerEvent_(s.data,{forceEmit:!1,last:!1})}onPointerUp_(s){this.handlePointerEvent_(s.data,{forceEmit:!0,last:!0})}onKeyDown_(s){const r=pe(Ui(!0),Ye(s));if(r===0)return;const c=this.value.rawValue,[_,x,S,O]=c.getComponents("hsv");this.value.setRawValue(new lt([_,x,S,O+r],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(s){pe(Ui(!0),Ye(s))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const Xe=ut("coltxt");class Pt{constructor(s,r){this.element=s.createElement("div"),this.element.classList.add(Xe());const c=s.createElement("div");c.classList.add(Xe("m")),this.modeElem_=function(S){const O=S.createElement("select");return O.appendChild([{text:"RGB",value:"rgb"},{text:"HSL",value:"hsl"},{text:"HSV",value:"hsv"}].reduce((G,it)=>{const xt=S.createElement("option");return xt.textContent=it.text,xt.value=it.value,G.appendChild(xt),G},S.createDocumentFragment())),O}(s),this.modeElem_.classList.add(Xe("ms")),c.appendChild(this.modeSelectElement);const _=s.createElement("div");_.classList.add(Xe("mm")),_.appendChild(ke(s,"dropdown")),c.appendChild(_),this.element.appendChild(c);const x=s.createElement("div");x.classList.add(Xe("w")),this.element.appendChild(x),this.textsElem_=x,this.textViews_=r.textViews,this.applyTextViews_(),j(r.colorMode,S=>{this.modeElem_.value=S})}get modeSelectElement(){return this.modeElem_}get textViews(){return this.textViews_}set textViews(s){this.textViews_=s,this.applyTextViews_()}applyTextViews_(){Zi(this.textsElem_);const s=this.element.ownerDocument;this.textViews_.forEach(r=>{const c=s.createElement("div");c.classList.add(Xe("c")),c.appendChild(r.element),this.textsElem_.appendChild(c)})}}function Is(l,s,r){const c=Ss(l,s)[r];return new bs({min:0,max:c})}function ls(l,s,r){return new Di(l,{arrayPosition:r===0?"fst":r===2?"lst":"mid",baseStep:Ui(!1),parser:s.parser,props:_t.fromObject({draggingScale:s.colorType==="float"?.01:1,formatter:(c=s.colorType,Ht(c==="float"?2:0))}),value:Ot(0,{constraint:Is(s.colorMode,s.colorType,r)}),viewProps:s.viewProps});var c}class gi{constructor(s,r){this.onModeSelectChange_=this.onModeSelectChange_.bind(this),this.colorType_=r.colorType,this.parser_=r.parser,this.value=r.value,this.viewProps=r.viewProps,this.colorMode=Ot(this.value.rawValue.mode),this.ccs_=this.createComponentControllers_(s),this.view=new Pt(s,{colorMode:this.colorMode,textViews:[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view]}),this.view.modeSelectElement.addEventListener("change",this.onModeSelectChange_)}createComponentControllers_(s){const r={colorMode:this.colorMode.rawValue,colorType:this.colorType_,parser:this.parser_,viewProps:this.viewProps},c=[ls(s,r,0),ls(s,r,1),ls(s,r,2)];return c.forEach((_,x)=>{Ys({primary:this.value,secondary:_.value,forward:S=>S.rawValue.getComponents(this.colorMode.rawValue,this.colorType_)[x],backward:(S,O)=>{const G=this.colorMode.rawValue,it=S.rawValue.getComponents(G,this.colorType_);return it[x]=O.rawValue,new lt(Yt(ae(it),it[3]),G,this.colorType_)}})}),c}onModeSelectChange_(s){const r=s.currentTarget;this.colorMode.rawValue=r.value,this.ccs_=this.createComponentControllers_(this.view.element.ownerDocument),this.view.textViews=[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view]}}const Fn=ut("hpl");class Er{constructor(s,r){this.onValueChange_=this.onValueChange_.bind(this),this.value=r.value,this.value.emitter.on("change",this.onValueChange_),this.element=s.createElement("div"),this.element.classList.add(Fn()),r.viewProps.bindTabIndex(this.element);const c=s.createElement("div");c.classList.add(Fn("c")),this.element.appendChild(c);const _=s.createElement("div");_.classList.add(Fn("m")),this.element.appendChild(_),this.markerElem_=_,this.update_()}update_(){const s=this.value.rawValue,[r]=s.getComponents("hsv");this.markerElem_.style.backgroundColor=Ar(new lt([r,100,100],"hsv"));const c=Ct(r,0,360,0,100);this.markerElem_.style.left=`${c}%`}onValueChange_(){this.update_()}}class Rs{constructor(s,r){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=r.value,this.viewProps=r.viewProps,this.view=new Er(s,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Bi(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(s,r){if(!s.point)return;const c=Ct(Xt(s.point.x,0,s.bounds.width),0,s.bounds.width,0,359),_=this.value.rawValue,[,x,S,O]=_.getComponents("hsv");this.value.setRawValue(new lt([c,x,S,O],"hsv"),r)}onPointerDown_(s){this.handlePointerEvent_(s.data,{forceEmit:!1,last:!1})}onPointerMove_(s){this.handlePointerEvent_(s.data,{forceEmit:!1,last:!1})}onPointerUp_(s){this.handlePointerEvent_(s.data,{forceEmit:!0,last:!0})}onKeyDown_(s){const r=pe(Ui(!1),Ye(s));if(r===0)return;const c=this.value.rawValue,[_,x,S,O]=c.getComponents("hsv");this.value.setRawValue(new lt([_+r,x,S,O],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(s){pe(Ui(!1),Ye(s))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const Bs=ut("svp");class Un{constructor(s,r){this.onValueChange_=this.onValueChange_.bind(this),this.value=r.value,this.value.emitter.on("change",this.onValueChange_),this.element=s.createElement("div"),this.element.classList.add(Bs()),r.viewProps.bindTabIndex(this.element);const c=s.createElement("canvas");c.height=64,c.width=64,c.classList.add(Bs("c")),this.element.appendChild(c),this.canvasElement=c;const _=s.createElement("div");_.classList.add(Bs("m")),this.element.appendChild(_),this.markerElem_=_,this.update_()}update_(){const s=function(it){const xt=it.ownerDocument.defaultView;return xt&&"document"in xt?it.getContext("2d"):null}(this.canvasElement);if(!s)return;const r=this.value.rawValue.getComponents("hsv"),c=this.canvasElement.width,_=this.canvasElement.height,x=s.getImageData(0,0,c,_),S=x.data;for(let it=0;it<_;it++)for(let xt=0;xt<c;xt++){const Zt=Ct(xt,0,c,0,100),Fe=Ct(it,0,_,100,0),Ce=en(r[0],Zt,Fe),Wi=4*(it*c+xt);S[Wi]=Ce[0],S[Wi+1]=Ce[1],S[Wi+2]=Ce[2],S[Wi+3]=255}s.putImageData(x,0,0);const O=Ct(r[1],0,100,0,100);this.markerElem_.style.left=`${O}%`;const G=Ct(r[2],0,100,100,0);this.markerElem_.style.top=`${G}%`}onValueChange_(){this.update_()}}class so{constructor(s,r){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=r.value,this.viewProps=r.viewProps,this.view=new Un(s,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Bi(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(s,r){if(!s.point)return;const c=Ct(s.point.x,0,s.bounds.width,0,100),_=Ct(s.point.y,0,s.bounds.height,100,0),[x,,,S]=this.value.rawValue.getComponents("hsv");this.value.setRawValue(new lt([x,c,_,S],"hsv"),r)}onPointerDown_(s){this.handlePointerEvent_(s.data,{forceEmit:!1,last:!1})}onPointerMove_(s){this.handlePointerEvent_(s.data,{forceEmit:!1,last:!1})}onPointerUp_(s){this.handlePointerEvent_(s.data,{forceEmit:!0,last:!0})}onKeyDown_(s){dr(s.key)&&s.preventDefault();const[r,c,_,x]=this.value.rawValue.getComponents("hsv"),S=Ui(!1),O=pe(S,Ye(s)),G=pe(S,As(s));O===0&&G===0||this.value.setRawValue(new lt([r,c+O,_+G,x],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(s){const r=Ui(!1),c=pe(r,Ye(s)),_=pe(r,As(s));c===0&&_===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class no{constructor(s,r){this.value=r.value,this.viewProps=r.viewProps,this.hPaletteC_=new Rs(s,{value:this.value,viewProps:this.viewProps}),this.svPaletteC_=new so(s,{value:this.value,viewProps:this.viewProps}),this.alphaIcs_=r.supportsAlpha?{palette:new Mn(s,{value:this.value,viewProps:this.viewProps}),text:new Di(s,{parser:fi,baseStep:.1,props:_t.fromObject({draggingScale:.01,formatter:Ht(2)}),value:Ot(0,{constraint:new bs({min:0,max:1})}),viewProps:this.viewProps})}:null,this.alphaIcs_&&Ys({primary:this.value,secondary:this.alphaIcs_.text.value,forward:c=>c.rawValue.getComponents()[3],backward:(c,_)=>{const x=c.rawValue.getComponents();return x[3]=_.rawValue,new lt(x,c.rawValue.mode)}}),this.textC_=new gi(s,{colorType:r.colorType,parser:fi,value:this.value,viewProps:this.viewProps}),this.view=new Kt(s,{alphaViews:this.alphaIcs_?{palette:this.alphaIcs_.palette.view,text:this.alphaIcs_.text.view}:null,hPaletteView:this.hPaletteC_.view,supportsAlpha:r.supportsAlpha,svPaletteView:this.svPaletteC_.view,textView:this.textC_.view})}get textController(){return this.textC_}}const Ln=ut("colsw");class Vn{constructor(s,r){this.onValueChange_=this.onValueChange_.bind(this),r.value.emitter.on("change",this.onValueChange_),this.value=r.value,this.element=s.createElement("div"),this.element.classList.add(Ln()),r.viewProps.bindClassModifiers(this.element);const c=s.createElement("div");c.classList.add(Ln("sw")),this.element.appendChild(c),this.swatchElem_=c;const _=s.createElement("button");_.classList.add(Ln("b")),r.viewProps.bindDisabled(_),this.element.appendChild(_),this.buttonElement=_,this.update_()}update_(){const s=this.value.rawValue;this.swatchElem_.style.backgroundColor=In(s)}onValueChange_(){this.update_()}}class ro{constructor(s,r){this.value=r.value,this.viewProps=r.viewProps,this.view=new Vn(s,{value:this.value,viewProps:this.viewProps})}}class On{constructor(s,r){this.onButtonBlur_=this.onButtonBlur_.bind(this),this.onButtonClick_=this.onButtonClick_.bind(this),this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.value=r.value,this.viewProps=r.viewProps,this.foldable_=Ke.create(r.expanded),this.swatchC_=new ro(s,{value:this.value,viewProps:this.viewProps});const c=this.swatchC_.view.buttonElement;c.addEventListener("blur",this.onButtonBlur_),c.addEventListener("click",this.onButtonClick_),this.textC_=new bn(s,{parser:r.parser,props:_t.fromObject({formatter:r.formatter}),value:this.value,viewProps:this.viewProps}),this.view=new fe(s,{foldable:this.foldable_,pickerLayout:r.pickerLayout}),this.view.swatchElement.appendChild(this.swatchC_.view.element),this.view.textElement.appendChild(this.textC_.view.element),this.popC_=r.pickerLayout==="popup"?new qr(s,{viewProps:this.viewProps}):null;const _=new no(s,{colorType:r.colorType,supportsAlpha:r.supportsAlpha,value:this.value,viewProps:this.viewProps});_.view.allFocusableElements.forEach(x=>{x.addEventListener("blur",this.onPopupChildBlur_),x.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=_,this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(_.view.element),Ys({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:x=>x.rawValue,backward:(x,S)=>S.rawValue})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),Si(this.foldable_,this.view.pickerElement))}get textController(){return this.textC_}onButtonBlur_(s){if(!this.popC_)return;const r=this.view.element,c=s.relatedTarget;c&&r.contains(c)||(this.popC_.shows.rawValue=!1)}onButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(s){if(!this.popC_)return;const r=this.popC_.view.element,c=Ve(s);c&&r.contains(c)||c&&c===this.swatchC_.view.buttonElement&&!li(r.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(s){this.popC_?s.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&s.key==="Escape"&&this.swatchC_.view.buttonElement.focus()}}function oo(l){return ae(l.getComponents("rgb")).reduce((s,r)=>s<<8|255&Math.floor(r),0)}function ao(l){return l.getComponents("rgb").reduce((s,r,c)=>s<<8|255&Math.floor(c===3?255*r:r),0)>>>0}function lo(l){return typeof l!="number"?lt.black():new lt([(s=l)>>16&255,s>>8&255,255&s],"rgb");var s}function ho(l){return typeof l!="number"?lt.black():new lt([(s=l)>>24&255,s>>16&255,s>>8&255,Ct(255&s,0,255,0,1)],"rgb");var s}function Sr(l){var s;return!(!(l!=null&&l.alpha)&&!(!((s=l==null?void 0:l.color)===null||s===void 0)&&s.alpha))}function co(l){return l?s=>In(s,"0x"):s=>yr(s,"0x")}const Ae={id:"input-color-number",type:"input",accept:(l,s)=>{if(typeof l!="number"||!function(c){return"color"in c||"view"in c&&c.view==="color"}(s))return null;const r=vt(s);return r?{initialValue:l,params:r}:null},binding:{reader:l=>Sr(l.params)?ho:lo,equals:lt.equals,writer:l=>function(s){const r=s?ao:oo;return(c,_)=>{tn(c,r(_))}}(Sr(l.params))},controller:l=>{const s=Sr(l.params),r="expanded"in l.params?l.params.expanded:void 0,c="picker"in l.params?l.params.picker:void 0;return new On(l.document,{colorType:"int",expanded:r!=null&&r,formatter:co(s),parser:kn("int"),pickerLayout:c??"popup",supportsAlpha:s,value:l.value,viewProps:l.viewProps})}};function We(l){return s=>function(r,c){return lt.isColorObject(r)?lt.fromObject(r,c):lt.black(c)}(s,l)}function uo(l,s){return r=>l?Ps(r,s):Rn(r,s)}const on={id:"input-color-object",type:"input",accept:(l,s)=>{if(!lt.isColorObject(l))return null;const r=vt(s);return r?{initialValue:l,params:r}:null},binding:{reader:l=>We(Li(l.params)),equals:lt.equals,writer:l=>{return c=l.initialValue,s=lt.isRgbaColorObject(c),r=Li(l.params),(_,x)=>{s?function(S,O,G){const it=O.toRgbaObject(G);S.writeProperty("r",it.r),S.writeProperty("g",it.g),S.writeProperty("b",it.b),S.writeProperty("a",it.a)}(_,x,r):function(S,O,G){const it=O.toRgbaObject(G);S.writeProperty("r",it.r),S.writeProperty("g",it.g),S.writeProperty("b",it.b)}(_,x,r)};var s,r,c}},controller:l=>{var s;const r=lt.isRgbaColorObject(l.initialValue),c="expanded"in l.params?l.params.expanded:void 0,_="picker"in l.params?l.params.picker:void 0,x=(s=Li(l.params))!==null&&s!==void 0?s:"int";return new On(l.document,{colorType:x,expanded:c!=null&&c,formatter:uo(r,x),parser:kn(x),pickerLayout:_??"popup",supportsAlpha:r,value:l.value,viewProps:l.viewProps})}},po={id:"input-color-string",type:"input",accept:(l,s)=>{if(typeof l!="string"||"view"in s&&s.view==="text")return null;const r=Tn(l,Li(s));if(!r||!ks(r))return null;const c=vt(s);return c?{initialValue:l,params:c}:null},binding:{reader:l=>{var s;return function(r){const c=br[r];return _=>{if(typeof _!="string")return lt.black(r);const x=c.reduce((S,O)=>S||O(_),null);return x??lt.black(r)}}((s=Li(l.params))!==null&&s!==void 0?s:"int")},equals:lt.equals,writer:l=>{const s=Tn(l.initialValue,Li(l.params));if(!s)throw J.shouldNeverHappen();const r=function(c){const _=ks(c);return _?(x,S)=>{tn(x,_(S))}:null}(s);if(!r)throw J.notBindable();return r}},controller:l=>{const s=Tn(l.initialValue,Li(l.params));if(!s)throw J.shouldNeverHappen();const r=ks(s);if(!r)throw J.shouldNeverHappen();const c="expanded"in l.params?l.params.expanded:void 0,_="picker"in l.params?l.params.picker:void 0;return new On(l.document,{colorType:s.type,expanded:c!=null&&c,formatter:r,parser:kn(s.type),pickerLayout:_??"popup",supportsAlpha:s.alpha,value:l.value,viewProps:l.viewProps})}};class Oi{constructor(s){this.components=s.components,this.asm_=s.assembly}constrain(s){const r=this.asm_.toComponents(s).map((c,_)=>{var x,S;return(S=(x=this.components[_])===null||x===void 0?void 0:x.constrain(c))!==null&&S!==void 0?S:c});return this.asm_.fromComponents(r)}}const Pr=ut("pndtxt");class zn{constructor(s,r){this.textViews=r.textViews,this.element=s.createElement("div"),this.element.classList.add(Pr()),this.textViews.forEach(c=>{const _=s.createElement("div");_.classList.add(Pr("a")),_.appendChild(c.element),this.element.appendChild(_)})}}class Nn{constructor(s,r){this.value=r.value,this.viewProps=r.viewProps,this.acs_=r.axes.map((c,_)=>function(x,S,O){return new Di(x,{arrayPosition:O===0?"fst":O===S.axes.length-1?"lst":"mid",baseStep:S.axes[O].baseStep,parser:S.parser,props:S.axes[O].textProps,value:Ot(0,{constraint:S.axes[O].constraint}),viewProps:S.viewProps})}(s,r,_)),this.acs_.forEach((c,_)=>{Ys({primary:this.value,secondary:c.value,forward:x=>r.assembly.toComponents(x.rawValue)[_],backward:(x,S)=>{const O=r.assembly.toComponents(x.rawValue);return O[_]=S.rawValue,r.assembly.fromComponents(O)}})}),this.view=new zn(s,{textViews:this.acs_.map(c=>c.view)})}}function Tr(l,s){return"step"in l&&!W(l.step)?new ts(l.step,s):null}function kr(l){return"max"in l&&!W(l.max)||"min"in l&&!W(l.min)?new bs({max:l.max,min:l.min}):null}function fo(l){const[s,r]=function(c){const _=c?Je(c,bs):null;return _?[_.minValue,_.maxValue]:[void 0,void 0]}(l);return[s??0,r??100]}const ge={id:"input-number",type:"input",accept:(l,s)=>{if(typeof l!="number")return null;const r=ct,c=Qt(s,{format:r.optional.function,max:r.optional.number,min:r.optional.number,options:r.optional.custom(re),step:r.optional.number});return c?{initialValue:l,params:c}:null},binding:{reader:l=>Kr,constraint:l=>function(s,r){const c=[],_=Tr(s,r);_&&c.push(_);const x=kr(s);x&&c.push(x);const S=Bt(s.options);return S&&c.push(S),new qs(c)}(l.params,l.initialValue),writer:l=>tn},controller:l=>{var s,r;const c=l.value,_=l.constraint;if(_&&Je(_,js))return new Qs(l.document,{props:_t.fromObject({options:(s=Pe(_))!==null&&s!==void 0?s:[]}),value:c,viewProps:l.viewProps});const x=(r="format"in l.params?l.params.format:void 0)!==null&&r!==void 0?r:Ht(oe(_,c.rawValue));if(_&&Je(_,bs)){const[S,O]=fo(_);return new rs(l.document,{baseStep:$e(_),parser:fi,sliderProps:_t.fromObject({maxValue:O,minValue:S}),textProps:_t.fromObject({draggingScale:Mi(_,c.rawValue),formatter:x}),value:c,viewProps:l.viewProps})}return new Di(l.document,{baseStep:$e(_),parser:fi,props:_t.fromObject({draggingScale:Mi(_,c.rawValue),formatter:x}),value:c,viewProps:l.viewProps})}};class mi{constructor(s=0,r=0){this.x=s,this.y=r}getComponents(){return[this.x,this.y]}static isObject(s){if(W(s))return!1;const r=s.x,c=s.y;return typeof r=="number"&&typeof c=="number"}static equals(s,r){return s.x===r.x&&s.y===r.y}toObject(){return{x:this.x,y:this.y}}}const Ir={toComponents:l=>l.getComponents(),fromComponents:l=>new mi(...l)},hs=ut("p2d");class _o{constructor(s,r){this.element=s.createElement("div"),this.element.classList.add(hs()),r.viewProps.bindClassModifiers(this.element),j(r.expanded,ht(this.element,hs(void 0,"expanded")));const c=s.createElement("div");c.classList.add(hs("h")),this.element.appendChild(c);const _=s.createElement("button");_.classList.add(hs("b")),_.appendChild(ke(s,"p2dpad")),r.viewProps.bindDisabled(_),c.appendChild(_),this.buttonElement=_;const x=s.createElement("div");if(x.classList.add(hs("t")),c.appendChild(x),this.textElement=x,r.pickerLayout==="inline"){const S=s.createElement("div");S.classList.add(hs("p")),this.element.appendChild(S),this.pickerElement=S}else this.pickerElement=null}}const ti=ut("p2dp");class an{constructor(s,r){this.onFoldableChange_=this.onFoldableChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.invertsY_=r.invertsY,this.maxValue_=r.maxValue,this.element=s.createElement("div"),this.element.classList.add(ti()),r.layout==="popup"&&this.element.classList.add(ti(void 0,"p"));const c=s.createElement("div");c.classList.add(ti("p")),r.viewProps.bindTabIndex(c),this.element.appendChild(c),this.padElement=c;const _=s.createElementNS(se,"svg");_.classList.add(ti("g")),this.padElement.appendChild(_),this.svgElem_=_;const x=s.createElementNS(se,"line");x.classList.add(ti("ax")),x.setAttributeNS(null,"x1","0"),x.setAttributeNS(null,"y1","50%"),x.setAttributeNS(null,"x2","100%"),x.setAttributeNS(null,"y2","50%"),this.svgElem_.appendChild(x);const S=s.createElementNS(se,"line");S.classList.add(ti("ax")),S.setAttributeNS(null,"x1","50%"),S.setAttributeNS(null,"y1","0"),S.setAttributeNS(null,"x2","50%"),S.setAttributeNS(null,"y2","100%"),this.svgElem_.appendChild(S);const O=s.createElementNS(se,"line");O.classList.add(ti("l")),O.setAttributeNS(null,"x1","50%"),O.setAttributeNS(null,"y1","50%"),this.svgElem_.appendChild(O),this.lineElem_=O;const G=s.createElement("div");G.classList.add(ti("m")),this.padElement.appendChild(G),this.markerElem_=G,r.value.emitter.on("change",this.onValueChange_),this.value=r.value,this.update_()}get allFocusableElements(){return[this.padElement]}update_(){const[s,r]=this.value.rawValue.getComponents(),c=this.maxValue_,_=Ct(s,-c,+c,0,100),x=Ct(r,-c,+c,0,100),S=this.invertsY_?100-x:x;this.lineElem_.setAttributeNS(null,"x2",`${_}%`),this.lineElem_.setAttributeNS(null,"y2",`${S}%`),this.markerElem_.style.left=`${_}%`,this.markerElem_.style.top=`${S}%`}onValueChange_(){this.update_()}onFoldableChange_(){this.update_()}}function Me(l,s,r){return[pe(s[0],Ye(l)),pe(s[1],As(l))*(r?1:-1)]}class zi{constructor(s,r){this.onPadKeyDown_=this.onPadKeyDown_.bind(this),this.onPadKeyUp_=this.onPadKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=r.value,this.viewProps=r.viewProps,this.baseSteps_=r.baseSteps,this.maxValue_=r.maxValue,this.invertsY_=r.invertsY,this.view=new an(s,{invertsY:this.invertsY_,layout:r.layout,maxValue:this.maxValue_,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Bi(this.view.padElement),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.padElement.addEventListener("keydown",this.onPadKeyDown_),this.view.padElement.addEventListener("keyup",this.onPadKeyUp_)}handlePointerEvent_(s,r){if(!s.point)return;const c=this.maxValue_,_=Ct(s.point.x,0,s.bounds.width,-c,+c),x=Ct(this.invertsY_?s.bounds.height-s.point.y:s.point.y,0,s.bounds.height,-c,+c);this.value.setRawValue(new mi(_,x),r)}onPointerDown_(s){this.handlePointerEvent_(s.data,{forceEmit:!1,last:!1})}onPointerMove_(s){this.handlePointerEvent_(s.data,{forceEmit:!1,last:!1})}onPointerUp_(s){this.handlePointerEvent_(s.data,{forceEmit:!0,last:!0})}onPadKeyDown_(s){dr(s.key)&&s.preventDefault();const[r,c]=Me(s,this.baseSteps_,this.invertsY_);r===0&&c===0||this.value.setRawValue(new mi(this.value.rawValue.x+r,this.value.rawValue.y+c),{forceEmit:!1,last:!1})}onPadKeyUp_(s){const[r,c]=Me(s,this.baseSteps_,this.invertsY_);r===0&&c===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class ln{constructor(s,r){var c,_;this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.onPadButtonBlur_=this.onPadButtonBlur_.bind(this),this.onPadButtonClick_=this.onPadButtonClick_.bind(this),this.value=r.value,this.viewProps=r.viewProps,this.foldable_=Ke.create(r.expanded),this.popC_=r.pickerLayout==="popup"?new qr(s,{viewProps:this.viewProps}):null;const x=new zi(s,{baseSteps:[r.axes[0].baseStep,r.axes[1].baseStep],invertsY:r.invertsY,layout:r.pickerLayout,maxValue:r.maxValue,value:this.value,viewProps:this.viewProps});x.view.allFocusableElements.forEach(S=>{S.addEventListener("blur",this.onPopupChildBlur_),S.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=x,this.textC_=new Nn(s,{assembly:Ir,axes:r.axes,parser:r.parser,value:this.value,viewProps:this.viewProps}),this.view=new _o(s,{expanded:this.foldable_.value("expanded"),pickerLayout:r.pickerLayout,viewProps:this.viewProps}),this.view.textElement.appendChild(this.textC_.view.element),(c=this.view.buttonElement)===null||c===void 0||c.addEventListener("blur",this.onPadButtonBlur_),(_=this.view.buttonElement)===null||_===void 0||_.addEventListener("click",this.onPadButtonClick_),this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(this.pickerC_.view.element),Ys({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:S=>S.rawValue,backward:(S,O)=>O.rawValue})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),Si(this.foldable_,this.view.pickerElement))}onPadButtonBlur_(s){if(!this.popC_)return;const r=this.view.element,c=s.relatedTarget;c&&r.contains(c)||(this.popC_.shows.rawValue=!1)}onPadButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(s){if(!this.popC_)return;const r=this.popC_.view.element,c=Ve(s);c&&r.contains(c)||c&&c===this.view.buttonElement&&!li(r.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(s){this.popC_?s.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&s.key==="Escape"&&this.view.buttonElement.focus()}}function go(l){return mi.isObject(l)?new mi(l.x,l.y):new mi}function Ds(l,s){l.writeProperty("x",s.x),l.writeProperty("y",s.y)}function vi(l,s){if(!l)return;const r=[],c=Tr(l,s);c&&r.push(c);const _=kr(l);return _&&r.push(_),new qs(r)}function hn(l,s){var r,c;const _=l&&Je(l,bs);if(_)return Math.max(Math.abs((r=_.minValue)!==null&&r!==void 0?r:0),Math.abs((c=_.maxValue)!==null&&c!==void 0?c:0));const x=$e(l);return Math.max(10*Math.abs(x),10*Math.abs(s))}function Ms(l,s){const r=s instanceof Oi?s.components[0]:void 0,c=s instanceof Oi?s.components[1]:void 0,_=hn(r,l.x),x=hn(c,l.y);return Math.max(_,x)}function Rr(l,s){return{baseStep:$e(s),constraint:s,textProps:_t.fromObject({draggingScale:Mi(s,l),formatter:Ht(oe(s,l))})}}function mo(l){if(!("y"in l))return!1;const s=l.y;return!!s&&"inverted"in s&&!!s.inverted}const vo={id:"input-point2d",type:"input",accept:(l,s)=>{if(!mi.isObject(l))return null;const r=ct,c=Qt(s,{expanded:r.optional.boolean,picker:r.optional.custom(En),x:r.optional.custom(ee),y:r.optional.object({inverted:r.optional.boolean,max:r.optional.number,min:r.optional.number,step:r.optional.number})});return c?{initialValue:l,params:c}:null},binding:{reader:l=>go,constraint:l=>{return s=l.params,r=l.initialValue,new Oi({assembly:Ir,components:[vi("x"in s?s.x:void 0,r.x),vi("y"in s?s.y:void 0,r.y)]});var s,r},equals:mi.equals,writer:l=>Ds},controller:l=>{const s=l.document,r=l.value,c=l.constraint;if(!(c instanceof Oi))throw J.shouldNeverHappen();const _="expanded"in l.params?l.params.expanded:void 0,x="picker"in l.params?l.params.picker:void 0;return new ln(s,{axes:[Rr(r.rawValue.x,c.components[0]),Rr(r.rawValue.y,c.components[1])],expanded:_!=null&&_,invertsY:mo(l.params),maxValue:Ms(r.rawValue,c),parser:fi,pickerLayout:x??"popup",value:r,viewProps:l.viewProps})}};class wi{constructor(s=0,r=0,c=0){this.x=s,this.y=r,this.z=c}getComponents(){return[this.x,this.y,this.z]}static isObject(s){if(W(s))return!1;const r=s.x,c=s.y,_=s.z;return typeof r=="number"&&typeof c=="number"&&typeof _=="number"}static equals(s,r){return s.x===r.x&&s.y===r.y&&s.z===r.z}toObject(){return{x:this.x,y:this.y,z:this.z}}}const Br={toComponents:l=>l.getComponents(),fromComponents:l=>new wi(...l)};function Hn(l){return wi.isObject(l)?new wi(l.x,l.y,l.z):new wi}function wo(l,s){l.writeProperty("x",s.x),l.writeProperty("y",s.y),l.writeProperty("z",s.z)}function Xn(l,s){return{baseStep:$e(s),constraint:s,textProps:_t.fromObject({draggingScale:Mi(s,l),formatter:Ht(oe(s,l))})}}const bo={id:"input-point3d",type:"input",accept:(l,s)=>{if(!wi.isObject(l))return null;const r=ct,c=Qt(s,{x:r.optional.custom(ee),y:r.optional.custom(ee),z:r.optional.custom(ee)});return c?{initialValue:l,params:c}:null},binding:{reader:l=>Hn,constraint:l=>{return s=l.params,r=l.initialValue,new Oi({assembly:Br,components:[vi("x"in s?s.x:void 0,r.x),vi("y"in s?s.y:void 0,r.y),vi("z"in s?s.z:void 0,r.z)]});var s,r},equals:wi.equals,writer:l=>wo},controller:l=>{const s=l.value,r=l.constraint;if(!(r instanceof Oi))throw J.shouldNeverHappen();return new Nn(l.document,{assembly:Br,axes:[Xn(s.rawValue.x,r.components[0]),Xn(s.rawValue.y,r.components[1]),Xn(s.rawValue.z,r.components[2])],parser:fi,value:s,viewProps:l.viewProps})}};class ei{constructor(s=0,r=0,c=0,_=0){this.x=s,this.y=r,this.z=c,this.w=_}getComponents(){return[this.x,this.y,this.z,this.w]}static isObject(s){if(W(s))return!1;const r=s.x,c=s.y,_=s.z,x=s.w;return typeof r=="number"&&typeof c=="number"&&typeof _=="number"&&typeof x=="number"}static equals(s,r){return s.x===r.x&&s.y===r.y&&s.z===r.z&&s.w===r.w}toObject(){return{x:this.x,y:this.y,z:this.z,w:this.w}}}const Ni={toComponents:l=>l.getComponents(),fromComponents:l=>new ei(...l)};function Ko(l){return ei.isObject(l)?new ei(l.x,l.y,l.z,l.w):new ei}function xo(l,s){l.writeProperty("x",s.x),l.writeProperty("y",s.y),l.writeProperty("z",s.z),l.writeProperty("w",s.w)}const yo={id:"input-point4d",type:"input",accept:(l,s)=>{if(!ei.isObject(l))return null;const r=ct,c=Qt(s,{x:r.optional.custom(ee),y:r.optional.custom(ee),z:r.optional.custom(ee),w:r.optional.custom(ee)});return c?{initialValue:l,params:c}:null},binding:{reader:l=>Ko,constraint:l=>{return s=l.params,r=l.initialValue,new Oi({assembly:Ni,components:[vi("x"in s?s.x:void 0,r.x),vi("y"in s?s.y:void 0,r.y),vi("z"in s?s.z:void 0,r.z),vi("w"in s?s.w:void 0,r.w)]});var s,r},equals:ei.equals,writer:l=>xo},controller:l=>{const s=l.value,r=l.constraint;if(!(r instanceof Oi))throw J.shouldNeverHappen();return new Nn(l.document,{assembly:Ni,axes:s.rawValue.getComponents().map((c,_)=>{return x=c,{baseStep:$e(S=r.components[_]),constraint:S,textProps:_t.fromObject({draggingScale:Mi(S,x),formatter:Ht(oe(S,x))})};var x,S}),parser:fi,value:s,viewProps:l.viewProps})}},Ao={id:"input-string",type:"input",accept:(l,s)=>{if(typeof l!="string")return null;const r=Qt(s,{options:ct.optional.custom(re)});return r?{initialValue:l,params:r}:null},binding:{reader:l=>Js,constraint:l=>function(s){const r=[],c=Bt(s.options);return c&&r.push(c),new qs(r)}(l.params),writer:l=>tn},controller:l=>{var s;const r=l.document,c=l.value,_=l.constraint;return _&&Je(_,js)?new Qs(r,{props:_t.fromObject({options:(s=Pe(_))!==null&&s!==void 0?s:[]}),value:c,viewProps:l.viewProps}):new bn(r,{parser:x=>x,props:_t.fromObject({formatter:An}),value:c,viewProps:l.viewProps})}},Fs={defaultInterval:200,defaultLineCount:3},Us=ut("mll");class Wn{constructor(s,r){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=r.formatter,this.element=s.createElement("div"),this.element.classList.add(Us()),r.viewProps.bindClassModifiers(this.element);const c=s.createElement("textarea");c.classList.add(Us("i")),c.style.height=`calc(var(--bld-us) * ${r.lineCount})`,c.readOnly=!0,r.viewProps.bindDisabled(c),this.element.appendChild(c),this.textareaElem_=c,r.value.emitter.on("change",this.onValueUpdate_),this.value=r.value,this.update_()}update_(){const s=this.textareaElem_,r=s.scrollTop===s.scrollHeight-s.clientHeight,c=[];this.value.rawValue.forEach(_=>{_!==void 0&&c.push(this.formatter_(_))}),s.textContent=c.join(`
`),r&&(s.scrollTop=s.scrollHeight)}onValueUpdate_(){this.update_()}}class Hi{constructor(s,r){this.value=r.value,this.viewProps=r.viewProps,this.view=new Wn(s,{formatter:r.formatter,lineCount:r.lineCount,value:this.value,viewProps:this.viewProps})}}const Gn=ut("sgl");class qn{constructor(s,r){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=r.formatter,this.element=s.createElement("div"),this.element.classList.add(Gn()),r.viewProps.bindClassModifiers(this.element);const c=s.createElement("input");c.classList.add(Gn("i")),c.readOnly=!0,c.type="text",r.viewProps.bindDisabled(c),this.element.appendChild(c),this.inputElement=c,r.value.emitter.on("change",this.onValueUpdate_),this.value=r.value,this.update_()}update_(){const s=this.value.rawValue,r=s[s.length-1];this.inputElement.value=r!==void 0?this.formatter_(r):""}onValueUpdate_(){this.update_()}}class jn{constructor(s,r){this.value=r.value,this.viewProps=r.viewProps,this.view=new qn(s,{formatter:r.formatter,value:this.value,viewProps:this.viewProps})}}const Qn={id:"monitor-bool",type:"monitor",accept:(l,s)=>{if(typeof l!="boolean")return null;const r=Qt(s,{lineCount:ct.optional.number});return r?{initialValue:l,params:r}:null},binding:{reader:l=>hr},controller:l=>{var s;return l.value.rawValue.length===1?new jn(l.document,{formatter:Qr,value:l.value,viewProps:l.viewProps}):new Hi(l.document,{formatter:Qr,lineCount:(s=l.params.lineCount)!==null&&s!==void 0?s:Fs.defaultLineCount,value:l.value,viewProps:l.viewProps})}},Ge=ut("grl");class cn{constructor(s,r){this.onCursorChange_=this.onCursorChange_.bind(this),this.onValueUpdate_=this.onValueUpdate_.bind(this),this.element=s.createElement("div"),this.element.classList.add(Ge()),r.viewProps.bindClassModifiers(this.element),this.formatter_=r.formatter,this.props_=r.props,this.cursor_=r.cursor,this.cursor_.emitter.on("change",this.onCursorChange_);const c=s.createElementNS(se,"svg");c.classList.add(Ge("g")),c.style.height=`calc(var(--bld-us) * ${r.lineCount})`,this.element.appendChild(c),this.svgElem_=c;const _=s.createElementNS(se,"polyline");this.svgElem_.appendChild(_),this.lineElem_=_;const x=s.createElement("div");x.classList.add(Ge("t"),ut("tt")()),this.element.appendChild(x),this.tooltipElem_=x,r.value.emitter.on("change",this.onValueUpdate_),this.value=r.value,this.update_()}get graphElement(){return this.svgElem_}update_(){const s=this.svgElem_.getBoundingClientRect(),r=this.value.rawValue.length-1,c=this.props_.get("minValue"),_=this.props_.get("maxValue"),x=[];this.value.rawValue.forEach((xt,Zt)=>{if(xt===void 0)return;const Fe=Ct(Zt,0,r,0,s.width),Ce=Ct(xt,c,_,s.height,0);x.push([Fe,Ce].join(","))}),this.lineElem_.setAttributeNS(null,"points",x.join(" "));const S=this.tooltipElem_,O=this.value.rawValue[this.cursor_.rawValue];if(O===void 0)return void S.classList.remove(Ge("t","a"));const G=Ct(this.cursor_.rawValue,0,r,0,s.width),it=Ct(O,c,_,s.height,0);S.style.left=`${G}px`,S.style.top=`${it}px`,S.textContent=`${this.formatter_(O)}`,S.classList.contains(Ge("t","a"))||(S.classList.add(Ge("t","a"),Ge("t","in")),Qe(S),S.classList.remove(Ge("t","in")))}onValueUpdate_(){this.update_()}onCursorChange_(){this.update_()}}class dn{constructor(s,r){if(this.onGraphMouseMove_=this.onGraphMouseMove_.bind(this),this.onGraphMouseLeave_=this.onGraphMouseLeave_.bind(this),this.onGraphPointerDown_=this.onGraphPointerDown_.bind(this),this.onGraphPointerMove_=this.onGraphPointerMove_.bind(this),this.onGraphPointerUp_=this.onGraphPointerUp_.bind(this),this.props_=r.props,this.value=r.value,this.viewProps=r.viewProps,this.cursor_=Ot(-1),this.view=new cn(s,{cursor:this.cursor_,formatter:r.formatter,lineCount:r.lineCount,props:this.props_,value:this.value,viewProps:this.viewProps}),li(s)){const c=new Bi(this.view.element);c.emitter.on("down",this.onGraphPointerDown_),c.emitter.on("move",this.onGraphPointerMove_),c.emitter.on("up",this.onGraphPointerUp_)}else this.view.element.addEventListener("mousemove",this.onGraphMouseMove_),this.view.element.addEventListener("mouseleave",this.onGraphMouseLeave_)}onGraphMouseLeave_(){this.cursor_.rawValue=-1}onGraphMouseMove_(s){const r=this.view.element.getBoundingClientRect();this.cursor_.rawValue=Math.floor(Ct(s.offsetX,0,r.width,0,this.value.rawValue.length))}onGraphPointerDown_(s){this.onGraphPointerMove_(s)}onGraphPointerMove_(s){s.data.point?this.cursor_.rawValue=Math.floor(Ct(s.data.point.x,0,s.data.bounds.width,0,this.value.rawValue.length)):this.cursor_.rawValue=-1}onGraphPointerUp_(){this.cursor_.rawValue=-1}}function un(l){return"format"in l&&!W(l.format)?l.format:Ht(2)}function Dr(l){return"view"in l&&l.view==="graph"}const pn={id:"monitor-number",type:"monitor",accept:(l,s)=>{if(typeof l!="number")return null;const r=ct,c=Qt(s,{format:r.optional.function,lineCount:r.optional.number,max:r.optional.number,min:r.optional.number,view:r.optional.string});return c?{initialValue:l,params:c}:null},binding:{defaultBufferSize:l=>Dr(l)?64:1,reader:l=>Kr},controller:l=>Dr(l.params)?function(s){var r,c,_;return new dn(s.document,{formatter:un(s.params),lineCount:(r=s.params.lineCount)!==null&&r!==void 0?r:Fs.defaultLineCount,props:_t.fromObject({maxValue:(c="max"in s.params?s.params.max:null)!==null&&c!==void 0?c:100,minValue:(_="min"in s.params?s.params.min:null)!==null&&_!==void 0?_:0}),value:s.value,viewProps:s.viewProps})}(l):function(s){var r;return s.value.rawValue.length===1?new jn(s.document,{formatter:un(s.params),value:s.value,viewProps:s.viewProps}):new Hi(s.document,{formatter:un(s.params),lineCount:(r=s.params.lineCount)!==null&&r!==void 0?r:Fs.defaultLineCount,value:s.value,viewProps:s.viewProps})}(l)},fn={id:"monitor-string",type:"monitor",accept:(l,s)=>{if(typeof l!="string")return null;const r=ct,c=Qt(s,{lineCount:r.optional.number,multiline:r.optional.boolean});return c?{initialValue:l,params:c}:null},binding:{reader:l=>Js},controller:l=>{var s;const r=l.value;return r.rawValue.length>1||"multiline"in l.params&&l.params.multiline?new Hi(l.document,{formatter:An,lineCount:(s=l.params.lineCount)!==null&&s!==void 0?s:Fs.defaultLineCount,value:r,viewProps:l.viewProps}):new jn(l.document,{formatter:An,value:r,viewProps:l.viewProps})}};class Co{constructor(s){this.onValueChange_=this.onValueChange_.bind(this),this.reader=s.reader,this.writer=s.writer,this.emitter=new tt,this.value=s.value,this.value.emitter.on("change",this.onValueChange_),this.target=s.target,this.read()}read(){const s=this.target.read();s!==void 0&&(this.value.rawValue=this.reader(s))}write_(s){this.writer(this.target,s)}onValueChange_(s){this.write_(s.rawValue),this.emitter.emit("change",{options:s.options,rawValue:s.rawValue,sender:this})}}class Eo{constructor(s){this.onTick_=this.onTick_.bind(this),this.reader_=s.reader,this.target=s.target,this.emitter=new tt,this.value=s.value,this.ticker=s.ticker,this.ticker.emitter.on("tick",this.onTick_),this.read()}dispose(){this.ticker.dispose()}read(){const s=this.target.read();if(s===void 0)return;const r=this.value.rawValue,c=this.reader_(s);this.value.rawValue=function(_,x){const S=[...Zr(_),x];return S.length>_.length?S.splice(0,S.length-_.length):Cn(S,_.length),S}(r,c),this.emitter.emit("update",{rawValue:c,sender:this})}onTick_(s){this.read()}}function Ls(l,s){return s===0?new Vo:new Oo(l,s??Fs.defaultInterval)}class Xi{constructor(){this.pluginsMap_={blades:[],inputs:[],monitors:[]}}getAll(){return[...this.pluginsMap_.blades,...this.pluginsMap_.inputs,...this.pluginsMap_.monitors]}register(s){s.type==="blade"?this.pluginsMap_.blades.unshift(s):s.type==="input"?this.pluginsMap_.inputs.unshift(s):s.type==="monitor"&&this.pluginsMap_.monitors.unshift(s)}createInput(s,r,c){if(W(r.read()))throw new J({context:{key:r.key},type:"nomatchingcontroller"});const _=this.pluginsMap_.inputs.reduce((x,S)=>x??function(O,G){const it=O.accept(G.target.read(),G.params);if(W(it))return null;const xt=ct,Zt={target:G.target,initialValue:it.initialValue,params:it.params},Fe=O.binding.reader(Zt),Ce=O.binding.constraint?O.binding.constraint(Zt):void 0,Wi=Ot(Fe(it.initialValue),{constraint:Ce,equals:O.binding.equals}),Zn=new Co({reader:Fe,target:G.target,value:Wi,writer:O.binding.writer(Zt)}),Lr=xt.optional.boolean(G.params.disabled).value,Vr=xt.optional.boolean(G.params.hidden).value,cs=O.controller({constraint:Ce,document:G.document,initialValue:it.initialValue,params:it.params,value:Zn.value,viewProps:Ze.create({disabled:Lr,hidden:Vr})}),Vs=xt.optional.string(G.params.label).value;return new Se(G.document,{binding:Zn,blade:di(),props:_t.fromObject({label:Vs??G.target.key}),valueController:cs})}(S,{document:s,target:r,params:c}),null);if(_)return _;throw new J({context:{key:r.key},type:"nomatchingcontroller"})}createMonitor(s,r,c){const _=this.pluginsMap_.monitors.reduce((x,S)=>x??function(O,G){var it,xt,Zt;const Fe=ct,Ce=O.accept(G.target.read(),G.params);if(W(Ce))return null;const Wi={target:G.target,initialValue:Ce.initialValue,params:Ce.params},Zn=O.binding.reader(Wi),Lr=(xt=(it=Fe.optional.number(G.params.bufferSize).value)!==null&&it!==void 0?it:O.binding.defaultBufferSize&&O.binding.defaultBufferSize(Ce.params))!==null&&xt!==void 0?xt:1,Vr=Fe.optional.number(G.params.interval).value,cs=new Eo({reader:Zn,target:G.target,ticker:Ls(G.document,Vr),value:Ri(Lr)}),Vs=Fe.optional.boolean(G.params.disabled).value,To=Fe.optional.boolean(G.params.hidden).value,Yo=O.controller({document:G.document,params:Ce.params,value:cs.value,viewProps:Ze.create({disabled:Vs,hidden:To})}),ko=(Zt=Fe.optional.string(G.params.label).value)!==null&&Zt!==void 0?Zt:G.target.key;return new Ne(G.document,{binding:cs,blade:di(),props:_t.fromObject({label:ko}),valueController:Yo})}(S,{document:s,params:c,target:r}),null);if(_)return _;throw new J({context:{key:r.key},type:"nomatchingcontroller"})}createBlade(s,r){const c=this.pluginsMap_.blades.reduce((_,x)=>_??function(S,O){const G=S.accept(O.params);if(!G)return null;const it=ct.optional.boolean(O.params.disabled).value,xt=ct.optional.boolean(O.params.hidden).value;return S.controller({blade:di(),document:O.document,params:Object.assign(Object.assign({},G.params),{disabled:it,hidden:xt}),viewProps:Ze.create({disabled:it,hidden:xt})})}(x,{document:s,params:r}),null);if(!c)throw new J({type:"nomatchingview",context:{params:r}});return c}createBladeApi(s){if(s instanceof Se)return new ms(s);if(s instanceof Ne)return new vs(s);if(s instanceof Ti)return new ws(s,this);const r=this.pluginsMap_.blades.reduce((c,_)=>c??_.api({controller:s,pool:this}),null);if(!r)throw J.shouldNeverHappen();return r}}class ii extends F{constructor(s){super(s),this.emitter_=new tt,this.controller_.valueController.value.emitter.on("change",r=>{this.emitter_.emit("change",{event:new E(this,r.rawValue)})})}get label(){return this.controller_.props.get("label")}set label(s){this.controller_.props.set("label",s)}get options(){return this.controller_.valueController.props.get("options")}set options(s){this.controller_.valueController.props.set("options",s)}get value(){return this.controller_.valueController.value.rawValue}set value(s){this.controller_.valueController.value.rawValue=s}on(s,r){const c=r.bind(this);return this.emitter_.on(s,_=>{c(_.event)}),this}}class si extends F{constructor(s){super(s),this.emitter_=new tt,this.controller_.valueController.value.emitter.on("change",r=>{this.emitter_.emit("change",{event:new E(this,r.rawValue)})})}get label(){return this.controller_.props.get("label")}set label(s){this.controller_.props.set("label",s)}get maxValue(){return this.controller_.valueController.sliderController.props.get("maxValue")}set maxValue(s){this.controller_.valueController.sliderController.props.set("maxValue",s)}get minValue(){return this.controller_.valueController.sliderController.props.get("minValue")}set minValue(s){this.controller_.valueController.sliderController.props.set("minValue",s)}get value(){return this.controller_.valueController.value.rawValue}set value(s){this.controller_.valueController.value.rawValue=s}on(s,r){const c=r.bind(this);return this.emitter_.on(s,_=>{c(_.event)}),this}}class So extends F{constructor(s){super(s),this.emitter_=new tt,this.controller_.valueController.value.emitter.on("change",r=>{this.emitter_.emit("change",{event:new E(this,r.rawValue)})})}get label(){return this.controller_.props.get("label")}set label(s){this.controller_.props.set("label",s)}get formatter(){return this.controller_.valueController.props.get("formatter")}set formatter(s){this.controller_.valueController.props.set("formatter",s)}get value(){return this.controller_.valueController.value.rawValue}set value(s){this.controller_.valueController.value.rawValue=s}on(s,r){const c=r.bind(this);return this.emitter_.on(s,_=>{c(_.event)}),this}}const Zo={id:"list",type:"blade",accept(l){const s=ct,r=Qt(l,{options:s.required.custom(re),value:s.required.raw,view:s.required.constant("list"),label:s.optional.string});return r?{params:r}:null},controller(l){const s=new Qs(l.document,{props:_t.fromObject({options:$(l.params.options)}),value:Ot(l.params.value),viewProps:l.viewProps});return new te(l.document,{blade:l.blade,props:_t.fromObject({label:l.params.label}),valueController:s})},api:l=>l.controller instanceof te&&l.controller.valueController instanceof Qs?new ii(l.controller):null};class Kn extends Hs{constructor(s,r){super(s,r)}get element(){return this.controller_.view.element}importPreset(s){(function(r,c){r.forEach(_=>{const x=c[_.presetKey];x!==void 0&&_.write(x)})})(this.controller_.rackController.rack.find(Se).map(r=>r.binding.target),s),this.refresh()}exportPreset(){return this.controller_.rackController.rack.find(Se).map(s=>s.binding.target).reduce((s,r)=>Object.assign(s,{[r.presetKey]:r.read()}),{})}refresh(){this.controller_.rackController.rack.find(Se).forEach(s=>{s.binding.read()}),this.controller_.rackController.rack.find(Ne).forEach(s=>{s.binding.read()})}}class Po extends ne{constructor(s,r){super(s,{expanded:r.expanded,blade:r.blade,props:r.props,root:!0,viewProps:r.viewProps})}}const Mr={id:"slider",type:"blade",accept(l){const s=ct,r=Qt(l,{max:s.required.number,min:s.required.number,view:s.required.constant("slider"),format:s.optional.function,label:s.optional.string,value:s.optional.number});return r?{params:r}:null},controller(l){var s,r;const c=(s=l.params.value)!==null&&s!==void 0?s:0,_=new rs(l.document,{baseStep:1,parser:fi,sliderProps:_t.fromObject({maxValue:l.params.max,minValue:l.params.min}),textProps:_t.fromObject({draggingScale:Mi(void 0,c),formatter:(r=l.params.format)!==null&&r!==void 0?r:Qo}),value:Ot(c),viewProps:l.viewProps});return new te(l.document,{blade:l.blade,props:_t.fromObject({label:l.params.label}),valueController:_})},api:l=>l.controller instanceof te&&l.controller.valueController instanceof rs?new si(l.controller):null},Fr={id:"text",type:"blade",accept(l){const s=ct,r=Qt(l,{parse:s.required.function,value:s.required.raw,view:s.required.constant("text"),format:s.optional.function,label:s.optional.string});return r?{params:r}:null},controller(l){var s;const r=new bn(l.document,{parser:l.params.parse,props:_t.fromObject({formatter:(s=l.params.format)!==null&&s!==void 0?s:c=>String(c)}),value:Ot(l.params.value),viewProps:l.viewProps});return new te(l.document,{blade:l.blade,props:_t.fromObject({label:l.params.label}),valueController:r})},api:l=>l.controller instanceof te&&l.controller.valueController instanceof bn?new So(l.controller):null};function Ur(l,s,r){if(l.querySelector(`style[data-tp-style=${s}]`))return;const c=l.createElement("style");c.dataset.tpStyle=s,c.textContent=r,l.head.appendChild(c)}const Jo=new class{constructor(l){const[s,r]=l.split("-"),c=s.split(".");this.major=parseInt(c[0],10),this.minor=parseInt(c[1],10),this.patch=parseInt(c[2],10),this.prerelease=r??null}toString(){const l=[this.major,this.minor,this.patch].join(".");return this.prerelease!==null?[l,this.prerelease].join("-"):l}}("3.1.0");R.BladeApi=F,R.ButtonApi=B,R.FolderApi=Hs,R.InputBindingApi=ms,R.ListApi=ii,R.MonitorBindingApi=vs,R.Pane=class extends Kn{constructor(l){var s,r;const c=l??{},_=(s=c.document)!==null&&s!==void 0?s:Qi(),x=function(){const S=new Xi;return[vo,bo,yo,Ao,ge,po,on,Ae,Fi,Qn,fn,pn,zs,Yi,Fo,Wr].forEach(O=>{S.register(O)}),S}();super(new Po(_,{expanded:c.expanded,blade:di(),props:_t.fromObject({title:c.title}),viewProps:Ze.create()}),x),this.pool_=x,this.containerElem_=(r=c.container)!==null&&r!==void 0?r:function(S){const O=S.createElement("div");return O.classList.add(ut("dfw")()),S.body&&S.body.appendChild(O),O}(_),this.containerElem_.appendChild(this.element),this.doc_=_,this.usesDefaultWrapper_=!c.container,this.setUpDefaultPlugins_()}get document(){if(!this.doc_)throw J.alreadyDisposed();return this.doc_}dispose(){const l=this.containerElem_;if(!l)throw J.alreadyDisposed();if(this.usesDefaultWrapper_){const s=l.parentElement;s&&s.removeChild(l)}this.containerElem_=null,this.doc_=null,super.dispose()}registerPlugin(l){("plugin"in l?[l.plugin]:"plugins"in l?l.plugins:[]).forEach(s=>{this.pool_.register(s),this.embedPluginStyle_(s)})}embedPluginStyle_(l){l.css&&Ur(this.document,`plugin-${l.id}`,l.css)}setUpDefaultPlugins_(){Ur(this.document,"default",'.tp-tbiv_b,.tp-coltxtv_ms,.tp-ckbv_i,.tp-rotv_b,.tp-fldv_b,.tp-mllv_i,.tp-sglv_i,.tp-grlv_g,.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw,.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{background-color:var(--btn-bg);border-radius:var(--elm-br);color:var(--btn-fg);cursor:pointer;display:block;font-weight:bold;height:var(--bld-us);line-height:var(--bld-us);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.tp-p2dv_b:hover,.tp-btnv_b:hover,.tp-lstv_s:hover{background-color:var(--btn-bg-h)}.tp-p2dv_b:focus,.tp-btnv_b:focus,.tp-lstv_s:focus{background-color:var(--btn-bg-f)}.tp-p2dv_b:active,.tp-btnv_b:active,.tp-lstv_s:active{background-color:var(--btn-bg-a)}.tp-p2dv_b:disabled,.tp-btnv_b:disabled,.tp-lstv_s:disabled{opacity:.5}.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw{background-color:var(--in-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--bld-us);line-height:var(--bld-us);min-width:0;width:100%}.tp-txtv_i:hover,.tp-p2dpv_p:hover,.tp-colswv_sw:hover{background-color:var(--in-bg-h)}.tp-txtv_i:focus,.tp-p2dpv_p:focus,.tp-colswv_sw:focus{background-color:var(--in-bg-f)}.tp-txtv_i:active,.tp-p2dpv_p:active,.tp-colswv_sw:active{background-color:var(--in-bg-a)}.tp-txtv_i:disabled,.tp-p2dpv_p:disabled,.tp-colswv_sw:disabled{opacity:.5}.tp-mllv_i,.tp-sglv_i,.tp-grlv_g{background-color:var(--mo-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--mo-fg);height:var(--bld-us);scrollbar-color:currentColor transparent;scrollbar-width:thin;width:100%}.tp-mllv_i::-webkit-scrollbar,.tp-sglv_i::-webkit-scrollbar,.tp-grlv_g::-webkit-scrollbar{height:8px;width:8px}.tp-mllv_i::-webkit-scrollbar-corner,.tp-sglv_i::-webkit-scrollbar-corner,.tp-grlv_g::-webkit-scrollbar-corner{background-color:transparent}.tp-mllv_i::-webkit-scrollbar-thumb,.tp-sglv_i::-webkit-scrollbar-thumb,.tp-grlv_g::-webkit-scrollbar-thumb{background-clip:padding-box;background-color:currentColor;border:transparent solid 2px;border-radius:4px}.tp-rotv{--font-family: var(--tp-font-family, Roboto Mono, Source Code Pro, Menlo, Courier, monospace);--bs-br: var(--tp-base-border-radius, 6px);--cnt-h-p: var(--tp-container-horizontal-padding, 4px);--cnt-v-p: var(--tp-container-vertical-padding, 4px);--elm-br: var(--tp-element-border-radius, 2px);--bld-s: var(--tp-blade-spacing, 4px);--bld-us: var(--tp-blade-unit-size, 20px);--bs-bg: var(--tp-base-background-color, #28292e);--bs-sh: var(--tp-base-shadow-color, rgba(0, 0, 0, 0.2));--btn-bg: var(--tp-button-background-color, #adafb8);--btn-bg-a: var(--tp-button-background-color-active, #d6d7db);--btn-bg-f: var(--tp-button-background-color-focus, #c8cad0);--btn-bg-h: var(--tp-button-background-color-hover, #bbbcc4);--btn-fg: var(--tp-button-foreground-color, #28292e);--cnt-bg: var(--tp-container-background-color, rgba(187, 188, 196, 0.1));--cnt-bg-a: var(--tp-container-background-color-active, rgba(187, 188, 196, 0.25));--cnt-bg-f: var(--tp-container-background-color-focus, rgba(187, 188, 196, 0.2));--cnt-bg-h: var(--tp-container-background-color-hover, rgba(187, 188, 196, 0.15));--cnt-fg: var(--tp-container-foreground-color, #bbbcc4);--in-bg: var(--tp-input-background-color, rgba(187, 188, 196, 0.1));--in-bg-a: var(--tp-input-background-color-active, rgba(187, 188, 196, 0.25));--in-bg-f: var(--tp-input-background-color-focus, rgba(187, 188, 196, 0.2));--in-bg-h: var(--tp-input-background-color-hover, rgba(187, 188, 196, 0.15));--in-fg: var(--tp-input-foreground-color, #bbbcc4);--lbl-fg: var(--tp-label-foreground-color, rgba(187, 188, 196, 0.7));--mo-bg: var(--tp-monitor-background-color, rgba(0, 0, 0, 0.2));--mo-fg: var(--tp-monitor-foreground-color, rgba(187, 188, 196, 0.7));--grv-fg: var(--tp-groove-foreground-color, rgba(187, 188, 196, 0.1))}.tp-rotv_c>.tp-cntv.tp-v-lst,.tp-tabv_c .tp-brkv>.tp-cntv.tp-v-lst,.tp-fldv_c>.tp-cntv.tp-v-lst{margin-bottom:calc(-1*var(--cnt-v-p))}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-tabv_c .tp-brkv>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_c{border-bottom-left-radius:0}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-tabv_c .tp-brkv>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_b{border-bottom-left-radius:0}.tp-rotv_c>*:not(.tp-v-fst),.tp-tabv_c .tp-brkv>*:not(.tp-v-fst),.tp-fldv_c>*:not(.tp-v-fst){margin-top:var(--bld-s)}.tp-rotv_c>.tp-sprv:not(.tp-v-fst),.tp-tabv_c .tp-brkv>.tp-sprv:not(.tp-v-fst),.tp-fldv_c>.tp-sprv:not(.tp-v-fst),.tp-rotv_c>.tp-cntv:not(.tp-v-fst),.tp-tabv_c .tp-brkv>.tp-cntv:not(.tp-v-fst),.tp-fldv_c>.tp-cntv:not(.tp-v-fst){margin-top:var(--cnt-v-p)}.tp-rotv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-tabv_c .tp-brkv>.tp-sprv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-rotv_c>.tp-cntv+*:not(.tp-v-hidden),.tp-tabv_c .tp-brkv>.tp-cntv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-cntv+*:not(.tp-v-hidden){margin-top:var(--cnt-v-p)}.tp-rotv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-tabv_c .tp-brkv>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-fldv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-rotv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-tabv_c .tp-brkv>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-fldv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv{margin-top:0}.tp-tabv_c .tp-brkv>.tp-cntv,.tp-fldv_c>.tp-cntv{margin-left:4px}.tp-tabv_c .tp-brkv>.tp-fldv>.tp-fldv_b,.tp-fldv_c>.tp-fldv>.tp-fldv_b{border-top-left-radius:var(--elm-br);border-bottom-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv>.tp-fldv.tp-fldv-expanded>.tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-fldv-expanded>.tp-fldv_b{border-bottom-left-radius:0}.tp-tabv_c .tp-brkv .tp-fldv>.tp-fldv_c,.tp-fldv_c .tp-fldv>.tp-fldv_c{border-bottom-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv>.tp-tabv>.tp-tabv_i,.tp-fldv_c>.tp-tabv>.tp-tabv_i{border-top-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv .tp-tabv>.tp-tabv_c,.tp-fldv_c .tp-tabv>.tp-tabv_c{border-bottom-left-radius:var(--elm-br)}.tp-rotv_b,.tp-fldv_b{background-color:var(--cnt-bg);color:var(--cnt-fg);cursor:pointer;display:block;height:calc(var(--bld-us) + 4px);line-height:calc(var(--bld-us) + 4px);overflow:hidden;padding-left:var(--cnt-h-p);padding-right:calc(4px + var(--bld-us) + var(--cnt-h-p));position:relative;text-align:left;text-overflow:ellipsis;white-space:nowrap;width:100%;transition:border-radius .2s ease-in-out .2s}.tp-rotv_b:hover,.tp-fldv_b:hover{background-color:var(--cnt-bg-h)}.tp-rotv_b:focus,.tp-fldv_b:focus{background-color:var(--cnt-bg-f)}.tp-rotv_b:active,.tp-fldv_b:active{background-color:var(--cnt-bg-a)}.tp-rotv_b:disabled,.tp-fldv_b:disabled{opacity:.5}.tp-rotv_m,.tp-fldv_m{background:linear-gradient(to left, var(--cnt-fg), var(--cnt-fg) 2px, transparent 2px, transparent 4px, var(--cnt-fg) 4px);border-radius:2px;bottom:0;content:"";display:block;height:6px;right:calc(var(--cnt-h-p) + (var(--bld-us) + 4px - 6px)/2 - 2px);margin:auto;opacity:.5;position:absolute;top:0;transform:rotate(90deg);transition:transform .2s ease-in-out;width:6px}.tp-rotv.tp-rotv-expanded .tp-rotv_m,.tp-fldv.tp-fldv-expanded>.tp-fldv_b>.tp-fldv_m{transform:none}.tp-rotv_c,.tp-fldv_c{box-sizing:border-box;height:0;opacity:0;overflow:hidden;padding-bottom:0;padding-top:0;position:relative;transition:height .2s ease-in-out,opacity .2s linear,padding .2s ease-in-out}.tp-rotv.tp-rotv-cpl:not(.tp-rotv-expanded) .tp-rotv_c,.tp-fldv.tp-fldv-cpl:not(.tp-fldv-expanded)>.tp-fldv_c{display:none}.tp-rotv.tp-rotv-expanded .tp-rotv_c,.tp-fldv.tp-fldv-expanded>.tp-fldv_c{opacity:1;padding-bottom:var(--cnt-v-p);padding-top:var(--cnt-v-p);transform:none;overflow:visible;transition:height .2s ease-in-out,opacity .2s linear .2s,padding .2s ease-in-out}.tp-lstv,.tp-coltxtv_m{position:relative}.tp-lstv_s{padding:0 20px 0 4px;width:100%}.tp-lstv_m,.tp-coltxtv_mm{bottom:0;margin:auto;pointer-events:none;position:absolute;right:2px;top:0}.tp-lstv_m svg,.tp-coltxtv_mm svg{bottom:0;height:16px;margin:auto;position:absolute;right:0;top:0;width:16px}.tp-lstv_m svg path,.tp-coltxtv_mm svg path{fill:currentColor}.tp-pndtxtv,.tp-coltxtv_w{display:flex}.tp-pndtxtv_a,.tp-coltxtv_c{width:100%}.tp-pndtxtv_a+.tp-pndtxtv_a,.tp-coltxtv_c+.tp-pndtxtv_a,.tp-pndtxtv_a+.tp-coltxtv_c,.tp-coltxtv_c+.tp-coltxtv_c{margin-left:2px}.tp-btnv_b{width:100%}.tp-btnv_t{text-align:center}.tp-ckbv_l{display:block;position:relative}.tp-ckbv_i{left:0;opacity:0;position:absolute;top:0}.tp-ckbv_w{background-color:var(--in-bg);border-radius:var(--elm-br);cursor:pointer;display:block;height:var(--bld-us);position:relative;width:var(--bld-us)}.tp-ckbv_w svg{bottom:0;display:block;height:16px;left:0;margin:auto;opacity:0;position:absolute;right:0;top:0;width:16px}.tp-ckbv_w svg path{fill:none;stroke:var(--in-fg);stroke-width:2}.tp-ckbv_i:hover+.tp-ckbv_w{background-color:var(--in-bg-h)}.tp-ckbv_i:focus+.tp-ckbv_w{background-color:var(--in-bg-f)}.tp-ckbv_i:active+.tp-ckbv_w{background-color:var(--in-bg-a)}.tp-ckbv_i:checked+.tp-ckbv_w svg{opacity:1}.tp-ckbv.tp-v-disabled .tp-ckbv_w{opacity:.5}.tp-colv{position:relative}.tp-colv_h{display:flex}.tp-colv_s{flex-grow:0;flex-shrink:0;width:var(--bld-us)}.tp-colv_t{flex:1;margin-left:4px}.tp-colv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-colv.tp-colv-cpl .tp-colv_p{overflow:visible}.tp-colv.tp-colv-expanded .tp-colv_p{margin-top:var(--bld-s);opacity:1}.tp-colv .tp-popv{left:calc(-1*var(--cnt-h-p));right:calc(-1*var(--cnt-h-p));top:var(--bld-us)}.tp-colpv_h,.tp-colpv_ap{margin-left:6px;margin-right:6px}.tp-colpv_h{margin-top:var(--bld-s)}.tp-colpv_rgb{display:flex;margin-top:var(--bld-s);width:100%}.tp-colpv_a{display:flex;margin-top:var(--cnt-v-p);padding-top:calc(var(--cnt-v-p) + 2px);position:relative}.tp-colpv_a:before{background-color:var(--grv-fg);content:"";height:2px;left:calc(-1*var(--cnt-h-p));position:absolute;right:calc(-1*var(--cnt-h-p));top:0}.tp-colpv_ap{align-items:center;display:flex;flex:3}.tp-colpv_at{flex:1;margin-left:4px}.tp-svpv{border-radius:var(--elm-br);outline:none;overflow:hidden;position:relative}.tp-svpv_c{cursor:crosshair;display:block;height:calc(var(--bld-us)*4);width:100%}.tp-svpv_m{border-radius:100%;border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;filter:drop-shadow(0 0 1px rgba(0, 0, 0, 0.3));height:12px;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;width:12px}.tp-svpv:focus .tp-svpv_m{border-color:#fff}.tp-hplv{cursor:pointer;height:var(--bld-us);outline:none;position:relative}.tp-hplv_c{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAABCAYAAABubagXAAAAQ0lEQVQoU2P8z8Dwn0GCgQEDi2OK/RBgYHjBgIpfovFh8j8YBIgzFGQxuqEgPhaDOT5gOhPkdCxOZeBg+IDFZZiGAgCaSSMYtcRHLgAAAABJRU5ErkJggg==);background-position:left top;background-repeat:no-repeat;background-size:100% 100%;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;position:absolute;top:50%;width:100%}.tp-hplv_m{border-radius:var(--elm-br);border:rgba(255,255,255,.75) solid 2px;box-shadow:0 0 2px rgba(0,0,0,.1);box-sizing:border-box;height:12px;left:50%;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;top:50%;width:12px}.tp-hplv:focus .tp-hplv_m{border-color:#fff}.tp-aplv{cursor:pointer;height:var(--bld-us);outline:none;position:relative;width:100%}.tp-aplv_b{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:4px 4px;background-position:0 0,2px 2px;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;overflow:hidden;position:absolute;top:50%;width:100%}.tp-aplv_c{bottom:0;left:0;position:absolute;right:0;top:0}.tp-aplv_m{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:12px 12px;background-position:0 0,6px 6px;border-radius:var(--elm-br);box-shadow:0 0 2px rgba(0,0,0,.1);height:12px;left:50%;margin-left:-6px;margin-top:-6px;overflow:hidden;pointer-events:none;position:absolute;top:50%;width:12px}.tp-aplv_p{border-radius:var(--elm-br);border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;bottom:0;left:0;position:absolute;right:0;top:0}.tp-aplv:focus .tp-aplv_p{border-color:#fff}.tp-colswv{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:10px 10px;background-position:0 0,5px 5px;border-radius:var(--elm-br);overflow:hidden}.tp-colswv.tp-v-disabled{opacity:.5}.tp-colswv_sw{border-radius:0}.tp-colswv_b{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border-width:0;cursor:pointer;display:block;height:var(--bld-us);left:0;margin:0;outline:none;padding:0;position:absolute;top:0;width:var(--bld-us)}.tp-colswv_b:focus::after{border:rgba(255,255,255,.75) solid 2px;border-radius:var(--elm-br);bottom:0;content:"";display:block;left:0;position:absolute;right:0;top:0}.tp-coltxtv{display:flex;width:100%}.tp-coltxtv_m{margin-right:4px}.tp-coltxtv_ms{border-radius:var(--elm-br);color:var(--lbl-fg);cursor:pointer;height:var(--bld-us);line-height:var(--bld-us);padding:0 18px 0 4px}.tp-coltxtv_ms:hover{background-color:var(--in-bg-h)}.tp-coltxtv_ms:focus{background-color:var(--in-bg-f)}.tp-coltxtv_ms:active{background-color:var(--in-bg-a)}.tp-coltxtv_mm{color:var(--lbl-fg)}.tp-coltxtv_w{flex:1}.tp-dfwv{position:absolute;top:8px;right:8px;width:256px}.tp-fldv.tp-fldv-not .tp-fldv_b{display:none}.tp-fldv_t{padding-left:4px}.tp-fldv_c{border-left:var(--cnt-bg) solid 4px}.tp-fldv_b:hover+.tp-fldv_c{border-left-color:var(--cnt-bg-h)}.tp-fldv_b:focus+.tp-fldv_c{border-left-color:var(--cnt-bg-f)}.tp-fldv_b:active+.tp-fldv_c{border-left-color:var(--cnt-bg-a)}.tp-grlv{position:relative}.tp-grlv_g{display:block;height:calc(var(--bld-us)*3)}.tp-grlv_g polyline{fill:none;stroke:var(--mo-fg);stroke-linejoin:round}.tp-grlv_t{margin-top:-4px;transition:left .05s,top .05s;visibility:hidden}.tp-grlv_t.tp-grlv_t-a{visibility:visible}.tp-grlv_t.tp-grlv_t-in{transition:none}.tp-grlv.tp-v-disabled .tp-grlv_g{opacity:.5}.tp-grlv .tp-ttv{background-color:var(--mo-fg)}.tp-grlv .tp-ttv::before{border-top-color:var(--mo-fg)}.tp-lblv{align-items:center;display:flex;line-height:1.3;padding-left:var(--cnt-h-p);padding-right:var(--cnt-h-p)}.tp-lblv.tp-lblv-nol{display:block}.tp-lblv_l{color:var(--lbl-fg);flex:1;-webkit-hyphens:auto;-ms-hyphens:auto;hyphens:auto;overflow:hidden;padding-left:4px;padding-right:16px}.tp-lblv.tp-v-disabled .tp-lblv_l{opacity:.5}.tp-lblv.tp-lblv-nol .tp-lblv_l{display:none}.tp-lblv_v{align-self:flex-start;flex-grow:0;flex-shrink:0;width:160px}.tp-lblv.tp-lblv-nol .tp-lblv_v{width:100%}.tp-lstv_s{padding:0 20px 0 4px;width:100%}.tp-lstv_m{color:var(--btn-fg)}.tp-sglv_i{padding:0 4px}.tp-sglv.tp-v-disabled .tp-sglv_i{opacity:.5}.tp-mllv_i{display:block;height:calc(var(--bld-us)*3);line-height:var(--bld-us);padding:0 4px;resize:none;white-space:pre}.tp-mllv.tp-v-disabled .tp-mllv_i{opacity:.5}.tp-p2dv{position:relative}.tp-p2dv_h{display:flex}.tp-p2dv_b{height:var(--bld-us);margin-right:4px;position:relative;width:var(--bld-us)}.tp-p2dv_b svg{display:block;height:16px;left:50%;margin-left:-8px;margin-top:-8px;position:absolute;top:50%;width:16px}.tp-p2dv_b svg path{stroke:currentColor;stroke-width:2}.tp-p2dv_b svg circle{fill:currentColor}.tp-p2dv_t{flex:1}.tp-p2dv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-p2dv.tp-p2dv-expanded .tp-p2dv_p{margin-top:var(--bld-s);opacity:1}.tp-p2dv .tp-popv{left:calc(-1*var(--cnt-h-p));right:calc(-1*var(--cnt-h-p));top:var(--bld-us)}.tp-p2dpv{padding-left:calc(var(--bld-us) + 4px)}.tp-p2dpv_p{cursor:crosshair;height:0;overflow:hidden;padding-bottom:100%;position:relative}.tp-p2dpv_g{display:block;height:100%;left:0;pointer-events:none;position:absolute;top:0;width:100%}.tp-p2dpv_ax{opacity:.1;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_l{opacity:.5;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_m{border:var(--in-fg) solid 1px;border-radius:50%;box-sizing:border-box;height:4px;margin-left:-2px;margin-top:-2px;position:absolute;width:4px}.tp-p2dpv_p:focus .tp-p2dpv_m{background-color:var(--in-fg);border-width:0}.tp-popv{background-color:var(--bs-bg);border-radius:6px;box-shadow:0 2px 4px var(--bs-sh);display:none;max-width:168px;padding:var(--cnt-v-p) var(--cnt-h-p);position:absolute;visibility:hidden;z-index:1000}.tp-popv.tp-popv-v{display:block;visibility:visible}.tp-sprv_r{background-color:var(--grv-fg);border-width:0;display:block;height:2px;margin:0;width:100%}.tp-sldv.tp-v-disabled{opacity:.5}.tp-sldv_t{box-sizing:border-box;cursor:pointer;height:var(--bld-us);margin:0 6px;outline:none;position:relative}.tp-sldv_t::before{background-color:var(--in-bg);border-radius:1px;bottom:0;content:"";display:block;height:2px;left:0;margin:auto;position:absolute;right:0;top:0}.tp-sldv_k{height:100%;left:0;position:absolute;top:0}.tp-sldv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:"";display:block;height:2px;left:0;margin-bottom:auto;margin-top:auto;position:absolute;right:0;top:0}.tp-sldv_k::after{background-color:var(--btn-bg);border-radius:var(--elm-br);bottom:0;content:"";display:block;height:12px;margin-bottom:auto;margin-top:auto;position:absolute;right:-6px;top:0;width:12px}.tp-sldv_t:hover .tp-sldv_k::after{background-color:var(--btn-bg-h)}.tp-sldv_t:focus .tp-sldv_k::after{background-color:var(--btn-bg-f)}.tp-sldv_t:active .tp-sldv_k::after{background-color:var(--btn-bg-a)}.tp-sldtxtv{display:flex}.tp-sldtxtv_s{flex:2}.tp-sldtxtv_t{flex:1;margin-left:4px}.tp-tabv.tp-v-disabled{opacity:.5}.tp-tabv_i{align-items:flex-end;display:flex;overflow:hidden}.tp-tabv.tp-tabv-nop .tp-tabv_i{height:calc(var(--bld-us) + 4px);position:relative}.tp-tabv.tp-tabv-nop .tp-tabv_i::before{background-color:var(--cnt-bg);bottom:0;content:"";height:2px;left:0;position:absolute;right:0}.tp-tabv_c{border-left:var(--cnt-bg) solid 4px;padding-bottom:var(--cnt-v-p);padding-top:var(--cnt-v-p)}.tp-tbiv{flex:1;min-width:0;position:relative}.tp-tbiv+.tp-tbiv{margin-left:2px}.tp-tbiv+.tp-tbiv::before{background-color:var(--cnt-bg);bottom:0;content:"";height:2px;left:-2px;position:absolute;width:2px}.tp-tbiv_b{background-color:var(--cnt-bg);display:block;padding-left:calc(var(--cnt-h-p) + 4px);padding-right:calc(var(--cnt-h-p) + 4px);width:100%}.tp-tbiv_b:hover{background-color:var(--cnt-bg-h)}.tp-tbiv_b:focus{background-color:var(--cnt-bg-f)}.tp-tbiv_b:active{background-color:var(--cnt-bg-a)}.tp-tbiv_b:disabled{opacity:.5}.tp-tbiv_t{color:var(--cnt-fg);height:calc(var(--bld-us) + 4px);line-height:calc(var(--bld-us) + 4px);opacity:.5;overflow:hidden;text-overflow:ellipsis}.tp-tbiv.tp-tbiv-sel .tp-tbiv_t{opacity:1}.tp-txtv{position:relative}.tp-txtv_i{padding:0 4px}.tp-txtv.tp-txtv-fst .tp-txtv_i{border-bottom-right-radius:0;border-top-right-radius:0}.tp-txtv.tp-txtv-mid .tp-txtv_i{border-radius:0}.tp-txtv.tp-txtv-lst .tp-txtv_i{border-bottom-left-radius:0;border-top-left-radius:0}.tp-txtv.tp-txtv-num .tp-txtv_i{text-align:right}.tp-txtv.tp-txtv-drg .tp-txtv_i{opacity:.3}.tp-txtv_k{cursor:pointer;height:100%;left:-3px;position:absolute;top:0;width:12px}.tp-txtv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:"";height:calc(var(--bld-us) - 4px);left:50%;margin-bottom:auto;margin-left:-1px;margin-top:auto;opacity:.1;position:absolute;top:0;transition:border-radius .1s,height .1s,transform .1s,width .1s;width:2px}.tp-txtv_k:hover::before,.tp-txtv.tp-txtv-drg .tp-txtv_k::before{opacity:1}.tp-txtv.tp-txtv-drg .tp-txtv_k::before{border-radius:50%;height:4px;transform:translateX(-1px);width:4px}.tp-txtv_g{bottom:0;display:block;height:8px;left:50%;margin:auto;overflow:visible;pointer-events:none;position:absolute;top:0;visibility:hidden;width:100%}.tp-txtv.tp-txtv-drg .tp-txtv_g{visibility:visible}.tp-txtv_gb{fill:none;stroke:var(--in-fg);stroke-dasharray:1}.tp-txtv_gh{fill:none;stroke:var(--in-fg)}.tp-txtv .tp-ttv{margin-left:6px;visibility:hidden}.tp-txtv.tp-txtv-drg .tp-ttv{visibility:visible}.tp-ttv{background-color:var(--in-fg);border-radius:var(--elm-br);color:var(--bs-bg);padding:2px 4px;pointer-events:none;position:absolute;transform:translate(-50%, -100%)}.tp-ttv::before{border-color:var(--in-fg) transparent transparent transparent;border-style:solid;border-width:2px;box-sizing:border-box;content:"";font-size:.9em;height:4px;left:50%;margin-left:-2px;position:absolute;top:100%;width:4px}.tp-rotv{background-color:var(--bs-bg);border-radius:var(--bs-br);box-shadow:0 2px 4px var(--bs-sh);font-family:var(--font-family);font-size:11px;font-weight:500;line-height:1;text-align:left}.tp-rotv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br);border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br);padding-left:calc(4px + var(--bld-us) + var(--cnt-h-p));text-align:center}.tp-rotv.tp-rotv-expanded .tp-rotv_b{border-bottom-left-radius:0;border-bottom-right-radius:0}.tp-rotv.tp-rotv-not .tp-rotv_b{display:none}.tp-rotv_c>.tp-fldv.tp-v-lst>.tp-fldv_c,.tp-rotv_c>.tp-tabv.tp-v-lst>.tp-tabv_c{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c .tp-fldv.tp-v-vlst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-right-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst{margin-top:calc(-1*var(--cnt-v-p))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst>.tp-fldv_b{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst{margin-top:calc(-1*var(--cnt-v-p))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst>.tp-tabv_i{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv.tp-v-disabled,.tp-rotv .tp-v-disabled{pointer-events:none}.tp-rotv.tp-v-hidden,.tp-rotv .tp-v-hidden{display:none}'),this.pool_.getAll().forEach(l=>{this.embedPluginStyle_(l)}),this.registerPlugin({plugins:[Mr,Zo,Wr,Fr]})}},R.SeparatorApi=At,R.SliderApi=si,R.TabApi=ar,R.TabPageApi=or,R.TextApi=So,R.TpChangeEvent=E,R.VERSION=Jo,Object.defineProperty(R,"__esModule",{value:!0})})(M)},excalibur:P=>{P.exports=f}},m={};function b(P){var M=m[P];if(M!==void 0)return M.exports;var R=m[P]={exports:{}};return w[P].call(R.exports,R,R.exports,b),R.exports}b.n=P=>{var M=P&&P.__esModule?()=>P.default:()=>P;return b.d(M,{a:M}),M},b.d=(P,M)=>{for(var R in M)b.o(M,R)&&!b.o(P,R)&&Object.defineProperty(P,R,{enumerable:!0,get:M[R]})},b.o=(P,M)=>Object.prototype.hasOwnProperty.call(P,M),b.r=P=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(P,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(P,"__esModule",{value:!0})};var T={};return(()=>{b.r(T),b.d(T,{DevTool:()=>F});var P=b("excalibur"),M=b("./node_modules/tweakpane/dist/tweakpane.js"),R=b("./picker-system.ts");class F{constructor(E){this.engine=E,this.pointerPos={x:0,y:0},this.highlightedEntities=[-1],this.selectedEntity=null,this.selectedEntityId=-1,this._previousScenes=[],this._previousScene=null,this.pane=new M.Pane({title:"Excalibur Dev Tools",expanded:!0});const A=document.createElement("style");A.innerText=".excalibur-tweakpane-custom { width: 405px; }",document.head.appendChild(A),this.pane.element.parentElement.classList.add("excalibur-tweakpane-custom"),this._buildMain(),this.tabs=this.pane.addTab({pages:[{title:"Entity"},{title:"Screen"},{title:"Camera"},{title:"Clock"},{title:"Timers"},{title:"Physics"},{title:"Settings"}]}),this.selectedEntityTab=this.tabs.pages[0],this.screenTab=this.tabs.pages[1],this.cameraTab=this.tabs.pages[2],this.clockTab=this.tabs.pages[3],this.timerTab=this.tabs.pages[4],this.physicsTab=this.tabs.pages[5],this.debugTab=this.tabs.pages[6],this._installPickerSystemIfNeeded(E.currentScene),E.debug.transform.showPosition=!0,E.debug.entity.showName=!0,this.selectedEntityFolder=this.selectedEntityTab.addFolder({title:"Selected"}),this._buildScreenTab(),this._buildCameraTab(),this._buildClockTab(),this._buildTimersTab(),this._buildPhysicsTab(),this._buildDebugSettingsTab(),setInterval(()=>{this.update(this)},30),this.addListeners()}addListeners(){this.engine.canvas.addEventListener("click",()=>{this.highlightedEntities[0]!==-1&&this.selectEntityById(this.highlightedEntities[0])})}selectEntityById(E){const A=this.engine;this.selectedEntityId=E,this.selectedEntity=A.currentScene.world.entityManager.getById(E),this._buildEntityUI(this.selectedEntity);const L=this.selectedEntity.get(P.TransformComponent);this._buildTransformUI(L);const V=this.selectedEntity.get(P.MotionComponent);if(this._buildMotionUI(V),this.selectedEntity instanceof P.ParticleEmitter)this._buildParticleEmitterUI(this.selectedEntity);else{const W=this.selectedEntity.get(P.GraphicsComponent);this._buildGraphicsUI(W);const Q=this.selectedEntity.get(P.ColliderComponent),rt=this.selectedEntity.get(P.BodyComponent);this._buildColliderUI(Q,rt)}}update(E){const A=E.engine,L=A.input.pointers.primary.lastWorldPos;this.pointerPos.x=L.x,this.pointerPos.y=L.y,this.pointerPosInput.refresh();const V=[...this.pickerSystem.lastFrameEntityToPointers.keys(),...this.pickerSystem.currentFrameEntityToPointers.keys()];V.length===0&&(V.push(-1),V.push(this.selectedEntityId)),this.highlightedEntities=V,A.debug.filter.useFilter=!0,A.debug.filter.ids=V,this.currentResolution.width===A.screen.resolution.width&&this.currentResolution.height===A.screen.resolution.height&&this.currentViewport.width===A.screen.viewport.width&&this.currentViewport.height===A.screen.viewport.height||(this.resolutionText.dispose(),this.viewportText.dispose(),this.resolutionText=this.screenFolder.addBlade({view:"text",label:"resolution",value:`(${A.screen.resolution.width}x${A.screen.resolution.height})`,parse:W=>String(W),index:0}),this.viewportText=this.screenFolder.addBlade({view:"text",label:"viewport",value:`(${A.screen.viewport.width.toFixed(0)}x${A.screen.viewport.height.toFixed(0)})`,parse:W=>String(W),index:1})),this._buildTimersTab(),this._buildSceneUI()}_installPickerSystemIfNeeded(E){this.pickerSystem=E.world.systemManager.get(R.PickerSystem),this.pickerSystem||(this.pickerSystem=new R.PickerSystem,E.world.systemManager.addSystem(this.pickerSystem))}_buildMain(){this.pane.addInput({debug:!1},"debug").on("change",()=>{this.engine.toggleDebug()}),this.pane.addMonitor(this.engine.clock.fpsSampler,"fps",{view:"graph",label:"fps (0 - 120)",min:0,max:120}),this._buildSceneUI(),this.pointerPos={x:10,y:10},this.pointerPosInput=this.pane.addInput(this,"pointerPos",{label:"pointer pos (world)"}),this.pane.addInput(this,"selectedEntityId",{label:"Select By Id"}).on("change",E=>this.selectEntityById(E.value))}_buildEntityUI(E){var A,L;this.selectedEntityFolder&&(this.selectedEntityFolder.dispose(),this.selectedEntityFolder=this.selectedEntityTab.addFolder({title:"Selected"})),this.selectedEntityFolder.addBlade({view:"text",label:"id",value:E.id.toString(),parse:V=>String(V)}),this.selectedEntityFolder.addInput(this.selectedEntity,"name"),this.selectedEntityFolder.addBlade({view:"text",label:"tags",value:E.tags.join(",")||"none",parse:V=>String(V)}),E instanceof P.Actor&&E.color&&this.selectedEntityFolder.addInput(this.selectedEntity,"color").on("change",V=>{E.color=new P.Color(V.value.r,V.value.g,V.value.b,V.value.a)}),this.selectedEntityFolder.addBlade({view:"text",label:"parent",value:E.parent?`(${(A=E.parent)===null||A===void 0?void 0:A.id}) ${(L=E.parent)===null||L===void 0?void 0:L.name}`:"none",parse:V=>String(V)}),this.selectedEntityFolder.addBlade({view:"list",label:"children",options:E.children.map(V=>({text:`(${V.id}) ${V.name}`,value:V.id})),value:E.children.length?E.children[0].id:"none"}),this.selectedEntityFolder.addButton({title:"Kill Entity"}).on("click",V=>{this.selectedEntity.kill(),this.selectedEntityFolder.dispose(),this.selectedEntityFolder=this.selectedEntityTab.addFolder({title:"Selected"})})}_buildColliderUI(E,A){var L,V;if(E){const W=this.selectedEntityFolder.addFolder({title:"Collider & Body"});W.addBlade({view:"text",label:"type",value:(V=(L=E.get())===null||L===void 0?void 0:L.constructor.name)!==null&&V!==void 0?V:"none",parse:Q=>String(Q)}),A&&(W.addBlade({view:"list",label:"collisionType",options:[P.CollisionType.Active,P.CollisionType.Fixed,P.CollisionType.Passive,P.CollisionType.PreventCollision].map(Q=>({text:Q,value:Q})),value:A.collisionType}).on("change",Q=>{A.collisionType=Q.value}),W.addBlade({view:"list",label:"collisionGroup",options:[P.CollisionGroup.All,...P.CollisionGroupManager.groups].map(Q=>({text:Q.name,value:Q})),value:A.group}).on("change",Q=>{A.group=Q.value}))}}_buildParticleEmitterUI(E){const A=this.selectedEntityFolder.addFolder({title:"Particles"});A.addInput(E,"isEmitting"),A.addInput(E,"emitRate"),A.addInput(E,"fadeFlag"),A.addInput(E,"particleLife",{min:100,max:1e4,step:100}),A.addInput(E,"width"),A.addInput(E,"height"),A.addInput(E,"minVel"),A.addInput(E,"maxVel"),A.addInput(E,"minAngle",{min:0,max:2*Math.PI,step:.1}),A.addInput(E,"maxAngle",{min:0,max:2*Math.PI,step:.1}),A.addInput(E,"minSize"),A.addInput(E,"maxSize"),A.addInput(E,"beginColor"),A.addInput(E,"endColor"),A.addInput(E,"opacity",{min:0,max:1,step:.01}),A.addInput(E,"randomRotation"),A.addInput(E,"particleRotationalVelocity")}_buildGraphicsUI(E){var A;if(E){const L=this.selectedEntityFolder.addFolder({title:"Graphics"});L.addInput(E,"anchor"),L.addInput(E,"opacity",{min:0,max:1,step:.05}),L.addInput(E,"visible");const V=[],W=[],Q=E.current.map(B=>B.graphic),rt=[];let J=0;for(let B in E.graphics)V.push({text:B,value:J++}),W.push(E.graphics[B]),rt.push(E.graphics[B]);let k=0;for(let B of Q)rt.indexOf(B)===-1&&(V.push({text:"anonymous"+k++,value:J}),W.push(B));L.addBlade({view:"list",label:"graphics",options:V,value:W.indexOf((A=E.current[0])===null||A===void 0?void 0:A.graphic)}).on("change",B=>{E.use(W[B.value])})}}_buildMotionUI(E){if(E){const A=this.selectedEntityFolder.addFolder({title:"Motion"});A.addInput(E,"vel"),A.addInput(E,"acc"),A.addInput(E,"angularVelocity",{step:.1}),A.addInput(E,"scaleFactor"),A.addInput(E,"inertia")}}_buildTransformUI(E){if(E){const A=this.selectedEntityFolder.addFolder({title:"Transform"});A.addBlade({view:"list",label:"coord plane",options:[P.CoordPlane.World,P.CoordPlane.Screen].map(k=>({text:k,value:k})),value:E.coordPlane}).on("change",k=>E.coordPlane=k.value);const L=A.addInput(E,"pos"),V=A.addInput(E,"rotation",{min:0,max:2*Math.PI}),W=A.addInput(E,"scale");A.addSeparator();const Q=A.addInput(E,"globalPos",{label:"global pos"}),rt=A.addInput(E,"globalRotation",{label:"global rot",min:0,max:2*Math.PI}),J=A.addInput(E,"globalScale",{label:"global pos"});Q.on("change",()=>L.refresh()),L.on("change",()=>Q.refresh()),rt.on("change",()=>V.refresh()),V.on("change",()=>rt.refresh()),J.on("change",()=>W.refresh()),W.on("change",()=>J.refresh()),A.addInput(E,"z",{label:"z-index"})}}_buildScreenTab(){this.screenFolder=this.screenTab.addFolder({title:"Screen"}),this.currentResolution=this.engine.screen.resolution,this.currentViewport=this.engine.screen.viewport,this.resolutionText=this.screenFolder.addBlade({view:"text",label:"resolution",value:`(${this.engine.screen.resolution.width}x${this.engine.screen.resolution.height})`,parse:L=>String(L),index:0}),this.viewportText=this.screenFolder.addBlade({view:"text",label:"viewport",value:`(${this.engine.screen.viewport.width.toFixed(0)}x${this.engine.screen.viewport.height.toFixed(0)})`,parse:L=>String(L),index:1}),this.screenFolder.addButton({title:"Fullscreen"}).on("click",()=>{this.engine.screen.goFullScreen()}),this.screenFolder.addSeparator();const E=this.screenFolder.addBlade({view:"list",label:"Color Blindness Mode",options:[P.ColorBlindnessMode.Deuteranope,P.ColorBlindnessMode.Protanope,P.ColorBlindnessMode.Tritanope].map(L=>({text:L,value:L})),value:P.ColorBlindnessMode.Deuteranope}),A={simulate:!1};this.screenFolder.addInput(A,"simulate"),this.screenFolder.addButton({title:"Apply"}).on("click",()=>{A.simulate?this.engine.debug.colorBlindMode.simulate(E.value):this.engine.debug.colorBlindMode.correct(E.value)}),this.screenFolder.addButton({title:"Clear"}).on("click",()=>{this.engine.debug.colorBlindMode.clear()})}_buildCameraTab(){const E=this.cameraTab.addFolder({title:"Camera"});E.addInput(this.engine.currentScene.camera,"zoom",{min:.01,max:10,step:.1}),E.addInput(this.engine.currentScene.camera,"pos")}_buildClockTab(){const E=this.clockTab.addFolder({title:"Clock"});let A=this.engine.clock instanceof P.TestClock,L=16;const V=E.addButton({title:"step",disabled:!A,index:2}).on("click",()=>this.engine.clock.step(L));E.addBlade({view:"slider",label:"step (ms)",min:1,max:100,step:16,value:L}).on("change",rt=>L=rt.value),E.addButton({title:"Use Test Clock",index:0}).on("click",()=>{this.engine.debug.useTestClock(),A=!0,V.disabled=!1}),E.addButton({title:"Use Standard Clock",index:1}).on("click",()=>{this.engine.debug.useStandardClock(),A=!1,V.disabled=!0}),this.pane.addSeparator();const W=E.addButton({title:"Stop",disabled:!1}),Q=E.addButton({title:"Start",disabled:!0});W.on("click",()=>{this.engine.clock.stop(),Q.disabled=!1,W.disabled=!0}),Q.on("click",()=>{this.engine.clock.start(),W.disabled=!1,Q.disabled=!0})}_buildTimersTab(){this.timerTab,this._timersFolder&&this._timersFolder.dispose(),this._timersFolder=this.timerTab.addFolder({title:"Timers"});for(let E of this.engine.currentScene.timers){let A=E.repeats&&E.maxNumberOfRepeats===-1?"repeats":E._numberOfTicks+1+" of "+(E.maxNumberOfRepeats===-1?1:E.maxNumberOfRepeats);E.isRunning||(A="stopped"),E.complete&&(A="complete"),this._timersFolder.addBlade({view:"text",label:`timer(${E.id})`,value:`${A} next(${E.timeToNextAction.toFixed(0)}ms)`,parse:L=>String(L)})}}_buildPhysicsTab(){const E=this.physicsTab,A={};for(let V in P.Physics)A[V]=P.Physics[V];E.addInput(A,"enabled").on("change",V=>P.Physics.enabled=V.value),E.addInput(A,"acc");const L=E.addInput(A,"collisionResolutionStrategy");E.addButton({title:"Use Arcade"}).on("click",()=>{P.Physics.useArcadePhysics(),A.collisionResolutionStrategy=P.Physics.collisionResolutionStrategy,L.refresh()}),E.addButton({title:"Use Realistic"}).on("click",()=>{P.Physics.useRealisticPhysics(),A.collisionResolutionStrategy=P.Physics.collisionResolutionStrategy,L.refresh()}),E.addInput(A,"bodiesCanSleepByDefault").on("change",V=>P.Physics.bodiesCanSleepByDefault=V.value),E.addInput(A,"warmStart").on("change",V=>P.Physics.warmStart=V.value),E.addInput(A,"sleepEpsilon",{min:.01,max:2,step:.05}).on("change",V=>P.Physics.sleepEpsilon=V.value),E.addInput(A,"wakeThreshold",{min:.01,max:2,step:.05}).on("change",V=>P.Physics.wakeThreshold=V.value),E.addInput(A,"positionIterations",{min:1,max:30,step:1}).on("change",V=>P.Physics.positionIterations=V.value),E.addInput(A,"velocityIterations",{min:1,max:30,step:1}).on("change",V=>P.Physics.velocityIterations=V.value),E.addInput(A,"checkForFastBodies").on("change",V=>P.Physics.checkForFastBodies=V.value)}_buildDebugSettingsTab(){const E=this.debugTab;for(let A of["entity","transform","motion","body","collider","physics","graphics","camera"]){let L=E.addFolder({title:A});if(this.engine.debug[A]){for(let V in this.engine.debug[A])if(V)if(V.toLocaleLowerCase().includes("color"))L.addInput(this.engine.debug[A],V);else{if(Array.isArray(this.engine.debug[A][V]))continue;L.addInput(this.engine.debug[A],V)}}}}_areArraysEqual(E,A,L){return E.length===A.length&&E.every(L)}_areScenesEqual(E,A){return this._areArraysEqual(E,A,(L,V,W)=>L.value===W[V].value)}_buildSceneUI(){const E=[];let A="";for(let L in this.engine.scenes)this.engine.currentScene===this.engine.scenes[L]&&(A=L),E.push({text:L,value:L});this._previousScene===this.engine.currentScene&&this._areScenesEqual(this._previousScenes,E)||(this._scenePicker&&this._scenePicker.dispose(),this._numberEntitiesBlade&&this._numberEntitiesBlade.dispose(),this._scenePicker=this.pane.addBlade({view:"list",label:"current scene",options:E,value:A,index:2}),this._scenePicker.on("change",L=>{this.engine.goToScene(L.value)}),this._numberEntitiesBlade=this.pane.addBlade({view:"text",label:"number of entities",value:this.engine.currentScene.world.entityManager.entities.length,parse:L=>String(L),index:3}),this._installPickerSystemIfNeeded(this.engine.currentScene),this._previousScene=this.engine.currentScene,this._previousScenes=E)}}})(),T})())})(Du);const Fu=p=>{const{images:y}=p,f=he.getSounds(),w=Object.values({...f,...y});return new va(w)},Uu="/fgj-2023/assets/duck-d4ffca21.jpg",Lu="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAPUAAACVCAYAAACARbw/AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsIAAA7CARUoSoAAAAO4SURBVHhe7d3RUuJAEIZR2Pd/512Cxg2QyCQkk+mec6osb1Xy+bfecP17cwHS+PP9GUhC1JCMqCEZUUMyooZkRA3JiBqSETUkI2pIRtSQjKghGVFDMqKGZEQNyYgakhE1JCNqSEbUHbperz8f5CPqzjyHLO58RM2dsPMQNT+sdg6i5oW4YxM1i4Qdk6j5ldWOR9RcSt7PQdxxiJq7IWxx5yBqHpS+C5Ow2yVqXljt2ETNInHHJGrecpLHImqKWO04RM0q4m6fqNnESd4uUbOZ1W6TqPmYuNsianazJm6OI2p2Z7XPJWoO4SQ/j6g5lJO8PlFThdWuR9RU4ySvQ9RU5yQ/lqg5jdU+hqg5lZN8f9fbD/T9T7QCL9h5GnkE7kqfg5a+5tY0sdSCZlQaq2dmmfOb5gxhl8Q9hC3uV6KmWeLeRtSdKz13z1T6NQr7SxP/KJt7MSI8bNRXGm7Pz4+lJpQh1pJgez7JRU1IpUvcY9iiJiyrPU/UhCfuR6ImjTVxZyZq0ul9tUVNSj2f5KImtR5PclHThZ5WW9R0o5eTXNR0J/tJLmq6lXW1RU3XMp7kooabTHGLGiZKwh60HLao4Un01RY1LIgat6jhjWgnuaihQKTVFjWsECFuUcMGa+KuTdTwgRZXW9TwodZWW9Swk9K4jyZq2EntM3uJqOFDpTHXWnFRw0ZrYq55losaNig9s8/4G1vUsEKr6zwlaigQIeaRqOGNlk/tOaKGBZHWeUrU8CRqzCNRw7foMY9EDTclMQ9ajnkkarqWZZ2nRE2XMsY8EjXdyXRqzxE13ci8zlOiJr1eYh6JmrR6i3kkalIqiXmQKeaRqEml13WeEjUpiPk/URNez6f2HFETlnWeJ2rCEfPvrrdv+vTvuvR8Yn+RHvrS56THkKcsdeei/EIVdDlR07Qh5pKgh5gF/UXUNEnM2zURtReFKTF/pol/lFHPXDCtPAIlMQ88sr9zfnM6p/a+RM1pxHwMUXMKp/ZxRE1V1vl4oqYKMdcjag4n5rpEzWHWrDP7ETW7c2qfS9TsRsxtEDW7KIl5IObjiZqPWOf2iJpNxNwuUbOKmNsnaoqVxDwQ87lEzVvWORZRs0jMMYmaWU7tuETNA+scn6i5E3MeokbMyYiat8Qci6hZZJ1jEjUvxBybqHkg5vhEzZ11zkPUnXkOV8z5eNsdSMZSQzKihmREDcmIGpIRNSQjakhG1JCMqCEZUUMyooZkRA3JiBqSETUkI2pIRtSQjKghGVFDMqKGVC6Xf4n0NTEGboo1AAAAAElFTkSuQmCC",Vu="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAPUAAACVCAYAAACARbw/AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsIAAA7CARUoSoAAAASgSURBVHhe7d1Nbiw1FIDRbpYAU5jB/hf0mMEUtvCIX9qhUqnqdv3b1+dIrSSzSMmXe12K3Pfvb25AGD89PgJBiBqCETUEI2oIRtQQjKghGFFDMKKGYEQNwYgaghE1BCNqCEbUEIyoIRhRQzCihmBEDcGIukP3+/3jRTyi7sw4ZHHH446yzowD/ufX3x+f3W4///Xt8RktE3VnhlEPgx4Sd9us33zx729//HjRJlEzS9htEjVPmdrtETVFxN0OUbOIuOsnaj4pffIt7HqJmi9S2CVxm9p1EjWzxN0mUfNSCvuXv/98fDVP3HUQNUXSPx6WTO1E2NcSNYtYyesnalaxktdL1KyWV3Jx10XUbLb0vC3uY4ma3ZSetxNhH0fU7M5Kfi1Rcwjn7euImkOJ+3yi5hQp7pKwE2FvI2pOY2qfQ9ScTtzHEjWXySu5uPclai6Vwl563hb3c9Xc++1dIs43de93WouvlH4P5u4jH7v6e61VFVEv+UFyrBpCyX/gxb1OFVFbp+pRUyDiXseZmmqleZNeHqYtI2qql5fJJQ/Temb95kML66uV/LVqo3Y+4hlxz7N+06ThSu68/ZmoaVYKexh3iR7CFjXNy3Gb2u9ETRjifidqwhmu5D3GLWpCylM76S1uURPaOO4SrYctarrQ09QWNd3oZSUXNd2JHreo6VYOOykJO2khbFHTtYhTW9TwJlLcooaB8UreYtyihpHh1E5Kwk5qiVvUMGPNSp5cHbao4YXWVnJRQ4GplbzWuEUNC7QQt6hhham4S5wRtqhhgxqntqhho9pWclHDTrbEvSdRw07SXeT5PvKhkrD3JGrYaC7m7Ox3dBU1rFQSc0nQe797iKhhhb1iPuLtgEQNCzybzlfHnIkaCuwRc3JkzJmo4YVXq3aJo6fzkKhhRgur9hRRw0irMWeihofWY85EDW+2xpxcHXMmaro2N52XxlxL0Imo6dKrVbtEbTFnoqY7W1ftWmPORE03tq7atceciZrwtsactBBzJmrC2ivmloJORE1IUzEnkWPORE0oW6dzyzFnoiYEMf9P1DRvS8xJlJgzUdOsqem8NOZoQSeipjnPVu0SUWPO7t+HFxVfZOre47OvVe1VBT/+YlMhJ72u2XOqjZrz1fxLv3Uy98T6zYca/7hOrdpLz829ETVV2iPmHoNORE11tq7avcacVXGmTpyr63BlEFtj5l01UXOOYThTwVwRh5j3Zf3mMinmcdAp5pKgU8yCniZqLrE25kTMz4maU81N5xKmcxlRcwqr9nlEzeHEfC5Rc5jxdBbzOUTN7tbGnIh5O1Gzm60xC3ofomYXw5gTMV9H1GyydjqL+TiiZhUx10vULLI25kTM5xA1xbbELOjziJqXpqZzCTFfQ9TMWrtqi/laomaSmNslaj4ZTufSmBMx10PUfLE0ZkHXxXVGnRmv1WsJuV4mNYuYzPUTNUXE3A5R85KY2yJqZpnObRI1X4i5bZ5+d2juCbiQYxA1BGP9hmBEDcGIGoIRNQQjaghG1BCMqCEYUUMwooZgRA3BiBqCETUEI2oIRtQQjKghGFFDMKKGYEQNodxu/wFizwGyYmH+4AAAAABJRU5ErkJggg==",Ou="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAPUAAACVCAIAAAAPJytoAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAPaSURBVHhe7dzbciI5FEVBM///z251q4KZsWkJsK5HmS/WI65a7CiIsG+fn58fENQ/10+ISN9Epm8i0zeR6ZvI9E1k+iYyfROZvolM30SmbyLTN5Hpm8j0TWT6JjJ9E5m+iUzfRObv0/q63W754DpPoe9e7mXfudTjeT5pL5X9PW6m0Hdjyl6Kvpsx2wvSdwPKXpa+f0rZK9P3+8qz7duSFej7HdWyxb0Ifb9G2XvR9wsKZSfKXpC+n2K2N6XvCmVvTd8lhbITZa9P34+Z7Rj0/ZWyI9H3v5Qdj74vhbITZW9K32Y7sqP7VnZ45/at7BOc2Hd1tq8T+zur72rZ4g7mlL6VfaYj+i6UnSg7sOB9m+3Dhe1b2SQx/39Vuezr1F/hZTDmRkTb7z+rvUTclI1588fpu1q2uA8UoW9l8zfb910oO5lbtvfVdBt/vly5bB76cssG3KMt9/v344gHEp6wWd/K5iU79V0oO1E23+3Rt9nmPav3rWx+Yum+C2UnyqZq0b7NNk0s17eyaWihvpVNc6v0XSg7UTbvmd+32aafmX0rm96m9V0oO1E2TUzo22wzzNC+lc1gg/pWNlOM6LtQdqJs+unbt9lmrl59K5sVdOm7UHaibIZp3LfZZikt+1Y2q+n7+TJRNhN177v8xAJdtey7sNMqZ4rG+11+GpE4g3V5PjHkLKLX83d1yFXOAH0/X6qcufr2nRUSTyROPyP6Tgw5UwzqO1M5gw3tOysknkichib0nRhyxpjTd6ZyepvZd1at/DrB6+b3nRlyelil76Q65CrnVQv1nVUrv07whOX6zgw5TSzad1IdcpVTtW7fWbXy6wSPrN53Zsh5zx59J9UhVznfbdN3pnJeslnfWSHxROLcbdl3Ysh5xq28hVsopzz3F/Q2Kxhwa3bd7/8qX6aJhYl7ugh9JynxQuWpM6mdKUjfmcr5IlTfWSHxROKLKN+mViJ8vvybcsoDfvEvLyDwpV5WwP2+Sz0Vkvr9sGLLo4vcd1at/DoRUfy+M0N+plP6TqpDrvJ4Duo7q1Z+nQjhuL4zQ36IQ/tOqkOu8gDO7TurVn6d2NPpfWeGPCp9X6pDrvId6ft/VB6Mvh8oJJ5IfCP6fsyQx6DvEpXvTt91hcQTia9M308x5JvS9wtUvh19v6yQeCLxpej7HYZ8F5H//nKM51N2qcez3z/1Z8qFuyh9tyHxNem7GUO+IH03pvKl6LsLiS/C9yd93b9dcZ2n0DeReT4hMn0Tmb6JTN9Epm8i0zeR6ZvI9E1k+iYyfROZvolM30SmbyLTN5Hpm8j0TWT6Jq6Pj1/oCzUn3YScTQAAAABJRU5ErkJggg==",zu="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAPUAAACVCAIAAAAPJytoAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAARjSURBVHhe7dxNdhM7FEXhmCFAF3ow/wFBD7owBXOxlMKJbZXk0s/V0f46FC0S1ua+47Ve6nQ+n18AUR/ir4Ai+oYy+oYy+oYy+oYy+oYy+oYy+oYy+oYy+oYy+oYy+oYy+oYy+oYy+oYy/v/vhv58+RYePv78Hh7QGX03sZW9IfEh2Cf13caNUei7JiubuF2h7zp2yz6dTvEJHdF3Bdxst+j7EAaJc/T9pHTZn379iE8Yir6L7ZZN3H7Qd5n0GqFsb+g7F2d7RvS9r7Ts80X8DYai7x1Fg4SyvaHvh5442/EJbtD3HQwSGfT9HmUroe//ds92fHpF2f7R9z8MElX0zSBRtnTfRYOEsme0aN9PDJL4hKks1/cTZRP3vNbqO1G2oWw9q/RddLYpW4Z+308MkviE+Yn3zSBZnGzfDBIYwb4ZJNiovZ8tXXZ8etX0e098JbjW9M11On2ne+p/s+k7X7vEFfaJlZQ+29dxW9ky/6Sxa+6+i8o2lL2aiftOD4DbsjvHzQuRPZhyf5eWHZ+6452aj/z+/DU+XbC/o7kGyYy3Q8xM93uWs41Htv+gcb/fKDrbVjZxI/DeN2XjCNd955dtKBu3nPa9e7bj0wVnG4+465tBgooc9V1UtqFs7PLSd6JswyDBc8b3zSBBOyP7pmy0Nqzv0kESn4ASA/rmbKObrn1TNjrr13d+2YayUUWPvnfPdny64GyjorZ9M0gwVsO+KRvDNem7dJDEJ6C2yn0zSOBKtb4pGw7V6TtRtmGQYJSjfXO24dmhvikbzlX+fBlQNpxo0vf12y1OF/E3QF+H+k68lsUSp3IMd/R+W+JFlccnoIs6+yT9fi0OOUaptr9LDzmVo4PKny+pHK5U7jsorTw+AbU16TtIJG445OigYd+GuYKx2vYdMFcwSo++A+YK+uvXt2GuoLOufQfMFXQzoO8gv3IOOZ42rO8gkbhhruCgwX0b5graGd93wFxBC176DqgcdfnqO0gkbpgryOexb8MhRxVO+w6oHAe57jsomitUjmsT9G3yD7khcWzm6DtgrqDUadKX7+S/8XDgN5j+IrFJT9AjZrrf19J/Ix7mCnF7MGvfhrmCXRP3HVA5Embd33dljvI+3zL7JFN6ah4k1bfx87nz3Vdif7TYX/UUpt8n7zBXcE2t76Co8vAASZp9B+lhxyFfgXLfhrmyOPG+A+bKspboO8isnEOuZKG+g0TihrkiZrm+DXNlHSv2HTBXVrBu3wGVa1u97yCRuLmeK1Q+F/qOMg+5IfGJ0PcbzBUx9H0Hc0UGfd/HXNFA3ynMldnR9z4qnxd950okbpgrPqn9fFoHmT8CtxUf8PNpQ3C/i2XOFXjA/T4k/4fkud9DcL8PSY9yDEffR6XnCsai7zqo3Cf6ronEveHzZRO3nztJfwj6bmirnLhHoW8oY39DGX1DGX1DGX1DGX1DGX1DGX1DGX1DGX1DGX1DGX1DGX1DGX1DGX1DGX1DGX1D18vLX5uSYbWtCGUgAAAAAElFTkSuQmCC",Nu="/fgj-2023/assets/Ground Tileset-94846569.png",Hu="/fgj-2023/assets/Trees-81a1cb9a.png",Xu="/fgj-2023/assets/Cliff-025a7f2b.png",Wu="data:image/png;base64,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",Gu="data:image/png;base64,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",qu="data:image/png;base64,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",ju="data:image/png;base64,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",Qu="data:image/png;base64,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",Ku="data:image/png;base64,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",Zu="data:image/png;base64,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",Ju="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAJAAAADACAYAAADryOpPAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAm3SURBVHhe7d1daB1FFAfwW8WAlpQ8JLWSoNxISSNopH2RSFWq4AfqiygKgiKYgAh+oEhLQYSiiOIHiJAIoiAoii9W1EIVSzH4UrEKpqGYi5KINgFDQhVSpXbO7r80Q8fd7Jm7M5P+f7Ccuxp1dzLnf68l2dMgIiIiIiIiIiIiIiIiIiIiz9bl1Zu+vr6T+cv/NTMz4/2/TfWv/3l5JarEWwpg5/f29sr5hg0bpMLi4mL+KjM7O5u/+n91J1WqCRpq/ZlApKLuop6eHtn5/f39cm7vfBs6oejrJicnpdbV6akmaOj1ZwKRSuXuwM7v7u6Wc3tHF3WwCzq7ruRJNUFjWX8mEKl4SyD46Y3H81dnd8Wjr+WvVpqfn5c6NzdXa/KkmqCxrD8TiFS8JRB2/robR6We/HJMKth/HZ1Qd/LAWkvQUOvPBCKVyhvI7FhzXH7RPw1z/PbzlBxF8HX45/Dvyf92MKaDzWE6Fd16Jvx1fB2YDjZH3feB/17o9WcCkYq3jrl922Z5Tx4bvUPOXUbH9kr99NDR4Klj2NfdO/KKVNdniNnxJ6XGfh8uvq+bCUQq6l141fDNsvOvuvYWOV/46k2pLl07HpH6wzdfZHVi3zndwVqh158JRCqVd5+98y8bGJL6y9RhqWWFTqJUE9S+7rLs75P2PphApFK5e0Zu2pp9ZtiZ/d/J7tZmqQc/eVfq9jsfkOriqwOqqpqgvju4KnxmQyLiulzs78ue5lGpoy9k/7c5vv87JhDVT59A4+Ny3mgdkoId3XPvy1Jd0BEL879LrauDXclZla9OXi0k0GLvsJwXJf7cB09JxX03mtukjI6MSGUCURDqbkFHw8Tvy1IPf/GHVBi+K/uJP2i1WlKPHTtWS8eCKzmvf31CalEnIzkPPJZ1vq9Ormrjxo1yP81mU85h4uPp/FVm6JaLpQ5v6pAK2utlApGKt27p6uqSTujr65Nz2/r16/NXmVAJBHZyHl66IH+VsTvYTtChzhP5q0zdyQOuBDp+/Hj+aqWZmRmpCwsLXq6XCUQq3rsGSdTRsfK99lSn5K8yvjuhqrIdHFuCgiv5T11X/iqzvJx9NvW93kwgUqmte9ApEDp5oGwHx5qgEGp9mUCkEkX3xKCog2NN0NCYQERERERERERERERERERERERR8fYzLZg1UaTdz08+V4Vaf/48EKkU7sayO3u1U25iS6JYEzT29WcCkUrpBBocHJRzW9npNXYnTE9nv/nZ7mcrp56gsa8/E4hUSu8+dAI61aWog6HuBEo1QSHW9WcCkcqqdx86obOzU863914o9fSTr3LX7Ho7f7USOqLu6TapJqgttvVnApFK5d2HTrhtS/Y748/ec4NUe9YEOsHu5LoTCFJNUFss688EIpXKG8j8OYg5fvtzqWEOG+ZSmZ1v7/6QcN1LS0sNcwCuF3PBvn3+ITkg1vsIvf5MIFLx9v5dNO3mplc/lxr6s4PNvm58hsBcMFy3Lfb7sLVr/ZlApOK9e9AJLrHM2bKlmqC2utefCUQq3nYjpt88+uL7cv7L1PdSIfR0m7JSTVDX9CFo1/ozgUhFvQvxxPcjF10p5/asicsGrpaKRAo13aZI0QTAX/Prr3u6UBF79sfur87+Zz5IINzHlr9+lMpZGRRU2zfQey89IceeHRvkiJ3pUHNcdypJzWE+SxRNA4yJSXhz7H37RTnajQlEKt7ex/+d6ZH3YnuqDWZO+J5T5Rs+A3V1b5Lz+59+VerDyx9JxTyx2D4DgWtuG2DWh+8ZH0wgUlHvQjzBfWBgQM4ByYOZE7HPmrAT1J4Hho7G/fjqYK2iWR9Yd3va0NTUlFTt+jOBSMX7BjLJYw7TAeiCFFyydZ0cYCYYmsMkj/15IiX4PuD7gsMXJhCpeHsfXyvTbjDBMPbPbLZQ688EIpUouykGqSRmaEwgIiIiIiIiIiIiIiIiIiIioqh4/xkXPD20iHm+X/6SPKp7/fnzQKTiLQWw8+0nwbue/I6pN0XqTqpUEzTU+jOBSEXdRT092W909vev/J34stNvXF83OTkpta5OTzVBQ68/E4hU2pZA4Opgl7onAqaeoKHXnwlEKt4SqLu7W85dHXnm3AkDz0g8OPu3VMytqCt5YK0kaKj1ZwKRivcEAnQCdr6ZgGNgBsVzH34t9bMj2RM86k4eWCsJGmr9mUCk0rYNZD4rmANzq2yYc2V2fqj0ORtcN5gONgfmiNn3g7ljsd5Hu9efCUQq3jrGfi/e/8StUm2jY3ulxjJzwvUZAnAf9hyx2O+jrvVnApGK9+5JddpNqglq47wwSoq33RhqXpVva3VeGKYmvfHMfVI5L4yioN6F9rywS/Od7ppwg4k9oyMjUmObF4ZZGbgPW2wJenpe2M7sT5p3tzZLReLYkyMPfvKuVM4Loyi0fQNhbhXmWKUCc8IwNwxzxGKHuWyY09ZuTCBS8fY+jie8N5tNObfnMaQ2L+zAY8NS3+q4Wyq6ObV5YfaUnomPp6We3+dn7j0TiFTUuxBPdE99Xpg9I8NOTDO5x/DdwVpY/z7OC6MUedtAZ86iMgfmVKUKc8IwNwzsuWKxw/cB3xffmECk4q2VQs2r8q3oM8WpGvV1Q13rzwQilSi7KQapJGZoTCAiIiIiIiIiIiIiIiIiIiKiqHj7GZdUp9ysFaHWnz8PRCqFu7Hszl7tlJvYkijWBI19/ZlApFI6gQYHB+XcBTvc9aR3wNdNT2e/4Tk3197f8Ew9QWNffyYQqZTefegEu1NdXB0MOJ+fn5fariRKPUEh1vVnApHKqndd0ZPdy3YwtDuBINUEtcW2/kwgUqncNUWdUNa53sFVxbL+TCBSUXdN1U4I1bmQaoLaQq8/E4hUvHVN2U4I3bG2VBPUFmr9mUCkot6F9pSYfe88L9Xl5gd3SY1t5kSqCRp6/ZlApFJ597nmU2EuWFmhkyjVBLWvuyz7+6S9DyYQqVTuHtecKsyj2n7nA1JdQk8wrJqgvju4KkxW7NrxiJzjulzs7wsmJ42+MCa16uwSJhCp6BNofFzOG61DUrCje+59WaoLOqLu6Teu5KzKVyevFhJosTebKlSU+HMfPCUV991obpOinRzJBCIVdbeUnVNla7VaUut+8rsrOa9/fUJqUScjOTFPzFcnV2XPaXPBnAzfc9uYQKTirVtcMybATqRQCQR2cp45kaeMoc4T+atM3ckDrgRyTeaZ8TynjQlEKt67BknU0bHyvRaT88B3J1RVtoNjS1BwJT+mC8HycvbZ1Pd6M4FIpbbuiXX6TdkOjjVBIdT6MoFIJYruiUFRB8eaoKExgUih0fgPPISYVfJZmG0AAAAASUVORK5CYII=",Yu="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAJAAAADACAYAAADryOpPAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAnSSURBVHhe7d1NaFxVFAfwau0iqFgjSpv4UdpGRKvUTJsqqAS1GzutrvwANy6mUXAhLgoVNEQFQURcCJpm4UbwY2cydVMtRQVtbWJRW5Q0RdFGQYxKlYDaqve8+UNz4Doz79x5977k/4PH8cUY3tzc8583SZyzjIiIiIiIiIiIiIiIiGiROqdR27aztvWfxj+KPWP75Gvpj2u+z8PHqTWprP+5jUqUS+6ur26ryA4eH98t5w8/PCr11VeHpE5OnpAKlcpaqfrzdux4Tmp972ShCZRKB+eVyvozgcjE3DXohOHh++QcO93XAfj4yMhbUotOHih7gkLs9WcCkUnu3ad3voYdD7ojIJUkKmuCxl5/JhCZmBOoun2TnFf610lt1eTUjNT6xOGsFtzJZU/QVNafCUQmwTaQ29Hu2HTqIjk0fByflwrf9bjEOfvQUn0cRa8/E4hMgm2gob5+Oc65Y0gO7Hgc+Dg+LzWxOjiUWOvPBCIT8yuHTw89L68Geo78KOe9O1+U+s/72U9swe1+5+Sex6XOblwldfPArkJfvYB+FYOuxHX6rh8fH52ekhrrVSTEXn8mEJkES6CRR8bkfHRou1SfodEJqcOv1KTGSiAoa4JC7PVnApGJuXt6e3ukA57cOifn9S+ukOpTvf47qc/s65Z68uTsku5gq9jrzwQik9y7Dzv/8t4eOe/uznb03as+kNrMa8c2SP3+5KzUWElU1gTV6//QtV9KbeadH2+TOjeXPV7r+jOByCR396xfv046oG/9wt8CTx/Pfkr7xoM/SPWZ/OaM1FidrDv45buOScV1+VTWZD336LvXSo2VoDo5cV0+D7y+Wqrv+3X8+AwTiIpn3kDd3RfL0a6pb07LUTSXnO644foNy9zh7t1w/+a4Tv6/A/Df4evg6zb+dWHyrmPe75vGBCIT8/O27rq1fdlzbLPd/enB7HdIMzmfe/PC9W4ZyH4HNjf3i9RW7930vQQe58FD2ePJey+R17rG49m8JXs8PnicJ6YX/iWB9XqZQGQSrFt6Gq8KNtyQ/XxH04kUK4FAJ+emJh2sHW5cPxSdPOBLICSO9uXn2c+LZgO9amQCkUnwrkESdXV1yTmsa9wbQehOyKvVDk4tQcGX/DPqXmd+fl5q6PVmApFJYd2DToHYyQOtdnCqCQqx1pcJRCZJdE8KmnVwqgkaGxOIiIiIiIiIiIiIiIiIiIiIKCnB/6bFN28rlTlbi13R68+/ByKTYN2PnV2rbZVzwMyJ1OZs+ZQ1QWOtPxOITMzdo3d+syk3seds+ZQ1QWOvPxOITIInUKtSSaKyJ2js9WcCkYm5i/A+y24izNkOX/hb458WwqSb2DMmoOwJGnv9mUBkYu6enXf2SwcM3zso53rWBKbaaKkkUOkTNPL6M4HIxLyBZn85JYc2O/O1HKkbe+JNOXC9biqPOzDpDxMKcaQm9vozgcgk2PN3tdInz8V62g3mamEe18SZP6Smcg+hrxv3EJgLhuvVUrl+iLX+TCAyCd496ATAXC3M46rWbpfKDu6MotefCUQmwbqnuvE82fnjj2Xvzjqp5jfEns7TqrImaLPpPVj/+pG/UYNcNxOITMy7EDt/W99Pcl4bXCEVKmuWS9325s1SwTqnKjQk6H9VzjVMxJn9NQuoUB1s5Zv98fRNH0kFJBAex97pS6VanwmYQGTS8Q109bOXyeHe6b3ZBJ8UvPBRrxwf/nm3HG7GqDv2f3+lHGVxz9hKOTqNCUQmwZ7Hm82cCD2nKjTcA331+1Vy7psnds0F30pN5R4IcC+EmRjXqXfeR/qHnvHBBCIT8y7EO7jfNnirnAM6FzMnUp81oRMU88B0R+PxxJ7SA81mfWDd9f3nBwc+lGpdfyYQmQTfQC553OE6QE+8KRM3wdAdLnn0/USZ4PuA7wuOUJhAZBLseXyxTLvBvVDq92xarPVnApFJkt2UgrIkZmxMICIiIiIiIiIiIiIiIiIiIqKkmP/GBe+zDL6pNpDKdJvFIvb68++ByMS8G6vbKrLTx8d3y7meaqNnTYyN7ZOa2pwtKFuCxl5/JhCZBOsmdMLw8H1yDr7pN6kkUdkTFGKtPxOITMxd5Nv5zaTWyWVP0FjrzwQik2AJVN2evatFpX/h/9EJvmk4mwd2LekOtoq9/kwgMgmeQNpQX79UNwHHwQyKkbcPSN3z3tSS7mCr2OvPBCKTjm8g39wq35yr2PR8MMwNwxwxPB7MGUtdp9efCUQmwe+Btp97vlQ95QaGRiek1ieno947QLN7CDwePUcslccRe/2ZQGQSPIHqY/ul6ik3kErywGJL0KLXnwlEJsF2o55245tXldq8sLInKDSbF4apSTteyt73mvPCKAnmXajnhfU3drrugKc+uUUq3jH94KHsneBTmxfWszK7HDwOLfTEPyvMyOhbv/An6Hvv/1iqnhw5duAvqZwXRkno+AYqam5VKJgLhjlhmBuGOWKpw1w2zGnrNCYQmQR7HtfTbvQ8hqONd3rv6sqmOqc+Lwz3FPqeLfV5YbDWM6WH88IoKeZdiHd0XyzzwnCdOjHd5B4ndAdbYf05L4xKKdgGOnsWlTswp6qsMCcMc8PKCt8HfF9CYwKRSbDn8VjzqkJrdk+Ryr2PFmv9mUBkkmQ3paAsiRkbE4iIiIiIiIiIiIiIiBIW7Pc7vnd8p2LEWn/+LoxMOrZL0RFlSaLFlqBFrT8TiExy705fx+qPa77PS63ji+rgvFJZfyYQmeTuLv2+OlONGRK12lapzWZM9Df+fX0i+/+s6nsnC+30VDo4r1TWnwlEJuauQSdg1oTe+Ro6YWTkLalFJw+UPUEh9vozgcgk9+7THaxnTPg6GNy7wDtLvYPzSmX9mUBkEiyBwDftBrDzIVYClT1BU1l/JhCZBE+gdi31Ds4rlfVnApEJN5DiEub/DlqIG4hMuIHIhBuITMyvHPK+Goj16gXK/ioSYq8/E4hMcm8gN6UHk3osQn2ddrnOk+O/TkQ3tgP/Hb5O48OFSWX9mUBkkrtz9Jyq5ct/ltqq6qVHpcaaYIiuu3HjajnPew/x2ZEfpMa6fkworP90ndRWnT59idTp49nPtvLOLmECkYk5gbYMZJ2Ld0HHjn7jwawzfUJPzmuVb8JfuwmKDgZrJ7cLCYRJkbXBFVJ9Hng9S1rfFCImEEVh7pZW51RpsabeWJOzU52cl57T5oPHeULNL7FeLxOITIJ1i2/GBHR6cl67dHK2O5HncOP6oejkAV8C+SbzhJ7TxgQik+BdgyTCpD9IdWJhqx2cWoKCL/n1rLb5+XmpodebCUQmhXVPqtNvWu3g1Ge+xlpfJhCZJNE9KWjWwakmaGxMIDJYtuxfpBS8S/SXvMQAAAAASUVORK5CYII=",$u="data:image/png;base64,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",tp="data:image/png;base64,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",ep="data:image/png;base64,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",ip="/fgj-2023/assets/berry-f5a45dd4.png",sp="/fgj-2023/assets/talo-65b3ded9.png",np="/fgj-2023/assets/bobby-dd4b3f3c.png",rp="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACMAAACgCAQAAAAs9B2kAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAAmJLR0QA/4ePzL8AAAAHdElNRQfnAgQOITJ84SzEAAAAEGNhTnYAAAAjAAAAIAAAAAAAAAAA33OCNAAAASlJREFUaN7t2EESwiAMBVDicP8rx0UdLSUBPkFF57MtfZO0JsGKphXrtkQhQ+ZPGU1woeWKWJiURKIJ9Ix939TricDpedGAL130evvl+hxjp9TFxI3duyAYAyXZYwbXvj8/MmQ+zOShXd1qb5XmSNWKz2BFL3VS010jA8S5ZanNaPdGO2o5M8g8UGtXrpD2FFB7VwaIAzH35GGiuWdhTUmR9TRzzjzECH5MK1dZU+6bwJglz4YMGTJkzNU6mPitqGpt0ROF2EmN/quT5/4qGh24zYpavIMJ0taLY5JCQHWqOJLCEGNhR4Emo9GZyXFHhgwZMmTexIx8eGn92X/MuBVzSpPsO+4Cge2bFBkyX2NCVcGaIkOGzELG+5aiKbHfkCFDhgwZMr/K3AFYMEMzB+tNNwAAACV0RVh0ZGF0ZTpjcmVhdGUAMjAyMy0wMi0wNFQxNDozMDo0MSswMDowMHMIaWsAAAAldEVYdGRhdGU6bW9kaWZ5ADIwMjMtMDItMDRUMTQ6MzA6NDErMDA6MDACVdHXAAAAAElFTkSuQmCCCg==",op="/fgj-2023/assets/dark-bb41fc0c.png",ap="/fgj-2023/assets/blood-7d12c4c5.png",lp="/fgj-2023/assets/kala-6a7f56fd.png",hp="/fgj-2023/assets/bad_bobby-0801b227.png",cp="/fgj-2023/assets/bad_berry-9d6e98b3.png",dp="/fgj-2023/assets/bad_fishman-254cdf4e.png",up=()=>({duckImage:new St(Uu),house:new St(sp),forward:new St(Lu),treeBoy:new St(ep),forwardActive:new St(Vu),backward:new St(Ou),backwardActive:new St(zu),groundSet:new St(Nu),cliffSet:new St(Xu),rockSet:new St(Wu),treeSet:new St(Hu),characterLavender:new St(Gu),characterShroom:new St(qu),characterGobbo:new St(ju),characterFurry:new St(Qu),characterTryhard:new St(Ku),characterBob:new St(Zu),characterAnimeProtagonist:new St(Ju),characterBlondie:new St(Yu),characterBerry:new St($u),characterTeacher:new St(tp),portraitKala:new St(lp),portraitBerry:new St(ip),portraitBob:new St(np),melee:new St(rp),dark:new St(op),blood:new St(ap),berryMotive:new St(hp),fishManMotive:new St(cp),bobbyMotive:new St(dp)}),pp=p=>({forward:new Jn({image:p.forward}),forwardActive:new Jn({image:p.forwardActive}),backward:new Jn({image:p.backward}),backwardActive:new Jn({image:p.backwardActive}),duck:new Jn({image:p.duckImage})}),fp=()=>{const p=Ea(),y=up(),f=pp(y);return{sounds:p,images:y,graphics:f}},Gi=(p,y)=>ji.fromImageSource({image:y.images[`character${p}`],grid:{rows:4,columns:3,spriteHeight:48,spriteWidth:48},spacing:{margin:{x:0,y:0}}}),_p=p=>ji.fromImageSource({image:p.images.cliffSet,grid:{rows:5,columns:11,spriteHeight:24,spriteWidth:24}}),gp=p=>ji.fromImageSource({image:p.images.melee,grid:{rows:5,columns:1,spriteHeight:32,spriteWidth:35}}),mp=p=>ji.fromImageSource({image:p.images.blood,grid:{rows:4,columns:6,spriteHeight:100,spriteWidth:100}}),vp=p=>ji.fromImageSource({image:p.images.treeSet,grid:{rows:3,columns:6,spriteHeight:110,spriteWidth:69}}),wp=p=>ji.fromImageSource({image:p.images.groundSet,grid:{rows:15,columns:22,spriteHeight:16,spriteWidth:16}}),bp=p=>ji.fromImageSource({image:p.images.house,grid:{rows:1,columns:1,spriteHeight:96,spriteWidth:96}}),xp=p=>ji.fromImageSource({image:p.images.rockSet,grid:{rows:3,columns:2,spriteHeight:32,spriteWidth:32}}),yp=p=>ji.fromImageSourceWithSourceViews({image:p.images.treeBoy,sourceViews:[{x:5,y:0,height:64,width:48},{x:55,y:0,height:64,width:48},{x:106,y:0,height:64,width:48},{x:156,y:0,height:64,width:48},{x:207,y:0,height:64,width:48}]}),Ap=p=>{const y=wp(p),f=vp(p),w=_p(p),m=yp(p),b=bp(p),T=gp(p),P=xp(p),M=mp(p),R=Gi("Lavender",p),F=Gi("Shroom",p),X=Gi("Gobbo",p),E=Gi("Furry",p),A=Gi("Tryhard",p),L=Gi("Bob",p),V=Gi("AnimeProtagonist",p),W=Gi("Blondie",p),Q=Gi("Berry",p),rt=Gi("Teacher",p);return{ground:y,cliff:w,house:b,treeBoy:m,effects:{melee:T,blood:M},rocks:{Rock1:P.getSprite(0,0),Rock2:P.getSprite(0,1),Rock3:P.getSprite(0,2),Rock4:P.getSprite(1,0),Rock5:P.getSprite(1,1),Rock6:P.getSprite(1,2)},trees:{Yellow1:f.getSprite(0,0),Yellow2:f.getSprite(1,0),Yellow3:f.getSprite(2,0),Yellow4:f.getSprite(3,0),Yellow5:f.getSprite(4,0),Yellow6:f.getSprite(5,0),Green1:f.getSprite(0,2),Green2:f.getSprite(1,2),Green3:f.getSprite(2,2),Green4:f.getSprite(3,2),Green5:f.getSprite(4,2),Green6:f.getSprite(5,2),Red1:f.getSprite(0,1),Red2:f.getSprite(1,1),Red3:f.getSprite(2,1),Red4:f.getSprite(3,1),Red5:f.getSprite(4,1),Red6:f.getSprite(5,1)},characters:{Lavender:R,Shroom:F,Gobbo:X,Furry:E,Tryhard:A,Bob:L,AnimeProtagonist:V,Blondie:W,Berry:Q,Teacher:rt}}},Cp=p=>({melee:()=>new ds({frames:[{graphic:p.effects.melee.getSprite(0,0),duration:20},{graphic:p.effects.melee.getSprite(0,1),duration:100},{graphic:p.effects.melee.getSprite(0,2),duration:50},{graphic:p.effects.melee.getSprite(0,3),duration:20},{graphic:p.effects.melee.getSprite(0,4),duration:20}],strategy:ia.End}),blood:()=>new ds({frames:new Array(24).fill(0).map((y,f)=>({graphic:p.effects.blood.getSprite(f%6,Math.floor(f/6)),duration:20})),strategy:ia.End})}),na=(p,y,f)=>{const w=new Ee({pos:f,scale:new bt(1,1),width:300,height:200});return w.graphics.use(p.graphics.forward),w.graphics.add("idle",p.graphics.forward),w.graphics.add("hover",p.graphics.forwardActive),w.on("pointerup",()=>{y()}),w.on("pointerenter",()=>{w.graphics.show("hover")}),w.on("pointerleave",()=>{w.graphics.show("idle")}),w};var Nr=(p=>(p[p.sideMiddle=0]="sideMiddle",p[p.sideTop=1]="sideTop",p[p.sideBottom=2]="sideBottom",p[p.verticalMiddle=3]="verticalMiddle",p[p.verticalLeft=4]="verticalLeft",p[p.verticalTopLeft=5]="verticalTopLeft",p[p.verticalBottomLeft=6]="verticalBottomLeft",p[p.verticalBottom=7]="verticalBottom",p[p.verticalBottomRight=8]="verticalBottomRight",p[p.verticalRight=9]="verticalRight",p[p.verticalTopRight=10]="verticalTopRight",p[p.verticalTop=11]="verticalTop",p))(Nr||{});const Ep=p=>{const y=p.spriteSheets.ground,f=50,w=p.objects.rocks,m=200,b=(m-f)/2,T=p.spriteSheets.cliff;let P=!1;const M=[p.objects.trees.Green1,p.objects.trees.Green2,p.objects.trees.Green3,p.objects.trees.Green4,p.objects.trees.Green5,p.objects.trees.Green6];return{width:140,height:140,resolution:10,detailResolution:2,zValue:10,detailZValue:6,onDeath:kt.Menu,getGroundTile:R=>{R<=f&&(R=f),R>=m&&(R=m-1),R-=f;const F=Math.floor(R/b);return y.getSprite(F*11+1,1)},getDetailTile:(R,F)=>R.b>225&&!P?(P=!0,p.objects.treeBoy(F)):R.b>200?ir(M)(F):R.r>200?ir(Object.values(w))(F):R.g>220?p.objects.house(F):null,getColliderTile:R=>{switch(R){case Nr.sideBottom:return T.getSprite(2,1);default:return T.getSprite(2,1)}}}},Sp=p=>{const y=p.spriteSheets.ground,f=p.objects.rocks,w=50,m=200,b=(m-w)/2,T=p.spriteSheets.cliff;let P=!1;const M=[p.objects.trees.Red1,p.objects.trees.Red2,p.objects.trees.Red3,p.objects.trees.Red4,p.objects.trees.Red5,p.objects.trees.Red6];return{width:140,height:140,resolution:10,detailResolution:2,zValue:10,detailZValue:6,onDeath:kt.Menu,getGroundTile:R=>{R<=w&&(R=w),R>=m&&(R=m-1),R-=w;const F=Math.floor(R/b);return y.getSprite(F*11+1,11)},getDetailTile:(R,F)=>R.b>225&&!P?(P=!0,p.objects.treeBoy(F)):R.b>200?ir(M)(F):R.r>200?ir(Object.values(f))(F):null,getColliderTile:R=>{switch(R){case Nr.sideBottom:return T.getSprite(2,1);default:return T.getSprite(2,1)}}}},Pp=p=>{const y=p.spriteSheets.ground,f=p.objects.rocks,w=50,m=200,b=(m-w)/2,T=p.spriteSheets.cliff;let P=!1;const M=[p.objects.trees.Yellow1,p.objects.trees.Yellow2,p.objects.trees.Yellow3,p.objects.trees.Yellow4,p.objects.trees.Yellow5,p.objects.trees.Yellow6];return{width:140,height:140,resolution:10,detailResolution:2,zValue:10,detailZValue:6,onDeath:kt.Menu,getGroundTile:R=>{R<=w&&(R=w),R>=m&&(R=m-1),R-=w;const F=Math.floor(R/b);return y.getSprite(F*11+1,6)},getDetailTile:(R,F)=>R.b>225&&!P?(P=!0,p.objects.treeBoy(F)):R.b>200?ir(M)(F):R.r>200?ir(Object.values(f))(F):null,getColliderTile:R=>{switch(R){case Nr.sideBottom:return T.getSprite(2,1);default:return T.getSprite(2,1)}}}},ir=p=>p[Math.floor(Math.random()*p.length)],Tp=(p,y,f,w,m,b)=>{let T=0;const P=new Ee({pos:new bt(400,800),scale:new bt(1,1),color:Ai.LightGray,width:1500,height:600}),M=new Os({text:p,font:new Ci({size:40,family:"sans-serif",style:tr.Normal,bold:!0,textAlign:er.Left,baseAlign:$n.Alphabetic})}),R=y.map(V=>new Os({text:V,font:new Ci({size:25,family:"sans-serif",style:tr.Oblique,bold:!1,textAlign:er.Left,baseAlign:$n.Top})})),F=new Ee({pos:new bt(550,-721),scale:new bt(1.2,1.2)});F.graphics.use(w);const X=new Ee({pos:new bt(0,-660),scale:new bt(1.1,1.1)});X.graphics.use(m),X.graphics.opacity=0;const E=new Ee({pos:new bt(30,55)});E.graphics.use(M);const A=new Ee({pos:new bt(30,120)});A.graphics.use(R[0]);const L=na(b,()=>{T++,T===R.length-1&&(X.graphics.opacity=1,F.graphics.opacity=0),T===R.length&&(f(),T=0),A.graphics.use(R[T])},new bt(1200,75));return P.addChild(X),P.addChild(F),P.addChild(E),P.addChild(A),P.addChild(L),P},ra=(p,y,f,w,m,b,T)=>{const P=new Mo,M=Tp(p,y,()=>{switch(console.log(m),m){case kt.Level1:{const R=Xp(b);b.game.addScene(R.key,R.scene);break}case kt.Level2:{console.log("create level2");const R=Gp(b);b.game.addScene(R.key,R.scene);break}case kt.Level3:{const R=jp(b);b.game.addScene(R.key,R.scene);break}}b.game.goToScene(m)},f,w,b.resources);return P.add(M),T&&(P.on("activate",()=>{T.play()}),P.on("deactivate",()=>{T.pause()})),P};var sa={},kp={get exports(){return sa},set exports(p){sa=p}};(function(p){(function(y,f){p.exports?p.exports=f():y.quickNoise=f()})(typeof self<"u"?self:Ru,function(){return function(){function f(F){F||(F=Math.random);const X=new Array(256).fill(1).map(function(E,A){return A});for(let E=X.length-1;E>0;--E){const A=Math.floor(F()*(E+1)),L=X[A];X[A]=X[E],X[E]=L}return X}const w=[1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1];function m(F,X,E){F==null||typeof F=="function"?F=f(F):F.length!==256&&(console.error("create(): Expected array of length 256, got ",F),F=f());for(let L=0;L<256;++L)X[L]=F[L],X[L+256]=F[L];let A=0;for(let L=0;L<X.length;++L){const V=X[L]%12*3;E[A++]=w[V],E[A++]=w[V+1],E[A++]=w[V+2]}}const b=256*2,T=b*3,P=b+T;function M(F){const X=new ArrayBuffer(P),E=new Uint8Array(X,0,b),A=new Int8Array(X,b,T);m(F,E,A);function L(V,W,Q,rt,J,k){rt=rt|0,J=J|0,k=k|0,V=+V,W=+W,Q=+Q;const B=(rt-1&255)>>>0,tt=(J-1&255)>>>0,Y=(k-1&255)>>>0,ut=Math.floor(V),oi=Math.floor(W),j=Math.floor(Q),mt=ut+0&B,ht=ut+1&B,nt=oi+0&tt,Ft=oi+1&tt,ce=j+0&Y,qt=j+1&Y;V-=ut,W-=oi,Q-=j;const Le=((V*6-15)*V+10)*V*V*V,us=((W*6-15)*W+10)*W*W*W,Ot=((Q*6-15)*Q+10)*Q*Q*Q,_t=E[mt],be=E[ht],Jt=E[_t+nt],ct=E[_t+Ft],Qt=E[be+nt],ps=E[be+Ft],ai=E[Jt+ce]*3,pt=E[Jt+qt]*3,se=E[ct+ce]*3,Qe=E[ct+qt]*3,li=E[Qt+ce]*3,Qi=E[Qt+qt]*3,Ki=E[ps+ce]*3,ke=E[ps+qt]*3,hi=A[ai]*(V+0)+A[ai+1]*(W+0)+A[ai+2]*(Q+0),fs=A[pt]*(V+0)+A[pt+1]*(W+0)+A[pt+2]*(Q-1),Zi=A[se]*(V+0)+A[se+1]*(W-1)+A[se+2]*(Q+0),Ve=A[Qe]*(V+0)+A[Qe+1]*(W-1)+A[Qe+2]*(Q-1),de=A[li]*(V-1)+A[li+1]*(W+0)+A[li+2]*(Q+0),_s=A[Qi]*(V-1)+A[Qi+1]*(W+0)+A[Qi+2]*(Q-1),ci=A[Ki]*(V-1)+A[Ki+1]*(W-1)+A[Ki+2]*(Q+0),zs=A[ke]*(V-1)+A[ke+1]*(W-1)+A[ke+2]*(Q-1),Oe=hi+(fs-hi)*Ot,di=Zi+(Ve-Zi)*Ot,Ke=de+(_s-de)*Ot,gs=ci+(zs-ci)*Ot,Si=Oe+(di-Oe)*us,ze=Ke+(gs-Ke)*us;return Si+(ze-Si)*Le}return L}const R=M([23,125,161,52,103,117,70,37,247,101,203,169,124,126,44,123,152,238,145,45,171,114,253,10,192,136,4,157,249,30,35,72,175,63,77,90,181,16,96,111,133,104,75,162,93,56,66,240,8,50,84,229,49,210,173,239,141,1,87,18,2,198,143,57,225,160,58,217,168,206,245,204,199,6,73,60,20,230,211,233,94,200,88,9,74,155,33,15,219,130,226,202,83,236,42,172,165,218,55,222,46,107,98,154,109,67,196,178,127,158,13,243,65,79,166,248,25,224,115,80,68,51,184,128,232,208,151,122,26,212,105,43,179,213,235,148,146,89,14,195,28,78,112,76,250,47,24,251,140,108,186,190,228,170,183,139,39,188,244,246,132,48,119,144,180,138,134,193,82,182,120,121,86,220,209,3,91,241,149,85,205,150,113,216,31,100,41,164,177,214,153,231,38,71,185,174,97,201,29,95,7,92,54,254,191,118,34,221,131,11,163,99,234,81,227,147,156,176,17,142,69,12,110,62,27,255,0,194,59,116,242,252,19,21,187,53,207,129,64,135,61,40,167,237,102,223,106,159,197,189,215,137,36,32,22,5]);return{create:M,noise:R}}()})})(kp);const pa=(p,y,f,w,m)=>{const b=new Array(p).fill(0).map(()=>({r:0,g:0,b:0})),T=sa.create(m);let P=0;for(let M=0;M<y;++M)for(let R=0;R<p;++R){const F=T(R/f,M/f,0+w)+1,X=T(R/f,M/f,1+w)+1,E=T(R/f,M/f,2+w)+1,A=Math.floor(F*128)&255,L=Math.floor(X*128)&255,V=Math.floor(E*128)&255;b[P++]={r:A,g:L,b:V}}return b};function Ip(p,y){let f=0,w=0,m=!1,b=!1,T=!1;return(p.input.keyboard.isHeld(je.Keys.Left)||p.input.keyboard.isHeld(je.Keys.A))&&(f=-1),(p.input.keyboard.isHeld(je.Keys.Right)||p.input.keyboard.isHeld(je.Keys.D))&&(f=1),(p.input.keyboard.isHeld(je.Keys.Up)||p.input.keyboard.isHeld(je.Keys.W))&&(w=-1),(p.input.keyboard.isHeld(je.Keys.Down)||p.input.keyboard.isHeld(je.Keys.S))&&(w=1),p.input.keyboard.isHeld(je.Keys.Space)&&(m=!0),p.input.keyboard.isHeld(je.Keys.E)&&(b=!0),(p.input.keyboard.isHeld(je.Keys.ShiftLeft)||p.input.keyboard.isHeld(je.Keys.ShiftRight))&&(T=!0),{input:Rt(f,w),actions:{meleeAttack:m,dash:T,rangedAttack:b}}}const Rp=Sa;function Sa(){let p=null,y=!1;const f=we(Vt.minStateChangeCooldown,Vt.maxStateChangeCooldown);let w=f;const m=we(Vt.minMeleeAttackCooldown,Vt.maxMeleeAttackCooldown);let b=m;const T=we(Vt.minPreMeleeAttackWait,Vt.maxPreMeleeAttackWait);let P=T;const M=we(Vt.minRangedAttackCooldown,Vt.maxRangedAttackCooldown);let R=M;const F=we(Vt.minMeleeAttackCooldown,Vt.maxMeleeAttackCooldown);let X=F;const E=we(Vt.minDashCooldown,Vt.maxDashCooldown);let A=E;return function(L,V){let W=!1,Q=!1,rt=!1;if(!p){const B=this.scene.actors.find(tt=>tt.name==="Player");B&&(p=B)}if(!p)return null;let J=p.pos.x-this.pos.x,k=p.pos.y-this.pos.y;if(w>0&&(w-=V),b>0&&(b-=V),R>0&&(R-=V),X>0&&(X-=V),A>0&&(A-=V),w<0&&(ea(J,k,Vt.detectionRange)?(y=!0,w=f):(w=f,y=!1)),y){const B=ea(J,k,Vt.hitRange);return!B&&P<T&&(P+=V),!B&&R<0&&Math.random()<Vt.rangedAttackChance&&(Q=!0,R=M),b<0&&B&&(P<0?(b=m,this.meleeAttackReset=!0,W=!0):P-=V),A<0&&ea(J,k,Vt.detectionRange)&&Math.random()<Vt.dashChance&&(A=E,rt=!0),{input:fa(J,k),actions:{meleeAttack:W,dash:rt,rangedAttack:Q},speed:rt?Vt.dashSpeed:Vt.chaseSpeed}}if(X>0)return null;{if(X=F,Math.random()<Vt.chanceToStayStill)return{input:bt.Zero,actions:{meleeAttack:W,dash:rt,rangedAttack:Q},speed:0};const B=Math.random()*Math.PI*2;return J=Math.cos(B)*10,k=Math.sin(B)*10,{input:fa(J,k),actions:{meleeAttack:W,dash:rt,rangedAttack:Q},speed:Vt.normalSpeed}}}}function ea(p,y,f){return Math.abs(p)<f&&Math.abs(y)<f}function fa(p,y){let f=0,w=0;return p<Vt.navigationDirectionThreshold&&(f=-1),p>=-Vt.navigationDirectionThreshold&&(f===-1?f=0:f=1),y<Vt.navigationDirectionThreshold?w=-1:y>=-Vt.navigationDirectionThreshold&&(w===-1?w=0:w=1),Rt(f,w)}const Bp=(p,y,f,w,m)=>{const b=p({name:"boss"});b.isAi=!0,y.add(b),b.stats={...Ue.bossStats},b.pos=Rt(Math.floor(we(500,1e3)),Math.floor(we(500,1e3))),b.AddStatefulLogic(Rp),b.on("kill",()=>{Np(w,m,f)})};function _a(p,y){return p=Math.ceil(p),y=Math.floor(y),Math.floor(Math.random()*(y-p)+p)}const Dp=350,Mp=1850,Fp=350,Up=1850,Lp=(p,y,f)=>{for(let w=0;w<y;w++){const m=p({name:"enemy"});m.isAi=!0,f.add(m),m.stats={...Ue.enemyStats},m.pos=Rt(Math.floor(we(300,1900)),Math.floor(we(300,1900))),m.pos=Rt(_a(Dp,Mp),_a(Fp,Up)),console.log(m.pos.x," : ",m.pos.y),m.AddStatefulLogic(Sa)}},Vp=(p,y)=>{const f=p.drawWidth,w=p.drawHeight,m=new Ee({name:"gameUI",pos:Rt(0,w-qe.height),color:Ai.LightGray,width:f,height:qe.height,z:qe.z}),b=new Ee({pos:Rt(qe.fieldWidth,qe.textYOffset),z:qe.fontZ}),T=new Os({text:"",font:new Ci({size:qe.fontSize})}),P=new Ee({pos:b.pos.add(Rt(qe.fieldWidth,0)),z:qe.fontZ}),M=new Os({text:"",font:new Ci({size:qe.fontSize})}),R=new Ee({pos:P.pos.add(Rt(qe.fieldWidth,0)),z:qe.fontZ}),F=new Os({text:"",font:new Ci({size:qe.fontSize})});return m.on("postupdate",X=>{T.text=`Health: ${Ue.playerStats.health}`,M.text=`Attack: ${Ue.playerStats.attack}`,F.text=`Movement: ${Ue.playerStats.speed}`}),b.graphics.use(T),P.graphics.use(M),R.graphics.use(F),m.addChild(b),m.addChild(P),m.addChild(R),m},Op=(p,y,f,w)=>{const m=new Ee({pos:p,color:Ai.LightGray,width:1500,height:500}),b=new Os({text:y,font:new Ci({size:40})}),T=new Ee({pos:new bt(50,150)}),P=new Os({text:"Go to next level",font:new Ci({size:40})}),M=new Ee({pos:new bt(50,250)});M.graphics.use(P),m.addChild(M),T.graphics.use(b),m.addChild(T);const R=na(w,f,Rt(50,300));return m.addChild(R),m},oa=(p,y,f,w,m,b,T,P)=>{const M=new Mo,R=Hp(m,M,b);M.add(R),M.add(p),p.AddLogic(Ip),M.camera.strategy.elasticToActor(p,.1,.1),M.camera.zoom=4,p.onPostKill=F=>zp(m,b.onDeath);for(const F of y)Lp(F,5,M);return Bp(f,M,T,p,m),P&&(M.on("activate",()=>{P.play()}),M.on("deactivate",()=>{P.pause()})),M},zp=(p,y=kt.Menu)=>{p.game.goToScene(y)},Np=(p,y,f)=>{y.game.currentScene.entities.forEach(b=>{b.active=!1});const w=Ue.LevelUp(),m=Op(Rt(200,100),w,()=>{switch(console.log(f),f){case kt.Dialog1:{const b=Pa(y);y.game.addScene(b.key,b.scene);break}case kt.Dialog2:{console.log("create dialog 2");const b=Wp(y);y.game.addScene(b.key,b.scene);break}case kt.Dialog3:{const b=qp(y);y.game.addScene(b.key,b.scene);break}}y.game.goToScene(f),m.kill()},y.resources);y.game.currentScene.add(m)},Hp=(p,y,f)=>{var P;const w=new xa({pos:Rt(0,0),tileWidth:da.width,tileHeight:da.height,columns:f.height,rows:f.width});w.z=-1;const m=pa(w.columns,w.rows,f.resolution,f.zValue),b=pa(w.columns,w.rows,f.detailResolution,f.detailZValue);for(let M=0;M<w.tiles.length;M++){const R=w.tiles[M],F=m[M],X=M%f.width,E=Math.floor(M/f.width),A=((P=f.getGroundTile(F.r))==null?void 0:P.clone())??p.resources.images.duckImage.toSprite();A.tint=Ai.fromRGB(F.r,F.g,F.b,1).lighten(1.5),R.addGraphic(A),(E===19||E===119||X===19||X===119)&&E>=19&&E<=119&&X>=19&&X<=119&&(R.addGraphic(f.getColliderTile(Nr.sideBottom)),R.solid=!0);const L=f.getDetailTile(b[M],R.pos);L&&y.add(L)}const T=Vp(p.game,p.resources);return y.add(T),w},aa={collisionType:qi.Active},Pa=p=>{const y=he.getSounds();return{key:kt.Dialog1,scene:ra("Berry",["I can't believe it, just a few moments ago I was enjoying my lollipop in the park.","Then a stranger came and took it away from me, just like that.","I'm so angry, I feel violated and frustrated.","At that moment, I swore to myself...","I swore that I would never let anyone treat me like that again.","I won't stand here and do nothing.","I won't let this stranger get away with what they did.","I won't let them treat me with disrespect and steal what's rightfully mine.","I'm going to get my lollipop back.","I'm going to chase after that stranger and make them pay for what they did to me.","I won't let them bully me or think that they can take advantage of me.","I'm not a weak little kid anymore, I'm brave and determined.","So watch out, stranger, because I'm coming for you.","And when I find you, you'll regret ever taking my lollipop."],p.resources.images.portraitBerry.toSprite(),p.resources.images.berryMotive.toSprite(),kt.Level1,p,y.gameMusicLoop)}},Xp=p=>{const y=Ep(p),f=he.getSounds();return{key:kt.Level1,scene:oa(p.objects.characters.Berry({...aa,pos:Rt(Math.floor(we(300,1900)),Math.floor(we(300,1900)))}),[p.objects.characters.Blondie,p.objects.characters.Teacher,p.objects.characters.Furry,p.objects.characters.Shroom],p.objects.characters.Bob,void 0,p,y,kt.Dialog2,f.gameMusicLoop)}},Wp=p=>{const y=he.getSounds();return{key:kt.Dialog2,scene:ra("Bobby",["Allow me to introduce myself, I am Bobby.","A man of simple origins but with a steadfast resolve.","I recently bore witness to a most distasteful spectacle.","A fish man who saw fit to instill fear and trepidation in the hearts of innocent children.","Such an act is wholly unacceptable and will not be tolerated under my watch.","I am not intimidated by the fish man's physical prowess.","I believe in the power of principle and justice.","I shall stand in defiance of his unjust actions.","I ensure that the children of this community are protected from his nefarious machinations.","I am determined to bring the fish man to heel.","And make him answer for his reprehensible behavior.","He shall learn that one cannot use their strength to bully and oppress others with impunity.","Therefore, I caution the fish man, for I am coming for him.","And when I find him, he shall rue the day he ever thought to threaten the innocent."],p.resources.images.portraitBob.toSprite(),p.resources.images.bobbyMotive.toSprite(),kt.Level2,p,y.gameMusicLoop)}},Gp=p=>{const y=Sp(p),f=he.getSounds();return{key:kt.Level2,scene:oa(p.objects.characters.Bob({...aa,pos:Rt(Math.floor(we(300,1900)),Math.floor(we(300,1900)))}),[p.objects.characters.Blondie,p.objects.characters.Tryhard,p.objects.characters.Furry,p.objects.characters.Shroom],p.objects.characters.Gobbo,void 0,p,y,kt.Dialog3,f.gameMusicLoop)}},qp=p=>{const y=he.getSounds(),f=p.resources.images.fishManMotive.toSprite();return f.scale=Rt(.55,.55),{key:kt.Dialog3,scene:ra("Fish man",["I'm the fish man, fierce and grand, Ruler of the seas and ocean land.","A pearl was stolen, this I can't condone,  And I'll make sure the thief atones.","Not cruel or mean, just upholding right,  Bringing balance to the ocean's sight.","With strength and might, I'll make them see,  The error of their ways, just wait and see.","So child, beware, I'm on your track,  And when I find you, you'll feel the smack!","For thieving's wrong, and this you'll learn,  And regret will be your constant yearn."],p.resources.images.portraitKala.toSprite(),f,kt.Level3,p,y.gameMusicLoop)}},jp=p=>{const y=Pp(p),f=he.getSounds();return{key:kt.Level3,scene:oa(p.objects.characters.Gobbo({...aa,pos:Rt(Math.floor(we(300,1900)),Math.floor(we(300,1900)))}),[p.objects.characters.Blondie,p.objects.characters.Lavender,p.objects.characters.Furry,p.objects.characters.Shroom],p.objects.characters.Berry,void 0,p,y,kt.Dialog1,f.gameMusicLoop)}},Qp=(p,y)=>{const{canvasHeight:f,canvasWidth:w}=p.game,m={key:kt.Menu,scene:new Mo},b=new Ee,T=p.resources.images.dark.toSprite(),P=1024,M=1024,R=w/P,F=f/M;T.scale=Rt(R,F),b.graphics.add(T),m.scene.add(b);const X=new Bo({text:`Root Causers
Best game FGJ-2023`,pos:new bt(1020,460),font:new Ci({size:75,family:"sans-serif",style:tr.Oblique,bold:!0,textAlign:er.Center,baseAlign:$n.Alphabetic,direction:Ro.LeftToRight,color:Ai.White,shadow:{blur:10,offset:new bt(10,10),color:Ai.Black}})}),E=new Bo({text:"Play game",pos:new bt(795,780),font:new Ci({size:30,family:"sans-serif",style:tr.Normal,bold:!1,textAlign:er.Center,baseAlign:$n.Alphabetic,direction:Ro.LeftToRight,lineWidth:100,shadow:{blur:2,offset:new bt(3,3),color:Ai.Black}})}),A=new Bo({text:`Esc returns to menu
WASD/Arrows to move
Space to attack
E to throw rock
Shift to dash`,pos:new bt(150,20),font:new Ci({size:20,padding:10,family:"sans-serif",style:tr.Normal,bold:!1,textAlign:er.Center,baseAlign:$n.Alphabetic,direction:Ro.LeftToRight,shadow:{blur:2,offset:new bt(3,3),color:Ai.Black}})}),L=new Ee({pos:new bt(1e3,825),width:300,height:125,color:Ai.DarkGray});L.addChild(A),m.scene.add(X),m.scene.add(E),m.scene.add(L);const V=na(p.resources,()=>{const W=Pa(p);p.game.addScene(W.key,W.scene),p.game.goToScene(kt.Dialog1)},new bt(700,800));return m.scene.add(V),y&&(m.scene.on("activate",()=>{y.play()}),m.scene.on("deactivate",()=>{y.pause()})),m},Kp=()=>{const p=ou(),y=fp(),f=Ap(y),w=Cp(f),m=Iu(p,y,f,w),b={game:p,objects:m,resources:y,spriteSheets:f,animations:w},T=Fu(y),P=Qp(b,he.getSounds().menuMusicLoop);p.addScene(P.key,P.scene),p.start(T).then(()=>p.goToScene(kt.Menu))},Zp=()=>{const p=document.getElementById("app");if(!p)throw"Document main must have id 'app'!";p.className="siteMain";const y=document.createElement("canvas");y.id=Aa,p.appendChild(y)};new he;new Ue;Zp();Kp();
